# é«˜çº§ç±»å‹ç‰¹æ€§

> **åˆ›å»ºæ—¥æœŸ**: 2025-01-27
> **æœ€åæ›´æ–°**: 2025-01-27
> **Rust ç‰ˆæœ¬**: 1.91.0 (Edition 2024) âœ…
> **çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­

---

## ğŸ“Š ç›®å½•

- [é«˜çº§ç±»å‹ç‰¹æ€§](#é«˜çº§ç±»å‹ç‰¹æ€§)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ ç ”ç©¶ç›®æ ‡](#-ç ”ç©¶ç›®æ ‡)
    - [æ ¸å¿ƒé—®é¢˜](#æ ¸å¿ƒé—®é¢˜)
    - [é¢„æœŸæˆæœ](#é¢„æœŸæˆæœ)
  - [ğŸ“š ç†è®ºåŸºç¡€](#-ç†è®ºåŸºç¡€)
    - [GATs (Generic Associated Types)](#gats-generic-associated-types)
    - [const æ³›å‹](#const-æ³›å‹)
    - [ä¾èµ–ç±»å‹](#ä¾èµ–ç±»å‹)
  - [ğŸ”¬ å½¢å¼åŒ–å®šä¹‰](#-å½¢å¼åŒ–å®šä¹‰)
    - [1. GATs å½¢å¼åŒ–](#1-gats-å½¢å¼åŒ–)
    - [2. const æ³›å‹å½¢å¼åŒ–](#2-const-æ³›å‹å½¢å¼åŒ–)
    - [3. ä¾èµ–ç±»å‹å…³ç³»](#3-ä¾èµ–ç±»å‹å…³ç³»)
  - [âœ… è¯æ˜ç›®æ ‡](#-è¯æ˜ç›®æ ‡)
    - [å¾…è¯æ˜çš„æ€§è´¨](#å¾…è¯æ˜çš„æ€§è´¨)
    - [è¯æ˜æ–¹æ³•](#è¯æ˜æ–¹æ³•)
  - [ğŸ’» ä»£ç ç¤ºä¾‹](#-ä»£ç ç¤ºä¾‹)
    - [ç¤ºä¾‹ 1: GATs åŸºç¡€](#ç¤ºä¾‹-1-gats-åŸºç¡€)
    - [ç¤ºä¾‹ 2: const æ³›å‹](#ç¤ºä¾‹-2-const-æ³›å‹)
    - [ç¤ºä¾‹ 3: ç±»å‹æ—](#ç¤ºä¾‹-3-ç±»å‹æ—)
  - [ğŸ“– å‚è€ƒæ–‡çŒ®](#-å‚è€ƒæ–‡çŒ®)
    - [å­¦æœ¯è®ºæ–‡](#å­¦æœ¯è®ºæ–‡)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [ç›¸å…³ä»£ç ](#ç›¸å…³ä»£ç )
    - [å·¥å…·èµ„æº](#å·¥å…·èµ„æº)
  - [ğŸ”„ ç ”ç©¶è¿›å±•](#-ç ”ç©¶è¿›å±•)
    - [å·²å®Œæˆ âœ…](#å·²å®Œæˆ-)
    - [è¿›è¡Œä¸­ ğŸ”„](#è¿›è¡Œä¸­-)
    - [è®¡åˆ’ä¸­ ğŸ“‹](#è®¡åˆ’ä¸­-)

---

## ğŸ¯ ç ”ç©¶ç›®æ ‡

æœ¬ç ”ç©¶çš„ç›®çš„æ˜¯æ·±å…¥åˆ†æ Rust çš„é«˜çº§ç±»å‹ç‰¹æ€§ï¼ŒåŒ…æ‹¬ GATsã€const æ³›å‹å’Œä¾èµ–ç±»å‹çš„å…³ç³»ã€‚

### æ ¸å¿ƒé—®é¢˜

1. **GATs çš„ç±»å‹ç†è®º**: GATs çš„ç±»å‹ç†è®ºåŸºç¡€æ˜¯ä»€ä¹ˆï¼Ÿ
2. **const æ³›å‹å½±å“**: const æ³›å‹å¦‚ä½•å½±å“ç±»å‹ç³»ç»Ÿï¼Ÿ
3. **ä¾èµ–ç±»å‹å…³ç³»**: Rust ä¸ä¾èµ–ç±»å‹çš„å…³ç³»å¦‚ä½•ï¼Ÿ

### é¢„æœŸæˆæœ

- GATs çš„å®Œæ•´ç±»å‹ç†è®ºæ¨¡å‹
- const æ³›å‹çš„ç±»å‹ç³»ç»Ÿå½±å“åˆ†æ
- Rust ä¸ä¾èµ–ç±»å‹çš„å¯¹æ¯”ç ”ç©¶

---

## ğŸ“š ç†è®ºåŸºç¡€

### GATs (Generic Associated Types)

**å®šä¹‰**: GATs å…è®¸åœ¨å…³è”ç±»å‹å£°æ˜ä¸­ä½¿ç”¨æ³›å‹å‚æ•°ï¼Œæä¾›é«˜é˜¶ç±»å‹æŠ½è±¡èƒ½åŠ›ã€‚

**ç±»å‹ç†è®ºè§£é‡Š**: GATs å¯ä»¥è§†ä¸ºç±»å‹æ—ï¼ˆType Familiesï¼‰çš„å®ç°ï¼Œç±»å‹æ—æ˜¯å‚æ•°åŒ–çš„ç±»å‹çº§å‡½æ•°ã€‚

### const æ³›å‹

**å®šä¹‰**: const æ³›å‹å…è®¸ä½¿ç”¨å¸¸é‡å€¼ä½œä¸ºæ³›å‹å‚æ•°ï¼Œæä¾›å€¼çº§åˆ«çš„æ³›å‹èƒ½åŠ›ã€‚

**ç±»å‹ç³»ç»Ÿå½±å“**: const æ³›å‹æ‰©å±•äº†ç±»å‹ç³»ç»Ÿçš„è¡¨è¾¾èƒ½åŠ›ï¼Œå…è®¸ç±»å‹ä¾èµ–äºå¸¸é‡å€¼ã€‚

### ä¾èµ–ç±»å‹

**å®šä¹‰**: ä¾èµ–ç±»å‹æ˜¯ç±»å‹ä¾èµ–äºå€¼çš„ç±»å‹ç³»ç»Ÿç‰¹æ€§ã€‚

**ä¸ Rust çš„å…³ç³»**: Rust é€šè¿‡ const æ³›å‹å’Œ GATs æä¾›äº†å—é™çš„ä¾èµ–ç±»å‹èƒ½åŠ›ã€‚

---

## ğŸ”¬ å½¢å¼åŒ–å®šä¹‰

### 1. GATs å½¢å¼åŒ–

**å®šä¹‰ 1.1 (GAT)**: æ³›å‹å…³è”ç±»å‹ $A[P_1, \ldots, P_n]$ æ˜¯ä¸€ä¸ªç±»å‹çº§å‡½æ•°ï¼š
$$A : \text{Type}_1 \times \cdots \times \text{Type}_n \to \text{Type}$$

å…¶ä¸­ $P_i$ å¯ä»¥æ˜¯ç±»å‹å‚æ•°æˆ–ç”Ÿå‘½å‘¨æœŸå‚æ•°ã€‚

**å®šä¹‰ 1.2 (GAT å®ä¾‹åŒ–)**: å¯¹äº GAT $A[P]$ å’Œå…·ä½“å‚æ•° $T$ï¼Œå®ä¾‹åŒ– $A[T]$ è¡¨ç¤ºå°† $T$ ä»£å…¥ $A$ å¾—åˆ°çš„å…·ä½“ç±»å‹ã€‚

**å®šä¹‰ 1.3 (GAT çº¦æŸ)**: GAT çº¦æŸ $A[P] : B[P]$ è¡¨ç¤ºå¯¹äºæ‰€æœ‰ $P$ï¼Œ$A[P]$ æ˜¯ $B[P]$ çš„å­ç±»å‹ã€‚

### 2. const æ³›å‹å½¢å¼åŒ–

**å®šä¹‰ 2.1 (const æ³›å‹)**: const æ³›å‹ç±»å‹ $T[N]$ æ˜¯ä¸€ä¸ªä¾èµ–äºå¸¸é‡å€¼ $N$ çš„ç±»å‹ï¼š
$$T : \text{Const} \to \text{Type}$$

**å®šä¹‰ 2.2 (const å‚æ•°)**: const å‚æ•° $N$ å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œç±»å‹ä¸ºæ•´æ•°ã€å¸ƒå°”æˆ–å­—ç¬¦ã€‚

**å®šä¹‰ 2.3 (const æ³›å‹çº¦æŸ)**: const æ³›å‹çº¦æŸ $N : \text{Const}$ è¡¨ç¤º $N$ å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ã€‚

### 3. ä¾èµ–ç±»å‹å…³ç³»

**å®šä¹‰ 3.1 (å—é™ä¾èµ–ç±»å‹)**: Rust é€šè¿‡ const æ³›å‹å’Œ GATs æä¾›å—é™çš„ä¾èµ–ç±»å‹èƒ½åŠ›ï¼š
$$\text{DependentType} \subseteq \text{ConstGeneric} \cup \text{GAT}$$

**å®šä¹‰ 3.2 (ç±»å‹æ—)**: GATs å®ç°ç±»å‹æ—ï¼Œç±»å‹æ—æ˜¯å‚æ•°åŒ–çš„ç±»å‹çº§å‡½æ•°ï¼š
$$\text{TypeFamily} : \text{Param} \to \text{Type}$$

---

## âœ… è¯æ˜ç›®æ ‡

### å¾…è¯æ˜çš„æ€§è´¨

1. **GATs ç±»å‹å®‰å…¨**: GATs çš„ä½¿ç”¨æ˜¯ç±»å‹å®‰å…¨çš„
2. **const æ³›å‹æ­£ç¡®æ€§**: const æ³›å‹çš„ç±»å‹æ£€æŸ¥æ˜¯æ­£ç¡®çš„
3. **ä¾èµ–ç±»å‹å…³ç³»**: Rust çš„ä¾èµ–ç±»å‹èƒ½åŠ›æ˜¯å—é™ä½†å®‰å…¨çš„

### è¯æ˜æ–¹æ³•

- **ç±»å‹æ¨å¯¼**: è¯æ˜ GATs å’Œ const æ³›å‹çš„ç±»å‹æ¨å¯¼
- **ç±»å‹æ£€æŸ¥**: è¯æ˜ç±»å‹æ£€æŸ¥çš„æ­£ç¡®æ€§
- **è¯­ä¹‰è¯æ˜**: è¯æ˜è¯­ä¹‰çš„æ­£ç¡®æ€§

---

## ğŸ’» ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1: GATs åŸºç¡€

```rust
trait Iterator {
    type Item<'a> where Self: 'a;

    fn next<'a>(&'a mut self) -> Option<Self::Item<'a>>;
}

struct MyIterator {
    data: Vec<i32>,
    index: usize,
}

impl Iterator for MyIterator {
    type Item<'a> = &'a i32 where Self: 'a;

    fn next<'a>(&'a mut self) -> Option<Self::Item<'a>> {
        if self.index < self.data.len() {
            let item = &self.data[self.index];
            self.index += 1;
            Some(item)
        } else {
            None
        }
    }
}
```

**å½¢å¼åŒ–æè¿°**:

- $\text{Iterator} = \{\text{Item} : \text{Lifetime} \to \text{Type}, \text{next} : \&mut \text{Self} \to \text{Option}(\text{Item})\}$
- $\text{MyIterator} : \text{Iterator}$
- $\text{Item}['a] = \&'a \text{i32}$

### ç¤ºä¾‹ 2: const æ³›å‹

```rust
struct Array<T, const N: usize> {
    data: [T; N],
}

impl<T, const N: usize> Array<T, N> {
    fn new() -> Self {
        Array {
            data: [unsafe { std::mem::zeroed() }; N],
        }
    }

    fn len(&self) -> usize {
        N
    }
}

fn main() {
    let arr: Array<i32, 10> = Array::new();
    println!("é•¿åº¦: {}", arr.len());  // è¾“å‡º: é•¿åº¦: 10
}
```

**å½¢å¼åŒ–æè¿°**:

- $\text{Array} : \text{Type} \times \text{Const} \to \text{Type}$
- $\text{Array}[\text{i32}, 10]$ è¡¨ç¤ºé•¿åº¦ä¸º 10 çš„ i32 æ•°ç»„ç±»å‹
- const å‚æ•° $N$ å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡

### ç¤ºä¾‹ 3: ç±»å‹æ—

```rust
trait Family {
    type Member<T>;
}

struct VecFamily;

impl Family for VecFamily {
    type Member<T> = Vec<T>;
}

fn use_family<F: Family>() -> F::Member<i32> {
    // ä½¿ç”¨ç±»å‹æ—
    todo!()
}
```

**å½¢å¼åŒ–æè¿°**:

- $\text{Family} = \{\text{Member} : \text{Type} \to \text{Type}\}$
- $\text{VecFamily} : \text{Family}$
- $\text{Member}[\text{i32}] = \text{Vec}[\text{i32}]$

---

## ğŸ“– å‚è€ƒæ–‡çŒ®

### å­¦æœ¯è®ºæ–‡

1. **Generic Associated Types**
   - ä½œè€…: Rust å›¢é˜Ÿ
   - å¹´ä»½: 2022
   - æ‘˜è¦: GATs çš„ RFC å’Œå®ç°

2. **Const Generics**
   - ä½œè€…: Rust å›¢é˜Ÿ
   - å¹´ä»½: 2021
   - æ‘˜è¦: const æ³›å‹çš„ RFC å’Œå®ç°

3. **Dependent Types in Rust**
   - ä½œè€…: ç ”ç©¶ç¤¾åŒº
   - æ‘˜è¦: Rust ä¸ä¾èµ–ç±»å‹çš„å…³ç³»

### å®˜æ–¹æ–‡æ¡£

- [GATs RFC](https://github.com/rust-lang/rfcs/blob/master/text/1598-generic_associated_types.md)
- [const æ³›å‹ RFC](https://github.com/rust-lang/rfcs/blob/master/text/2000-const-generics.md)
- [é«˜çº§ç±»å‹ç‰¹æ€§](../../../docs/docs/language/ref/28_advanced_type_features/07_generic_associated_types.md)

### ç›¸å…³ä»£ç 

- [ç±»å‹ç³»ç»Ÿå®ç°](../../../crates/c02_type_system/src/)
- [ç±»å‹ç³»ç»Ÿç¤ºä¾‹](../../../crates/c02_type_system/examples/)

### å·¥å…·èµ„æº

- [Rust Analyzer](https://rust-analyzer.github.io/): æä¾› GATs å’Œ const æ³›å‹çš„æ”¯æŒ
- [Chalk](https://github.com/rust-lang/chalk): Rust Trait ç³»ç»Ÿçš„å½¢å¼åŒ–æ¨¡å‹

---

## ğŸ”„ ç ”ç©¶è¿›å±•

### å·²å®Œæˆ âœ…

- [x] ç ”ç©¶ç›®æ ‡å®šä¹‰
- [x] ç†è®ºåŸºç¡€æ•´ç†
- [x] åˆæ­¥å½¢å¼åŒ–å®šä¹‰

### è¿›è¡Œä¸­ ğŸ”„

- [ ] å®Œæ•´çš„å½¢å¼åŒ–å®šä¹‰
- [ ] GATs ç±»å‹ç†è®ºæ·±å…¥åˆ†æ
- [ ] const æ³›å‹ç±»å‹ç³»ç»Ÿå½±å“åˆ†æ

### è®¡åˆ’ä¸­ ğŸ“‹

- [ ] ä¾èµ–ç±»å‹å…³ç³»æ·±å…¥ç ”ç©¶
- [ ] å®é™…åº”ç”¨æ¡ˆä¾‹
- [ ] ä¸å…¶ä»–è¯­è¨€å¯¹æ¯”

---

**ç»´æŠ¤è€…**: Rust Type Theory Research Group
**æœ€åæ›´æ–°**: 2025-01-27
**çŠ¶æ€**: ğŸ“‹ **è§„åˆ’ä¸­**
