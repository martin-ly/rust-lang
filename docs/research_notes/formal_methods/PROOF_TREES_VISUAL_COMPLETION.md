# è¯æ˜æ ‘å¯è§†åŒ–å®Œæ•´ç‰ˆ

> **åˆ›å»ºæ—¥æœŸ**: 2026-02-28
> **ç›®æ ‡**: å°†ç°æœ‰è¯æ˜è½¬æ¢ä¸º Mermaid å¯è§†åŒ–å›¾è¡¨
> **çŠ¶æ€**: ğŸ”´ é«˜ä¼˜å…ˆçº§

---

## ğŸ“‹ ç›®å½•

- [è¯æ˜æ ‘å¯è§†åŒ–å®Œæ•´ç‰ˆ](#è¯æ˜æ ‘å¯è§†åŒ–å®Œæ•´ç‰ˆ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [è¯æ˜æ ‘ 1: æ‰€æœ‰æƒå”¯ä¸€æ€§å®šç† (T1)](#è¯æ˜æ ‘-1-æ‰€æœ‰æƒå”¯ä¸€æ€§å®šç†-t1)
    - [å®šç†é™ˆè¿°1](#å®šç†é™ˆè¿°1)
    - [Rust ä»£ç éªŒè¯](#rust-ä»£ç éªŒè¯)
  - [è¯æ˜æ ‘ 2: å€Ÿç”¨æ£€æŸ¥å™¨æ­£ç¡®æ€§ (T1-T3)](#è¯æ˜æ ‘-2-å€Ÿç”¨æ£€æŸ¥å™¨æ­£ç¡®æ€§-t1-t3)
    - [å®šç†é™ˆè¿°](#å®šç†é™ˆè¿°)
    - [Rust ä»£ç éªŒè¯2](#rust-ä»£ç éªŒè¯2)
  - [è¯æ˜æ ‘ 3: ç±»å‹å®‰å…¨å®šç†](#è¯æ˜æ ‘-3-ç±»å‹å®‰å…¨å®šç†)
    - [å®šç†é™ˆè¿°3](#å®šç†é™ˆè¿°3)
  - [è¯æ˜æ ‘ 4: ç”Ÿå‘½å‘¨æœŸæ¨æ–­æ­£ç¡®æ€§](#è¯æ˜æ ‘-4-ç”Ÿå‘½å‘¨æœŸæ¨æ–­æ­£ç¡®æ€§)
    - [å®šç†é™ˆè¿°4](#å®šç†é™ˆè¿°4)
  - [è¯æ˜æ ‘ 5: å¼‚æ­¥çŠ¶æ€æœºå®‰å…¨](#è¯æ˜æ ‘-5-å¼‚æ­¥çŠ¶æ€æœºå®‰å…¨)
    - [å®šç†é™ˆè¿°5](#å®šç†é™ˆè¿°5)
    - [Rust ä»£ç éªŒè¯5](#rust-ä»£ç éªŒè¯5)
  - [ä½¿ç”¨è¯´æ˜](#ä½¿ç”¨è¯´æ˜)
    - [å¦‚ä½•é˜…è¯»è¯æ˜æ ‘](#å¦‚ä½•é˜…è¯»è¯æ˜æ ‘)
    - [ä¸ä»£ç çš„å¯¹åº”](#ä¸ä»£ç çš„å¯¹åº”)
    - [éªŒè¯æ–¹æ³•](#éªŒè¯æ–¹æ³•)

## è¯æ˜æ ‘ 1: æ‰€æœ‰æƒå”¯ä¸€æ€§å®šç† (T1)

### å®šç†é™ˆè¿°1

**å®šç† T1 (æ‰€æœ‰æƒå”¯ä¸€æ€§)**:

å¯¹äºä»»æ„èµ„æº `x` å’Œæ—¶åˆ» `t`ï¼Œè‹¥ `owns(x, t)` æˆç«‹ï¼Œåˆ™ä¸å­˜åœ¨ `t' â‰  t` ä½¿å¾— `owns(x, t')` åŒæ—¶æˆç«‹ã€‚

```mermaid
graph TD
    subgraph "å®šç† T1: æ‰€æœ‰æƒå”¯ä¸€æ€§"
    T1[âˆ€x,t: owns(x,t) â†’ Â¬âˆƒt'â‰ t: owns(x,t')]
    end

    subgraph "è¯æ˜ç»“æ„"
    P1[åŸºä¾‹: x åœ¨æ ˆä¸Šåˆ†é…] --> P1_1[Def 1.1: æ ˆå¸§å”¯ä¸€æ€§]
    P1 --> P1_2[Def 2.1: move è½¬ç§»æ‰€æœ‰æƒ]
    P1_2 --> P1_3[Def 2.2: drop é‡Šæ”¾æ‰€æœ‰æƒ]

    P2[å½’çº³å‡è®¾: å¯¹æ—¶åˆ» t æˆç«‹] --> P3[å½’çº³æ­¥: è¯æ˜å¯¹ t+1 æˆç«‹]
    P3 --> P3_1[æƒ…å†µ 1: æ‰€æœ‰æƒä¿æŒä¸å˜]
    P3 --> P3_2[æƒ…å†µ 2: æ‰€æœ‰æƒé€šè¿‡ move è½¬ç§»]
    P3 --> P3_3[æƒ…å†µ 3: æ‰€æœ‰æƒé€šè¿‡ drop é‡Šæ”¾]

    P3_2 --> P3_2_1[å¼•ç† 2.1: move ååŸæ‰€æœ‰è€…å¤±æ•ˆ]
    P3_2 --> P3_2_2[å¼•ç† 2.2: æ–°æ‰€æœ‰è€…å”¯ä¸€]

    P3_3 --> P3_3_1[å¼•ç† 2.3: drop åèµ„æºä¸å¯è®¿é—®]
    end

    subgraph "åè¯"
    C1[å‡è®¾: âˆƒt'â‰ t: owns(x,t') âˆ§ owns(x,t)] --> C2[çŸ›ç›¾ 1: è¿èƒŒæ ˆå¸§å”¯ä¸€æ€§]
    C1 --> C3[çŸ›ç›¾ 2: è¿èƒŒ move è¯­ä¹‰]
    C2 --> R[âˆ´ å‡è®¾ä¸æˆç«‹, T1 å¾—è¯]
    C3 --> R
    end

    T1 --> P1
    T1 --> P2
    P3 --> C1
```

### Rust ä»£ç éªŒè¯

```rust
// T1 çš„ Rust ä½“ç°ï¼šæ‰€æœ‰æƒç³»ç»Ÿä¿è¯
fn demonstrate_ownership_uniqueness() {
    let s = String::from("hello");  // owns(s, t0)
    // let s2 = s;                  // move: owns(s2, t1), Â¬owns(s, t1)
    // println!("{}", s);           // é”™è¯¯ï¼è¿èƒŒå”¯ä¸€æ€§

    let s2 = s;                      // æ‰€æœ‰æƒè½¬ç§»
    // println!("{}", s);           // ç¼–è¯‘é”™è¯¯ï¼švalue borrowed here after move
    println!("{}", s2);              // OK: s2 æ˜¯å”¯ä¸€å®šæ‰€æœ‰è€…
} // drop(s2) - æ‰€æœ‰æƒé‡Šæ”¾
```

---

## è¯æ˜æ ‘ 2: å€Ÿç”¨æ£€æŸ¥å™¨æ­£ç¡®æ€§ (T1-T3)

### å®šç†é™ˆè¿°

**å®šç† T1 (ä¸å¯å˜å€Ÿç”¨å®‰å…¨)**:
`borrow_immut(x) â†’ âˆ€t: åœ¨å€Ÿç”¨æœŸé—´ x ä¸å¯å˜`

**å®šç† T2 (å¯å˜å€Ÿç”¨å”¯ä¸€æ€§)**:
`borrow_mut(x) â†’ âˆ€t: åœ¨å€Ÿç”¨æœŸé—´æ— å…¶ä»–å€Ÿç”¨`

**å®šç† T3 (å€Ÿç”¨æœ‰æ•ˆæ€§)**:
`borrow(x) â†’ valid(x) åœ¨å€Ÿç”¨æœŸé—´`

```mermaid
graph TD
    subgraph "å€Ÿç”¨æ£€æŸ¥å™¨å®šç†ä½“ç³»"
    BC[å€Ÿç”¨æ£€æŸ¥å™¨<br/>Borrow Checker]
    BC --> T1[T1: ä¸å¯å˜å€Ÿç”¨å®‰å…¨]
    BC --> T2[T2: å¯å˜å€Ÿç”¨å”¯ä¸€æ€§]
    BC --> T3[T3: å€Ÿç”¨æœ‰æ•ˆæ€§]
    end

    subgraph "T1 è¯æ˜"
    T1 --> T1_D1[Def: borrow_immut(x) åˆ›å»º &T]
    T1 --> T1_D2[Def: ä¸å¯å˜å¼•ç”¨ &T ä¸å…è®¸ä¿®æ”¹]
    T1_D1 --> T1_L1[å¼•ç† 1.1: &T ç”Ÿå‘½å‘¨æœŸå†… T ä¸å¯å˜]
    T1_L1 --> T1_P[å½’çº³è¯æ˜: æ‰€æœ‰ç¨‹åºç‚¹æ»¡è¶³]
    end

    subgraph "T2 è¯æ˜"
    T2 --> T2_D1[Def: borrow_mut(x) åˆ›å»º &mut T]
    T2 --> T2_D2[Def: å¯å˜å¼•ç”¨ &mut T æ’ä»–]
    T2_D1 --> T2_L1[å¼•ç† 2.1: &mut T å­˜åœ¨æ—¶æ— å…¶ä»–å¼•ç”¨]
    T2_L1 --> T2_L2[å¼•ç† 2.2: å€Ÿç”¨å†²çªæ£€æµ‹ç®—æ³•]
    T2_L2 --> T2_P[æ„é€ æ€§è¯æ˜: MIR  borrowck ç®—æ³•æ­£ç¡®æ€§]
    end

    subgraph "T3 è¯æ˜"
    T3 --> T3_D1[Def: å€Ÿç”¨å¿…é¡»åœ¨æ‰€æœ‰è€…ç”Ÿå‘½å‘¨æœŸå†…]
    T3_D1 --> T3_L1[å¼•ç† 3.1: ç”Ÿå‘½å‘¨æœŸæ¨æ–­æ­£ç¡®æ€§]
    T3_L1 --> T3_L2[å¼•ç† 3.2: ç”Ÿå‘½å‘¨æœŸçº¦æŸæ±‚è§£]
    T3_L2 --> T3_P[è¯æ˜: çº¦æŸç³»ç»Ÿå¯æ»¡è¶³æ€§]
    end

    subgraph "å€Ÿç”¨è§„åˆ™å±‚æ¬¡"
    R1[è§„åˆ™ 1: &T å¯å¤šä¸ª] --> R1_1[è¯»å–è€…-è¯»å–è€…å…¼å®¹]
    R2[è§„åˆ™ 2: &mut T å”¯ä¸€] --> R2_1[å†™å…¥è€…æ’ä»–]
    R3[è§„åˆ™ 3: &T å’Œ &mut T äº’æ–¥] --> R3_1[è¯»å–-å†™å…¥äº’æ–¥]
    R4[è§„åˆ™ 4: å€Ÿç”¨ä¸æ´»å¾—æ¯”æ‰€æœ‰è€…é•¿] --> R4_1[ç”Ÿå‘½å‘¨æœŸè¾¹ç•Œ]
    end

    T1_P --> R1
    T2_P --> R2
    T2_P --> R3
    T3_P --> R4
```

### Rust ä»£ç éªŒè¯2

```rust
fn demonstrate_borrow_checker() {
    let mut x = 5;

    // T1: ä¸å¯å˜å€Ÿç”¨å®‰å…¨
    let r1 = &x;
    let r2 = &x;  // OK: å¤šä¸ªä¸å¯å˜å€Ÿç”¨
    println!("{} {}", r1, r2);

    // T2: å¯å˜å€Ÿç”¨å”¯ä¸€æ€§
    let r3 = &mut x;  // OK: ä¹‹å‰å€Ÿç”¨å·²ç»“æŸ
    // let r4 = &x;     // é”™è¯¯ï¼ä¸ &mut x å†²çª
    *r3 += 1;

    // T3: å€Ÿç”¨æœ‰æ•ˆæ€§
    let r = &x;
    // drop(x);         // é”™è¯¯ï¼r ä»ç„¶å€Ÿç”¨ x
    println!("{}", r);
} // x åœ¨è¿™é‡Œ drop
```

---

## è¯æ˜æ ‘ 3: ç±»å‹å®‰å…¨å®šç†

### å®šç†é™ˆè¿°3

**ç±»å‹å®‰å…¨ = è¿›å±•æ€§ (Progress) + ä¿æŒæ€§ (Preservation)**:

```mermaid
graph TD
    subgraph "ç±»å‹å®‰å…¨å®šä¹‰"
    TS[ç±»å‹å®‰å…¨å®šç†] --> PR[è¿›å±•æ€§ Progress]
    TS --> PS[ä¿æŒæ€§ Preservation]

    PR --> PR_D["âˆ€e: Î“ âŠ¢ e : T â†’ <br/>e æ˜¯å€¼ âˆ¨ âˆƒe': e â†’ e'"]
    PS --> PS_D["âˆ€e,e': Î“ âŠ¢ e : T âˆ§ e â†’ e' â†’ <br/>Î“ âŠ¢ e' : T"]
    end

    subgraph "è¿›å±•æ€§è¯æ˜"
    PR_P1[åŸºä¾‹: å˜é‡/å­—é¢é‡] --> PR_P1_1[å·²æ˜¯å€¼ï¼Œæˆç«‹]

    PR_P2[å½’çº³æ­¥: å¤åˆè¡¨è¾¾å¼] --> PR_P2_1[å‡½æ•°åº”ç”¨ e1 e2]
    PR_P2_1 --> PR_P2_1_1[IH: e1 è¿›å±•]
    PR_P2_1 --> PR_P2_1_2[IH: e2 è¿›å±•]

    PR_P2 --> PR_P2_2[æ¨¡å¼åŒ¹é… match]
    PR_P2_2 --> PR_P2_2_1[ scrutinee è¿›å±•]
    PR_P2_2 --> PR_P2_2_2[ è‡‚è¦†ç›–æ£€æŸ¥]

    PR_P2 --> PR_P2_3[æ–¹æ³•è°ƒç”¨]
    PR_P2_3 --> PR_P2_3_1[ receiver è¿›å±•]
    PR_P2_3 --> PR_P2_3_2[ æ–¹æ³•è§£æ]
    end

    subgraph "ä¿æŒæ€§è¯æ˜"
    PS_P1[æ›¿æ¢å¼•ç†] --> PS_P1_1["Î“, x:T âŠ¢ e : U âˆ§ Î“ âŠ¢ v : T <br/>â†’ Î“ âŠ¢ [v/x]e : U"]

    PS_P2[æ±‚å€¼ä¿æŒ] --> PS_P2_1[Î²-å½’çº¦: (Î»x.e) v â†’ [v/x]e]
    PS_P2_1 --> PS_P2_1_1[ç”±æ›¿æ¢å¼•ç†ï¼Œç±»å‹ä¿æŒ]

    PS_P2 --> PS_P2_2[match å½’çº¦]
    PS_P2_2 --> PS_P2_2_1[æ¨¡å¼åŒ¹é…æ­£ç¡®æ€§]
    PS_P2_2 --> PS_P2_2_2[ç»‘å®šç±»å‹ä¸€è‡´æ€§]

    PS_P2 --> PS_P2_3[æ–¹æ³•åˆ†æ´¾]
    PS_P2_3 --> PS_P2_3_1[é™æ€/åŠ¨æ€åˆ†æ´¾ç±»å‹ä¸€è‡´]
    end

    subgraph "Rust ç‰¹å®šè§„åˆ™"
    RS1[æ‰€æœ‰æƒè½¬ç§»ä¿æŒç±»å‹] --> RS1_1[move ä¸æ”¹å˜ç±»å‹]
    RS2[å€Ÿç”¨åˆ›å»ºå­ç±»å‹] --> RS2_1[&mut T <: &T ä¸æˆç«‹]
    RS3[ç”Ÿå‘½å‘¨æœŸå­ç±»å‹] --> RS3_1['a: 'b â†’ &'a T <: &'b T]
    end

    PS_P2_1 --> RS1
    PS_P2_2 --> RS2
    PS_P2_3 --> RS3
```

---

## è¯æ˜æ ‘ 4: ç”Ÿå‘½å‘¨æœŸæ¨æ–­æ­£ç¡®æ€§

### å®šç†é™ˆè¿°4

**å®šç† LF-T1**: ç”Ÿå‘½å‘¨æœŸæ¨æ–­ç®—æ³•è¾“å‡ºçš„çº¦æŸç³»ç»Ÿæ˜¯å¯è¡Œçš„ï¼ˆè‹¥å­˜åœ¨è§£ï¼‰ã€‚
**å®šç† LF-T2**: æ¨æ–­çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æå°çš„ï¼ˆæœ€ç²¾ç¡®çš„ï¼‰ã€‚
**å®šç† LF-T3**: æ˜¾å¼æ ‡æ³¨ä¸æ¨æ–­ç»“æœä¸€è‡´æ—¶ç¨‹åºè¡Œä¸ºç›¸åŒã€‚

```mermaid
graph TD
    subgraph "ç”Ÿå‘½å‘¨æœŸæ¨æ–­ç³»ç»Ÿ"
    LI[Lifetime Inference] --> LI_I[è¾“å…¥: AST + å€Ÿç”¨æ¨¡å¼]
    LI --> LI_O[è¾“å‡º: ç”Ÿå‘½å‘¨æœŸçº¦æŸç³»ç»Ÿ]

    LI_I --> LI_I1[å‡½æ•°ç­¾å]
    LI_I --> LI_I2[å˜é‡ç»‘å®š]
    LI_I --> LI_I3[å€Ÿç”¨è¡¨è¾¾å¼]
    LI_I --> LI_I4[ç»“æ„ä½“å­—æ®µ]
    end

    subgraph "çº¦æŸç”Ÿæˆ"
    CG[Constraint Generation] --> CG1[è¾“å‡ºçº¦æŸ: 'a: 'b]
    CG --> CG2[è¾“å…¥çº¦æŸ: å€Ÿç”¨ç‚¹ = å¼•ç”¨ç”Ÿå‘½å‘¨æœŸ]
    CG --> CG3[æ€æ­»çº¦æŸ: å€¼ç§»åŠ¨/drop]

    CG1 --> CG1_1[å‡½æ•°è¿”å›: 'out: 'input]
    CG1 --> CG1_2[ç»“æ„ä½“: å­—æ®µ âŠ† ç»“æ„ä½“]

    CG2 --> CG2_1[&x åˆ›å»º 'a = x çš„ç”Ÿå‘½å‘¨æœŸ]
    CG2 --> CG2_2[&mut x åˆ›å»º 'b âŠ† x çš„å¯å˜æœŸ]
    end

    subgraph "çº¦æŸæ±‚è§£"
    CS[Constraint Solving] --> CS1[æ„å»ºæœ‰å‘å›¾]
    CS1 --> CS1_1[èŠ‚ç‚¹: ç”Ÿå‘½å‘¨æœŸå˜é‡]
    CS1 --> CS1_2[è¾¹: 'a: 'b è¡¨ç¤º a â†’ b]

    CS --> CS2[æ£€æµ‹å¾ªç¯]
    CS2 --> CS2_1[å¾ªç¯ = æ— æœ‰æ•ˆè§£]

    CS --> CS3[è®¡ç®—æœ€å°è§£]
    CS3 --> CS3_1[æ¯ä¸ª 'a = å¯è¾¾èŠ‚ç‚¹é›†åˆ]
    CS3 --> CS3_2[æœ€å°ç¨‹åºç‚¹åŒ…å«]
    end

    subgraph "æ­£ç¡®æ€§è¯æ˜"
    T1[å®šç† LF-T1: å¯è¡Œæ€§] --> T1_P["è‹¥ç®—æ³•è¿”å›è§£ S<br/>åˆ™ S æ»¡è¶³æ‰€æœ‰çº¦æŸ"]
    T1_P --> T1_L1[å¼•ç†: å›¾æ„é€ æ­£ç¡®æ€§]
    T1_L1 --> T1_L2[å¼•ç†: å¯è¾¾æ€§ = å­ç±»å‹å…³ç³»]

    T2[å®šç† LF-T2: æå°æ€§] --> T2_P["è§£ S æ˜¯æœ€å°çš„<br/>âˆ€S': S âŠ† S'"]
    T2_P --> T2_L1[å¼•ç†: ç¨‹åºç‚¹åŒ…å«åº]

    T3[å®šç† LF-T3: ä¸€è‡´æ€§] --> T3_P["æ˜¾å¼æ ‡æ³¨ä¸æ¨æ–­ç­‰ä»·<br/>å½“æ ‡æ³¨æ»¡è¶³çº¦æŸ"]
    T3_P --> T3_L1[å¼•ç†: æ ‡æ³¨åŠ å¼ºçº¦æŸ]
    end

    LI_O --> CG
    CG --> CS
    CS --> T1
    CS --> T2
```

---

## è¯æ˜æ ‘ 5: å¼‚æ­¥çŠ¶æ€æœºå®‰å…¨

### å®šç†é™ˆè¿°5

**å®šç† T6.1**: å¼‚æ­¥çŠ¶æ€æœºåœ¨ await ç‚¹ä¿æŒå†…å­˜å®‰å…¨ã€‚
**å®šç† T6.2**: Future çš„ Pin ä¿è¯è‡ªå¼•ç”¨å®‰å…¨ã€‚
**å®šç† T6.3**: å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ä¸å¼•å…¥æ•°æ®ç«äº‰ã€‚

```mermaid
graph TD
    subgraph "å¼‚æ­¥çŠ¶æ€æœºå½¢å¼åŒ–"
    AS[Async State Machine] --> AS_S[çŠ¶æ€: Init â†’ Running â†’ Suspended â†’ Completed]
    AS --> AS_T[è½¬æ¢: Poll/Suspend/Complete]
    AS --> AS_C[çº¦æŸ: è·¨ await ä¿æŒå®‰å…¨]
    end

    subgraph "å®šç† T6.1: await ç‚¹å†…å­˜å®‰å…¨"
    T6_1[âˆ€await: å¯„å­˜å™¨çŠ¶æ€ä¿å­˜å®‰å…¨] --> T6_1_1[å±€éƒ¨å˜é‡å­˜å…¥çŠ¶æ€æœº]
    T6_1 --> T6_1_2[å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿]

    T6_1_1 --> T6_1_1_1[Def: çŠ¶æ€æœºåŒ…å«æ‰€æœ‰æ´»å˜é‡]
    T6_1_1 --> T6_1_1_2[è¯æ˜: å€Ÿç”¨æ£€æŸ¥å™¨éªŒè¯è·¨ await å®‰å…¨]

    T6_1_2 --> T6_1_2_1[å¼•ç†: å»¶é•¿ç”Ÿå‘½å‘¨æœŸä¸è¿åå€Ÿç”¨è§„åˆ™]
    T6_1_2 --> T6_1_2_2[å¼•ç†: æ¢å¤æ—¶çŠ¶æ€ä¸€è‡´]
    end

    subgraph "å®šç† T6.2: Pin è‡ªå¼•ç”¨å®‰å…¨"
    T6_2[Pin<Future> ä¿è¯è‡ªå¼•ç”¨æœ‰æ•ˆ] --> T6_2_1[Def: Pin ç¦æ­¢ç§»åŠ¨åº•å±‚å¯¹è±¡]
    T6_2 --> T6_2_2[çŠ¶æ€æœºè‡ªå¼•ç”¨çš„åˆ›å»º]

    T6_2_1 --> T6_2_1_1[Pin::new_unchecked å¥‘çº¦]
    T6_2_1 --> T6_2_1_2[Drop guarantee]

    T6_2_2 --> T6_2_2_1[ç”Ÿæˆæ—¶: è‡ªå¼•ç”¨å­—æ®µåˆå§‹åŒ–]
    T6_2_2 --> T6_2_2_2[await å: è‡ªå¼•ç”¨ä»ç„¶æœ‰æ•ˆ]
    end

    subgraph "å®šç† T6.3: è°ƒåº¦å®‰å…¨æ€§"
    T6_3[ä»»åŠ¡è°ƒåº¦æ— æ•°æ®ç«äº‰] --> T6_3_1[Send/Sync è¾¹ç•Œ]
    T6_3 --> T6_3_2[è¿è¡Œæ—¶è°ƒåº¦ä¿è¯]

    T6_3_1 --> T6_3_1_1[è·¨çº¿ç¨‹å‘é€: T: Send]
    T6_3_1 --> T6_3_1_2[å…±äº«è®¿é—®: T: Sync]

    T6_3_2 --> T6_3_2_1[å•çº¿ç¨‹æ‰§è¡Œå™¨: æ— å¹¶å‘]
    T6_3_2 --> T6_3_2_2[å¤šçº¿ç¨‹æ‰§è¡Œå™¨: work-stealing å®‰å…¨]

    T6_3_1 --> T6_3_3[ç¼–è¯‘å™¨éªŒè¯ + è¿è¡Œæ—¶ä¿è¯]
    T6_3_2 --> T6_3_3
    end

    subgraph "çŠ¶æ€è½¬æ¢å›¾"
    S0[Init] -->|poll| S1[Running]
    S1 -->|await| S2[Suspended]
    S2 -->|poll resumed| S1
    S1 -->|return| S3[Completed]
    S1 -->|panic| S4[Panicked]

    S2 -.->|Cancel| S5[Cancelling]
    S5 -->|drop| S6[Dropped]
    end

    AS_S --> S0
    T6_1 --> S2
    T6_2 --> S2
```

### Rust ä»£ç éªŒè¯5

```rust
// T6.1: await ç‚¹å†…å­˜å®‰å…¨
async fn demonstrate_async_safety() {
    let local = String::from("data");  // å±€éƒ¨å˜é‡
    let ref_local = &local;             // å€Ÿç”¨

    some_async().await;                 // await ç‚¹
    // local ä»æœ‰æ•ˆï¼Œref_local ä»æœ‰æ•ˆ
    println!("{} {}", local, ref_local);
}

// T6.2: Pin è‡ªå¼•ç”¨å®‰å…¨
use std::pin::Pin;
use std::marker::PhantomPinned;

struct SelfReferential {
    data: String,
    ptr_to_data: *const String,
    _pin: PhantomPinned,
}

impl SelfReferential {
    fn new(data: String) -> Pin<Box<Self>> {
        let mut boxed = Box::pin(Self {
            data,
            ptr_to_data: std::ptr::null(),
            _pin: PhantomPinned,
        });

        let ptr = &boxed.data as *const String;
        unsafe {
            let mut_ref = Pin::as_mut(&mut boxed);
            Pin::get_unchecked_mut(mut_ref).ptr_to_data = ptr;
        }

        boxed
    }
}

// T6.3: Send/Sync è¾¹ç•Œ
async fn task() {
    let not_send = std::rc::Rc::new(42);
    // some_async().await;  // é”™è¯¯ï¼Rc ä¸èƒ½è·¨ await

    let is_send = std::sync::Arc::new(42);
    some_async().await;      // OK: Arc æ˜¯ Send
}

async fn some_async() {}
```

---

## ä½¿ç”¨è¯´æ˜

### å¦‚ä½•é˜…è¯»è¯æ˜æ ‘

1. **ä»å·¦åˆ°å³**: ä»å®šç†é™ˆè¿°åˆ°è¯æ˜ç»†èŠ‚
2. **ä»ä¸Šåˆ°ä¸‹**: ä»åŸºç¡€åˆ°å½’çº³/æ„é€ æ­¥éª¤
3. **å®çº¿ç®­å¤´**: é€»è¾‘ä¾èµ–å…³ç³»
4. **è™šçº¿ç®­å¤´**: å¯é€‰/å¼‚å¸¸è·¯å¾„

### ä¸ä»£ç çš„å¯¹åº”

æ¯ä¸ªè¯æ˜æ ‘éƒ½åŒ…å«ï¼š

- å½¢å¼åŒ–å®šç†é™ˆè¿°
- Mermaid å¯è§†åŒ–å›¾è¡¨
- Rust ä»£ç éªŒè¯ç¤ºä¾‹

### éªŒè¯æ–¹æ³•

```bash
# éªŒè¯ä»£ç ç¤ºä¾‹
cargo test --doc

# éªŒè¯å½¢å¼åŒ–å®šä¹‰
cargo build --features formal_verification
```

---

**ç»´æŠ¤è€…**: Rust å½¢å¼åŒ–æ–¹æ³•ç ”ç©¶å›¢é˜Ÿ
**åˆ›å»ºæ—¥æœŸ**: 2026-02-28
**ç‰ˆæœ¬**: v1.0 (100% è¯æ˜æ ‘å¯è§†åŒ–)
