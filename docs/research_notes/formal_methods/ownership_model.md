# æ‰€æœ‰æƒæ¨¡å‹å½¢å¼åŒ–

> **åˆ›å»ºæ—¥æœŸ**: 2025-01-27
> **æœ€åæ›´æ–°**: 2025-11-15
> **Rust ç‰ˆæœ¬**: 1.91.1+ (Edition 2024) âœ…
> **çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­

---

## ğŸ“Š ç›®å½•

- [æ‰€æœ‰æƒæ¨¡å‹å½¢å¼åŒ–](#æ‰€æœ‰æƒæ¨¡å‹å½¢å¼åŒ–)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ ç ”ç©¶ç›®æ ‡](#-ç ”ç©¶ç›®æ ‡)
    - [æ ¸å¿ƒé—®é¢˜](#æ ¸å¿ƒé—®é¢˜)
    - [é¢„æœŸæˆæœ](#é¢„æœŸæˆæœ)
  - [ğŸ“š ç†è®ºåŸºç¡€](#-ç†è®ºåŸºç¡€)
    - [Rust æ‰€æœ‰æƒä¸‰åŸåˆ™](#rust-æ‰€æœ‰æƒä¸‰åŸåˆ™)
    - [ç›¸å…³æ¦‚å¿µ](#ç›¸å…³æ¦‚å¿µ)
    - [ç†è®ºèƒŒæ™¯](#ç†è®ºèƒŒæ™¯)
  - [ğŸ”¬ å½¢å¼åŒ–å®šä¹‰](#-å½¢å¼åŒ–å®šä¹‰)
    - [1. å€¼ä¸ç¯å¢ƒ](#1-å€¼ä¸ç¯å¢ƒ)
    - [2. æ‰€æœ‰æƒè§„åˆ™](#2-æ‰€æœ‰æƒè§„åˆ™)
    - [3. å†…å­˜å®‰å…¨](#3-å†…å­˜å®‰å…¨)
  - [âœ… è¯æ˜ç›®æ ‡](#-è¯æ˜ç›®æ ‡)
    - [å¾…è¯æ˜çš„æ€§è´¨](#å¾…è¯æ˜çš„æ€§è´¨)
    - [è¯æ˜æ–¹æ³•](#è¯æ˜æ–¹æ³•)
  - [ğŸ’» ä»£ç ç¤ºä¾‹](#-ä»£ç ç¤ºä¾‹)
    - [ç¤ºä¾‹ 1: æ‰€æœ‰æƒè½¬ç§»](#ç¤ºä¾‹-1-æ‰€æœ‰æƒè½¬ç§»)
    - [ç¤ºä¾‹ 2: å€Ÿç”¨](#ç¤ºä¾‹-2-å€Ÿç”¨)
    - [ç¤ºä¾‹ 3: å¤åˆ¶è¯­ä¹‰](#ç¤ºä¾‹-3-å¤åˆ¶è¯­ä¹‰)
    - [ç¤ºä¾‹ 4: ä½œç”¨åŸŸè§„åˆ™](#ç¤ºä¾‹-4-ä½œç”¨åŸŸè§„åˆ™)
  - [ğŸ“– å‚è€ƒæ–‡çŒ®](#-å‚è€ƒæ–‡çŒ®)
    - [å­¦æœ¯è®ºæ–‡](#å­¦æœ¯è®ºæ–‡)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [ç›¸å…³ä»£ç ](#ç›¸å…³ä»£ç )
    - [å·¥å…·èµ„æº](#å·¥å…·èµ„æº)
  - [ğŸ”„ ç ”ç©¶è¿›å±•](#-ç ”ç©¶è¿›å±•)
    - [å·²å®Œæˆ âœ…](#å·²å®Œæˆ-)
    - [è¿›è¡Œä¸­ ğŸ”„](#è¿›è¡Œä¸­-)
    - [è®¡åˆ’ä¸­ ğŸ“‹](#è®¡åˆ’ä¸­-)

---

## ğŸ¯ ç ”ç©¶ç›®æ ‡

æœ¬ç ”ç©¶çš„ç›®çš„æ˜¯å½¢å¼åŒ–å®šä¹‰ Rust çš„æ‰€æœ‰æƒç³»ç»Ÿï¼Œå¹¶è¯æ˜å…¶ä¿è¯å†…å­˜å®‰å…¨ã€‚

### æ ¸å¿ƒé—®é¢˜

1. **æ‰€æœ‰æƒè§„åˆ™çš„å½¢å¼åŒ–**: å¦‚ä½•ç”¨æ•°å­¦è¯­è¨€ç²¾ç¡®æè¿°æ‰€æœ‰æƒè§„åˆ™ï¼Ÿ
2. **å†…å­˜å®‰å…¨è¯æ˜**: å¦‚ä½•è¯æ˜æ‰€æœ‰æƒç³»ç»Ÿä¿è¯å†…å­˜å®‰å…¨ï¼Ÿ
3. **æ‰€æœ‰æƒè½¬ç§»è¯­ä¹‰**: æ‰€æœ‰æƒè½¬ç§»çš„è¯­ä¹‰å¦‚ä½•å½¢å¼åŒ–è¡¨ç¤ºï¼Ÿ

### é¢„æœŸæˆæœ

- æ‰€æœ‰æƒç³»ç»Ÿçš„å½¢å¼åŒ–å®šä¹‰
- å†…å­˜å®‰å…¨çš„å½¢å¼åŒ–è¯æ˜
- æ‰€æœ‰æƒè½¬ç§»çš„è¯­ä¹‰æ¨¡å‹

---

## ğŸ“š ç†è®ºåŸºç¡€

### Rust æ‰€æœ‰æƒä¸‰åŸåˆ™

1. **æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…**
2. **åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…**
3. **å½“æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå€¼è¢«ä¸¢å¼ƒ**

### ç›¸å…³æ¦‚å¿µ

**ç§»åŠ¨è¯­ä¹‰ (Move Semantics)**: æ‰€æœ‰æƒä»ä¸€ä¸ªå˜é‡è½¬ç§»åˆ°å¦ä¸€ä¸ªå˜é‡ã€‚å½“å€¼è¢«ç§»åŠ¨æ—¶ï¼ŒåŸå˜é‡ä¸å†æ‹¥æœ‰è¯¥å€¼ã€‚

**å¤åˆ¶è¯­ä¹‰ (Copy Semantics)**: å®ç° `Copy` trait çš„ç±»å‹å¯ä»¥å¤åˆ¶ã€‚å¤åˆ¶ä¸ä¼šè½¬ç§»æ‰€æœ‰æƒï¼Œè€Œæ˜¯åˆ›å»ºå€¼çš„å‰¯æœ¬ã€‚

**å€Ÿç”¨ (Borrowing)**: ä¸´æ—¶å€Ÿç”¨æ‰€æœ‰æƒï¼Œä¸è½¬ç§»æ‰€æœ‰æƒã€‚å€Ÿç”¨å¯ä»¥æ˜¯ä¸å¯å˜çš„ï¼ˆ`&T`ï¼‰æˆ–å¯å˜çš„ï¼ˆ`&mut T`ï¼‰ã€‚

**ä½œç”¨åŸŸ (Scope)**: å˜é‡çš„æœ‰æ•ˆèŒƒå›´ã€‚å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå¦‚æœå®ƒæ‹¥æœ‰å€¼ï¼Œå€¼ä¼šè¢«ä¸¢å¼ƒã€‚

### ç†è®ºèƒŒæ™¯

**çº¿æ€§ç±»å‹ç³»ç»Ÿ (Linear Type System)**: ç”¨äºå»ºæ¨¡æ‰€æœ‰æƒè½¬ç§»çš„ç±»å‹ç³»ç»Ÿã€‚åœ¨çº¿æ€§ç±»å‹ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå€¼åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè¿™ä¸ Rust çš„æ‰€æœ‰æƒç³»ç»Ÿéå¸¸ç›¸ä¼¼ã€‚

**åˆ†ç¦»é€»è¾‘ (Separation Logic)**: ç”¨äºè¡¨è¾¾å€Ÿç”¨è§„åˆ™çš„é€»è¾‘ç³»ç»Ÿã€‚åˆ†ç¦»é€»è¾‘å¯ä»¥è¡¨è¾¾å†…å­˜çš„åˆ†ç¦»å’Œå…±äº«ï¼Œè¿™ä¸ Rust çš„å€Ÿç”¨è§„åˆ™å¯¹åº”ã€‚

**èµ„æºç®¡ç†ç†è®º**: æ‰€æœ‰æƒç³»ç»Ÿå¯ä»¥è§†ä¸ºä¸€ç§èµ„æºç®¡ç†æœºåˆ¶ï¼Œç¡®ä¿èµ„æºåœ¨ä½¿ç”¨åæ­£ç¡®é‡Šæ”¾ã€‚

---

## ğŸ”¬ å½¢å¼åŒ–å®šä¹‰

### 1. å€¼ä¸ç¯å¢ƒ

**å®šä¹‰ 1.1 (å€¼)**: å€¼ $v$ å¯ä»¥æ˜¯ï¼š

- æ•´æ•°ã€å¸ƒå°”å€¼ç­‰åŸºæœ¬ç±»å‹
- ç»“æ„ä½“ã€æšä¸¾ç­‰å¤åˆç±»å‹
- å¼•ç”¨ã€æŒ‡é’ˆç­‰

**å®šä¹‰ 1.2 (ç¯å¢ƒ)**: ç¯å¢ƒ $\Gamma$ æ˜¯ä¸€ä¸ªä»å˜é‡åˆ°å€¼çš„æ˜ å°„ï¼š
$$\Gamma : \text{Var} \to \text{Val}$$

**å®šä¹‰ 1.3 (æ‰€æœ‰æƒç¯å¢ƒ)**: æ‰€æœ‰æƒç¯å¢ƒ $\Omega$ æ˜¯ä¸€ä¸ªä»å˜é‡åˆ°æ‰€æœ‰æƒçš„æ˜ å°„ï¼š
$$\Omega : \text{Var} \to \{\text{Owned}, \text{Borrowed}, \text{Moved}\}$$

### 2. æ‰€æœ‰æƒè§„åˆ™

**è§„åˆ™ 1 (æ‰€æœ‰æƒå”¯ä¸€æ€§)**:
å¯¹äºä»»ä½•å€¼ $v$ï¼Œåœ¨ç¯å¢ƒ $\Omega$ ä¸­ï¼Œæœ€å¤šå­˜åœ¨ä¸€ä¸ªå˜é‡ $x$ ä½¿å¾— $\Omega(x) = \text{Owned}$ ä¸” $\Gamma(x) = v$ã€‚

**è§„åˆ™ 2 (ç§»åŠ¨è¯­ä¹‰)**:
å½“æ‰§è¡Œ `let y = x;` æ—¶ï¼ˆ$x$ ä¸å®ç° `Copy`ï¼‰ï¼Œæ‰€æœ‰æƒä» $x$ è½¬ç§»åˆ° $y$ï¼š

- $\Omega(x) \leftarrow \text{Moved}$
- $\Omega(y) \leftarrow \text{Owned}$
- $\Gamma(y) \leftarrow \Gamma(x)$

**è§„åˆ™ 3 (ä½œç”¨åŸŸç»“æŸ)**:
å½“å˜é‡ $x$ ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå¦‚æœ $\Omega(x) = \text{Owned}$ï¼Œåˆ™å€¼è¢«ä¸¢å¼ƒï¼ˆdeallocatedï¼‰ã€‚

**è§„åˆ™ 4 (å¤åˆ¶è¯­ä¹‰)**:
å¦‚æœç±»å‹ $T$ å®ç° `Copy` traitï¼Œåˆ™æ‰§è¡Œ `let y = x;` æ—¶ï¼Œ$x$ å’Œ $y$ éƒ½æ‹¥æœ‰å€¼çš„å‰¯æœ¬ï¼š

- $\Omega(x) = \text{Owned}$
- $\Omega(y) = \text{Owned}$
- $\Gamma(y) = \text{copy}(\Gamma(x))$

**è§„åˆ™ 5 (å€Ÿç”¨è§„åˆ™)**:
å€Ÿç”¨ä¸è½¬ç§»æ‰€æœ‰æƒï¼š

- ä¸å¯å˜å€Ÿç”¨: $\Omega(x) = \text{Owned}$ï¼Œå­˜åœ¨å€Ÿç”¨å¼•ç”¨ $\&x$
- å¯å˜å€Ÿç”¨: $\Omega(x) = \text{Owned}$ï¼Œå­˜åœ¨å”¯ä¸€å€Ÿç”¨å¼•ç”¨ $\&mut x$

### 3. å†…å­˜å®‰å…¨

**å®šç† 1 (å†…å­˜å®‰å…¨)**:
åœ¨æ‰€æœ‰æƒç³»ç»Ÿä¸‹ï¼Œç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼š

- ä¸ä¼šå‡ºç°æ‚¬å‚æŒ‡é’ˆï¼ˆdangling pointerï¼‰
- ä¸ä¼šå‡ºç°åŒé‡é‡Šæ”¾ï¼ˆdouble freeï¼‰
- ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼ˆmemory leakï¼‰

**è¯æ˜æ€è·¯**:

- æ‰€æœ‰æƒå”¯ä¸€æ€§ä¿è¯æ¯ä¸ªå€¼åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…
- ä½œç”¨åŸŸè§„åˆ™ä¿è¯å€¼åœ¨ä½¿ç”¨åæ­£ç¡®é‡Šæ”¾
- ç§»åŠ¨è¯­ä¹‰ä¿è¯å€¼ä¸ä¼šè¢«æ„å¤–å¤åˆ¶

**å®šç† 2 (æ‰€æœ‰æƒå”¯ä¸€æ€§)**:
å¯¹äºä»»ä½•å€¼ $v$ï¼Œåœ¨ä»»æ„æ—¶åˆ»ï¼Œæœ€å¤šå­˜åœ¨ä¸€ä¸ªå˜é‡ $x$ ä½¿å¾— $\Omega(x) = \text{Owned}$ ä¸” $\Gamma(x) = v$ã€‚

**è¯æ˜**: ç”±è§„åˆ™ 1 å’Œè§„åˆ™ 2 ç›´æ¥å¾—å‡ºã€‚

---

## âœ… è¯æ˜ç›®æ ‡

### å¾…è¯æ˜çš„æ€§è´¨

1. **è¿›å±•æ€§ (Progress)**: è‰¯å‹ç¨‹åºä¸ä¼šå¡ä½
2. **ä¿æŒæ€§ (Preservation)**: ç±»å‹åœ¨æ±‚å€¼åä¿æŒ
3. **å†…å­˜å®‰å…¨**: ä¸ä¼šå‡ºç°å†…å­˜é”™è¯¯

### è¯æ˜æ–¹æ³•

- **ç»“æ„å½’çº³**: å¯¹ç¨‹åºç»“æ„è¿›è¡Œå½’çº³è¯æ˜
- **è§„åˆ™å½’çº³**: å¯¹ç±»å‹è§„åˆ™è¿›è¡Œå½’çº³è¯æ˜
- **æ¨¡å‹æ£€æŸ¥**: ä½¿ç”¨å·¥å…·éªŒè¯ç³»ç»Ÿå±æ€§

---

## ğŸ’» ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1: æ‰€æœ‰æƒè½¬ç§»

```rust
fn main() {
    let s1 = String::from("hello");  // s1 æ‹¥æœ‰å­—ç¬¦ä¸²
    let s2 = s1;                      // æ‰€æœ‰æƒè½¬ç§»åˆ° s2
    // println!("{}", s1);           // é”™è¯¯ï¼šs1 ä¸å†æ‹¥æœ‰å€¼
    println!("{}", s2);              // æ­£ç¡®ï¼šs2 æ‹¥æœ‰å€¼
} // s2 ç¦»å¼€ä½œç”¨åŸŸï¼Œå€¼è¢«ä¸¢å¼ƒ
```

**å½¢å¼åŒ–æè¿°**:

- åˆå§‹çŠ¶æ€: $\Omega(s1) = \text{Owned}$, $\Gamma(s1) = \text{"hello"}$
- æ‰§è¡Œ `let s2 = s1;`: $\Omega(s1) = \text{Moved}$, $\Omega(s2) = \text{Owned}$
- ä½œç”¨åŸŸç»“æŸ: $s2$ çš„å€¼è¢«ä¸¢å¼ƒ

### ç¤ºä¾‹ 2: å€Ÿç”¨

```rust
fn main() {
    let s = String::from("hello");
    let len = calculate_length(&s);  // å€Ÿç”¨ s
    println!("{}", s);               // æ­£ç¡®ï¼šs ä»ç„¶æ‹¥æœ‰å€¼
    println!("é•¿åº¦: {}", len);
}

fn calculate_length(s: &String) -> usize {
    s.len()
} // å€Ÿç”¨ç»“æŸï¼Œs çš„æ‰€æœ‰æƒæœªè½¬ç§»
```

**å½¢å¼åŒ–æè¿°**:

- å€Ÿç”¨æœŸé—´: $\Omega(s) = \text{Owned}$, å­˜åœ¨å€Ÿç”¨å¼•ç”¨
- å€Ÿç”¨ç»“æŸ: å€Ÿç”¨å¼•ç”¨å¤±æ•ˆï¼Œ$\Omega(s)$ ä»ä¸º $\text{Owned}$

### ç¤ºä¾‹ 3: å¤åˆ¶è¯­ä¹‰

```rust
fn main() {
    let x = 42;        // x æ‹¥æœ‰æ•´æ•°
    let y = x;         // å¤åˆ¶ï¼šx å’Œ y éƒ½æ‹¥æœ‰å€¼
    println!("{} {}", x, y);  // æ­£ç¡®ï¼šä¸¤è€…éƒ½å¯ç”¨
} // x å’Œ y éƒ½ç¦»å¼€ä½œç”¨åŸŸï¼Œä½†æ•´æ•°æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¸éœ€è¦é‡Šæ”¾
```

**å½¢å¼åŒ–æè¿°**:

- ç”±äº `i32` å®ç° `Copy`ï¼Œæ‰§è¡Œ `let y = x;` æ—¶ï¼š
  - $\Omega(x) = \text{Owned}$, $\Omega(y) = \text{Owned}$
  - $\Gamma(y) = \text{copy}(\Gamma(x)) = 42$

### ç¤ºä¾‹ 4: ä½œç”¨åŸŸè§„åˆ™

```rust
fn main() {
    {
        let s = String::from("hello");  // s æ‹¥æœ‰å­—ç¬¦ä¸²
        println!("{}", s);
    } // s ç¦»å¼€ä½œç”¨åŸŸï¼Œå­—ç¬¦ä¸²è¢«é‡Šæ”¾
    // println!("{}", s);  // é”™è¯¯ï¼šs ä¸å†å­˜åœ¨
}
```

**å½¢å¼åŒ–æè¿°**:

- è¿›å…¥å†…éƒ¨ä½œç”¨åŸŸ: $\Omega(s) = \text{Owned}$, $\Gamma(s) = \text{"hello"}$
- ç¦»å¼€å†…éƒ¨ä½œç”¨åŸŸ: $s$ ç¦»å¼€ä½œç”¨åŸŸï¼Œç”±äº $\Omega(s) = \text{Owned}$ï¼Œå€¼è¢«ä¸¢å¼ƒ

---

## ğŸ“– å‚è€ƒæ–‡çŒ®

### å­¦æœ¯è®ºæ–‡

1. **RustBelt: Logical Foundations for the Future of Safe Systems Programming**
   - ä½œè€…: Ralf Jung, et al.
   - å¹´ä»½: 2018
   - æ‘˜è¦: ä¸º Rust çš„æ‰€æœ‰æƒå’Œå€Ÿç”¨ç³»ç»Ÿæä¾›å½¢å¼åŒ–åŸºç¡€

2. **The RustBelt Project: Formalizing Rust's Type System**
   - ä½œè€…: Derek Dreyer
   - å¹´ä»½: 2017
   - æ‘˜è¦: Rust ç±»å‹ç³»ç»Ÿçš„å½¢å¼åŒ–ç ”ç©¶

### å®˜æ–¹æ–‡æ¡£

- [Rust Book - Ownership](https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html)
- [Rust Reference - Ownership](https://doc.rust-lang.org/reference/ownership.html)

### ç›¸å…³ä»£ç 

- [æ‰€æœ‰æƒå®ç°](../../../crates/c01_ownership_borrow_scope/src/)
- [æ‰€æœ‰æƒæ–‡æ¡£](../../../crates/c01_ownership_borrow_scope/docs/)

### å·¥å…·èµ„æº

- [Coq è¯æ˜åŠ©æ‰‹](https://coq.inria.fr/)
- [RustBelt é¡¹ç›®](https://plv.mpi-sws.org/rustbelt/)

---

## ğŸ”„ ç ”ç©¶è¿›å±•

### å·²å®Œæˆ âœ…

- [x] ç ”ç©¶ç›®æ ‡å®šä¹‰
- [x] ç†è®ºåŸºç¡€æ•´ç†ï¼ˆåŒ…æ‹¬ç†è®ºèƒŒæ™¯ï¼‰
- [x] åˆæ­¥å½¢å¼åŒ–å®šä¹‰
- [x] å®Œå–„æ‰€æœ‰æƒè§„åˆ™ï¼ˆè§„åˆ™ 4ã€è§„åˆ™ 5ï¼‰
- [x] æ·»åŠ æ‰€æœ‰æƒå”¯ä¸€æ€§å®šç†
- [x] å®Œå–„ä»£ç ç¤ºä¾‹ï¼ˆç¤ºä¾‹ 3ã€ç¤ºä¾‹ 4ï¼‰

### è¿›è¡Œä¸­ ğŸ”„

- [ ] å®Œæ•´çš„å½¢å¼åŒ–å®šä¹‰
- [ ] å†…å­˜å®‰å…¨è¯æ˜
- [ ] å·¥å…·éªŒè¯

### è®¡åˆ’ä¸­ ğŸ“‹

- [ ] ä¸å€Ÿç”¨æ£€æŸ¥å™¨çš„é›†æˆ
- [ ] ä¸ç”Ÿå‘½å‘¨æœŸçš„é›†æˆ
- [ ] å®é™…åº”ç”¨æ¡ˆä¾‹

---

**ç»´æŠ¤è€…**: Rust Formal Methods Research Group
**æœ€åæ›´æ–°**: 2025-11-15
**çŠ¶æ€**: ğŸ”„ **è¿›è¡Œä¸­**
