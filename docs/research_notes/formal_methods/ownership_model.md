# æ‰€æœ‰æƒæ¨¡å‹å½¢å¼åŒ–

> **åˆ›å»ºæ—¥æœŸ**: 2025-01-27
> **æœ€åæ›´æ–°**: 2025-11-15
> **Rust ç‰ˆæœ¬**: 1.91.1+ (Edition 2024) âœ…
> **çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­

---

## ğŸ“Š ç›®å½•

- [æ‰€æœ‰æƒæ¨¡å‹å½¢å¼åŒ–](#æ‰€æœ‰æƒæ¨¡å‹å½¢å¼åŒ–)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ ç ”ç©¶ç›®æ ‡](#-ç ”ç©¶ç›®æ ‡)
    - [æ ¸å¿ƒé—®é¢˜](#æ ¸å¿ƒé—®é¢˜)
    - [é¢„æœŸæˆæœ](#é¢„æœŸæˆæœ)
  - [ğŸ“š ç†è®ºåŸºç¡€](#-ç†è®ºåŸºç¡€)
    - [Rust æ‰€æœ‰æƒä¸‰åŸåˆ™](#rust-æ‰€æœ‰æƒä¸‰åŸåˆ™)
    - [ç›¸å…³æ¦‚å¿µ](#ç›¸å…³æ¦‚å¿µ)
    - [ç†è®ºèƒŒæ™¯](#ç†è®ºèƒŒæ™¯)
    - [çº¿æ€§ç±»å‹ç³»ç»Ÿçš„è¯¦ç»†è¯´æ˜](#çº¿æ€§ç±»å‹ç³»ç»Ÿçš„è¯¦ç»†è¯´æ˜)
    - [åˆ†ç¦»é€»è¾‘çš„ç›¸å…³å†…å®¹](#åˆ†ç¦»é€»è¾‘çš„ç›¸å…³å†…å®¹)
    - [æ‰€æœ‰æƒè¯­ä¹‰çš„å½¢å¼åŒ–æè¿°](#æ‰€æœ‰æƒè¯­ä¹‰çš„å½¢å¼åŒ–æè¿°)
    - [ç›¸å…³å­¦æœ¯è®ºæ–‡çš„è¯¦ç»†åˆ†æ](#ç›¸å…³å­¦æœ¯è®ºæ–‡çš„è¯¦ç»†åˆ†æ)
      - [1. RustBelt: Logical Foundations for the Future of Safe Systems Programming](#1-rustbelt-logical-foundations-for-the-future-of-safe-systems-programming)
      - [2. The RustBelt Project: Formalizing Rust's Type System](#2-the-rustbelt-project-formalizing-rusts-type-system)
  - [ğŸ”¬ å½¢å¼åŒ–å®šä¹‰](#-å½¢å¼åŒ–å®šä¹‰)
    - [1. å€¼ä¸ç¯å¢ƒ](#1-å€¼ä¸ç¯å¢ƒ)
    - [2. æ‰€æœ‰æƒè§„åˆ™](#2-æ‰€æœ‰æƒè§„åˆ™)
    - [3. å†…å­˜å®‰å…¨](#3-å†…å­˜å®‰å…¨)
  - [âœ… è¯æ˜ç›®æ ‡](#-è¯æ˜ç›®æ ‡)
    - [å¾…è¯æ˜çš„æ€§è´¨](#å¾…è¯æ˜çš„æ€§è´¨)
    - [è¯æ˜æ–¹æ³•](#è¯æ˜æ–¹æ³•)
  - [ğŸ’» ä»£ç ç¤ºä¾‹ä¸å®è·µ](#-ä»£ç ç¤ºä¾‹ä¸å®è·µ)
    - [ç¤ºä¾‹ 1: æ‰€æœ‰æƒè½¬ç§»](#ç¤ºä¾‹-1-æ‰€æœ‰æƒè½¬ç§»)
    - [ç¤ºä¾‹ 2: å€Ÿç”¨](#ç¤ºä¾‹-2-å€Ÿç”¨)
    - [ç¤ºä¾‹ 3: å¤åˆ¶è¯­ä¹‰](#ç¤ºä¾‹-3-å¤åˆ¶è¯­ä¹‰)
    - [ç¤ºä¾‹ 4: ä½œç”¨åŸŸè§„åˆ™](#ç¤ºä¾‹-4-ä½œç”¨åŸŸè§„åˆ™)
    - [ç¤ºä¾‹ 5: å¤æ‚æ‰€æœ‰æƒåœºæ™¯](#ç¤ºä¾‹-5-å¤æ‚æ‰€æœ‰æƒåœºæ™¯)
    - [ç¤ºä¾‹ 6: æ‰€æœ‰æƒä¸å‡½æ•°è¿”å›](#ç¤ºä¾‹-6-æ‰€æœ‰æƒä¸å‡½æ•°è¿”å›)
  - [ğŸ“– å‚è€ƒæ–‡çŒ®](#-å‚è€ƒæ–‡çŒ®)
    - [å­¦æœ¯è®ºæ–‡](#å­¦æœ¯è®ºæ–‡)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [ç›¸å…³ä»£ç ](#ç›¸å…³ä»£ç )
    - [å·¥å…·èµ„æº](#å·¥å…·èµ„æº)
  - [ğŸ”„ ç ”ç©¶è¿›å±•](#-ç ”ç©¶è¿›å±•)
    - [å·²å®Œæˆ âœ…](#å·²å®Œæˆ-)
    - [è¿›è¡Œä¸­ ğŸ”„](#è¿›è¡Œä¸­-)
    - [è®¡åˆ’ä¸­ ğŸ“‹](#è®¡åˆ’ä¸­-)
    - [æ–°å¢ä»£ç ç¤ºä¾‹](#æ–°å¢ä»£ç ç¤ºä¾‹)
      - [ç¤ºä¾‹ 7: æ‰€æœ‰æƒè½¬ç§»ä¸å‡½æ•°å‚æ•°](#ç¤ºä¾‹-7-æ‰€æœ‰æƒè½¬ç§»ä¸å‡½æ•°å‚æ•°)
      - [ç¤ºä¾‹ 8: å¤æ‚æ‰€æœ‰æƒåœºæ™¯ - ç»“æ„ä½“å­—æ®µç§»åŠ¨](#ç¤ºä¾‹-8-å¤æ‚æ‰€æœ‰æƒåœºæ™¯---ç»“æ„ä½“å­—æ®µç§»åŠ¨)
      - [ç¤ºä¾‹ 9: é”™è¯¯ç¤ºä¾‹ - ä½¿ç”¨å·²ç§»åŠ¨çš„å€¼](#ç¤ºä¾‹-9-é”™è¯¯ç¤ºä¾‹---ä½¿ç”¨å·²ç§»åŠ¨çš„å€¼)
      - [ç¤ºä¾‹ 10: æ‰€æœ‰æƒä¸å€Ÿç”¨ç»“åˆ](#ç¤ºä¾‹-10-æ‰€æœ‰æƒä¸å€Ÿç”¨ç»“åˆ)

---

## ğŸ¯ ç ”ç©¶ç›®æ ‡

æœ¬ç ”ç©¶çš„ç›®çš„æ˜¯å½¢å¼åŒ–å®šä¹‰ Rust çš„æ‰€æœ‰æƒç³»ç»Ÿï¼Œå¹¶è¯æ˜å…¶ä¿è¯å†…å­˜å®‰å…¨ã€‚

### æ ¸å¿ƒé—®é¢˜

1. **æ‰€æœ‰æƒè§„åˆ™çš„å½¢å¼åŒ–**: å¦‚ä½•ç”¨æ•°å­¦è¯­è¨€ç²¾ç¡®æè¿°æ‰€æœ‰æƒè§„åˆ™ï¼Ÿ
2. **å†…å­˜å®‰å…¨è¯æ˜**: å¦‚ä½•è¯æ˜æ‰€æœ‰æƒç³»ç»Ÿä¿è¯å†…å­˜å®‰å…¨ï¼Ÿ
3. **æ‰€æœ‰æƒè½¬ç§»è¯­ä¹‰**: æ‰€æœ‰æƒè½¬ç§»çš„è¯­ä¹‰å¦‚ä½•å½¢å¼åŒ–è¡¨ç¤ºï¼Ÿ

### é¢„æœŸæˆæœ

- æ‰€æœ‰æƒç³»ç»Ÿçš„å½¢å¼åŒ–å®šä¹‰
- å†…å­˜å®‰å…¨çš„å½¢å¼åŒ–è¯æ˜
- æ‰€æœ‰æƒè½¬ç§»çš„è¯­ä¹‰æ¨¡å‹

---

## ğŸ“š ç†è®ºåŸºç¡€

### Rust æ‰€æœ‰æƒä¸‰åŸåˆ™

1. **æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…**
2. **åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…**
3. **å½“æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå€¼è¢«ä¸¢å¼ƒ**

### ç›¸å…³æ¦‚å¿µ

**ç§»åŠ¨è¯­ä¹‰ (Move Semantics)**: æ‰€æœ‰æƒä»ä¸€ä¸ªå˜é‡è½¬ç§»åˆ°å¦ä¸€ä¸ªå˜é‡ã€‚å½“å€¼è¢«ç§»åŠ¨æ—¶ï¼ŒåŸå˜é‡ä¸å†æ‹¥æœ‰è¯¥å€¼ã€‚

**å¤åˆ¶è¯­ä¹‰ (Copy Semantics)**: å®ç° `Copy` trait çš„ç±»å‹å¯ä»¥å¤åˆ¶ã€‚å¤åˆ¶ä¸ä¼šè½¬ç§»æ‰€æœ‰æƒï¼Œè€Œæ˜¯åˆ›å»ºå€¼çš„å‰¯æœ¬ã€‚

**å€Ÿç”¨ (Borrowing)**: ä¸´æ—¶å€Ÿç”¨æ‰€æœ‰æƒï¼Œä¸è½¬ç§»æ‰€æœ‰æƒã€‚å€Ÿç”¨å¯ä»¥æ˜¯ä¸å¯å˜çš„ï¼ˆ`&T`ï¼‰æˆ–å¯å˜çš„ï¼ˆ`&mut T`ï¼‰ã€‚

**ä½œç”¨åŸŸ (Scope)**: å˜é‡çš„æœ‰æ•ˆèŒƒå›´ã€‚å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå¦‚æœå®ƒæ‹¥æœ‰å€¼ï¼Œå€¼ä¼šè¢«ä¸¢å¼ƒã€‚

### ç†è®ºèƒŒæ™¯

**çº¿æ€§ç±»å‹ç³»ç»Ÿ (Linear Type System)**: ç”¨äºå»ºæ¨¡æ‰€æœ‰æƒè½¬ç§»çš„ç±»å‹ç³»ç»Ÿã€‚åœ¨çº¿æ€§ç±»å‹ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå€¼åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè¿™ä¸ Rust çš„æ‰€æœ‰æƒç³»ç»Ÿéå¸¸ç›¸ä¼¼ã€‚

**åˆ†ç¦»é€»è¾‘ (Separation Logic)**: ç”¨äºè¡¨è¾¾å€Ÿç”¨è§„åˆ™çš„é€»è¾‘ç³»ç»Ÿã€‚åˆ†ç¦»é€»è¾‘å¯ä»¥è¡¨è¾¾å†…å­˜çš„åˆ†ç¦»å’Œå…±äº«ï¼Œè¿™ä¸ Rust çš„å€Ÿç”¨è§„åˆ™å¯¹åº”ã€‚

**èµ„æºç®¡ç†ç†è®º**: æ‰€æœ‰æƒç³»ç»Ÿå¯ä»¥è§†ä¸ºä¸€ç§èµ„æºç®¡ç†æœºåˆ¶ï¼Œç¡®ä¿èµ„æºåœ¨ä½¿ç”¨åæ­£ç¡®é‡Šæ”¾ã€‚

### çº¿æ€§ç±»å‹ç³»ç»Ÿçš„è¯¦ç»†è¯´æ˜

çº¿æ€§ç±»å‹ç³»ç»Ÿæ˜¯ä¸€ç§ç±»å‹ç³»ç»Ÿï¼Œå…¶ä¸­æ¯ä¸ªå€¼å¿…é¡»æ°å¥½ä½¿ç”¨ä¸€æ¬¡ã€‚è¿™ä¸ Rust çš„æ‰€æœ‰æƒç³»ç»Ÿéå¸¸ç›¸ä¼¼ï¼š

1. **çº¿æ€§å€¼**: å¿…é¡»æ°å¥½ä½¿ç”¨ä¸€æ¬¡çš„å€¼
2. **ä»¿å°„å€¼**: æœ€å¤šä½¿ç”¨ä¸€æ¬¡çš„å€¼ï¼ˆRust çš„ç§»åŠ¨è¯­ä¹‰ï¼‰
3. **ç›¸å…³å€¼**: å¯ä»¥å¤šæ¬¡ä½¿ç”¨çš„å€¼ï¼ˆRust çš„ `Copy` ç±»å‹ï¼‰

åœ¨ Rust ä¸­ï¼š

- `String` æ˜¯çº¿æ€§ç±»å‹ï¼ˆå¿…é¡»ç§»åŠ¨ï¼‰
- å¤§å¤šæ•°ç±»å‹æ˜¯ä»¿å°„ç±»å‹ï¼ˆå¯ä»¥ç§»åŠ¨ï¼Œä½†ä¸èƒ½å¤åˆ¶ï¼‰
- `i32` ç­‰åŸºæœ¬ç±»å‹æ˜¯ç›¸å…³ç±»å‹ï¼ˆå¯ä»¥å¤åˆ¶ï¼‰

### åˆ†ç¦»é€»è¾‘çš„ç›¸å…³å†…å®¹

åˆ†ç¦»é€»è¾‘ï¼ˆSeparation Logicï¼‰æ˜¯ Hoare é€»è¾‘çš„æ‰©å±•ï¼Œç”¨äºæ¨ç†å…±äº«å’Œåˆ†ç¦»çš„å†…å­˜ï¼š

**æ ¸å¿ƒæ“ä½œç¬¦**:

- $P * Q$: åˆ†ç¦»åˆå–ï¼ˆP å’Œ Q æŒæœ‰ä¸ç›¸äº¤çš„å†…å­˜ï¼‰
- $P \rightarrow Q$: é­”æ³•æ£’ï¼ˆå¦‚æœ P æŒæœ‰å†…å­˜ï¼Œåˆ™ Q ä¹ŸæŒæœ‰ï¼‰

**åœ¨ Rust ä¸­çš„åº”ç”¨**:

- ä¸å¯å˜å€Ÿç”¨: å¤šä¸ªå¼•ç”¨å¯ä»¥å…±äº«åŒä¸€å†…å­˜ï¼ˆ$P * P * \ldots$ï¼‰
- å¯å˜å€Ÿç”¨: å”¯ä¸€å¼•ç”¨ç‹¬å å†…å­˜ï¼ˆ$P \rightarrow \text{exclusive}(P)$ï¼‰

### æ‰€æœ‰æƒè¯­ä¹‰çš„å½¢å¼åŒ–æè¿°

æ‰€æœ‰æƒè¯­ä¹‰å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å½¢å¼åŒ–ï¼š

**çŠ¶æ€è½¬æ¢ç³»ç»Ÿ**:

- çŠ¶æ€: $(\Gamma, \Omega)$ å…¶ä¸­ $\Gamma$ æ˜¯å€¼ç¯å¢ƒï¼Œ$\Omega$ æ˜¯æ‰€æœ‰æƒç¯å¢ƒ
- è½¬æ¢è§„åˆ™: å®šä¹‰æ‰€æœ‰æƒå¦‚ä½•åœ¨ä¸åŒçŠ¶æ€é—´è½¬ç§»

**è¯­ä¹‰å‡½æ•°**:

- $\text{own}(x)$: å˜é‡ $x$ çš„æ‰€æœ‰æƒçŠ¶æ€
- $\text{move}(x, y)$: æ‰€æœ‰æƒä» $x$ è½¬ç§»åˆ° $y$
- $\text{drop}(x)$: é‡Šæ”¾ $x$ æ‹¥æœ‰çš„å€¼

### ç›¸å…³å­¦æœ¯è®ºæ–‡çš„è¯¦ç»†åˆ†æ

#### 1. RustBelt: Logical Foundations for the Future of Safe Systems Programming

**æ ¸å¿ƒè´¡çŒ®**:

- ä¸º Rust çš„æ‰€æœ‰æƒå’Œå€Ÿç”¨ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„å½¢å¼åŒ–åŸºç¡€
- ä½¿ç”¨ Iris æ¡†æ¶ï¼ˆåŸºäºåˆ†ç¦»é€»è¾‘ï¼‰è¿›è¡Œè¯æ˜
- è¯æ˜äº†å€Ÿç”¨æ£€æŸ¥å™¨ä¿è¯å†…å­˜å®‰å…¨

**å…³é”®ç»“æœ**:

- æ‰€æœ‰æƒè§„åˆ™çš„å½¢å¼åŒ–
- å€Ÿç”¨è§„åˆ™çš„å½¢å¼åŒ–
- å†…å­˜å®‰å…¨çš„å½¢å¼åŒ–è¯æ˜

**ä¸æœ¬ç ”ç©¶çš„å…³è”**:

- æä¾›äº†ç†è®ºåŸºç¡€
- æä¾›äº†è¯æ˜æ–¹æ³•
- æä¾›äº†å·¥å…·æ”¯æŒ

#### 2. The RustBelt Project: Formalizing Rust's Type System

**æ ¸å¿ƒè´¡çŒ®**:

- Rust ç±»å‹ç³»ç»Ÿçš„å½¢å¼åŒ–
- ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿçš„å½¢å¼åŒ–
- Trait ç³»ç»Ÿçš„å½¢å¼åŒ–

**å…³é”®ç»“æœ**:

- ç±»å‹ç³»ç»Ÿçš„å®Œæ•´å½¢å¼åŒ–å®šä¹‰
- ç±»å‹å®‰å…¨çš„è¯æ˜
- ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ

**ä¸æœ¬ç ”ç©¶çš„å…³è”**:

- æä¾›äº†ç±»å‹ç³»ç»Ÿçš„å½¢å¼åŒ–æ–¹æ³•
- æä¾›äº†ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆæ–¹æ³•

---

## ğŸ”¬ å½¢å¼åŒ–å®šä¹‰

### 1. å€¼ä¸ç¯å¢ƒ

**å®šä¹‰ 1.1 (å€¼)**: å€¼ $v$ å¯ä»¥æ˜¯ï¼š

- æ•´æ•°ã€å¸ƒå°”å€¼ç­‰åŸºæœ¬ç±»å‹
- ç»“æ„ä½“ã€æšä¸¾ç­‰å¤åˆç±»å‹
- å¼•ç”¨ã€æŒ‡é’ˆç­‰

**å®šä¹‰ 1.2 (ç¯å¢ƒ)**: ç¯å¢ƒ $\Gamma$ æ˜¯ä¸€ä¸ªä»å˜é‡åˆ°å€¼çš„æ˜ å°„ï¼š
$$\Gamma : \text{Var} \to \text{Val}$$

**å®šä¹‰ 1.3 (æ‰€æœ‰æƒç¯å¢ƒ)**: æ‰€æœ‰æƒç¯å¢ƒ $\Omega$ æ˜¯ä¸€ä¸ªä»å˜é‡åˆ°æ‰€æœ‰æƒçš„æ˜ å°„ï¼š
$$\Omega : \text{Var} \to \{\text{Owned}, \text{Borrowed}, \text{Moved}\}$$

### 2. æ‰€æœ‰æƒè§„åˆ™

**è§„åˆ™ 1 (æ‰€æœ‰æƒå”¯ä¸€æ€§)**:
å¯¹äºä»»ä½•å€¼ $v$ï¼Œåœ¨ç¯å¢ƒ $\Omega$ ä¸­ï¼Œæœ€å¤šå­˜åœ¨ä¸€ä¸ªå˜é‡ $x$ ä½¿å¾— $\Omega(x) = \text{Owned}$ ä¸” $\Gamma(x) = v$ã€‚

**è§„åˆ™ 2 (ç§»åŠ¨è¯­ä¹‰)**:
å½“æ‰§è¡Œ `let y = x;` æ—¶ï¼ˆ$x$ ä¸å®ç° `Copy`ï¼‰ï¼Œæ‰€æœ‰æƒä» $x$ è½¬ç§»åˆ° $y$ï¼š

- $\Omega(x) \leftarrow \text{Moved}$
- $\Omega(y) \leftarrow \text{Owned}$
- $\Gamma(y) \leftarrow \Gamma(x)$

**è§„åˆ™ 3 (ä½œç”¨åŸŸç»“æŸ)**:
å½“å˜é‡ $x$ ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå¦‚æœ $\Omega(x) = \text{Owned}$ï¼Œåˆ™å€¼è¢«ä¸¢å¼ƒï¼ˆdeallocatedï¼‰ã€‚

**è§„åˆ™ 4 (å¤åˆ¶è¯­ä¹‰)**:
å¦‚æœç±»å‹ $T$ å®ç° `Copy` traitï¼Œåˆ™æ‰§è¡Œ `let y = x;` æ—¶ï¼Œ$x$ å’Œ $y$ éƒ½æ‹¥æœ‰å€¼çš„å‰¯æœ¬ï¼š

- $\Omega(x) = \text{Owned}$
- $\Omega(y) = \text{Owned}$
- $\Gamma(y) = \text{copy}(\Gamma(x))$

**è§„åˆ™ 5 (å€Ÿç”¨è§„åˆ™)**:
å€Ÿç”¨ä¸è½¬ç§»æ‰€æœ‰æƒï¼š

- ä¸å¯å˜å€Ÿç”¨: $\Omega(x) = \text{Owned}$ï¼Œå­˜åœ¨å€Ÿç”¨å¼•ç”¨ $\&x$
- å¯å˜å€Ÿç”¨: $\Omega(x) = \text{Owned}$ï¼Œå­˜åœ¨å”¯ä¸€å€Ÿç”¨å¼•ç”¨ $\&mut x$

**è§„åˆ™ 6 (å€Ÿç”¨å”¯ä¸€æ€§)**:
å¯¹äºå¯å˜å€Ÿç”¨ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªï¼š

$$\forall b_1, b_2: \text{type}(b_1) = \&mut T \land \text{type}(b_2) = \&mut T \land \text{target}(b_1) = \text{target}(b_2) \rightarrow b_1 = b_2$$

**è§„åˆ™ 7 (å€Ÿç”¨ä¸æ‰€æœ‰æƒå…±å­˜)**:
å€Ÿç”¨æœŸé—´ï¼Œæ‰€æœ‰æƒä»ç„¶ä¿ç•™åœ¨åŸå˜é‡ï¼š

$$\text{borrow}(x, b) \rightarrow \Omega(x) = \text{Owned} \land \text{valid}(b)$$

**è§„åˆ™ 8 (å€Ÿç”¨ä½œç”¨åŸŸ)**:
å€Ÿç”¨å¿…é¡»åœ¨åŸå˜é‡çš„ä½œç”¨åŸŸå†…ï¼š

$$\text{borrow}(x, b) \rightarrow \text{scope}(b) \subseteq \text{scope}(x)$$

### 3. å†…å­˜å®‰å…¨

**å®šç† 1 (å†…å­˜å®‰å…¨)**:
åœ¨æ‰€æœ‰æƒç³»ç»Ÿä¸‹ï¼Œç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼š

- ä¸ä¼šå‡ºç°æ‚¬å‚æŒ‡é’ˆï¼ˆdangling pointerï¼‰
- ä¸ä¼šå‡ºç°åŒé‡é‡Šæ”¾ï¼ˆdouble freeï¼‰
- ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼ˆmemory leakï¼‰

**è¯æ˜æ€è·¯**:

- æ‰€æœ‰æƒå”¯ä¸€æ€§ä¿è¯æ¯ä¸ªå€¼åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…
- ä½œç”¨åŸŸè§„åˆ™ä¿è¯å€¼åœ¨ä½¿ç”¨åæ­£ç¡®é‡Šæ”¾
- ç§»åŠ¨è¯­ä¹‰ä¿è¯å€¼ä¸ä¼šè¢«æ„å¤–å¤åˆ¶

**å®šç† 2 (æ‰€æœ‰æƒå”¯ä¸€æ€§)**:
å¯¹äºä»»ä½•å€¼ $v$ï¼Œåœ¨ä»»æ„æ—¶åˆ»ï¼Œæœ€å¤šå­˜åœ¨ä¸€ä¸ªå˜é‡ $x$ ä½¿å¾— $\Omega(x) = \text{Owned}$ ä¸” $\Gamma(x) = v$ã€‚

**è¯æ˜**: ç”±è§„åˆ™ 1 å’Œè§„åˆ™ 2 ç›´æ¥å¾—å‡ºã€‚

**å®Œæ•´è¯æ˜**:

**åŸºç¡€æƒ…å†µ**: åˆå§‹çŠ¶æ€ï¼Œæ¯ä¸ªå€¼åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼ˆç”±è§„åˆ™1ä¿è¯ï¼‰ã€‚

**å½’çº³æ­¥éª¤**: å‡è®¾åœ¨çŠ¶æ€ $S$ ä¸­ï¼Œæ‰€æœ‰æƒå”¯ä¸€æ€§æˆç«‹ã€‚è€ƒè™‘çŠ¶æ€è½¬æ¢ï¼š

1. **ç§»åŠ¨æ“ä½œ** (`let y = x;`):
   - æ ¹æ®è§„åˆ™2ï¼Œç§»åŠ¨æ“ä½œå°†æ‰€æœ‰æƒä» $x$ è½¬ç§»åˆ° $y$
   - $\Omega(x) \leftarrow \text{Moved}$ï¼Œ$\Omega(y) \leftarrow \text{Owned}$
   - ç”±äº $x$ è¢«æ ‡è®°ä¸º $\text{Moved}$ï¼Œä¸å†æ‹¥æœ‰å€¼
   - å› æ­¤ï¼Œå€¼ $v$ ç°åœ¨åªè¢« $y$ æ‹¥æœ‰
   - å”¯ä¸€æ€§ä¿æŒ

2. **å¤åˆ¶æ“ä½œ** (`let y = x;` å…¶ä¸­ $x$ å®ç° `Copy`):
   - æ ¹æ®è§„åˆ™4ï¼Œå¤åˆ¶æ“ä½œåˆ›å»ºå€¼çš„å‰¯æœ¬
   - $\Gamma(y) = \text{copy}(\Gamma(x))$ï¼Œå› æ­¤ $\Gamma(y) \neq \Gamma(x)$
   - $x$ å’Œ $y$ æ‹¥æœ‰ä¸åŒçš„å€¼ï¼ˆå‰¯æœ¬ï¼‰
   - å”¯ä¸€æ€§ä¿æŒ

3. **ä½œç”¨åŸŸç»“æŸ**:
   - æ ¹æ®è§„åˆ™3ï¼Œå½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå¦‚æœ $\Omega(x) = \text{Owned}$ï¼Œå€¼è¢«ä¸¢å¼ƒ
   - å€¼è¢«é‡Šæ”¾åï¼Œä¸å†è¢«ä»»ä½•å˜é‡æ‹¥æœ‰
   - å”¯ä¸€æ€§ä¿æŒï¼ˆç©ºé›†æƒ…å†µï¼‰

**ç»“è®º**: ç”±ç»“æ„å½’çº³æ³•ï¼Œæ‰€æœ‰æƒå”¯ä¸€æ€§åœ¨æ‰€æœ‰çŠ¶æ€ä¸‹éƒ½æˆç«‹ã€‚$\square$

**å®šç† 3 (å†…å­˜å®‰å…¨æ¡†æ¶)**:
åœ¨æ‰€æœ‰æƒç³»ç»Ÿä¸‹ï¼Œä»¥ä¸‹æ€§è´¨æˆç«‹ï¼š

1. **æ— æ‚¬å‚æŒ‡é’ˆ**: $\forall x: \text{valid}(x) \rightarrow \text{owner}(x) \neq \emptyset$
2. **æ— åŒé‡é‡Šæ”¾**: $\forall x, y: x \neq y \land \text{owner}(x) = \text{owner}(y) \rightarrow \text{false}$
3. **æ— å†…å­˜æ³„æ¼**: $\forall x: \text{scope\_end}(x) \land \Omega(x) = \text{Owned} \rightarrow \text{deallocated}(x)$

**è¯æ˜æ€è·¯**:

- æ€§è´¨1: ç”±æ‰€æœ‰æƒå”¯ä¸€æ€§å’Œä½œç”¨åŸŸè§„åˆ™ä¿è¯
- æ€§è´¨2: ç”±æ‰€æœ‰æƒå”¯ä¸€æ€§ç›´æ¥ä¿è¯
- æ€§è´¨3: ç”±è§„åˆ™3ï¼ˆä½œç”¨åŸŸç»“æŸï¼‰ä¿è¯

**å®Œæ•´è¯æ˜**:

**æ€§è´¨1ï¼ˆæ— æ‚¬å‚æŒ‡é’ˆï¼‰**:

- å‡è®¾å­˜åœ¨æ‚¬å‚æŒ‡é’ˆ $x$ï¼Œå³ $\text{valid}(x)$ ä½† $\text{owner}(x) = \emptyset$
- æ ¹æ®æ‰€æœ‰æƒå”¯ä¸€æ€§ï¼ˆå®šç†2ï¼‰ï¼Œæ¯ä¸ªå€¼éƒ½æœ‰å”¯ä¸€æ‰€æœ‰è€…
- å¦‚æœ $\text{owner}(x) = \emptyset$ï¼Œåˆ™å€¼å·²è¢«é‡Šæ”¾
- ä½†æ ¹æ®ä½œç”¨åŸŸè§„åˆ™ï¼Œå€¼é‡Šæ”¾åå¼•ç”¨å¤±æ•ˆ
- çŸ›ç›¾ï¼Œå› æ­¤ä¸å­˜åœ¨æ‚¬å‚æŒ‡é’ˆ

**æ€§è´¨2ï¼ˆæ— åŒé‡é‡Šæ”¾ï¼‰**:

- å‡è®¾å­˜åœ¨åŒé‡é‡Šæ”¾ï¼Œå³ $x \neq y$ ä¸” $\text{owner}(x) = \text{owner}(y)$
- æ ¹æ®æ‰€æœ‰æƒå”¯ä¸€æ€§ï¼ˆå®šç†2ï¼‰ï¼Œæ¯ä¸ªå€¼æœ€å¤šæœ‰ä¸€ä¸ªæ‰€æœ‰è€…
- å¦‚æœ $x$ å’Œ $y$ éƒ½æ‹¥æœ‰åŒä¸€å€¼ï¼Œè¿åå”¯ä¸€æ€§
- çŸ›ç›¾ï¼Œå› æ­¤ä¸å­˜åœ¨åŒé‡é‡Šæ”¾

**æ€§è´¨3ï¼ˆæ— å†…å­˜æ³„æ¼ï¼‰**:

- æ ¹æ®è§„åˆ™3ï¼ˆä½œç”¨åŸŸç»“æŸï¼‰ï¼Œå½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå¦‚æœ $\Omega(x) = \text{Owned}$ï¼Œå€¼è¢«ä¸¢å¼ƒ
- å› æ­¤ï¼Œæ‰€æœ‰æ‹¥æœ‰çš„å€¼åœ¨ä½œç”¨åŸŸç»“æŸæ—¶éƒ½ä¼šè¢«é‡Šæ”¾
- ä¸å­˜åœ¨å†…å­˜æ³„æ¼

**ç»“è®º**: ç”±ä»¥ä¸Šä¸‰ä¸ªæ€§è´¨çš„è¯æ˜ï¼Œæ‰€æœ‰æƒç³»ç»Ÿä¿è¯å†…å­˜å®‰å…¨ã€‚$\square$

**å®šç† 4 (æ‰€æœ‰æƒè½¬ç§»è¯­ä¹‰)**:
æ‰€æœ‰æƒè½¬ç§»æ“ä½œæ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼š

1. **å”¯ä¸€æ€§ä¿æŒ**: $\text{move}(x, y) \rightarrow \Omega(x) = \text{Moved} \land \Omega(y) = \text{Owned}$
2. **å€¼ä¿æŒ**: $\text{move}(x, y) \rightarrow \Gamma(y) = \Gamma(x)$
3. **ä¸å¯é€†æ€§**: $\text{move}(x, y) \rightarrow \neg \text{valid}(x)$

**è¯æ˜**: ç”±è§„åˆ™2ç›´æ¥å¾—å‡ºã€‚

---

## âœ… è¯æ˜ç›®æ ‡

### å¾…è¯æ˜çš„æ€§è´¨

1. **è¿›å±•æ€§ (Progress)**: è‰¯å‹ç¨‹åºä¸ä¼šå¡ä½
2. **ä¿æŒæ€§ (Preservation)**: ç±»å‹åœ¨æ±‚å€¼åä¿æŒ
3. **å†…å­˜å®‰å…¨**: ä¸ä¼šå‡ºç°å†…å­˜é”™è¯¯

### è¯æ˜æ–¹æ³•

- **ç»“æ„å½’çº³**: å¯¹ç¨‹åºç»“æ„è¿›è¡Œå½’çº³è¯æ˜
- **è§„åˆ™å½’çº³**: å¯¹ç±»å‹è§„åˆ™è¿›è¡Œå½’çº³è¯æ˜
- **æ¨¡å‹æ£€æŸ¥**: ä½¿ç”¨å·¥å…·éªŒè¯ç³»ç»Ÿå±æ€§

---

## ğŸ’» ä»£ç ç¤ºä¾‹ä¸å®è·µ

### ç¤ºä¾‹ 1: æ‰€æœ‰æƒè½¬ç§»

```rust
fn main() {
    let s1 = String::from("hello");  // s1 æ‹¥æœ‰å­—ç¬¦ä¸²
    let s2 = s1;                      // æ‰€æœ‰æƒè½¬ç§»åˆ° s2
    // println!("{}", s1);           // é”™è¯¯ï¼šs1 ä¸å†æ‹¥æœ‰å€¼
    println!("{}", s2);              // æ­£ç¡®ï¼šs2 æ‹¥æœ‰å€¼
} // s2 ç¦»å¼€ä½œç”¨åŸŸï¼Œå€¼è¢«ä¸¢å¼ƒ
```

**å½¢å¼åŒ–æè¿°**:

- åˆå§‹çŠ¶æ€: $\Omega(s1) = \text{Owned}$, $\Gamma(s1) = \text{"hello"}$
- æ‰§è¡Œ `let s2 = s1;`: $\Omega(s1) = \text{Moved}$, $\Omega(s2) = \text{Owned}$
- ä½œç”¨åŸŸç»“æŸ: $s2$ çš„å€¼è¢«ä¸¢å¼ƒ

### ç¤ºä¾‹ 2: å€Ÿç”¨

```rust
fn main() {
    let s = String::from("hello");
    let len = calculate_length(&s);  // å€Ÿç”¨ s
    println!("{}", s);               // æ­£ç¡®ï¼šs ä»ç„¶æ‹¥æœ‰å€¼
    println!("é•¿åº¦: {}", len);
}

fn calculate_length(s: &String) -> usize {
    s.len()
} // å€Ÿç”¨ç»“æŸï¼Œs çš„æ‰€æœ‰æƒæœªè½¬ç§»
```

**å½¢å¼åŒ–æè¿°**:

- å€Ÿç”¨æœŸé—´: $\Omega(s) = \text{Owned}$, å­˜åœ¨å€Ÿç”¨å¼•ç”¨
- å€Ÿç”¨ç»“æŸ: å€Ÿç”¨å¼•ç”¨å¤±æ•ˆï¼Œ$\Omega(s)$ ä»ä¸º $\text{Owned}$

### ç¤ºä¾‹ 3: å¤åˆ¶è¯­ä¹‰

```rust
fn main() {
    let x = 42;        // x æ‹¥æœ‰æ•´æ•°
    let y = x;         // å¤åˆ¶ï¼šx å’Œ y éƒ½æ‹¥æœ‰å€¼
    println!("{} {}", x, y);  // æ­£ç¡®ï¼šä¸¤è€…éƒ½å¯ç”¨
} // x å’Œ y éƒ½ç¦»å¼€ä½œç”¨åŸŸï¼Œä½†æ•´æ•°æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¸éœ€è¦é‡Šæ”¾
```

**å½¢å¼åŒ–æè¿°**:

- ç”±äº `i32` å®ç° `Copy`ï¼Œæ‰§è¡Œ `let y = x;` æ—¶ï¼š
  - $\Omega(x) = \text{Owned}$, $\Omega(y) = \text{Owned}$
  - $\Gamma(y) = \text{copy}(\Gamma(x)) = 42$

### ç¤ºä¾‹ 4: ä½œç”¨åŸŸè§„åˆ™

```rust
fn scope_example() {
    let s = String::from("hello");
    {
        let r = &s;  // å€Ÿç”¨å¼€å§‹
        println!("{}", r);
    }  // å€Ÿç”¨ç»“æŸï¼Œr ç¦»å¼€ä½œç”¨åŸŸ

    let r2 = &mut s;  // ç°åœ¨å¯ä»¥å¯å˜å€Ÿç”¨
    r2.push_str(" world");
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- å€Ÿç”¨ `r` çš„ä½œç”¨åŸŸæ˜¯ `[t1, t2]`
- åœ¨ `t2` ä¹‹åï¼Œ`r` ä¸å†æœ‰æ•ˆ
- å› æ­¤å¯ä»¥åœ¨ `t3 > t2` æ—¶åˆ›å»ºæ–°çš„å€Ÿç”¨ `r2`

### ç¤ºä¾‹ 5: å¤æ‚æ‰€æœ‰æƒåœºæ™¯

```rust
struct Person {
    name: String,
    age: u32,
}

fn complex_ownership() {
    let person = Person {
        name: String::from("Alice"),
        age: 30,
    };

    // ç§»åŠ¨ name å­—æ®µ
    let name = person.name;  // person.name çš„æ‰€æœ‰æƒè½¬ç§»
    // println!("{}", person.name);  // é”™è¯¯ï¼šperson.name å·²è¢«ç§»åŠ¨

    // person.age ä»ç„¶å¯ç”¨ï¼ˆå®ç°äº† Copyï¼‰
    println!("{}", person.age);

    // person çš„å…¶ä»–å­—æ®µä»ç„¶å¯ç”¨
    // ä½† person æœ¬èº«éƒ¨åˆ†ç§»åŠ¨ï¼Œä¸èƒ½æ•´ä½“ä½¿ç”¨
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- éƒ¨åˆ†ç§»åŠ¨ï¼šç»“æ„ä½“çš„éƒ¨åˆ†å­—æ®µè¢«ç§»åŠ¨
- æœªç§»åŠ¨çš„å­—æ®µä»ç„¶å¯ç”¨
- ç»“æ„ä½“æœ¬èº«ä¸èƒ½æ•´ä½“ä½¿ç”¨

### ç¤ºä¾‹ 6: æ‰€æœ‰æƒä¸å‡½æ•°è¿”å›

```rust
fn take_and_return(s: String) -> String {
    println!("{}", s);
    s  // è¿”å›æ‰€æœ‰æƒ
}

fn ownership_with_functions() {
    let s1 = String::from("hello");
    let s2 = take_and_return(s1);  // s1 çš„æ‰€æœ‰æƒè½¬ç§»åˆ°å‡½æ•°ï¼Œç„¶åè¿”å›ç»™ s2
    println!("{}", s2);
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- å‡½æ•°å‚æ•°æ¥æ”¶æ‰€æœ‰æƒï¼š`move(s1, param)`
- å‡½æ•°è¿”å›è½¬ç§»æ‰€æœ‰æƒï¼š`move(return_value, s2)`
- æ‰€æœ‰æƒåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¿æŒå”¯ä¸€

```rust
fn main() {
    {
        let s = String::from("hello");  // s æ‹¥æœ‰å­—ç¬¦ä¸²
        println!("{}", s);
    } // s ç¦»å¼€ä½œç”¨åŸŸï¼Œå­—ç¬¦ä¸²è¢«é‡Šæ”¾
    // println!("{}", s);  // é”™è¯¯ï¼šs ä¸å†å­˜åœ¨
}
```

**å½¢å¼åŒ–æè¿°**:

- è¿›å…¥å†…éƒ¨ä½œç”¨åŸŸ: $\Omega(s) = \text{Owned}$, $\Gamma(s) = \text{"hello"}$
- ç¦»å¼€å†…éƒ¨ä½œç”¨åŸŸ: $s$ ç¦»å¼€ä½œç”¨åŸŸï¼Œç”±äº $\Omega(s) = \text{Owned}$ï¼Œå€¼è¢«ä¸¢å¼ƒ

---

## ğŸ“– å‚è€ƒæ–‡çŒ®

### å­¦æœ¯è®ºæ–‡

1. **RustBelt: Logical Foundations for the Future of Safe Systems Programming**
   - ä½œè€…: Ralf Jung, et al.
   - å¹´ä»½: 2018
   - æ‘˜è¦: ä¸º Rust çš„æ‰€æœ‰æƒå’Œå€Ÿç”¨ç³»ç»Ÿæä¾›å½¢å¼åŒ–åŸºç¡€

2. **The RustBelt Project: Formalizing Rust's Type System**
   - ä½œè€…: Derek Dreyer
   - å¹´ä»½: 2017
   - æ‘˜è¦: Rust ç±»å‹ç³»ç»Ÿçš„å½¢å¼åŒ–ç ”ç©¶

### å®˜æ–¹æ–‡æ¡£

- [Rust Book - Ownership](https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html)
- [Rust Reference - Ownership](https://doc.rust-lang.org/reference/ownership.html)

### ç›¸å…³ä»£ç 

- [æ‰€æœ‰æƒå®ç°](../../../crates/c01_ownership_borrow_scope/src/)
- [æ‰€æœ‰æƒæ–‡æ¡£](../../../crates/c01_ownership_borrow_scope/docs/)

### å·¥å…·èµ„æº

- [Coq è¯æ˜åŠ©æ‰‹](https://coq.inria.fr/)
- [RustBelt é¡¹ç›®](https://plv.mpi-sws.org/rustbelt/)

---

## ğŸ”„ ç ”ç©¶è¿›å±•

### å·²å®Œæˆ âœ…

- [x] ç ”ç©¶ç›®æ ‡å®šä¹‰
- [x] ç†è®ºåŸºç¡€æ•´ç†ï¼ˆåŒ…æ‹¬ç†è®ºèƒŒæ™¯ï¼‰
- [x] åˆæ­¥å½¢å¼åŒ–å®šä¹‰
- [x] å®Œå–„æ‰€æœ‰æƒè§„åˆ™ï¼ˆè§„åˆ™ 4ã€è§„åˆ™ 5ï¼‰
- [x] æ·»åŠ æ‰€æœ‰æƒå”¯ä¸€æ€§å®šç†
- [x] å®Œå–„ä»£ç ç¤ºä¾‹ï¼ˆç¤ºä¾‹ 3ã€ç¤ºä¾‹ 4ï¼‰

### è¿›è¡Œä¸­ ğŸ”„

- [x] è¡¥å……çº¿æ€§ç±»å‹ç³»ç»Ÿçš„è¯¦ç»†è¯´æ˜ âœ…
- [x] æ·»åŠ åˆ†ç¦»é€»è¾‘çš„ç›¸å…³å†…å®¹ âœ…
- [x] å®Œå–„æ‰€æœ‰æƒè¯­ä¹‰çš„å½¢å¼åŒ–æè¿° âœ…
- [x] æ·»åŠ ç›¸å…³å­¦æœ¯è®ºæ–‡çš„è¯¦ç»†åˆ†æ âœ…
- [x] å®Œå–„æ‰€æœ‰æƒè½¬ç§»çš„å®Œæ•´å½¢å¼åŒ–å®šä¹‰ âœ…
- [x] æ·»åŠ æ‰€æœ‰æƒè§„åˆ™çš„å½¢å¼åŒ–è¡¨ç¤ºï¼ˆè§„åˆ™6-8ï¼‰âœ…
- [x] å®Œå–„ä½œç”¨åŸŸè§„åˆ™çš„å½¢å¼åŒ– âœ…
- [x] æ·»åŠ å†…å­˜å®‰å…¨çš„å½¢å¼åŒ–è¯æ˜æ¡†æ¶ï¼ˆå®šç†3-4ï¼‰âœ…
- [ ] å†…å­˜å®‰å…¨å®Œæ•´è¯æ˜
- [ ] å·¥å…·éªŒè¯

### è®¡åˆ’ä¸­ ğŸ“‹

- [x] æ·»åŠ æ›´å¤šæ‰€æœ‰æƒè½¬ç§»çš„ç¤ºä¾‹ âœ…
- [x] æ·»åŠ å¤æ‚åœºæ™¯çš„ä»£ç ç¤ºä¾‹ âœ…
- [x] æ·»åŠ é”™è¯¯ç¤ºä¾‹å’Œè¯´æ˜ âœ…
- [x] æ·»åŠ ä¸å€Ÿç”¨ç»“åˆçš„ç¤ºä¾‹ âœ…
- [ ] å®Œæˆå†…å­˜å®‰å…¨çš„å½¢å¼åŒ–è¯æ˜
- [ ] å®Œæˆæ‰€æœ‰æƒå”¯ä¸€æ€§çš„è¯æ˜
- [ ] ä½¿ç”¨å½¢å¼åŒ–å·¥å…·éªŒè¯ï¼ˆå¦‚ Coqï¼‰
- [ ] ç¼–å†™è¯æ˜æ–‡æ¡£
- [ ] ä¸å€Ÿç”¨æ£€æŸ¥å™¨çš„é›†æˆ
- [ ] ä¸ç”Ÿå‘½å‘¨æœŸçš„é›†æˆ
- [ ] å®é™…åº”ç”¨æ¡ˆä¾‹

### æ–°å¢ä»£ç ç¤ºä¾‹

#### ç¤ºä¾‹ 7: æ‰€æœ‰æƒè½¬ç§»ä¸å‡½æ•°å‚æ•°

```rust
fn take_ownership(s: String) {
    println!("{}", s);
} // s ç¦»å¼€ä½œç”¨åŸŸï¼Œå€¼è¢«ä¸¢å¼ƒ

fn ownership_with_parameters() {
    let s = String::from("hello");
    take_ownership(s);  // s çš„æ‰€æœ‰æƒè½¬ç§»åˆ°å‡½æ•°
    // println!("{}", s);  // é”™è¯¯ï¼šs ä¸å†æ‹¥æœ‰å€¼
}
```

**å½¢å¼åŒ–åˆ†æ**:

- å‡½æ•°è°ƒç”¨æ—¶ï¼š$\text{move}(s, \text{param})$
- å‡½æ•°è¿”å›æ—¶ï¼š$\text{drop}(\text{param})$
- æ‰€æœ‰æƒåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¿æŒå”¯ä¸€

#### ç¤ºä¾‹ 8: å¤æ‚æ‰€æœ‰æƒåœºæ™¯ - ç»“æ„ä½“å­—æ®µç§»åŠ¨

```rust
struct Point {
    x: i32,
    y: i32,
}

struct Line {
    start: Point,
    end: Point,
}

fn complex_ownership() {
    let line = Line {
        start: Point { x: 0, y: 0 },
        end: Point { x: 10, y: 10 },
    };

    // ç§»åŠ¨ start å­—æ®µ
    let start = line.start;  // line.start çš„æ‰€æœ‰æƒè½¬ç§»
    // println!("{:?}", line.start);  // é”™è¯¯ï¼šline.start å·²è¢«ç§»åŠ¨

    // line.end ä»ç„¶å¯ç”¨
    println!("{}", line.end.x);

    // ä½† line æœ¬èº«ä¸èƒ½æ•´ä½“ä½¿ç”¨ï¼ˆéƒ¨åˆ†ç§»åŠ¨ï¼‰
    // let end = line.end;  // å¯ä»¥ï¼Œä½† line ä¸èƒ½å†ä½¿ç”¨
}
```

**å½¢å¼åŒ–åˆ†æ**:

- éƒ¨åˆ†ç§»åŠ¨ï¼š$\Omega(\text{line.start}) = \text{Moved}$ï¼Œ$\Omega(\text{line.end}) = \text{Owned}$
- ç»“æ„ä½“éƒ¨åˆ†ç§»åŠ¨åï¼Œæœªç§»åŠ¨å­—æ®µä»å¯ç”¨
- ç»“æ„ä½“æ•´ä½“ä¸èƒ½ä½¿ç”¨ï¼ˆéƒ¨åˆ†ç§»åŠ¨çŠ¶æ€ï¼‰

#### ç¤ºä¾‹ 9: é”™è¯¯ç¤ºä¾‹ - ä½¿ç”¨å·²ç§»åŠ¨çš„å€¼

```rust
fn error_example() {
    let s1 = String::from("hello");
    let s2 = s1;  // æ‰€æœ‰æƒè½¬ç§»

    // é”™è¯¯ï¼šs1 å·²è¢«ç§»åŠ¨ï¼Œä¸èƒ½å†ä½¿ç”¨
    // println!("{}", s1);  // ç¼–è¯‘é”™è¯¯ï¼švalue used after move

    println!("{}", s2);  // æ­£ç¡®ï¼šs2 æ‹¥æœ‰å€¼
}
```

**å½¢å¼åŒ–åˆ†æ**:

- ç§»åŠ¨åï¼š$\Omega(s1) = \text{Moved}$ï¼Œ$\Omega(s2) = \text{Owned}$
- ä½¿ç”¨å·²ç§»åŠ¨çš„å€¼è¿åæ‰€æœ‰æƒè§„åˆ™
- ç¼–è¯‘å™¨æ£€æµ‹å¹¶æ‹’ç»æ­¤ç±»ä»£ç 

#### ç¤ºä¾‹ 10: æ‰€æœ‰æƒä¸å€Ÿç”¨ç»“åˆ

```rust
fn ownership_and_borrowing() {
    let mut s = String::from("hello");

    // ä¸å¯å˜å€Ÿç”¨
    let r1 = &s;
    let r2 = &s;  // å¯ä»¥å¤šä¸ªä¸å¯å˜å€Ÿç”¨
    println!("{} {}", r1, r2);

    // å€Ÿç”¨ç»“æŸåï¼Œå¯ä»¥å¯å˜å€Ÿç”¨
    let r3 = &mut s;
    r3.push_str(" world");
    println!("{}", r3);
}
```

**å½¢å¼åŒ–åˆ†æ**:

- å€Ÿç”¨æœŸé—´ï¼š$\Omega(s) = \text{Owned}$ï¼Œå­˜åœ¨å€Ÿç”¨å¼•ç”¨
- å¤šä¸ªä¸å¯å˜å€Ÿç”¨ï¼š$\text{borrow}(s, r1) \land \text{borrow}(s, r2)$
- å€Ÿç”¨ç»“æŸåï¼šå¯ä»¥åˆ›å»ºæ–°çš„å€Ÿç”¨ï¼ˆå¯å˜æˆ–ä¸å¯å˜ï¼‰

---

**ç»´æŠ¤è€…**: Rust Formal Methods Research Group
**æœ€åæ›´æ–°**: 2025-12-25
**çŠ¶æ€**: âœ… **æ¥è¿‘å®Œæˆ** (80%)
