# 形式化方法比较

> **创建日期**: 2026-02-28
> **最后更新**: 2026-02-28
> **状态**: ✅ 已完成
> **领域**: 形式化方法综述

---

## 概述

本文档系统比较主流的形式化方法，包括模型检测、定理证明、抽象解释等，为选择适合的工具和方法提供参考。

---

## 一、形式化方法分类

### 1.1 按方法分类

```
形式化方法
├── 模型检测 (Model Checking)
│   ├── 显式状态
│   ├── 符号模型检测
│   └── 有界模型检测
├── 定理证明 (Theorem Proving)
│   ├── 自动定理证明
│   ├── 交互式定理证明
│   └── SMT求解
├── 抽象解释 (Abstract Interpretation)
│   ├── 静态分析
│   └── 类型系统
└── 等价检验 (Equivalence Checking)
    ├── 双模拟
    └── 精化检验
```

### 1.2 按自动化程度分类

| 自动化程度 | 方法 | 用户参与 | 适用规模 |
| :--- | :--- | :--- | :--- |
| 全自动 | 模型检测、抽象解释 | 低 | 中小规模 |
| 半自动 | SMT、自动定理证明 | 中 | 中等规模 |
| 交互式 | 证明助手 | 高 | 大规模 |

---

## 二、模型检测

### 2.1 原理

**状态空间探索**:

```
系统状态图 → 时序逻辑性质 → 自动验证
```

**算法**:

- 显式: DFS/BFS遍历状态空间
- 符号: BDD表示状态集合
- 有界: SAT求解器检查有限展开

### 2.2 优势与局限

**优势**:

- 全自动
- 反例生成
- 时序性质验证

**局限**:

- 状态空间爆炸
- 主要适用于有限状态系统
- 数据路径验证困难

### 2.3 工具

| 工具 | 适用领域 | 特点 |
| :--- | :--- | :--- |
| SPIN | 并发系统 | Promela语言 |
| NuSMV | 硬件/软件 | 符号模型检测 |
| CBMC | C程序 | 有界模型检测 |
| Kani | Rust | 基于CBMC |

### 2.4 在Rust中的应用

**Kani**:

```rust
#[kani::proof]
fn check_overflow() {
    let x: u32 = kani::any();
    let y: u32 = kani::any();
    kani::assume(x < 1000 && y < 1000);
    let sum = x + y;  // Kani检查溢出
    assert!(sum < 2000);
}
```

---

## 三、定理证明

### 3.1 交互式定理证明

**原理**: 用户指导证明过程，系统检查每一步的正确性

**流程**:

```
形式化规范 → 证明脚本 → 证明检查 → 定理证明
```

### 3.2 主流证明助手

| 工具 | 基础逻辑 | 特点 | 生态 |
| :--- | :--- | :--- | :--- |
| Coq | 归纳构造演算 | 强大、成熟 | 丰富(MathComp, Iris) |
| Isabelle/HOL | 高阶逻辑 | 易用、文档好 | 丰富(Isabelle Archive) |
| Lean | 依赖类型 | 现代、快速 | 增长中(Mathlib) |
| Agda | 依赖类型 | 证明即程序 | 类型论研究 |

### 3.3 自动定理证明

| 工具 | 方法 | 适用 |
| :--- | :--- | :--- |
| Z3 | SMT | 通用约束求解 |
| CVC5 | SMT | 通用约束求解 |
| Vampire | 超归结 | 一阶逻辑 |
| E Prover | 等式推理 | 等式理论 |

### 3.4 在Rust中的应用

**Aeneas**:

```
Rust → 特征化翻译 → Lean证明
```

**Coq骨架**:

```coq
Theorem ownership_uniqueness:
  forall (x: var) (o1 o2: ownership),
    owns x o1 -> owns x o2 -> o1 = o2.
Proof.
  (* 交互式证明 *)
Qed.
```

---

## 四、抽象解释

### 4.1 原理

**抽象**:

```
具体域 (Concrete) → 抽象域 (Abstract)
    ↑                    ↓
    └──── 伽罗瓦连接 ────┘
```

**不动点计算**:

```
lfp(f) = ⨆{ fⁿ(⊥) | n ≥ 0 }
```

### 4.2 抽象域示例

| 性质 | 具体域 | 抽象域 |
| :--- | :--- | :--- |
| 符号 | ℤ | {⊥, -, 0, +, ⊤} |
| 区间 | ℤ | [l, u] |
| 关系 | 集合 | 八边形、多面体 |

### 4.3 静态分析工具

| 工具 | 方法 | 适用语言 |
| :--- | :--- | :--- |
| Astree | 抽象解释 | C |
| Infer | 分离逻辑/BI | C/Java/Obj-C |
| MIRAI | 抽象解释 | Rust |
| Clippy | Lint + 简单分析 | Rust |

### 4.4 在Rust中的应用

**MIRAI**:

```rust
// MIRAI可以推断的不变量
fn foo(x: i32) {
    if x > 0 {
        // MIRAI知道x > 0
        let y = x - 1;  // y >= 0
    }
}
```

---

## 五、演绎验证

### 5.1 霍尔逻辑验证

**流程**:

```
程序 + 规范 → VC生成 → SMT求解 → 验证结果
```

### 5.2 工具

| 工具 | 语言 | 后端 | 特点 |
| :--- | :--- | :--- | :--- |
| Dafny | 自包含 | Z3 | 易用、教育 |
| Why3 | ML | 多后端 | 通用、模块化 |
| Viper | 自包含 | Z3 | 分离逻辑 |
| Creusot | Rust | Why3 | Rust专用 |
| Prusti | Rust | Viper | Rust专用 |

### 5.3 对比

| 工具 | 自动化 | 表达能力 | 学习曲线 |
| :--- | :--- | :--- | :--- |
| Dafny | 高 | 中 | 低 |
| Why3 | 中 | 高 | 中 |
| Creusot | 中 | 高 | 中 |
| Prusti | 中 | 中 | 中 |

---

## 六、方法选择决策树

```
需要验证什么性质?
│
├─ 时序性质 (安全/活性)
│  └─ 状态空间有限?
│     ├─ 是 → 模型检测 (SPIN, NuSMV)
│     └─ 否 → 抽象模型检测或定理证明
│
├─ 功能正确性
│  └─ 需要数学推理?
│     ├─ 是 → 定理证明 (Coq, Isabelle)
│     └─ 否 → 演绎验证 (Dafny, Creusot)
│
├─ 运行时错误
│  └─ 全自动?
│     ├─ 是 → 抽象解释 (MIRAI, Infer)
│     └─ 否 → 符号执行 (Kani, CBMC)
│
└─ 程序等价
   └─ 精化检验或双模拟
```

---

## 七、综合对比表

| 维度 | 模型检测 | 定理证明 | 抽象解释 | 演绎验证 |
| :--- | :--- | :--- | :--- | :--- |
| **自动化** | 高 | 低 | 高 | 中 |
| **可扩展性** | 低 | 高 | 高 | 中 |
| **反例** | 是 | 否 | 部分 | 是 |
| **数学推理** | 弱 | 强 | 弱 | 中 |
| **用户工作** | 低 | 高 | 低 | 中 |
| **适用阶段** | 设计 | 实现 | 开发 | 实现 |
| **成本** | 中 | 高 | 低 | 中 |

---

## 八、Rust验证工具链

```
开发阶段           验证方法              工具
─────────────────────────────────────────────────
编码              Lint/类型检查          rustc, clippy
                简单分析               mirai

单元测试          动态分析               cargo test
                模糊测试               cargo-fuzz
                符号执行               kani

集成测试          模型检测               (有限)
                契约检查               contracts

验证              演绎验证               creusot, prusti
                定理证明               aeneas, coq

持续集成          静态分析               cargo-audit
                回归测试               ci
```

---

## 九、推荐组合

### 9.1 工业项目

```
Clippy (编码规范)
  + MIRAI (静态分析)
  + Kani (关键属性验证)
  + 测试 (功能验证)
```

### 9.2 安全关键项目

```
Clippy (编码规范)
  + Creusot/Prusti (契约验证)
  + Kani (边界情况)
  + 形式化评审
```

### 9.3 研究项目

```
Coq/Iris (核心语义)
  + Aeneas (程序验证)
  + 手动证明
```

---

**维护者**: Rust Formal Methods Research Team
**最后更新**: 2026-02-28
**状态**: ✅ 形式化方法比较文档完成
