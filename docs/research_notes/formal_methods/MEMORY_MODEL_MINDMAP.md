# 内存模型概念思维导图

> **创建日期**: 2026-02-24
> **级别**: L1/L2
> **类型**: 思维导图

---

## 内存模型层次

```
                            Rust内存模型
                                 │
            ┌────────────────────┼────────────────────┐
            │                    │                    │
       【所有权模型】          【借用模型】          【内存布局】
            │                    │                    │
    ┌───────┴───────┐    ┌───────┴───────┐    ┌───────┴───────┐
    │               │    │               │    │               │
  唯一所有权      RAII   共享借用       可变借用  栈内存         堆内存
    │               │      │               │      │               │
  Move语义      Drop trait &T            &mut T  局部变量       Box/Vec
```

---

## Stacked Borrows

```
借用栈模型
│
├── 核心思想
│   └── 借用按顺序入栈
│
├── 规则
│   ├── 共享借用可重复
│   ├── 可变借用独占
│   └── 父借用被冻结
│
└── 状态转换
    ├── Active → Frozen
    └── Disabled
```

| 操作 | 借用栈变化 |
| :--- | :--- |
| `&x` | 推入共享借用 |
| `&mut x` | 清空并推入可变借用 |
| 使用父借用 | 检查有效性 |

---

## 内存区域

```
内存区域
│
├── 栈 (Stack)
│   ├── 固定大小数据
│   ├── 自动分配释放
│   └── LIFO顺序
│
├── 堆 (Heap)
│   ├── 动态大小数据
│   ├── 手动/智能指针管理
│   └── 通过Box/Rc/Arc访问
│
└── 静态区
    ├── 静态变量
    └── 常量数据
```

---

## 指针类型

```
指针分类
│
├── 安全指针
│   ├── &T (共享引用)
│   ├── &mut T (可变引用)
│   └── Box<T> (拥有指针)
│
└── 原始指针
    ├── *const T
    └── *mut T
```

---

## 内存安全保证

```
安全保证机制
│
├── 编译时
│   ├── 所有权检查
│   ├── 借用检查
│   └── 生命周期验证
│
└── 运行时
    └── 边界检查 (可选)
```

---

## 与形式化验证的关系

```
内存模型 ↔ 形式化
│
├── RustBelt
│   └── 所有权逻辑关系
│
├── Stacked Borrows
│   └── 操作语义
│
└── Miri
    └── 模型检测
```

---

**维护者**: Rust Formal Methods Research Team
**最后更新**: 2026-02-24
**状态**: ✅ 已完成 - 思维导图 14/15
