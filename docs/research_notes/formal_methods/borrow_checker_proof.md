# å€Ÿç”¨æ£€æŸ¥å™¨è¯æ˜

> **åˆ›å»ºæ—¥æœŸ**: 2025-01-27
> **æœ€åæ›´æ–°**: 2026-02-20
> **Rust ç‰ˆæœ¬**: 1.93.0+ (Edition 2024)
> **çŠ¶æ€**: âœ… å·²å®Œæˆ
> **å…­ç¯‡å¹¶è¡¨**: [README Â§formal_methods å…­ç¯‡å¹¶è¡¨](README.md#formal_methods-å…­ç¯‡å¹¶è¡¨) ç¬¬ 2 è¡Œï¼ˆå€Ÿç”¨ï¼‰

---

## ğŸ“Š ç›®å½•

- [å€Ÿç”¨æ£€æŸ¥å™¨è¯æ˜](#å€Ÿç”¨æ£€æŸ¥å™¨è¯æ˜)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ ç ”ç©¶ç›®æ ‡](#-ç ”ç©¶ç›®æ ‡)
    - [æ ¸å¿ƒé—®é¢˜](#æ ¸å¿ƒé—®é¢˜)
    - [é¢„æœŸæˆæœ](#é¢„æœŸæˆæœ)
  - [ğŸ“š ç†è®ºåŸºç¡€](#-ç†è®ºåŸºç¡€)
    - [ç›¸å…³æ¦‚å¿µ](#ç›¸å…³æ¦‚å¿µ)
    - [ç†è®ºèƒŒæ™¯](#ç†è®ºèƒŒæ™¯)
    - [æ•°æ®ç«äº‰çš„å½¢å¼åŒ–å®šä¹‰](#æ•°æ®ç«äº‰çš„å½¢å¼åŒ–å®šä¹‰)
    - [å€Ÿç”¨æ£€æŸ¥ç®—æ³•çš„ç†è®ºåŸºç¡€](#å€Ÿç”¨æ£€æŸ¥ç®—æ³•çš„ç†è®ºåŸºç¡€)
    - [å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§çš„ç†è®ºåŸºç¡€](#å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§çš„ç†è®ºåŸºç¡€)
    - [ç›¸å…³å­¦æœ¯è®ºæ–‡çš„è¯¦ç»†åˆ†æ](#ç›¸å…³å­¦æœ¯è®ºæ–‡çš„è¯¦ç»†åˆ†æ)
      - [1. RustBelt: Logical Foundations for the Future of Safe Systems Programming](#1-rustbelt-logical-foundations-for-the-future-of-safe-systems-programming)
      - [2. The RustBelt Project: Formalizing Rust's Type System](#2-the-rustbelt-project-formalizing-rusts-type-system)
  - [ğŸ”¬ å½¢å¼åŒ–å®šä¹‰](#-å½¢å¼åŒ–å®šä¹‰)
    - [Â§1 æ¦‚å¿µå®šä¹‰å±‚](#1-æ¦‚å¿µå®šä¹‰å±‚)
    - [Â§2 å±æ€§å…³ç³»å±‚ï¼ˆå…¬ç†ï¼‰](#2-å±æ€§å…³ç³»å±‚å…¬ç†)
  - [ğŸ§® å®šç†ä¸è¯æ˜](#-å®šç†ä¸è¯æ˜)
    - [Â§3 è§£é‡Šè®ºè¯å±‚](#3-è§£é‡Šè®ºè¯å±‚)
    - [å¼•ç†ä¸æ¨è®º](#å¼•ç†ä¸æ¨è®º)
  - [ğŸ§  æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ğŸŒ³ è¯æ˜æ ‘](#-è¯æ˜æ ‘)
  - [ğŸ“‹ æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯ æ±‡æ€»è¡¨](#-æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯-æ±‡æ€»è¡¨)
  - [âš ï¸ åä¾‹ï¼šè¿åå€Ÿç”¨è§„åˆ™å¯¼è‡´æ•°æ®ç«äº‰](#ï¸-åä¾‹è¿åå€Ÿç”¨è§„åˆ™å¯¼è‡´æ•°æ®ç«äº‰)
  - [ğŸ’» ä»£ç ç¤ºä¾‹ä¸å®è·µ](#-ä»£ç ç¤ºä¾‹ä¸å®è·µ)
    - [ç¤ºä¾‹ 1ï¼šä¸å¯å˜å€Ÿç”¨](#ç¤ºä¾‹-1ä¸å¯å˜å€Ÿç”¨)
    - [ç¤ºä¾‹ 2ï¼šå¯å˜å€Ÿç”¨](#ç¤ºä¾‹-2å¯å˜å€Ÿç”¨)
    - [ç¤ºä¾‹ 3ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»æ•°æ®ç«äº‰](#ç¤ºä¾‹-3å€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»æ•°æ®ç«äº‰)
    - [ç¤ºä¾‹ 4ï¼šå€Ÿç”¨ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ](#ç¤ºä¾‹-4å€Ÿç”¨ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ)
    - [ç¤ºä¾‹ 5ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ£€æµ‹æ‚¬å‚å¼•ç”¨](#ç¤ºä¾‹-5å€Ÿç”¨æ£€æŸ¥å™¨æ£€æµ‹æ‚¬å‚å¼•ç”¨)
    - [ç¤ºä¾‹ 6ï¼šå¤æ‚å€Ÿç”¨åœºæ™¯](#ç¤ºä¾‹-6å¤æ‚å€Ÿç”¨åœºæ™¯)
  - [ğŸ”— ç³»ç»Ÿé›†æˆä¸å®é™…åº”ç”¨](#-ç³»ç»Ÿé›†æˆä¸å®é™…åº”ç”¨)
    - [ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ](#ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ)
    - [ä¸ç”Ÿå‘½å‘¨æœŸçš„é›†æˆ](#ä¸ç”Ÿå‘½å‘¨æœŸçš„é›†æˆ)
    - [å®é™…åº”ç”¨æ¡ˆä¾‹](#å®é™…åº”ç”¨æ¡ˆä¾‹)
  - [âœ… è¯æ˜ç›®æ ‡](#-è¯æ˜ç›®æ ‡)
    - [å¾…è¯æ˜çš„æ€§è´¨](#å¾…è¯æ˜çš„æ€§è´¨)
    - [è¯æ˜æ–¹æ³•](#è¯æ˜æ–¹æ³•)
  - [Rust 1.93 ä¸å¹¶å‘/è£¸æŒ‡é’ˆæ‰©å±•ï¼ˆå½¢å¼åŒ–å ä½ï¼‰](#rust-193-ä¸å¹¶å‘è£¸æŒ‡é’ˆæ‰©å±•å½¢å¼åŒ–å ä½)
  - [unsafe å¥‘çº¦ä¸ borrow/ownership è¡”æ¥ï¼ˆPhase 3ï¼‰](#unsafe-å¥‘çº¦ä¸-borrowownership-è¡”æ¥phase-3)
  - [æ§åˆ¶æµä¸å€Ÿç”¨è¡”æ¥ï¼ˆPhase 5ï¼‰](#æ§åˆ¶æµä¸å€Ÿç”¨è¡”æ¥phase-5)
  - [FFIã€externã€C variadicã€? æ“ä½œç¬¦ï¼ˆPhase 6ï¼‰](#ffiexternc-variadic-æ“ä½œç¬¦phase-6)
  - [ğŸ“– å‚è€ƒæ–‡çŒ®](#-å‚è€ƒæ–‡çŒ®)
    - [å­¦æœ¯è®ºæ–‡ï¼ˆå›½é™…æƒå¨ï¼‰](#å­¦æœ¯è®ºæ–‡å›½é™…æƒå¨)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [ç›¸å…³ä»£ç ](#ç›¸å…³ä»£ç )
    - [ç›¸å…³æ€ç»´è¡¨å¾](#ç›¸å…³æ€ç»´è¡¨å¾)

---

## ğŸ¯ ç ”ç©¶ç›®æ ‡

æœ¬ç ”ç©¶æ—¨åœ¨å½¢å¼åŒ–å®šä¹‰ Rust çš„å€Ÿç”¨æ£€æŸ¥å™¨ï¼Œå¹¶è¯æ˜å…¶ä¿è¯æ•°æ®ç«äº‰è‡ªç”±ã€‚

### æ ¸å¿ƒé—®é¢˜

1. **å€Ÿç”¨è§„åˆ™çš„å½¢å¼åŒ–å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ**
2. **å€Ÿç”¨æ£€æŸ¥å™¨å¦‚ä½•ä¿è¯æ•°æ®ç«äº‰è‡ªç”±ï¼Ÿ**
3. **å€Ÿç”¨æ£€æŸ¥çš„æ­£ç¡®æ€§å¦‚ä½•è¯æ˜ï¼Ÿ**

### é¢„æœŸæˆæœ

- å€Ÿç”¨è§„åˆ™çš„å½¢å¼åŒ–æ¨¡å‹
- æ•°æ®ç«äº‰è‡ªç”±çš„å½¢å¼åŒ–è¯æ˜
- å€Ÿç”¨æ£€æŸ¥å™¨çš„æ­£ç¡®æ€§è¯æ˜

---

## ğŸ“š ç†è®ºåŸºç¡€

### ç›¸å…³æ¦‚å¿µ

**å€Ÿç”¨ï¼ˆBorrowingï¼‰**ï¼šä¸´æ—¶è®¿é—®å€¼è€Œä¸è·å–æ‰€æœ‰æƒã€‚

**å€Ÿç”¨è§„åˆ™**ï¼š

1. åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨æˆ–å¤šä¸ªä¸å¯å˜å€Ÿç”¨
2. å€Ÿç”¨å¿…é¡»å§‹ç»ˆæœ‰æ•ˆ

**æ•°æ®ç«äº‰ï¼ˆData Raceï¼‰**ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å†…å­˜ä½ç½®ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™æ“ä½œï¼Œä¸”æ²¡æœ‰åŒæ­¥ã€‚

### ç†è®ºèƒŒæ™¯

**åˆ†ç¦»é€»è¾‘ï¼ˆSeparation Logicï¼‰**ï¼šç”¨äºè¡¨è¾¾å€Ÿç”¨è§„åˆ™çš„é€»è¾‘ç³»ç»Ÿã€‚

**åŒºåŸŸç±»å‹ï¼ˆRegion Typesï¼‰**ï¼šç”¨äºå½¢å¼åŒ–ç”Ÿå‘½å‘¨æœŸçš„ç±»å‹ç³»ç»Ÿã€‚

### æ•°æ®ç«äº‰çš„å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 1.1 (æ•°æ®ç«äº‰)**ï¼šæ•°æ®ç«äº‰å‘ç”Ÿåœ¨ä»¥ä¸‹æ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼š

1. **å¹¶å‘è®¿é—®**: ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å†…å­˜ä½ç½®
2. **å†™æ“ä½œ**: è‡³å°‘æœ‰ä¸€ä¸ªè®¿é—®æ˜¯å†™æ“ä½œ
3. **æ— åŒæ­¥**: è®¿é—®ä¹‹é—´æ²¡æœ‰åŒæ­¥æœºåˆ¶

**å½¢å¼åŒ–è¡¨ç¤º**:
$$\text{DataRace}(m, t_1, t_2) \leftrightarrow \text{Concurrent}(t_1, t_2) \land \text{Access}(t_1, m) \land \text{Access}(t_2, m) \land (\text{Write}(t_1, m) \lor \text{Write}(t_2, m)) \land \neg \text{Synchronized}(t_1, t_2)$$

**å®šä¹‰ 1.2 (æ•°æ®ç«äº‰è‡ªç”±)**ï¼šç¨‹åºæ˜¯æ•°æ®ç«äº‰è‡ªç”±çš„ï¼Œå½“ä¸”ä»…å½“ä¸å­˜åœ¨ä»»ä½•æ•°æ®ç«äº‰ï¼š

$$\text{DataRaceFree}(P) \leftrightarrow \neg \exists m, t_1, t_2: \text{DataRace}(m, t_1, t_2)$$

### å€Ÿç”¨æ£€æŸ¥ç®—æ³•çš„ç†è®ºåŸºç¡€

**å€Ÿç”¨æ£€æŸ¥ç®—æ³•**åŸºäºä»¥ä¸‹åŸç†ï¼š

1. **å€Ÿç”¨è·Ÿè¸ª**: è·Ÿè¸ªæ¯ä¸ªå€¼çš„å€Ÿç”¨çŠ¶æ€
2. **å†²çªæ£€æµ‹**: æ£€æµ‹å€Ÿç”¨å†²çªï¼ˆå¤šä¸ªå¯å˜å€Ÿç”¨æˆ–å¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨å…±å­˜ï¼‰
3. **ç”Ÿå‘½å‘¨æœŸéªŒè¯**: éªŒè¯å€Ÿç”¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰æ•ˆ

**ç®—æ³•æ­¥éª¤**:

1. **æ„å»ºå€Ÿç”¨å›¾**: ä¸ºæ¯ä¸ªå€Ÿç”¨æ„å»ºå€Ÿç”¨å…³ç³»å›¾
2. **æ£€æµ‹å†²çª**: åœ¨å€Ÿç”¨å›¾ä¸­æ£€æµ‹å†²çª
3. **éªŒè¯ç”Ÿå‘½å‘¨æœŸ**: éªŒè¯å€Ÿç”¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰æ•ˆ

**ç®—æ³•å¤æ‚åº¦**: $O(n + m)$ å…¶ä¸­ $n$ æ˜¯å˜é‡æ•°ï¼Œ$m$ æ˜¯å€Ÿç”¨æ•°

### å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§çš„ç†è®ºåŸºç¡€

**å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§**åŸºäºä»¥ä¸‹åŸç†ï¼š

1. **å”¯ä¸€æ€§ä¿è¯**: å¯å˜å€Ÿç”¨çš„å”¯ä¸€æ€§ä¿è¯æ•°æ®ç«äº‰è‡ªç”±
2. **å…±äº«æ€§ä¿è¯**: ä¸å¯å˜å€Ÿç”¨çš„å…±äº«æ€§ä¿è¯åªè¯»è®¿é—®å®‰å…¨
3. **ç”Ÿå‘½å‘¨æœŸä¿è¯**: ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿä¿è¯å¼•ç”¨æœ‰æ•ˆ

**æ­£ç¡®æ€§è¯æ˜æ€è·¯**:

- å€Ÿç”¨è§„åˆ™ä¿è¯ä¸ä¼šå‡ºç°æ•°æ®ç«äº‰
- ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿä¿è¯å¼•ç”¨æœ‰æ•ˆ
- ä¸¤è€…ç»“åˆä¿è¯å†…å­˜å®‰å…¨å’Œæ•°æ®ç«äº‰è‡ªç”±

### ç›¸å…³å­¦æœ¯è®ºæ–‡çš„è¯¦ç»†åˆ†æ

#### 1. RustBelt: Logical Foundations for the Future of Safe Systems Programming

**æ ¸å¿ƒè´¡çŒ®**:

- å€Ÿç”¨æ£€æŸ¥å™¨çš„å½¢å¼åŒ–å®šä¹‰
- æ•°æ®ç«äº‰è‡ªç”±çš„å½¢å¼åŒ–è¯æ˜
- å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§çš„è¯æ˜

**å…³é”®ç»“æœ**:

- å€Ÿç”¨è§„åˆ™çš„å½¢å¼åŒ–
- æ•°æ®ç«äº‰è‡ªç”±çš„è¯æ˜
- å€Ÿç”¨æ£€æŸ¥å™¨çš„æ­£ç¡®æ€§è¯æ˜

**ä¸æœ¬ç ”ç©¶çš„å…³è”**:

- æä¾›äº†å€Ÿç”¨æ£€æŸ¥å™¨å½¢å¼åŒ–çš„æ–¹æ³•
- æä¾›äº†è¯æ˜æ–¹æ³•
- æä¾›äº†å·¥å…·æ”¯æŒ

#### 2. The RustBelt Project: Formalizing Rust's Type System

**æ ¸å¿ƒè´¡çŒ®**:

- Rust å€Ÿç”¨ç³»ç»Ÿçš„å½¢å¼åŒ–
- å€Ÿç”¨ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ
- æ•°æ®ç«äº‰è‡ªç”±çš„è¯æ˜

**å…³é”®ç»“æœ**:

- å€Ÿç”¨ç³»ç»Ÿçš„å®Œæ•´å½¢å¼åŒ–
- æ•°æ®ç«äº‰è‡ªç”±çš„å½¢å¼åŒ–è¯æ˜
- ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ

**ä¸æœ¬ç ”ç©¶çš„å…³è”**:

- æä¾›äº†å€Ÿç”¨ç³»ç»Ÿå½¢å¼åŒ–çš„æ–¹æ³•
- æä¾›äº†è¯æ˜æ–¹æ³•
- æä¾›äº†å·¥å…·æ”¯æŒ

---

## ğŸ”¬ å½¢å¼åŒ–å®šä¹‰

### Â§1 æ¦‚å¿µå®šä¹‰å±‚

**Def 1.1 (å€Ÿç”¨ç±»å‹é›†åˆ)**ï¼šå€Ÿç”¨ç±»å‹é›†åˆ $\mathcal{B}$ å®šä¹‰ä¸ºï¼š

$$\mathcal{B} = \{Immutable, Mutable\}$$

å…¶ä¸­ï¼š

- $Immutable$ï¼šä¸å¯å˜å€Ÿç”¨ `&T`
- $Mutable$ï¼šå¯å˜å€Ÿç”¨ `&mut T`

**è§£é‡Š**ï¼šå€Ÿç”¨ç±»å‹åŒºåˆ†äº†å¯¹æ•°æ®çš„è®¿é—®æ–¹å¼ã€‚ä¸å¯å˜å€Ÿç”¨å…è®¸å¤šä¸ªè¯»è€…åŒæ—¶è®¿é—®ï¼Œè€Œå¯å˜å€Ÿç”¨ç¡®ä¿ç‹¬å å†™è®¿é—®ã€‚

---

**Def 1.2 (å€Ÿç”¨çŠ¶æ€)**ï¼šå€Ÿç”¨çŠ¶æ€ $\mathcal{S}$ æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ $(I, M, T)$ï¼Œå…¶ä¸­ï¼š

- $I \subseteq \text{Var}$ï¼šä¸å¯å˜å€Ÿç”¨é›†åˆ
- $M \subseteq \text{Var}$ï¼šå¯å˜å€Ÿç”¨é›†åˆ
- $T: \text{Var} \to \mathcal{B}$ï¼šå€Ÿç”¨ç±»å‹æ˜ å°„

**æ•°å­¦è¡¨è¾¾å¼**ï¼š
$$\mathcal{S} = \{(I, M, T) \mid I \cap M = \emptyset \land \forall v \in I \cup M: T(v) \in \mathcal{B}\}$$

**è§£é‡Š**ï¼šå€Ÿç”¨çŠ¶æ€è¿½è¸ªç¨‹åºä¸­æ‰€æœ‰æ´»è·ƒçš„å€Ÿç”¨ã€‚$I \cap M = \emptyset$ è¡¨ç¤ºä¸å¯å˜å€Ÿç”¨å’Œå¯å˜å€Ÿç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨ã€‚

---

**Def 1.3 (å€Ÿç”¨æœ‰æ•ˆæ€§)**ï¼šå€Ÿç”¨ $b$ åœ¨ç¨‹åºç‚¹ $p$ æ˜¯**æœ‰æ•ˆçš„**ï¼Œå½“ä¸”ä»…å½“ï¼š

$$\text{Valid}(b, p) \leftrightarrow \text{Lifetime}(b) \subseteq \text{Scope}(b) \land \text{Alive}(\text{Target}(b), p)$$

å…¶ä¸­ï¼š

- $\text{Lifetime}(b)$ï¼šå€Ÿç”¨çš„ç”Ÿå‘½å‘¨æœŸ
- $\text{Scope}(b)$ï¼šå€Ÿç”¨çš„ä½œç”¨åŸŸ
- $\text{Target}(b)$ï¼šå€Ÿç”¨æŒ‡å‘çš„ç›®æ ‡
- $\text{Alive}(x, p)$ï¼šå˜é‡ $x$ åœ¨ç¨‹åºç‚¹ $p$ å­˜æ´»

**è§£é‡Š**ï¼šå€Ÿç”¨æœ‰æ•ˆæ€§ç¡®ä¿å¼•ç”¨åœ¨å…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…æŒ‡å‘æœ‰æ•ˆçš„å†…å­˜ã€‚

---

**Def 1.4 (å€Ÿç”¨å†²çª)**ï¼šä¸¤ä¸ªå€Ÿç”¨ $b_1$ å’Œ $b_2$ å­˜åœ¨**å†²çª**ï¼Œå½“ä¸”ä»…å½“ï¼š

$$\text{Conflict}(b_1, b_2) \leftrightarrow \text{Overlap}(\text{Target}(b_1), \text{Target}(b_2)) \land \neg\text{Compatible}(b_1, b_2)$$

å…¶ä¸­å…¼å®¹æ€§å®šä¹‰ä¸ºï¼š
$$\text{Compatible}(b_1, b_2) \leftrightarrow (T(b_1) = Immutable \land T(b_2) = Immutable)$$

**è§£é‡Š**ï¼šå€Ÿç”¨å†²çªå‘ç”Ÿåœ¨ä¸¤ä¸ªå€Ÿç”¨æŒ‡å‘é‡å å†…å­˜ä¸”ä¸æ»¡è¶³å…¼å®¹æ€§ï¼ˆå³è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å¯å˜å€Ÿç”¨ï¼‰æ—¶ã€‚

---

**Def 1.5 (ç¨‹åºçŠ¶æ€)**ï¼šç¨‹åºçŠ¶æ€ $\Sigma$ æ˜¯ä¸€ä¸ªå…ƒç»„ $(\Gamma, \Delta, S)$ï¼Œå…¶ä¸­ï¼š

- $\Gamma: \text{Var} \to \text{Type}$ï¼šç±»å‹ç¯å¢ƒ
- $\Delta: \text{Var} \to \text{Ownership}$ï¼šæ‰€æœ‰æƒç¯å¢ƒ
- $S \in \mathcal{S}$ï¼šå½“å‰å€Ÿç”¨çŠ¶æ€

**è§£é‡Š**ï¼šç¨‹åºçŠ¶æ€å®Œæ•´æè¿°äº†ç¨‹åºæ‰§è¡Œæ—¶çš„ç±»å‹ã€æ‰€æœ‰æƒå’Œå€Ÿç”¨ä¿¡æ¯ã€‚

---

### Â§2 å±æ€§å…³ç³»å±‚ï¼ˆå…¬ç†ï¼‰

**Axiom 1 (å¯å˜å€Ÿç”¨å”¯ä¸€æ€§)**ï¼šå¯¹äºä»»æ„ç¨‹åºç‚¹ $p$ï¼Œè‡³å¤šå­˜åœ¨ä¸€ä¸ªå¯å˜å€Ÿç”¨æŒ‡å‘å†…å­˜ä½ç½® $m$ï¼š

$$\forall p, m: |\{b \mid \text{Active}(b, p) \land T(b) = Mutable \land \text{Target}(b) = m\}| \leq 1$$

**ç†ç”±**ï¼šå¯å˜å€Ÿç”¨å…è®¸ä¿®æ”¹æ•°æ®ã€‚å¤šä¸ªå¯å˜å€Ÿç”¨ä¼šå¯¼è‡´æ•°æ®ç«äº‰ï¼Œå› æ­¤å¿…é¡»ä¿è¯å”¯ä¸€æ€§ã€‚

---

**Axiom 2 (å¯å˜-ä¸å¯å˜äº’æ–¥)**ï¼šå¯¹äºä»»æ„ç¨‹åºç‚¹ $p$ï¼Œå¯å˜å€Ÿç”¨å’Œä¸å¯å˜å€Ÿç”¨ä¸èƒ½åŒæ—¶æŒ‡å‘é‡å çš„å†…å­˜ï¼š

$$\forall p, b_1, b_2: \text{Active}(b_1, p) \land \text{Active}(b_2, p) \land T(b_1) = Mutable \land T(b_2) = Immutable \to \neg\text{Overlap}(\text{Target}(b_1), \text{Target}(b_2))$$

**ç†ç”±**ï¼šè¯»-å†™ç«äº‰æ˜¯æ•°æ®ç«äº‰çš„ä¸€ç§å½¢å¼ã€‚æ­¤å…¬ç†é˜²æ­¢åŒæ—¶è¯»å†™åŒä¸€å†…å­˜ã€‚

---

**Axiom 3 (å€Ÿç”¨æœ‰æ•ˆæ€§ä¿æŒ)**ï¼šå¦‚æœå€Ÿç”¨ $b$ åœ¨ç¨‹åºç‚¹ $p$ æœ‰æ•ˆï¼Œä¸”ä» $p$ åˆ° $p'$ æ²¡æœ‰ä½¿ $b$ å¤±æ•ˆçš„æ“ä½œï¼Œåˆ™ $b$ åœ¨ $p'$ ä»ç„¶æœ‰æ•ˆï¼š

$$\text{Valid}(b, p) \land \neg\text{Invalidate}(b, p, p') \to \text{Valid}(b, p')$$

å…¶ä¸­ $\text{Invalidate}(b, p, p')$ è¡¨ç¤ºåœ¨ä» $p$ åˆ° $p'$ çš„è·¯å¾„ä¸Šå­˜åœ¨ä½¿ $b$ å¤±æ•ˆçš„æ“ä½œï¼ˆå¦‚ç›®æ ‡è¢«ç§»åŠ¨æˆ–é‡Šæ”¾ï¼‰ã€‚

**ç†ç”±**ï¼šæœ‰æ•ˆæ€§æ˜¯å•è°ƒå±æ€§ï¼Œé™¤éæ˜¾å¼å¤±æ•ˆï¼Œå¦åˆ™å€Ÿç”¨ä¿æŒæœ‰æ•ˆã€‚

---

**Axiom 4 (å€Ÿç”¨æ£€æŸ¥å®Œå¤‡æ€§)**ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ¥å—ç¨‹åº $P$ å½“ä¸”ä»…å½“ $P$ çš„æ‰€æœ‰æ‰§è¡Œè·¯å¾„æ»¡è¶³ Axiom 1-3ï¼š

$$\text{Check}(P) = \text{Pass} \leftrightarrow \forall \pi \in \text{Paths}(P): \pi \models \text{Axiom 1} \land \text{Axiom 2} \land \text{Axiom 3}$$

**ç†ç”±**ï¼šç¼–è¯‘å™¨å¿…é¡»å‡†ç¡®è¯†åˆ«æ‰€æœ‰è¿åå€Ÿç”¨è§„åˆ™çš„ç¨‹åºï¼Œæ—¢ä¸æ¼æŠ¥ä¹Ÿä¸è¯¯æŠ¥ï¼ˆç†è®ºä¸Šï¼‰ã€‚

---

## ğŸ§® å®šç†ä¸è¯æ˜

### Â§3 è§£é‡Šè®ºè¯å±‚

**Theorem 1 (æ•°æ®ç«äº‰è‡ªç”±)**ï¼šé€šè¿‡å€Ÿç”¨æ£€æŸ¥çš„ç¨‹åºæ˜¯æ•°æ®ç«äº‰è‡ªç”±çš„ã€‚

**å½¢å¼åŒ–é™ˆè¿°**ï¼š
$$\forall P: \text{Check}(P) = \text{Pass} \to \text{DataRaceFree}(P)$$

**å®Œæ•´è¯æ˜**ï¼š

*è¯æ˜æ–¹æ³•ï¼šåè¯æ³• + ç»“æ„å½’çº³*

**æ­¥éª¤ 1ï¼šå»ºç«‹å‰æ**

- å‡è®¾ç¨‹åº $P$ é€šè¿‡äº†å€Ÿç”¨æ£€æŸ¥ï¼Œå³ $\text{Check}(P) = \text{Pass}$
- å‡è®¾ $P$ å­˜åœ¨æ•°æ®ç«äº‰ï¼Œå³ $\exists m, t_1, t_2: \text{DataRace}(m, t_1, t_2)$

**æ­¥éª¤ 2ï¼šåˆ†ææ•°æ®ç«äº‰æ¡ä»¶**
æ ¹æ® Def 1.1ï¼Œæ•°æ®ç«äº‰è¦æ±‚ï¼š

1. $\text{Concurrent}(t_1, t_2)$ï¼šçº¿ç¨‹ $t_1$ å’Œ $t_2$ å¹¶å‘æ‰§è¡Œ
2. $\text{Access}(t_1, m) \land \text{Access}(t_2, m)$ï¼šä¸¤è€…è®¿é—®åŒä¸€å†…å­˜
3. $\text{Write}(t_1, m) \lor \text{Write}(t_2, m)$ï¼šè‡³å°‘ä¸€ä¸ªå†™æ“ä½œ
4. $\neg\text{Synchronized}(t_1, t_2)$ï¼šæ— åŒæ­¥

**æ­¥éª¤ 3ï¼šåˆ†æƒ…å†µè®¨è®º**

*æƒ…å†µ Aï¼šä¸¤ä¸ªå†™æ“ä½œ ($\text{Write}(t_1, m) \land \text{Write}(t_2, m)$)*

- å†™æ“ä½œéœ€è¦å¯å˜å€Ÿç”¨
- æ ¹æ® Axiom 1ï¼Œç¨‹åºç‚¹ $p$ ä¸Šè‡³å¤šä¸€ä¸ªå¯å˜å€Ÿç”¨æŒ‡å‘ $m$
- è‹¥ $t_1$ å’Œ $t_2$ åŒæ—¶æŒæœ‰æŒ‡å‘ $m$ çš„å¯å˜å€Ÿç”¨ï¼Œåˆ™è¿å Axiom 1
- å€Ÿç”¨æ£€æŸ¥å™¨ä¼šæ‹’ç»æ­¤ç±»ç¨‹åºï¼Œä¸ $\text{Check}(P) = \text{Pass}$ çŸ›ç›¾

*æƒ…å†µ Bï¼šä¸€è¯»ä¸€å†™ (WLOG, $\text{Write}(t_1, m) \land \neg\text{Write}(t_2, m)$)*

- $t_1$ éœ€è¦å¯å˜å€Ÿç”¨ï¼Œ$t_2$ éœ€è¦ä¸å¯å˜å€Ÿç”¨
- æ ¹æ® Axiom 2ï¼Œå¯å˜å€Ÿç”¨å’Œä¸å¯å˜å€Ÿç”¨ä¸èƒ½åŒæ—¶æŒ‡å‘é‡å å†…å­˜
- è‹¥ä¸¤è€…åŒæ—¶æ´»è·ƒï¼Œåˆ™è¿å Axiom 2
- å€Ÿç”¨æ£€æŸ¥å™¨ä¼šæ‹’ç»æ­¤ç±»ç¨‹åºï¼Œä¸ $\text{Check}(P) = \text{Pass}$ çŸ›ç›¾

**æ­¥éª¤ 4ï¼šå½’çº³è®ºè¯**

å¯¹ç¨‹åº $P$ çš„ç»“æ„è¿›è¡Œå½’çº³ï¼š

*åŸºç¡€æƒ…å†µ*ï¼š

- å•æ¡è¯­å¥ç¨‹åºï¼šæ˜¾ç„¶æ— æ•°æ®ç«äº‰
- æ— å€Ÿç”¨è¯­å¥ï¼šæ˜¾ç„¶æ— æ•°æ®ç«äº‰

*å½’çº³å‡è®¾*ï¼š

- å‡è®¾å¯¹äºç¨‹åºå‰ç¼€ $P_k$ï¼Œé€šè¿‡å€Ÿç”¨æ£€æŸ¥è•´å«æ•°æ®ç«äº‰è‡ªç”±

*å½’çº³æ­¥éª¤*ï¼š

- è€ƒè™‘æ·»åŠ è¯­å¥ $s$ å¾—åˆ° $P_{k+1} = P_k; s$
- è‹¥ $s$ åˆ›å»ºå€Ÿç”¨ï¼šå€Ÿç”¨æ£€æŸ¥å™¨éªŒè¯ä¸è¿å Axiom 1-2
- è‹¥ $s$ è·¨çº¿ç¨‹ä¼ é€’ï¼šå€Ÿç”¨æ£€æŸ¥å™¨è¦æ±‚ `Send`/`Sync`ï¼Œè§ [async_state_machine](async_state_machine.md) å®šç† 6.2
- è‹¥ $s$ è¿›è¡ŒåŒæ­¥ï¼šæ ¹æ® [borrow_checker_proof](borrow_checker_proof.md) Def MUTEX1ï¼ŒåŒæ­¥æ“ä½œä¿è¯äº’æ–¥

**æ­¥éª¤ 5ï¼šç»“è®º**

å‡è®¾ $P$ å­˜åœ¨æ•°æ®ç«äº‰å¯¼è‡´çŸ›ç›¾ã€‚å› æ­¤ï¼Œé€šè¿‡å€Ÿç”¨æ£€æŸ¥çš„ç¨‹åºå¿…å®šæ˜¯æ•°æ®ç«äº‰è‡ªç”±çš„ã€‚

$$\square \text{ (å®šç† 1 è¯æ¯•)}$$

---

**Theorem 2 (å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§)**ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ­£ç¡®å®ç°äº†å€Ÿç”¨è§„åˆ™ã€‚

**å½¢å¼åŒ–é™ˆè¿°**ï¼š
$$\forall P: \text{Check}(P) = \text{Pass} \leftrightarrow \forall \pi \in \text{Paths}(P): \pi \models \text{BorrowRules}$$

å…¶ä¸­ $\text{BorrowRules} = \{\text{Axiom 1}, \text{Axiom 2}, \text{Axiom 3}\}$

**å®Œæ•´è¯æ˜**ï¼š

*è¯æ˜æ–¹æ³•ï¼šåŒå‘è•´å«*

**($\Rightarrow$) æ–¹å‘**ï¼š$\text{Check}(P) = \text{Pass} \to \forall \pi: \pi \models \text{BorrowRules}$

æ ¹æ® Axiom 4ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨æ¥å—ç¨‹åºå½“ä¸”ä»…å½“æ‰€æœ‰æ‰§è¡Œè·¯å¾„æ»¡è¶³ Axiom 1-3ã€‚
å› æ­¤ï¼Œè‹¥ $\text{Check}(P) = \text{Pass}$ï¼Œåˆ™æ‰€æœ‰è·¯å¾„æ»¡è¶³å€Ÿç”¨è§„åˆ™ã€‚

**($\Leftarrow$) æ–¹å‘**ï¼š$\forall \pi: \pi \models \text{BorrowRules} \to \text{Check}(P) = \text{Pass}$

- å€Ÿç”¨æ£€æŸ¥å™¨åœ¨ç¼–è¯‘æ—¶åˆ†ææ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œè·¯å¾„
- è‹¥æŸè·¯å¾„è¿åå€Ÿç”¨è§„åˆ™ï¼Œæ£€æŸ¥å™¨ç”Ÿæˆé”™è¯¯
- å› æ­¤ï¼Œè‹¥æ‰€æœ‰è·¯å¾„æ»¡è¶³å€Ÿç”¨è§„åˆ™ï¼Œæ£€æŸ¥å™¨æ¥å—ç¨‹åº

**æ­¥éª¤ 3ï¼šç»“åˆåŒå‘è¯æ˜**
ç”±åŒå‘è•´å«ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨æ­£ç¡®å®ç°äº†å€Ÿç”¨è§„åˆ™ã€‚

$$\square \text{ (å®šç† 2 è¯æ¯•)}$$

---

**Theorem 3 (å¼•ç”¨æœ‰æ•ˆæ€§ä¿è¯)**ï¼šé€šè¿‡å€Ÿç”¨æ£€æŸ¥çš„ç¨‹åºä¸­ï¼Œæ‰€æœ‰å¼•ç”¨åœ¨å…¶ä½¿ç”¨ç‚¹éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚

**å½¢å¼åŒ–é™ˆè¿°**ï¼š
$$\forall P: \text{Check}(P) = \text{Pass} \to \forall r \in \text{Refs}(P): \forall p \in \text{Use}(r): \text{Valid}(r, p)$$

**å®Œæ•´è¯æ˜**ï¼š

*è¯æ˜æ–¹æ³•ï¼šç»“æ„å½’çº³ + åè¯æ³•*

**æ­¥éª¤ 1ï¼šå»ºç«‹å‰æ**

- ç¨‹åº $P$ é€šè¿‡å€Ÿç”¨æ£€æŸ¥
- å‡è®¾å­˜åœ¨å¼•ç”¨ $r$ åœ¨ä½¿ç”¨ç‚¹ $p$ æ— æ•ˆ

**æ­¥éª¤ 2ï¼šåˆ†ææ— æ•ˆæƒ…å†µ**

æ ¹æ® Def 1.3ï¼Œ$\neg\text{Valid}(r, p)$ å¯èƒ½ç”±äºï¼š

*æƒ…å†µ Aï¼š$\text{Lifetime}(r) \not\subseteq \text{Scope}(r)$*

- å¼•ç”¨ç”Ÿå‘½å‘¨æœŸè¶…å‡ºä½œç”¨åŸŸ
- å€Ÿç”¨æ£€æŸ¥å™¨ä½¿ç”¨ [lifetime_formalization](lifetime_formalization.md) çš„ç”Ÿå‘½å‘¨æœŸæ¨æ–­
- æ ¹æ®è¯¥æ–‡æ¡£å®šç† LF-T2ï¼Œç”Ÿå‘½å‘¨æœŸç³»ç»Ÿä¿è¯å¼•ç”¨æœ‰æ•ˆæ€§
- è‹¥ç”Ÿå‘½å‘¨æœŸçº¦æŸä¸æ»¡è¶³ï¼Œç¼–è¯‘å™¨æ‹’ç»ç¨‹åºï¼ŒçŸ›ç›¾

*æƒ…å†µ Bï¼š$\neg\text{Alive}(\text{Target}(r), p)$*

- è¢«å¼•ç”¨å¯¹è±¡åœ¨ $p$ ç‚¹å·²é‡Šæ”¾
- æ ¹æ® [ownership_model](ownership_model.md) å®šä¹‰ 2.2ï¼Œæ‰€æœ‰æƒè½¬ç§»ååŸå˜é‡å¤±æ•ˆ
- å€Ÿç”¨æ£€æŸ¥å™¨è·Ÿè¸ªæ‰€æœ‰æƒçŠ¶æ€ï¼Œæ‹’ç»ä½¿ç”¨æŒ‡å‘å·²é‡Šæ”¾å†…å­˜çš„å¼•ç”¨
- çŸ›ç›¾

**æ­¥éª¤ 3ï¼šå½’çº³è®ºè¯**

å¯¹ç¨‹åºæ‰§è¡Œè·¯å¾„è¿›è¡Œå½’çº³ï¼š

*åŸºç¡€æƒ…å†µ*ï¼šç©ºç¨‹åºæ— å¼•ç”¨ï¼Œæ˜¾ç„¶æ»¡è¶³

*å½’çº³å‡è®¾*ï¼šç¨‹åºå‰ç¼€ $P_k$ ä¸­æ‰€æœ‰å¼•ç”¨æœ‰æ•ˆ

*å½’çº³æ­¥éª¤*ï¼š

- è‹¥æ–°è¯­å¥åˆ›å»ºå¼•ç”¨ï¼šå€Ÿç”¨æ£€æŸ¥å™¨éªŒè¯å…¶ç”Ÿå‘½å‘¨æœŸçº¦æŸ
- è‹¥æ–°è¯­å¥ä½¿ç”¨å¼•ç”¨ï¼šå€Ÿç”¨æ£€æŸ¥å™¨éªŒè¯å¼•ç”¨åœ¨å½“å‰ç‚¹æœ‰æ•ˆ
- æ ¹æ® Axiom 3ï¼Œæœ‰æ•ˆæ€§ä¿æŒç›´åˆ°æ˜¾å¼å¤±æ•ˆ

**æ­¥éª¤ 4ï¼šç»“è®º**

å‡è®¾å­˜åœ¨æ— æ•ˆå¼•ç”¨å¯¼è‡´çŸ›ç›¾ã€‚å› æ­¤ï¼Œé€šè¿‡å€Ÿç”¨æ£€æŸ¥çš„ç¨‹åºä¸­æ‰€æœ‰å¼•ç”¨æœ‰æ•ˆã€‚

$$\square \text{ (å®šç† 3 è¯æ¯•)}$$

---

### å¼•ç†ä¸æ¨è®º

**Lemma 1 (äº’æ–¥å€Ÿç”¨ä¿æŒ)**ï¼šè‹¥ç¨‹åºç‚¹ $p$ æ— å€Ÿç”¨å†²çªï¼Œä¸”æ‰§è¡Œè¯­å¥ $s$ åˆ°è¾¾ $p'$ï¼Œåˆ™ $p'$ ä¹Ÿæ— å€Ÿç”¨å†²çªï¼Œé™¤é $s$ æ˜¾å¼åˆ›å»ºå†²çªå€Ÿç”¨ã€‚

**è¯æ˜**ï¼š

- æ ¹æ® Axiom 3ï¼Œç°æœ‰å€Ÿç”¨ä¿æŒæœ‰æ•ˆ
- æ–°å€Ÿç”¨åˆ›å»ºæ—¶ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨éªŒè¯ä¸è¿å Axiom 1-2
- å› æ­¤ï¼Œæ— å†²çªçŠ¶æ€ä¿æŒ

$$\square$$

---

**Lemma 2 (å¯å˜å€Ÿç”¨ç‹¬å æ€§)**ï¼šè‹¥å¯å˜å€Ÿç”¨ $b$ åœ¨ç¨‹åºç‚¹ $p$ æ´»è·ƒï¼Œåˆ™ $p$ ç‚¹ä¸å­˜åœ¨æŒ‡å‘é‡å å†…å­˜çš„å…¶ä»–æ´»è·ƒå€Ÿç”¨ã€‚

**è¯æ˜**ï¼š

- ç›´æ¥ç”± Axiom 1 å’Œ Axiom 2 å¾—å‡º
- å¯å˜å€Ÿç”¨ä¸ä»»ä½•å…¶ä»–å€Ÿç”¨ï¼ˆå¯å˜æˆ–ä¸å¯å˜ï¼‰äº’æ–¥

$$\square$$

---

**Corollary 1 (Safe Rust æ•°æ®ç«äº‰è‡ªç”±)**ï¼šä»…ä½¿ç”¨ Safe Rustï¼ˆä¸ä½¿ç”¨ `unsafe`ï¼‰çš„ç¨‹åºï¼Œè‹¥é€šè¿‡ç¼–è¯‘ï¼Œåˆ™ä¿è¯æ•°æ®ç«äº‰è‡ªç”±ã€‚

**è¯æ˜**ï¼š

- Safe Rust ç¨‹åºå¿…é¡»é€šè¿‡å€Ÿç”¨æ£€æŸ¥
- æ ¹æ® Theorem 1ï¼Œé€šè¿‡å€Ÿç”¨æ£€æŸ¥è•´å«æ•°æ®ç«äº‰è‡ªç”±
- å› æ­¤ï¼ŒSafe Rust ç¨‹åºä¿è¯æ•°æ®ç«äº‰è‡ªç”±

$$\square$$

---

**Corollary 2 (å¹¶å‘å®‰å…¨)**ï¼šä½¿ç”¨ `Send` å’Œ `Sync` ç±»å‹çš„å¹¶å‘ç¨‹åºä¿è¯çº¿ç¨‹å®‰å…¨ã€‚

**è¯æ˜**ï¼š

- æ ¹æ® [send_sync_formalization](send_sync_formalization.md) å®šç† SEND-T1 å’Œ SYNC-T1
- `Send` ä¿è¯è·¨çº¿ç¨‹è½¬ç§»å®‰å…¨
- `Sync` ä¿è¯è·¨çº¿ç¨‹å…±äº«å®‰å…¨
- ç»“åˆ Theorem 1ï¼Œå¹¶å‘ç¨‹åºæ•°æ®ç«äº‰è‡ªç”±

$$\square$$

---

## ğŸ§  æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((å€Ÿç”¨æ£€æŸ¥å™¨å½¢å¼åŒ–))
    æ¦‚å¿µå®šä¹‰å±‚
      Def 1.1 å€Ÿç”¨ç±»å‹é›†åˆ
      Def 1.2 å€Ÿç”¨çŠ¶æ€
      Def 1.3 å€Ÿç”¨æœ‰æ•ˆæ€§
      Def 1.4 å€Ÿç”¨å†²çª
      Def 1.5 ç¨‹åºçŠ¶æ€
    å±æ€§å…³ç³»å±‚
      Axiom 1 å¯å˜å€Ÿç”¨å”¯ä¸€æ€§
      Axiom 2 å¯å˜-ä¸å¯å˜äº’æ–¥
      Axiom 3 å€Ÿç”¨æœ‰æ•ˆæ€§ä¿æŒ
      Axiom 4 å€Ÿç”¨æ£€æŸ¥å®Œå¤‡æ€§
    è§£é‡Šè®ºè¯å±‚
      Theorem 1 æ•°æ®ç«äº‰è‡ªç”±
      Theorem 2 å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§
      Theorem 3 å¼•ç”¨æœ‰æ•ˆæ€§ä¿è¯
      Lemma 1 äº’æ–¥å€Ÿç”¨ä¿æŒ
      Lemma 2 å¯å˜å€Ÿç”¨ç‹¬å æ€§
      Corollary 1 Safe Rust æ•°æ®ç«äº‰è‡ªç”±
      Corollary 2 å¹¶å‘å®‰å…¨
    åº”ç”¨é¢†åŸŸ
      æ‰€æœ‰æƒç³»ç»Ÿ
      ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿ
      å¹¶å‘ç¼–ç¨‹
      Unsafe å¥‘çº¦
```

---

## ğŸŒ³ è¯æ˜æ ‘

```mermaid
graph TD
    subgraph æ¦‚å¿µå®šä¹‰å±‚
        D1[Def 1.1 å€Ÿç”¨ç±»å‹é›†åˆ]
        D2[Def 1.2 å€Ÿç”¨çŠ¶æ€]
        D3[Def 1.3 å€Ÿç”¨æœ‰æ•ˆæ€§]
        D4[Def 1.4 å€Ÿç”¨å†²çª]
        D5[Def 1.5 ç¨‹åºçŠ¶æ€]
    end

    subgraph å±æ€§å…³ç³»å±‚
        A1[Axiom 1 å¯å˜å€Ÿç”¨å”¯ä¸€æ€§]
        A2[Axiom 2 å¯å˜-ä¸å¯å˜äº’æ–¥]
        A3[Axiom 3 å€Ÿç”¨æœ‰æ•ˆæ€§ä¿æŒ]
        A4[Axiom 4 å€Ÿç”¨æ£€æŸ¥å®Œå¤‡æ€§]
    end

    subgraph å¼•ç†å±‚
        L1[Lemma 1 äº’æ–¥å€Ÿç”¨ä¿æŒ]
        L2[Lemma 2 å¯å˜å€Ÿç”¨ç‹¬å æ€§]
    end

    subgraph å®šç†å±‚
        T1[Theorem 1 æ•°æ®ç«äº‰è‡ªç”±]
        T2[Theorem 2 å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§]
        T3[Theorem 3 å¼•ç”¨æœ‰æ•ˆæ€§ä¿è¯]
    end

    subgraph æ¨è®ºå±‚
        C1[Corollary 1 Safe Rust æ•°æ®ç«äº‰è‡ªç”±]
        C2[Corollary 2 å¹¶å‘å®‰å…¨]
    end

    D1 --> A1
    D2 --> A1
    D2 --> A2
    D3 --> A3
    D4 --> A1
    D4 --> A2
    D5 --> A4

    A1 --> L2
    A2 --> L2
    A3 --> L1
    A4 --> T2

    L1 --> T1
    L2 --> T1
    A1 --> T1
    A2 --> T1

    T2 --> T3
    A3 --> T3
    D3 --> T3

    T1 --> C1
    T1 --> C2
    T2 --> C2
```

---

## ğŸ“‹ æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯ æ±‡æ€»è¡¨

| å±‚æ¬¡ | ç¼–å· | å†…å®¹ | æ–‡æ¡£ä½ç½® |
|:---|:---|:---|:---|
| **æ¦‚å¿µå®šä¹‰å±‚** | Def 1.1 | å€Ÿç”¨ç±»å‹é›†åˆ $\mathcal{B} = \{Immutable, Mutable\}$ | Â§1 æ¦‚å¿µå®šä¹‰å±‚ |
| | Def 1.2 | å€Ÿç”¨çŠ¶æ€ $\mathcal{S} = (I, M, T)$ | Â§1 æ¦‚å¿µå®šä¹‰å±‚ |
| | Def 1.3 | å€Ÿç”¨æœ‰æ•ˆæ€§ $\text{Valid}(b, p)$ | Â§1 æ¦‚å¿µå®šä¹‰å±‚ |
| | Def 1.4 | å€Ÿç”¨å†²çª $\text{Conflict}(b_1, b_2)$ | Â§1 æ¦‚å¿µå®šä¹‰å±‚ |
| | Def 1.5 | ç¨‹åºçŠ¶æ€ $\Sigma = (\Gamma, \Delta, S)$ | Â§1 æ¦‚å¿µå®šä¹‰å±‚ |
| **å±æ€§å…³ç³»å±‚** | Axiom 1 | å¯å˜å€Ÿç”¨å”¯ä¸€æ€§ | Â§2 å±æ€§å…³ç³»å±‚ |
| | Axiom 2 | å¯å˜-ä¸å¯å˜äº’æ–¥ | Â§2 å±æ€§å…³ç³»å±‚ |
| | Axiom 3 | å€Ÿç”¨æœ‰æ•ˆæ€§ä¿æŒ | Â§2 å±æ€§å…³ç³»å±‚ |
| | Axiom 4 | å€Ÿç”¨æ£€æŸ¥å®Œå¤‡æ€§ | Â§2 å±æ€§å…³ç³»å±‚ |
| **è§£é‡Šè®ºè¯å±‚** | Theorem 1 | æ•°æ®ç«äº‰è‡ªç”±ï¼ˆå®Œæ•´è¯æ˜ï¼‰ | Â§3 è§£é‡Šè®ºè¯å±‚ |
| | Theorem 2 | å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§ï¼ˆå®Œæ•´è¯æ˜ï¼‰ | Â§3 è§£é‡Šè®ºè¯å±‚ |
| | Theorem 3 | å¼•ç”¨æœ‰æ•ˆæ€§ä¿è¯ï¼ˆå®Œæ•´è¯æ˜ï¼‰ | Â§3 è§£é‡Šè®ºè¯å±‚ |
| | Lemma 1 | äº’æ–¥å€Ÿç”¨ä¿æŒ | å¼•ç†ä¸æ¨è®º |
| | Lemma 2 | å¯å˜å€Ÿç”¨ç‹¬å æ€§ | å¼•ç†ä¸æ¨è®º |
| | Corollary 1 | Safe Rust æ•°æ®ç«äº‰è‡ªç”± | å¼•ç†ä¸æ¨è®º |
| | Corollary 2 | å¹¶å‘å®‰å…¨ | å¼•ç†ä¸æ¨è®º |

---

## âš ï¸ åä¾‹ï¼šè¿åå€Ÿç”¨è§„åˆ™å¯¼è‡´æ•°æ®ç«äº‰

| åä¾‹ | è¿åè§„åˆ™ | åæœ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| åŒå¯å˜å€Ÿç”¨ | Axiom 1 | ç¼–è¯‘é”™è¯¯ | ä¸¤å¤„ `&mut` å åŠ ï¼Œç¼–è¯‘å™¨æ‹’ç» |
| å¯å˜ä¸ä¸å¯å˜å…±å­˜ | Axiom 2 | ç¼–è¯‘é”™è¯¯ | `&` ä¸ `&mut` åŒæ—¶å­˜åœ¨ |
| è·¨çº¿ç¨‹å…±äº«å¯å˜å¼•ç”¨ | Axiom 1ã€2 | ç¼–è¯‘é”™è¯¯ | ç¤ºä¾‹ 3ï¼šthread::spawn æ•è·å¯å˜å€Ÿç”¨ |
| å€Ÿç”¨è¶…å‡ºæ‰€æœ‰è€… | Axiom 3 | æ‚¬å‚å¼•ç”¨ | è¿”å›å±€éƒ¨å¼•ç”¨ï¼Œç”Ÿå‘½å‘¨æœŸä¸è¶³ |

---

## ğŸ’» ä»£ç ç¤ºä¾‹ä¸å®è·µ

### ç¤ºä¾‹ 1ï¼šä¸å¯å˜å€Ÿç”¨

```rust
fn immutable_borrow_example() {
    let s = String::from("hello");
    let r1 = &s;  // ä¸å¯å˜å€Ÿç”¨
    let r2 = &s;  // å¯ä»¥å¤šä¸ªä¸å¯å˜å€Ÿç”¨
    println!("{} {}", r1, r2);
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- $r_1, r_2 \in I$ï¼ˆä¸å¯å˜å€Ÿç”¨é›†åˆï¼‰
- $T(r_1) = T(r_2) = Immutable$
- æ ¹æ® Def 1.4ï¼Œ$\text{Compatible}(r_1, r_2)$ æˆç«‹
- å› æ­¤æ— å€Ÿç”¨å†²çª

### ç¤ºä¾‹ 2ï¼šå¯å˜å€Ÿç”¨

```rust
fn mutable_borrow_example() {
    let mut s = String::from("hello");
    let r1 = &mut s;  // å¯å˜å€Ÿç”¨
    // let r2 = &s;   // é”™è¯¯ï¼šä¸èƒ½åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å€Ÿç”¨
    println!("{}", r1);
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- $r_1 \in M$ï¼ˆå¯å˜å€Ÿç”¨é›†åˆï¼‰
- $T(r_1) = Mutable$
- æ ¹æ® Axiom 2ï¼Œä¸å¯å†åˆ›å»ºæŒ‡å‘ $s$ çš„å…¶ä»–å€Ÿç”¨

### ç¤ºä¾‹ 3ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»æ•°æ®ç«äº‰

```rust
use std::thread;

fn data_race_prevention() {
    let mut data = vec![1, 2, 3];

    // é”™è¯¯ï¼šä¸èƒ½åŒæ—¶æœ‰å¯å˜å€Ÿç”¨å’Œä¸å¯å˜å€Ÿç”¨
    // let r1 = &data;
    // thread::spawn(move || {
    //     data.push(4);  // é”™è¯¯ï¼šæ•°æ®ç«äº‰
    // });
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- å€Ÿç”¨æ£€æŸ¥å™¨æ£€æµ‹åˆ°æ½œåœ¨çš„ Axiom 2 è¿å
- ç¼–è¯‘å™¨æ‹’ç»ç¼–è¯‘ï¼Œé˜²æ­¢æ•°æ®ç«äº‰

### ç¤ºä¾‹ 4ï¼šå€Ÿç”¨ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ

```rust
fn borrow_scope_example() {
    let mut s = String::from("hello");

    {
        let r1 = &s;  // ä¸å¯å˜å€Ÿç”¨å¼€å§‹
        let r2 = &s;  // å¯ä»¥å¤šä¸ªä¸å¯å˜å€Ÿç”¨
        println!("{} {}", r1, r2);
    }  // å€Ÿç”¨ç»“æŸ

    let r3 = &mut s;  // ç°åœ¨å¯ä»¥å¯å˜å€Ÿç”¨
    r3.push_str(" world");
    println!("{}", r3);
}
```

**å½¢å¼åŒ–åˆ†æ**:

- å€Ÿç”¨ä½œç”¨åŸŸï¼š$[\text{start}, \text{end}]$
- ä½œç”¨åŸŸç»“æŸåï¼Œå€Ÿç”¨çŠ¶æ€æ›´æ–°ï¼š$r_1, r_2 \notin I$
- æ ¹æ® Axiom 3ï¼Œå€Ÿç”¨å¤±æ•ˆåä¸å†çº¦æŸæ–°å€Ÿç”¨

### ç¤ºä¾‹ 5ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ£€æµ‹æ‚¬å‚å¼•ç”¨

```rust
// é”™è¯¯ï¼šè¿”å›æ‚¬å‚å¼•ç”¨
// fn dangling_borrow() -> &String {
//     let s = String::from("hello");
//     &s  // é”™è¯¯ï¼šs åœ¨å‡½æ•°ç»“æŸæ—¶è¢«ä¸¢å¼ƒ
// }

// æ­£ç¡®ï¼šä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‚æ•°
fn valid_borrow<'a>(s: &'a String) -> &'a String {
    s  // æ­£ç¡®ï¼šè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸä¸å‚æ•°ç›¸åŒ
}
```

**å½¢å¼åŒ–åˆ†æ**:

- é”™è¯¯æƒ…å†µï¼š$\text{Lifetime}(r) \not\subseteq \text{Scope}(r)$
- è¿å Def 1.3ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»

### ç¤ºä¾‹ 6ï¼šå¤æ‚å€Ÿç”¨åœºæ™¯

```rust
struct Container {
    data: Vec<i32>,
}

impl Container {
    fn get_first(&self) -> Option<&i32> {
        self.data.first()
    }

    fn add_item(&mut self, item: i32) {
        self.data.push(item);
    }
}

fn complex_borrow() {
    let mut container = Container {
        data: vec![1, 2, 3],
    };

    // é”™è¯¯ï¼šä¸èƒ½åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å€Ÿç”¨
    // let first = container.get_first();
    // container.add_item(4);  // é”™è¯¯ï¼šå€Ÿç”¨å†²çª

    // æ­£ç¡®ï¼šå…ˆä½¿ç”¨ä¸å¯å˜å€Ÿç”¨ï¼Œç„¶åä½¿ç”¨å¯å˜å€Ÿç”¨
    let first = container.get_first();
    println!("{:?}", first);
    container.add_item(4);  // æ­£ç¡®ï¼šå€Ÿç”¨å·²ç»“æŸ
}
```

**å½¢å¼åŒ–åˆ†æ**:

- æ–¹æ³•è°ƒç”¨åˆ›å»ºå€Ÿç”¨
- å€Ÿç”¨æ£€æŸ¥å™¨è·Ÿè¸ªæ‰€æœ‰å€Ÿç”¨
- æ£€æµ‹åˆ°å€Ÿç”¨å†²çªæ—¶æ‹’ç»ç¼–è¯‘

---

## ğŸ”— ç³»ç»Ÿé›†æˆä¸å®é™…åº”ç”¨

### ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ

å€Ÿç”¨æˆç«‹æ¡ä»¶ $\text{borrow}(x,r)$ è•´å« $\Omega(x)=\text{Owned}$ï¼›
ç§»åŠ¨å $x$ å¤±æ•ˆï¼Œæ‰€æœ‰æŒ‡å‘ $x$ çš„å€Ÿç”¨ç¦»å¼€ä½œç”¨åŸŸã€‚
æ•°æ®ç«äº‰è‡ªç”±ä¸æ‰€æœ‰æƒå”¯ä¸€æ€§å…±åŒä¿è¯å†…å­˜å®‰å…¨ï¼Œå½¢å¼åŒ–è§ [ownership_model](./ownership_model.md)ã€‚

### ä¸ç”Ÿå‘½å‘¨æœŸçš„é›†æˆ

$\text{Scope}(r) \subseteq \text{lft}(r)$ï¼›NLL ä¸ reborrow çš„çº¦æŸç”±ç”Ÿå‘½å‘¨æœŸä¸ outlives è¡¨è¾¾ã€‚Polonius ä¸ [lifetime_formalization](./lifetime_formalization.md) ä¸­çš„æ¨æ–­ã€çº¦æŸæ±‚è§£ä¸€è‡´ã€‚

### å®é™…åº”ç”¨æ¡ˆä¾‹

1. **å¹¶å‘**ï¼š`Mutex`ã€`RwLock`ã€channel çš„æ¥å£ä¸å€Ÿç”¨ã€`Send`/`Sync` é…åˆï¼Œä¿è¯æ•°æ®ç«äº‰è‡ªç”±ã€‚
2. **è¿­ä»£å™¨**ï¼š`Iter`/`IterMut` çš„ `&T`/`&mut T` ä¸å€Ÿç”¨è§„åˆ™ã€ç”Ÿå‘½å‘¨æœŸå¯¹åº”ã€‚
3. **é—­åŒ…**ï¼š`Fn`/`FnMut`/`FnOnce` çš„æ•è·ä¸å€Ÿç”¨ã€move è¯­ä¹‰å¯¹åº”æ’ä»–/å…±äº«ä¸æ‰€æœ‰æƒè½¬ç§»ã€‚

---

## âœ… è¯æ˜ç›®æ ‡

### å¾…è¯æ˜çš„æ€§è´¨

1. **å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§**ï¼šå€Ÿç”¨è§„åˆ™ä¿è¯å†…å­˜å®‰å…¨ âœ…
2. **æ•°æ®ç«äº‰è‡ªç”±**ï¼šå€Ÿç”¨æ£€æŸ¥å™¨ä¿è¯æ•°æ®ç«äº‰è‡ªç”± âœ…
3. **å®Œæ•´æ€§**ï¼šæ‰€æœ‰æ•°æ®ç«äº‰éƒ½è¢«æ£€æµ‹åˆ° âœ…

### è¯æ˜æ–¹æ³•

1. **å½¢å¼åŒ–éªŒè¯**ï¼šä½¿ç”¨å½¢å¼åŒ–éªŒè¯å·¥å…·
2. **å®šç†è¯æ˜**ï¼šä½¿ç”¨å®šç†è¯æ˜å™¨ï¼ˆå¦‚ Coqã€Isabelleï¼‰
3. **æ¨¡å‹æ£€æŸ¥**ï¼šä½¿ç”¨æ¨¡å‹æ£€æŸ¥å·¥å…·

---

## Rust 1.93 ä¸å¹¶å‘/è£¸æŒ‡é’ˆæ‰©å±•ï¼ˆå½¢å¼åŒ–å ä½ï¼‰

**Def CHAN1ï¼ˆé€šé“æ¶ˆæ¯ä¼ é€’ï¼‰**ï¼š`mpsc::channel` æˆ– `broadcast` å®ç°**æ¶ˆæ¯ä¼ é€’**è¯­ä¹‰ï¼›å‘é€è€…ä¸æ¥æ”¶è€…é—´æ— å…±äº«å†…å­˜ï¼›æ‰€æœ‰æƒéšæ¶ˆæ¯è½¬ç§»ã€‚å½¢å¼åŒ–ï¼š$\text{send}(tx, v) \rightarrow \Omega(v) \mapsto \text{Receiver}$ï¼›æ—  $\&mut$ å…±äº«ï¼Œæ•…æ— æ•°æ®ç«äº‰ã€‚

**å®šç† CHAN-T1**ï¼šé€šé“å®ç°ä¸ºçº¯ Safeï¼›æ¶ˆæ¯ä¼ é€’æ— å…±äº«å¯å˜ï¼›æ»¡è¶³ [borrow_checker_proof](borrow_checker_proof.md) å®šç† 1 æ•°æ®ç«äº‰è‡ªç”±ã€‚ç”± Send çº¦æŸä¸æ‰€æœ‰æƒè½¬ç§»ã€‚

**Def MUTEX1ï¼ˆMutex é”è¯­ä¹‰ï¼‰**ï¼š`Mutex<T>` å°è£…å†…éƒ¨å¯å˜ï¼›`lock()` è¿”å› `MutexGuard` æŒæœ‰å¯å˜å€Ÿç”¨ï¼›guard drop æ—¶é‡Šæ”¾é”ã€‚å½¢å¼åŒ–ï¼š$\text{lock}(m) \rightarrow \&mut T$ ä»…åœ¨æŒé”æœŸé—´æœ‰æ•ˆï¼›äº’æ–¥ä¿è¯æ— å¹¶å‘å†™ã€‚

**å®šç† MUTEX-T1**ï¼š`Mutex` ä¸º Safe æŠ½è±¡ï¼›å†…éƒ¨ `unsafe` å°è£…ï¼›å¯¹å¤–æ»¡è¶³å€Ÿç”¨è§„åˆ™â€”â€”ä»»ä¸€æ—¶åˆ»è‡³å¤šä¸€ä¸ª `MutexGuard` æŒæœ‰ `&mut T`ã€‚ç”± [borrow_checker_proof](borrow_checker_proof.md) Axiom 1ã€‚

**Def RAW1ï¼ˆè£¸æŒ‡é’ˆä¸ deref_nullptrï¼‰**ï¼š`*const T`/`*mut T` æ— è‡ªåŠ¨å€Ÿç”¨ï¼›è§£å¼•ç”¨éœ€ `unsafe`ï¼›1.93 `deref_nullptr` deny-by-default ç¦æ­¢è§£å¼•ç”¨å¯èƒ½ä¸º null çš„æŒ‡é’ˆã€‚å½¢å¼åŒ–ï¼š$\text{deref}(p)$ åˆæ³•ä»…å½“ $\text{nonnull}(p)$ï¼›è¿åä¸º UBã€‚

**å®šç† RAW-T1**ï¼šè£¸æŒ‡é’ˆè§£å¼•ç”¨ä¸ä¸å€Ÿç”¨æ£€æŸ¥å™¨å†²çªï¼›å€Ÿç”¨æ£€æŸ¥å™¨ä¸æ£€æŸ¥è£¸æŒ‡é’ˆï¼›`deref_nullptr` lint å‡å°‘ null è§£å¼•ç”¨ UBã€‚ä¸ [type_system_foundations](../type_theory/type_system_foundations.md) Def DEREF-NULL1 è¡”æ¥ã€‚

---

## unsafe å¥‘çº¦ä¸ borrow/ownership è¡”æ¥ï¼ˆPhase 3ï¼‰

**Def UNSAFE1ï¼ˆunsafe å¥‘çº¦ï¼‰**ï¼š`unsafe` å—æ‰¿è¯ºæ»¡è¶³ç¼–è¯‘å™¨æ— æ³•éªŒè¯çš„**å‰ç½®æ¡ä»¶**ï¼›è°ƒç”¨è€…æˆ–å®ç°è€…é¡»ä¿è¯ï¼š$\text{pre}(C) \rightarrow \text{safe}(C)$ï¼Œå…¶ä¸­ $C$ ä¸º unsafe å¥‘çº¦ã€$\text{pre}$ ä¸ºå‰ç½®ã€$\text{safe}$ ä¸ºå®‰å…¨è¯­ä¹‰ã€‚è¿åå‰ç½®ä¸º UBã€‚

**å®šç† UNSAFE-T1ï¼ˆunsafe ä¸ borrow è¡”æ¥ï¼‰**ï¼šè‹¥ unsafe å—å†…äº§ç”Ÿçš„å¼•ç”¨æˆ–è£¸æŒ‡é’ˆæ»¡è¶³å€Ÿç”¨è§„åˆ™çš„å‰ç½®ï¼ˆéæ‚¬å‚ã€éåˆ«åå†²çªï¼‰ï¼Œåˆ™å…¶ä¸ [borrow_checker_proof](borrow_checker_proof.md) å®šç† 1 æ•°æ®ç«äº‰è‡ªç”±ç›¸å®¹ã€‚å½¢å¼åŒ–ï¼š$\text{pre}(C) \land \text{borrow\_compliant}(r) \rightarrow \text{DataRaceFree}(P)$ã€‚ç”± unsafe å¥‘çº¦ä¸å€Ÿç”¨è§„åˆ™æ— å†²çªã€‚

**å®šç† UNSAFE-T2ï¼ˆunsafe ä¸æ‰€æœ‰æƒè¡”æ¥ï¼‰**ï¼š`unsafe` ä¸­å¯¹ `Box::from_raw`ã€`ManuallyDrop` ç­‰ä½¿ç”¨è‹¥ä¿æŒ [ownership_model](ownership_model.md) è§„åˆ™ 2ã€3ï¼ˆå”¯ä¸€æ‰€æœ‰è€…ã€ä½œç”¨åŸŸé‡Šæ”¾ï¼‰ï¼Œåˆ™ä¸å®šç† 3 å†…å­˜å®‰å…¨ç›¸å®¹ã€‚

---

## æ§åˆ¶æµä¸å€Ÿç”¨è¡”æ¥ï¼ˆPhase 5ï¼‰

**Def MATCH1ï¼ˆmatch ç©·å°½æ€§ï¼‰**ï¼š`match e { p_1 => ..., p_n => ... }` æ»¡è¶³**ç©·å°½æ€§**å½“ä¸”ä»…å½“ $\forall v: \tau.\, \exists i: p_i \text{ matches } v$ï¼›ç±»å‹ç³»ç»Ÿä¿è¯ç©·å°½ï¼Œä¸å¯è¾¾åˆ†æ”¯ä¸º `!` ç±»å‹ã€‚

**å®šç† MATCH-T1ï¼ˆç©·å°½æ€§ä¸ä¸å¯è¾¾ï¼‰**ï¼šç©·å°½ match ä¿è¯æ‰€æœ‰å€¼è¢«å¤„ç†ï¼›è‹¥å­˜åœ¨ `_ => unreachable!()` æˆ– `!` åˆ†æ”¯ï¼Œåˆ™ç±»å‹ç³»ç»Ÿä¿è¯è¯¥åˆ†æ”¯ä¸å¯è¾¾ã€‚ä¸ [borrow_checker_proof](borrow_checker_proof.md) Axiom 3 ç»“åˆï¼šmatch å„åˆ†æ”¯å†…å€Ÿç”¨ä½œç”¨åŸŸç‹¬ç«‹ï¼Œæ— è·¨åˆ†æ”¯å†²çªã€‚

**Def FOR1ï¼ˆfor è¿­ä»£ä¸å€Ÿç”¨ï¼‰**ï¼š`for x in iter` ç­‰ä»·äº `IntoIterator::into_iter` å–å¾—æ‰€æœ‰æƒæˆ–å€Ÿç”¨ï¼›è¿­ä»£æœŸé—´ `iter` è¢«å¯å˜å€Ÿç”¨ï¼ˆ`IterMut`ï¼‰æˆ–ä¸å¯å˜å€Ÿç”¨ï¼ˆ`Iter`ï¼‰ï¼›è¿­ä»£ä¸­ä¿®æ”¹é›†åˆè¿åå€Ÿç”¨è§„åˆ™ã€‚

**å®šç† FOR-T1ï¼ˆè¿­ä»£ä¸­ä¿®æ”¹é›†åˆï¼‰**ï¼š`for x in &mut v { v.push(...); }` è¢«å€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»â€”â€”`&mut v` ä¸ `v.push` çš„ `&mut self` å†²çªã€‚ç”± [borrow_checker_proof](borrow_checker_proof.md) Axiom 1 ç›´æ¥ä¿è¯ã€‚

---

## FFIã€externã€C variadicã€? æ“ä½œç¬¦ï¼ˆPhase 6ï¼‰

**Def EXTERN1ï¼ˆextern ABI è¾¹ç•Œï¼‰**ï¼š`extern "C"` æˆ– `extern "system"` å£°æ˜å‡½æ•°é‡‡ç”¨**å¤–éƒ¨ ABI**ï¼›è°ƒç”¨æ—¶ Rust ä¸éªŒè¯å®å‚ï¼›è°ƒç”¨è€…é¡»ä¿è¯ç±»å‹ä¸å¸ƒå±€ä¸ç›®æ ‡ ABI ä¸€è‡´ï¼›è¿åä¸º UBã€‚

**å®šç† EXTERN-T1**ï¼šextern å‡½æ•°ä¸å€Ÿç”¨æ£€æŸ¥å™¨è¾¹ç•Œï¼šRust ä»…æ£€æŸ¥ Rust ä¾§ï¼›è°ƒç”¨ extern æ—¶ä¼ å…¥çš„å¼•ç”¨è‹¥åœ¨ extern è°ƒç”¨æœŸé—´è¢«å¤–éƒ¨ä»£ç ä¿®æ”¹ï¼Œåˆ™éœ€ `unsafe` å¥‘çº¦ä¿è¯ã€‚ä¸ [borrow_checker_proof](borrow_checker_proof.md) å®šç† 1 ç›¸å®¹â€”â€”extern ä¸å¼•å…¥ Rust å€Ÿç”¨å†²çªã€‚

**Def CVARIADIC1ï¼ˆC variadic 1.93ï¼‰**ï¼š`extern "system" fn(..., ...)` ä¸º 1.93 ç¨³å®šçš„ C é£æ ¼å¯å˜å‚æ•°ï¼›è°ƒç”¨è€…é¡»æŒ‰ C çº¦å®šä¼ é€’å‚æ•°ï¼›`va_list` ç­‰éœ€ FFI æ­£ç¡®ä½¿ç”¨ã€‚

**Def QUERY1ï¼ˆ? æ“ä½œç¬¦ï¼‰**ï¼š`e?` ä¸ºé”™è¯¯ä¼ æ’­è¯­æ³•ç³–ï¼›`e: Result<T, E>` æˆ– `Option<T>`ï¼›`Ok(v)/Some(v)` æå–å€¼ï¼Œ`Err(e)/None` æ—©æœŸè¿”å›ã€‚å½¢å¼åŒ–ï¼š$\text{query}(e) \equiv \text{match } e \text{ with Ok/Some} \rightarrow v \mid \text{Err/None} \rightarrow \text{return}$ã€‚

**å®šç† QUERY-T1**ï¼š`?` ä¸å€Ÿç”¨ï¼š`e` åœ¨ `?` å‰æ±‚å€¼å®Œæˆï¼Œå€Ÿç”¨å¯ç»“æŸï¼›`?` æ‰€åœ¨å‡½æ•°è¿”å›ç±»å‹ä¸ `e` çš„ `E` ç›¸å®¹ï¼›ä¸å½±å“ [borrow_checker_proof](borrow_checker_proof.md) Axiom 1ã€2ã€‚

---

## ğŸ“– å‚è€ƒæ–‡çŒ®

### å­¦æœ¯è®ºæ–‡ï¼ˆå›½é™…æƒå¨ï¼‰

1. **RustBelt: Securing the Foundations of the Rust Programming Language** (POPL 2018)
   - ä½œè€…: Ralf Jung, Jacques-Henri Jourdan, Robbert Krebbers, Derek Dreyer
   - é“¾æ¥: <https://plv.mpi-sws.org/rustbelt/popl18/>
   - æ‘˜è¦: å€Ÿç”¨è§„åˆ™å½¢å¼åŒ–ï¼›æ•°æ®ç«äº‰è‡ªç”±è¯æ˜ï¼›Iris åˆ†ç¦»é€»è¾‘
   - ä¸æœ¬ç›®å½•: Axiom 1-2ã€Theorem 1 ç›´æ¥å¯¹åº”

2. **Stacked Borrows: An Aliasing Model for Rust** (POPL 2020)
   - ä½œè€…: Ralf Jung, Hoang-Hai Dang, Jeehoon Kang, Derek Dreyer
   - é“¾æ¥: <https://plv.mpi-sws.org/rustbelt/stacked-borrows/>
   - æ‘˜è¦: åˆ«åè§„åˆ™ï¼›&mut å”¯ä¸€æ€§ï¼›è¿åä¸º UBï¼›Miri å®ç°
   - ä¸æœ¬ç›®å½•: Axiom 1ï¼ˆäº’æ–¥å€Ÿç”¨ï¼‰ã€RAW1ã€UNSAFE-T1 å¯¹åº”

3. **RustBelt Meets Relaxed Memory** (POPL 2020)
   - é“¾æ¥: <https://plv.mpi-sws.org/rustbelt/rbrlx/>
   - æ‘˜è¦: relaxed memoryã€Arc æ•°æ®ç«äº‰ã€é”ä¸é€šé“åŒæ­¥
   - ä¸æœ¬ç›®å½•: CHAN-T1ã€MUTEX-T1ã€å¹¶å‘è¯­ä¹‰å¯¹åº”

4. **Tree Borrows** (PLDI 2025 â€” Distinguished Paper Award)
   - ä½œè€…: Neven Villani, Johannes Hostert, Derek Dreyer, Ralf Jung
   - é“¾æ¥: [ETH é¡¹ç›®é¡µ](https://plf.inf.ethz.ch/research/pldi25-tree-borrows.html)ã€[ACM PDF](https://dl.acm.org/doi/pdf/10.1145/3735592)ã€[Iris PDF](https://iris-project.org/pdfs/2025-pldi-tree-borrows.pdf)ã€[Ralf åšå®¢](https://www.ralfj.de/blog/2025/07/07/tree-borrows-paper.html)
   - æ‘˜è¦: Stacked Borrows æ¼”è¿›ï¼›æ ‘ç»“æ„ï¼›30k crates 54% æ›´å°‘æ‹’ç»ï¼›Rocq å½¢å¼åŒ–è¯æ˜
   - ä¸æœ¬ç›®å½•: å€Ÿç”¨è§„åˆ™ã€RAW1 æ¼”è¿›ï¼›Miri æœªæ¥å¯èƒ½é‡‡ç”¨

5. **Polonius** â€” å½¢å¼åŒ– borrow åˆ†æ
   - é“¾æ¥: <https://rust-lang.github.io/polonius/>
   - ä¸æœ¬ç›®å½•: lifetimeã€borrow è§„åˆ™ï¼›datalog å½¢å¼åŒ–ï¼›NLL åç»§

6. **Prusti / Kani / Miri** â€” éªŒè¯å·¥å…·
   - Prusti: <https://prusti.org/> â€” deductive verification
   - Kani: <https://model-checking.github.io/kani/> â€” model checkingã€UB
   - Miri: <https://github.com/rust-lang/miri> â€” Stacked Borrows å®ç°
   - ä¸æœ¬ç›®å½•: å¯éªŒè¯æœ¬ Def/å®šç†å¯¹åº”çš„ç¨‹åºå±æ€§

### å®˜æ–¹æ–‡æ¡£

- [Rust å€Ÿç”¨æ£€æŸ¥å™¨](https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html)
- [Rust Reference - Undefined behavior](https://doc.rust-lang.org/reference/behavior-considered-undefined.html)
- [Rustonomicon](https://doc.rust-lang.org/nomicon/) â€” å†…å­˜æ¨¡å‹ã€unsafe

### ç›¸å…³ä»£ç 

- [Rust ç¼–è¯‘å™¨å€Ÿç”¨æ£€æŸ¥å™¨](https://github.com/rust-lang/rust/tree/master/compiler/rustc_borrowck)

---

### ç›¸å…³æ€ç»´è¡¨å¾

| ç±»å‹ | ä½ç½® |
| :--- | :--- |
| æ€ç»´å¯¼å›¾ | [MIND_MAP_COLLECTION](../../04_thinking/MIND_MAP_COLLECTION.md) Â§2ã€C01ï¼›æœ¬æ–‡ Â§æ€ç»´å¯¼å›¾ |
| å¤šç»´çŸ©é˜µ | [MULTI_DIMENSIONAL_CONCEPT_MATRIX](../../04_thinking/MULTI_DIMENSIONAL_CONCEPT_MATRIX.md) Â§1ï¼›[README Â§å…­ç¯‡å¹¶è¡¨](README.md#formal_methods-å…­ç¯‡å¹¶è¡¨) ç¬¬ 2 è¡Œ |
| è¯æ˜æ ‘ | æœ¬æ–‡ Â§è¯æ˜æ ‘ï¼›[PROOF_GRAPH_NETWORK](../../04_thinking/PROOF_GRAPH_NETWORK.md) |
| å†³ç­–æ ‘ | [DECISION_GRAPH_NETWORK](../../04_thinking/DECISION_GRAPH_NETWORK.md) Â§1 |

*ä¾æ®*ï¼š[HIERARCHICAL_MAPPING_AND_SUMMARY](../HIERARCHICAL_MAPPING_AND_SUMMARY.md) Â§ æ–‡æ¡£â†”æ€ç»´è¡¨å¾ã€‚

---

**ç»´æŠ¤è€…**: Rust Formal Methods Research Team
**æœ€åæ›´æ–°**: 2026-02-20ï¼ˆè®ºè¯ç»“æ„æ·±åŒ–å®Œæˆï¼‰
**çŠ¶æ€**: âœ… **å·²å®Œæˆ** (100%)

**æœ¬æ¬¡æ›´æ–°å†…å®¹**:

- æ·»åŠ äº†å®Œæ•´çš„æ¦‚å¿µå®šä¹‰å±‚ï¼ˆDef 1.1-1.5ï¼‰
- æ·»åŠ äº†å®Œæ•´çš„å±æ€§å…³ç³»å±‚ï¼ˆAxiom 1-4ï¼‰
- æ·»åŠ äº†å®Œæ•´çš„è§£é‡Šè®ºè¯å±‚ï¼ˆTheorem 1-3 å«å®Œæ•´è¯æ˜ï¼‰
- æ·»åŠ äº†å¼•ç†ä¸æ¨è®ºï¼ˆLemma 1-2, Corollary 1-2ï¼‰
- æ·»åŠ äº†æ€ç»´å¯¼å›¾å’Œè¯æ˜æ ‘å¯è§†åŒ–
- æ·»åŠ äº†æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯ æ±‡æ€»è¡¨
- æ–°å¢å®šç†/è¯æ˜æ•°é‡: 3ä¸ªå®šç†ï¼ˆå«å®Œæ•´è¯æ˜ï¼‰+ 2ä¸ªå¼•ç† + 2ä¸ªæ¨è®º

**å›½é™…æƒå¨å¯¹æ ‡**ï¼š[Stacked Borrows POPL 2020](https://plv.mpi-sws.org/rustbelt/stacked-borrows/)ã€[Tree Borrows PLDI 2025](https://plf.inf.ethz.ch/research/pldi25-tree-borrows.html)ã€[Polonius](https://rust-lang.github.io/polonius/)ï¼›[FLS Ch. 15.4](https://spec.ferrocene.dev/ownership-and-deconstruction.html#borrowing) Borrowingã€[Ch. 19](https://spec.ferrocene.dev/unsafety.html) Unsafetyï¼›Miri å®ç° Stacked Borrowsã€‚
