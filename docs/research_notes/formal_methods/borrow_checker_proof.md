# å€Ÿç”¨æ£€æŸ¥å™¨è¯æ˜

> **åˆ›å»ºæ—¥æœŸ**: 2025-01-27
> **æœ€åæ›´æ–°**: 2026-02-12ï¼ˆå›½é™…æƒå¨å¯¹æ ‡è¡¥å…¨ï¼‰
> **Rust ç‰ˆæœ¬**: 1.93.0+ (Edition 2024) âœ…
> **çŠ¶æ€**: âœ… å·²å®Œæˆ (100%)
> **å…­ç¯‡å¹¶è¡¨**: [README Â§formal_methods å…­ç¯‡å¹¶è¡¨](README.md#formal_methods-å…­ç¯‡å¹¶è¡¨) ç¬¬ 2 è¡Œï¼ˆå€Ÿç”¨ï¼‰

---

## ğŸ“Š ç›®å½•

- [å€Ÿç”¨æ£€æŸ¥å™¨è¯æ˜](#å€Ÿç”¨æ£€æŸ¥å™¨è¯æ˜)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ ç ”ç©¶ç›®æ ‡](#-ç ”ç©¶ç›®æ ‡)
    - [æ ¸å¿ƒé—®é¢˜](#æ ¸å¿ƒé—®é¢˜)
    - [é¢„æœŸæˆæœ](#é¢„æœŸæˆæœ)
  - [ğŸ“š ç†è®ºåŸºç¡€](#-ç†è®ºåŸºç¡€)
    - [ç›¸å…³æ¦‚å¿µ](#ç›¸å…³æ¦‚å¿µ)
    - [ç†è®ºèƒŒæ™¯](#ç†è®ºèƒŒæ™¯)
    - [æ•°æ®ç«äº‰çš„å½¢å¼åŒ–å®šä¹‰](#æ•°æ®ç«äº‰çš„å½¢å¼åŒ–å®šä¹‰)
    - [å€Ÿç”¨æ£€æŸ¥ç®—æ³•çš„ç†è®ºåŸºç¡€](#å€Ÿç”¨æ£€æŸ¥ç®—æ³•çš„ç†è®ºåŸºç¡€)
    - [å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§çš„ç†è®ºåŸºç¡€](#å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§çš„ç†è®ºåŸºç¡€)
    - [ç›¸å…³å­¦æœ¯è®ºæ–‡çš„è¯¦ç»†åˆ†æ](#ç›¸å…³å­¦æœ¯è®ºæ–‡çš„è¯¦ç»†åˆ†æ)
      - [1. RustBelt: Logical Foundations for the Future of Safe Systems Programming](#1-rustbelt-logical-foundations-for-the-future-of-safe-systems-programming)
      - [2. The RustBelt Project: Formalizing Rust's Type System](#2-the-rustbelt-project-formalizing-rusts-type-system)
  - [ğŸ”¬ å½¢å¼åŒ–å®šä¹‰](#-å½¢å¼åŒ–å®šä¹‰)
    - [1. å€Ÿç”¨ç±»å‹](#1-å€Ÿç”¨ç±»å‹)
    - [2. å€Ÿç”¨è§„åˆ™](#2-å€Ÿç”¨è§„åˆ™)
    - [3. æ•°æ®ç«äº‰è‡ªç”±](#3-æ•°æ®ç«äº‰è‡ªç”±)
  - [âš ï¸ åä¾‹ï¼šè¿åå€Ÿç”¨è§„åˆ™å¯¼è‡´æ•°æ®ç«äº‰](#ï¸-åä¾‹è¿åå€Ÿç”¨è§„åˆ™å¯¼è‡´æ•°æ®ç«äº‰)
  - [ğŸŒ³ å…¬ç†-å®šç†è¯æ˜æ ‘](#-å…¬ç†-å®šç†è¯æ˜æ ‘)
    - [æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯ å±‚æ¬¡æ±‡æ€»](#æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯-å±‚æ¬¡æ±‡æ€»)
  - [ğŸ’» ä»£ç ç¤ºä¾‹ä¸å®è·µ](#-ä»£ç ç¤ºä¾‹ä¸å®è·µ)
    - [ç¤ºä¾‹ 1ï¼šä¸å¯å˜å€Ÿç”¨](#ç¤ºä¾‹-1ä¸å¯å˜å€Ÿç”¨)
    - [ç¤ºä¾‹ 2ï¼šå¯å˜å€Ÿç”¨](#ç¤ºä¾‹-2å¯å˜å€Ÿç”¨)
    - [ç¤ºä¾‹ 3ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»æ•°æ®ç«äº‰](#ç¤ºä¾‹-3å€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»æ•°æ®ç«äº‰)
    - [ç¤ºä¾‹ 4ï¼šå€Ÿç”¨ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ](#ç¤ºä¾‹-4å€Ÿç”¨ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ)
    - [ç¤ºä¾‹ 5ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ£€æµ‹æ‚¬å‚å¼•ç”¨](#ç¤ºä¾‹-5å€Ÿç”¨æ£€æŸ¥å™¨æ£€æµ‹æ‚¬å‚å¼•ç”¨)
    - [ç¤ºä¾‹ 6ï¼šå¤æ‚å€Ÿç”¨åœºæ™¯](#ç¤ºä¾‹-6å¤æ‚å€Ÿç”¨åœºæ™¯)
    - [ç¤ºä¾‹ 3ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»æ•°æ®ç«äº‰ï¼ˆåŸç¤ºä¾‹ä¿ç•™ï¼‰](#ç¤ºä¾‹-3å€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»æ•°æ®ç«äº‰åŸç¤ºä¾‹ä¿ç•™)
  - [ğŸ’» ä»£ç ç¤ºä¾‹](#-ä»£ç ç¤ºä¾‹)
    - [ç¤ºä¾‹ 1ï¼šä¸å¯å˜å€Ÿç”¨](#ç¤ºä¾‹-1ä¸å¯å˜å€Ÿç”¨-1)
    - [ç¤ºä¾‹ 2ï¼šå¯å˜å€Ÿç”¨å”¯ä¸€æ€§](#ç¤ºä¾‹-2å¯å˜å€Ÿç”¨å”¯ä¸€æ€§)
    - [ç¤ºä¾‹ 3ï¼šå€Ÿç”¨ä½œç”¨åŸŸ](#ç¤ºä¾‹-3å€Ÿç”¨ä½œç”¨åŸŸ)
  - [ğŸ”— ç³»ç»Ÿé›†æˆä¸å®é™…åº”ç”¨](#-ç³»ç»Ÿé›†æˆä¸å®é™…åº”ç”¨)
    - [ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ](#ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ)
    - [ä¸ç”Ÿå‘½å‘¨æœŸçš„é›†æˆ](#ä¸ç”Ÿå‘½å‘¨æœŸçš„é›†æˆ)
    - [å®é™…åº”ç”¨æ¡ˆä¾‹](#å®é™…åº”ç”¨æ¡ˆä¾‹)
  - [âœ… è¯æ˜ç›®æ ‡](#-è¯æ˜ç›®æ ‡)
    - [å¾…è¯æ˜çš„æ€§è´¨](#å¾…è¯æ˜çš„æ€§è´¨)
    - [è¯æ˜æ–¹æ³•](#è¯æ˜æ–¹æ³•)
  - [Rust 1.93 ä¸å¹¶å‘/è£¸æŒ‡é’ˆæ‰©å±•ï¼ˆå½¢å¼åŒ–å ä½ï¼‰](#rust-193-ä¸å¹¶å‘è£¸æŒ‡é’ˆæ‰©å±•å½¢å¼åŒ–å ä½)
  - [unsafe å¥‘çº¦ä¸ borrow/ownership è¡”æ¥ï¼ˆPhase 3ï¼‰](#unsafe-å¥‘çº¦ä¸-borrowownership-è¡”æ¥phase-3)
  - [æ§åˆ¶æµä¸å€Ÿç”¨è¡”æ¥ï¼ˆPhase 5ï¼‰](#æ§åˆ¶æµä¸å€Ÿç”¨è¡”æ¥phase-5)
  - [FFIã€externã€C variadicã€? æ“ä½œç¬¦ï¼ˆPhase 6ï¼‰](#ffiexternc-variadic-æ“ä½œç¬¦phase-6)
  - [ğŸ“– å‚è€ƒæ–‡çŒ®](#-å‚è€ƒæ–‡çŒ®)
    - [å­¦æœ¯è®ºæ–‡ï¼ˆå›½é™…æƒå¨ï¼‰](#å­¦æœ¯è®ºæ–‡å›½é™…æƒå¨)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [ç›¸å…³ä»£ç ](#ç›¸å…³ä»£ç )

---

## ğŸ¯ ç ”ç©¶ç›®æ ‡

æœ¬ç ”ç©¶æ—¨åœ¨å½¢å¼åŒ–å®šä¹‰ Rust çš„å€Ÿç”¨æ£€æŸ¥å™¨ï¼Œå¹¶è¯æ˜å…¶ä¿è¯æ•°æ®ç«äº‰è‡ªç”±ã€‚

### æ ¸å¿ƒé—®é¢˜

1. **å€Ÿç”¨è§„åˆ™çš„å½¢å¼åŒ–å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ**
2. **å€Ÿç”¨æ£€æŸ¥å™¨å¦‚ä½•ä¿è¯æ•°æ®ç«äº‰è‡ªç”±ï¼Ÿ**
3. **å€Ÿç”¨æ£€æŸ¥çš„æ­£ç¡®æ€§å¦‚ä½•è¯æ˜ï¼Ÿ**

### é¢„æœŸæˆæœ

- å€Ÿç”¨è§„åˆ™çš„å½¢å¼åŒ–æ¨¡å‹
- æ•°æ®ç«äº‰è‡ªç”±çš„å½¢å¼åŒ–è¯æ˜
- å€Ÿç”¨æ£€æŸ¥å™¨çš„æ­£ç¡®æ€§è¯æ˜

---

## ğŸ“š ç†è®ºåŸºç¡€

### ç›¸å…³æ¦‚å¿µ

**å€Ÿç”¨ï¼ˆBorrowingï¼‰**ï¼šä¸´æ—¶è®¿é—®å€¼è€Œä¸è·å–æ‰€æœ‰æƒã€‚

**å€Ÿç”¨è§„åˆ™**ï¼š

1. åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨æˆ–å¤šä¸ªä¸å¯å˜å€Ÿç”¨
2. å€Ÿç”¨å¿…é¡»å§‹ç»ˆæœ‰æ•ˆ

**æ•°æ®ç«äº‰ï¼ˆData Raceï¼‰**ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å†…å­˜ä½ç½®ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™æ“ä½œï¼Œä¸”æ²¡æœ‰åŒæ­¥ã€‚

### ç†è®ºèƒŒæ™¯

**åˆ†ç¦»é€»è¾‘ï¼ˆSeparation Logicï¼‰**ï¼šç”¨äºè¡¨è¾¾å€Ÿç”¨è§„åˆ™çš„é€»è¾‘ç³»ç»Ÿã€‚

**åŒºåŸŸç±»å‹ï¼ˆRegion Typesï¼‰**ï¼šç”¨äºå½¢å¼åŒ–ç”Ÿå‘½å‘¨æœŸçš„ç±»å‹ç³»ç»Ÿã€‚

### æ•°æ®ç«äº‰çš„å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 1.1 (æ•°æ®ç«äº‰)**ï¼šæ•°æ®ç«äº‰å‘ç”Ÿåœ¨ä»¥ä¸‹æ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼š

1. **å¹¶å‘è®¿é—®**: ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å†…å­˜ä½ç½®
2. **å†™æ“ä½œ**: è‡³å°‘æœ‰ä¸€ä¸ªè®¿é—®æ˜¯å†™æ“ä½œ
3. **æ— åŒæ­¥**: è®¿é—®ä¹‹é—´æ²¡æœ‰åŒæ­¥æœºåˆ¶

**å½¢å¼åŒ–è¡¨ç¤º**:
$$\text{DataRace}(m, t_1, t_2) \leftrightarrow \text{Concurrent}(t_1, t_2) \land \text{Access}(t_1, m) \land \text{Access}(t_2, m) \land (\text{Write}(t_1, m) \lor \text{Write}(t_2, m)) \land \neg \text{Synchronized}(t_1, t_2)$$

**å®šä¹‰ 1.2 (æ•°æ®ç«äº‰è‡ªç”±)**ï¼šç¨‹åºæ˜¯æ•°æ®ç«äº‰è‡ªç”±çš„ï¼Œå½“ä¸”ä»…å½“ä¸å­˜åœ¨ä»»ä½•æ•°æ®ç«äº‰ï¼š

$$\text{DataRaceFree}(P) \leftrightarrow \neg \exists m, t_1, t_2: \text{DataRace}(m, t_1, t_2)$$

### å€Ÿç”¨æ£€æŸ¥ç®—æ³•çš„ç†è®ºåŸºç¡€

**å€Ÿç”¨æ£€æŸ¥ç®—æ³•**åŸºäºä»¥ä¸‹åŸç†ï¼š

1. **å€Ÿç”¨è·Ÿè¸ª**: è·Ÿè¸ªæ¯ä¸ªå€¼çš„å€Ÿç”¨çŠ¶æ€
2. **å†²çªæ£€æµ‹**: æ£€æµ‹å€Ÿç”¨å†²çªï¼ˆå¤šä¸ªå¯å˜å€Ÿç”¨æˆ–å¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨å…±å­˜ï¼‰
3. **ç”Ÿå‘½å‘¨æœŸéªŒè¯**: éªŒè¯å€Ÿç”¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰æ•ˆ

**ç®—æ³•æ­¥éª¤**:

1. **æ„å»ºå€Ÿç”¨å›¾**: ä¸ºæ¯ä¸ªå€Ÿç”¨æ„å»ºå€Ÿç”¨å…³ç³»å›¾
2. **æ£€æµ‹å†²çª**: åœ¨å€Ÿç”¨å›¾ä¸­æ£€æµ‹å†²çª
3. **éªŒè¯ç”Ÿå‘½å‘¨æœŸ**: éªŒè¯å€Ÿç”¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰æ•ˆ

**ç®—æ³•å¤æ‚åº¦**: $O(n + m)$ å…¶ä¸­ $n$ æ˜¯å˜é‡æ•°ï¼Œ$m$ æ˜¯å€Ÿç”¨æ•°

### å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§çš„ç†è®ºåŸºç¡€

**å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§**åŸºäºä»¥ä¸‹åŸç†ï¼š

1. **å”¯ä¸€æ€§ä¿è¯**: å¯å˜å€Ÿç”¨çš„å”¯ä¸€æ€§ä¿è¯æ•°æ®ç«äº‰è‡ªç”±
2. **å…±äº«æ€§ä¿è¯**: ä¸å¯å˜å€Ÿç”¨çš„å…±äº«æ€§ä¿è¯åªè¯»è®¿é—®å®‰å…¨
3. **ç”Ÿå‘½å‘¨æœŸä¿è¯**: ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿä¿è¯å¼•ç”¨æœ‰æ•ˆ

**æ­£ç¡®æ€§è¯æ˜æ€è·¯**:

- å€Ÿç”¨è§„åˆ™ä¿è¯ä¸ä¼šå‡ºç°æ•°æ®ç«äº‰
- ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿä¿è¯å¼•ç”¨æœ‰æ•ˆ
- ä¸¤è€…ç»“åˆä¿è¯å†…å­˜å®‰å…¨å’Œæ•°æ®ç«äº‰è‡ªç”±

### ç›¸å…³å­¦æœ¯è®ºæ–‡çš„è¯¦ç»†åˆ†æ

#### 1. RustBelt: Logical Foundations for the Future of Safe Systems Programming

**æ ¸å¿ƒè´¡çŒ®**:

- å€Ÿç”¨æ£€æŸ¥å™¨çš„å½¢å¼åŒ–å®šä¹‰
- æ•°æ®ç«äº‰è‡ªç”±çš„å½¢å¼åŒ–è¯æ˜
- å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§çš„è¯æ˜

**å…³é”®ç»“æœ**:

- å€Ÿç”¨è§„åˆ™çš„å½¢å¼åŒ–
- æ•°æ®ç«äº‰è‡ªç”±çš„è¯æ˜
- å€Ÿç”¨æ£€æŸ¥å™¨çš„æ­£ç¡®æ€§è¯æ˜

**ä¸æœ¬ç ”ç©¶çš„å…³è”**:

- æä¾›äº†å€Ÿç”¨æ£€æŸ¥å™¨å½¢å¼åŒ–çš„æ–¹æ³•
- æä¾›äº†è¯æ˜æ–¹æ³•
- æä¾›äº†å·¥å…·æ”¯æŒ

#### 2. The RustBelt Project: Formalizing Rust's Type System

**æ ¸å¿ƒè´¡çŒ®**:

- Rust å€Ÿç”¨ç³»ç»Ÿçš„å½¢å¼åŒ–
- å€Ÿç”¨ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ
- æ•°æ®ç«äº‰è‡ªç”±çš„è¯æ˜

**å…³é”®ç»“æœ**:

- å€Ÿç”¨ç³»ç»Ÿçš„å®Œæ•´å½¢å¼åŒ–
- æ•°æ®ç«äº‰è‡ªç”±çš„å½¢å¼åŒ–è¯æ˜
- ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ

**ä¸æœ¬ç ”ç©¶çš„å…³è”**:

- æä¾›äº†å€Ÿç”¨ç³»ç»Ÿå½¢å¼åŒ–çš„æ–¹æ³•
- æä¾›äº†è¯æ˜æ–¹æ³•
- æä¾›äº†å·¥å…·æ”¯æŒ

---

## ğŸ”¬ å½¢å¼åŒ–å®šä¹‰

### 1. å€Ÿç”¨ç±»å‹

**å®šä¹‰ 2.1 (å€Ÿç”¨ç±»å‹)**ï¼šå€Ÿç”¨ç±»å‹é›†åˆä¸ºï¼š

$$B = \{Immutable, Mutable\}$$

å…¶ä¸­ï¼š

- `Immutable`ï¼šä¸å¯å˜å€Ÿç”¨ `&T`
- `Mutable`ï¼šå¯å˜å€Ÿç”¨ `&mut T`

**å½¢å¼åŒ–è¡¨ç¤º**ï¼š

$$\text{BorrowType}(b) \in B$$

### 2. å€Ÿç”¨è§„åˆ™

**å®šä¹‰ 2.2 (å€Ÿç”¨è§„åˆ™)**ï¼šå€Ÿç”¨å¿…é¡»æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼š

**è§„åˆ™ 1ï¼ˆå”¯ä¸€æ€§ï¼‰**ï¼šå¯¹äºå¯å˜å€Ÿç”¨ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªï¼š

$$\forall b_1, b_2: \text{BorrowType}(b_1) = \text{Mutable} \land \text{BorrowType}(b_2) = \text{Mutable} \rightarrow \text{Disjoint}(b_1, b_2)$$

**è§„åˆ™ 2ï¼ˆå…±äº«æ€§ï¼‰**ï¼šå¯¹äºä¸å¯å˜å€Ÿç”¨ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œä½†ä¸èƒ½ä¸å¯å˜å€Ÿç”¨å…±å­˜ï¼š

$$\forall b_1: \text{BorrowType}(b_1) = \text{Immutable}, \forall b_2: \text{BorrowType}(b_2) = \text{Mutable} \rightarrow \text{Disjoint}(b_1, b_2)$$

**è§„åˆ™ 3ï¼ˆæœ‰æ•ˆæ€§ï¼‰**ï¼šå€Ÿç”¨å¿…é¡»åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆï¼š

$$\text{Valid}(b) \leftrightarrow \text{Lifetime}(b) \subseteq \text{Scope}(b)$$

### 3. æ•°æ®ç«äº‰è‡ªç”±

**å®šä¹‰ 2.3 (æ•°æ®ç«äº‰è‡ªç”±)**ï¼šç¨‹åºæ˜¯æ•°æ®ç«äº‰è‡ªç”±çš„ï¼Œå½“ä¸”ä»…å½“ï¼š

$$\forall m_1, m_2: \text{Access}(m_1) \land \text{Access}(m_2) \land \text{Overlap}(m_1, m_2) \rightarrow \text{Compatible}(m_1, m_2)$$

å…¶ä¸­ï¼š

- `Access(m)` è¡¨ç¤ºå¯¹å†…å­˜ä½ç½® `m` çš„è®¿é—®
- `Overlap(m1, m2)` è¡¨ç¤º `m1` å’Œ `m2` é‡å 
- `Compatible(m1, m2)` è¡¨ç¤º `m1` å’Œ `m2` å…¼å®¹ï¼ˆéƒ½æ˜¯è¯»æ“ä½œï¼‰

**å®šç† 1 (æ•°æ®ç«äº‰è‡ªç”±)**ï¼šå€Ÿç”¨æ£€æŸ¥å™¨ä¿è¯ç¨‹åºæ˜¯æ•°æ®ç«äº‰è‡ªç”±çš„ã€‚

**è¯æ˜æ€è·¯**:

- å€Ÿç”¨è§„åˆ™ä¿è¯ä¸ä¼šåŒæ—¶æœ‰å¯å˜å€Ÿç”¨å’Œä¸å¯å˜å€Ÿç”¨
- å¯å˜å€Ÿç”¨çš„å”¯ä¸€æ€§ä¿è¯å†™æ“ä½œçš„äº’æ–¥æ€§
- ä¸å¯å˜å€Ÿç”¨çš„å…±äº«æ€§ä¿è¯åªè¯»è®¿é—®çš„å®‰å…¨æ€§
- å› æ­¤ï¼Œä¸ä¼šå‡ºç°æ•°æ®ç«äº‰

**å®Œæ•´è¯æ˜**:

**å‰ææ¡ä»¶**ï¼ˆå…¬ç†é“¾ï¼‰:

1. å€Ÿç”¨è§„åˆ™1ï¼šå¯å˜å€Ÿç”¨å”¯ä¸€æ€§
2. å€Ÿç”¨è§„åˆ™2ï¼šå¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨äº’æ–¥
3. å€Ÿç”¨æ£€æŸ¥å™¨éªŒè¯æ‰€æœ‰å€Ÿç”¨

**è¯æ˜æ­¥éª¤**:

1. **å¯å˜å€Ÿç”¨å”¯ä¸€æ€§ä¿è¯**:
   - æ ¹æ®å€Ÿç”¨è§„åˆ™1ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨
   - å› æ­¤ï¼Œå†™æ“ä½œæ˜¯äº’æ–¥çš„
   - ä¸ä¼šå‡ºç°å¤šä¸ªå†™æ“ä½œåŒæ—¶è®¿é—®åŒä¸€å†…å­˜ä½ç½®

2. **å¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨äº’æ–¥ä¿è¯**:
   - æ ¹æ®å€Ÿç”¨è§„åˆ™2ï¼Œå¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨ä¸èƒ½å…±å­˜
   - å› æ­¤ï¼Œå†™æ“ä½œä¸è¯»æ“ä½œä¸ä¼šåŒæ—¶å‘ç”Ÿ
   - ä¸ä¼šå‡ºç°è¯»å†™ç«äº‰

3. **å€Ÿç”¨æ£€æŸ¥å™¨éªŒè¯ä¿è¯**:
   - å€Ÿç”¨æ£€æŸ¥å™¨åœ¨ç¼–è¯‘æ—¶éªŒè¯æ‰€æœ‰å€Ÿç”¨
   - è¿åå€Ÿç”¨è§„åˆ™çš„ä»£ç ä¼šè¢«æ‹’ç»ç¼–è¯‘
   - å› æ­¤ï¼Œæ‰€æœ‰é€šè¿‡ç¼–è¯‘çš„ç¨‹åºéƒ½æ»¡è¶³å€Ÿç”¨è§„åˆ™

**å½’çº³ç»†åŒ–**ï¼ˆå¯¹ç¨‹åºæ‰§è¡Œæ­¥éª¤ï¼‰:

- **åŸºç¡€æƒ…å†µ**ï¼šç©ºç¨‹åºã€å•è¯­å¥ç¨‹åºï¼Œæ— å¹¶å‘è®¿é—®ï¼Œæ˜¾ç„¶æ•°æ®ç«äº‰è‡ªç”±
- **å½’çº³æ­¥éª¤**ï¼šå‡è®¾æ‰§è¡Œå‰ç¼€ $e_1; \ldots; e_{n-1}$ å·²æ»¡è¶³æ•°æ®ç«äº‰è‡ªç”±ã€‚è€ƒè™‘ç¬¬ $n$ æ­¥ $e_n$ï¼š
  - è‹¥ $e_n$ ä¸ºå€Ÿç”¨æ“ä½œï¼šè§„åˆ™ 1ã€2 ä¿è¯å…¶ä¸å·²æœ‰å€Ÿç”¨ä¸å†²çª
  - è‹¥ $e_n$ ä¸ºè·¨çº¿ç¨‹æ“ä½œï¼šå€Ÿç”¨æ£€æŸ¥å™¨è¦æ±‚ `Send`/`Sync`ï¼Œä¸ [async_state_machine](async_state_machine.md) å®šç† 6.2 ä¸€è‡´
  - å› æ­¤ $e_1; \ldots; e_n$ ä»æ»¡è¶³æ•°æ®ç«äº‰è‡ªç”±

**ç»“è®º**: ç”±ä»¥ä¸Šä¸‰ä¸ªæ­¥éª¤åŠå½’çº³ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨ä¿è¯ç¨‹åºæ˜¯æ•°æ®ç«äº‰è‡ªç”±çš„ã€‚$\square$

**å…¬ç†é“¾æ ‡æ³¨**ï¼šè§„åˆ™ 1,2 â†’ å®šç† 1ã€‚

---

## âš ï¸ åä¾‹ï¼šè¿åå€Ÿç”¨è§„åˆ™å¯¼è‡´æ•°æ®ç«äº‰

| åä¾‹ | è¿åè§„åˆ™ | åæœ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| åŒå¯å˜å€Ÿç”¨ | è§„åˆ™ 1 | ç¼–è¯‘é”™è¯¯ | ä¸¤å¤„ `&mut` å åŠ ï¼Œç¼–è¯‘å™¨æ‹’ç» |
| å¯å˜ä¸ä¸å¯å˜å…±å­˜ | è§„åˆ™ 2 | ç¼–è¯‘é”™è¯¯ | `&` ä¸ `&mut` åŒæ—¶å­˜åœ¨ |
| è·¨çº¿ç¨‹å…±äº«å¯å˜å¼•ç”¨ | è§„åˆ™ 1ã€2 | ç¼–è¯‘é”™è¯¯ | ç¤ºä¾‹ 3ï¼šthread::spawn æ•è·å¯å˜å€Ÿç”¨ |
| å€Ÿç”¨è¶…å‡ºæ‰€æœ‰è€… | è§„åˆ™ 3 | æ‚¬å‚å¼•ç”¨ | è¿”å›å±€éƒ¨å¼•ç”¨ï¼Œç”Ÿå‘½å‘¨æœŸä¸è¶³ |

---

## ğŸŒ³ å…¬ç†-å®šç†è¯æ˜æ ‘

```text
å€Ÿç”¨æ£€æŸ¥å™¨å®‰å…¨æ€§è¯æ˜æ ‘

  è§„åˆ™ 1: å¯å˜å€Ÿç”¨å”¯ä¸€æ€§
  è§„åˆ™ 2: å¯å˜ä¸ä¸å¯å˜äº’æ–¥
  è§„åˆ™ 3: å€Ÿç”¨æœ‰æ•ˆæ€§ï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰
  â”‚
  â”œâ”€ è§„åˆ™ 1 + è§„åˆ™ 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å®šç† 1: æ•°æ®ç«äº‰è‡ªç”±
  â”‚   â”œâ”€ æ­¥éª¤1: å†™æ“ä½œäº’æ–¥
  â”‚   â”œâ”€ æ­¥éª¤2: è¯»å†™ä¸å¹¶å­˜
  â”‚   â””â”€ æ­¥éª¤3: ç¼–è¯‘æ—¶éªŒè¯
  â”‚
  â””â”€ å€Ÿç”¨è§„åˆ™å½’çº³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å®šç† 2: å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§
```

### æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯ å±‚æ¬¡æ±‡æ€»

| å±‚æ¬¡ | å†…å®¹ | æœ¬é¡µå¯¹åº” |
| :--- | :--- | :--- |
| **æ¦‚å¿µå®šä¹‰å±‚** | è§„åˆ™ 1â€“3ï¼ˆå¯å˜å”¯ä¸€ã€äº’æ–¥ã€æœ‰æ•ˆæ€§ï¼‰ï¼›Def 1.1â€“1.2 æ•°æ®ç«äº‰ | Â§å½¢å¼åŒ–å®šä¹‰ |
| **å±æ€§å…³ç³»å±‚** | è§„åˆ™ 1+2 â†’ å®šç† 1ï¼›å€Ÿç”¨è§„åˆ™å½’çº³ â†’ å®šç† 2 | Â§å…¬ç†-å®šç†è¯æ˜æ ‘ |
| **è§£é‡Šè®ºè¯å±‚** | å®šç† 1 æ•°æ®ç«äº‰è‡ªç”±è¯æ˜ï¼›åä¾‹ï¼šÂ§åä¾‹ | Â§å½¢å¼åŒ–å®šä¹‰ã€Â§åä¾‹ |

---

## ğŸ’» ä»£ç ç¤ºä¾‹ä¸å®è·µ

### ç¤ºä¾‹ 1ï¼šä¸å¯å˜å€Ÿç”¨

```rust
fn immutable_borrow_example() {
    let s = String::from("hello");
    let r1 = &s;  // ä¸å¯å˜å€Ÿç”¨
    let r2 = &s;  // å¯ä»¥å¤šä¸ªä¸å¯å˜å€Ÿç”¨
    println!("{} {}", r1, r2);
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- `r1` å’Œ `r2` éƒ½æ˜¯ä¸å¯å˜å€Ÿç”¨
- æ ¹æ®å€Ÿç”¨è§„åˆ™ 2ï¼Œå¤šä¸ªä¸å¯å˜å€Ÿç”¨æ˜¯å…è®¸çš„
- å› æ­¤ä»£ç æ˜¯å®‰å…¨çš„

### ç¤ºä¾‹ 2ï¼šå¯å˜å€Ÿç”¨

```rust
fn mutable_borrow_example() {
    let mut s = String::from("hello");
    let r1 = &mut s;  // å¯å˜å€Ÿç”¨
    // let r2 = &s;   // é”™è¯¯ï¼šä¸èƒ½åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å€Ÿç”¨
    println!("{}", r1);
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- `r1` æ˜¯å¯å˜å€Ÿç”¨
- æ ¹æ®å€Ÿç”¨è§„åˆ™ 1ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨
- å› æ­¤ä¸èƒ½åŒæ—¶æœ‰ä¸å¯å˜å€Ÿç”¨

### ç¤ºä¾‹ 3ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»æ•°æ®ç«äº‰

```rust
use std::thread;

fn data_race_prevention() {
    let mut data = vec![1, 2, 3];

    // é”™è¯¯ï¼šä¸èƒ½åŒæ—¶æœ‰å¯å˜å€Ÿç”¨å’Œä¸å¯å˜å€Ÿç”¨
    // let r1 = &data;
    // thread::spawn(move || {
    //     data.push(4);  // é”™è¯¯ï¼šæ•°æ®ç«äº‰
    // });
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- å€Ÿç”¨æ£€æŸ¥å™¨æ£€æµ‹åˆ°æ½œåœ¨çš„æ•°æ®ç«äº‰
- æ ¹æ®å€Ÿç”¨è§„åˆ™ï¼Œä¸å…è®¸åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å€Ÿç”¨
- å› æ­¤ç¼–è¯‘å™¨æ‹’ç»ç¼–è¯‘ï¼Œé˜²æ­¢æ•°æ®ç«äº‰

### ç¤ºä¾‹ 4ï¼šå€Ÿç”¨ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ

```rust
fn borrow_scope_example() {
    let mut s = String::from("hello");

    {
        let r1 = &s;  // ä¸å¯å˜å€Ÿç”¨å¼€å§‹
        let r2 = &s;  // å¯ä»¥å¤šä¸ªä¸å¯å˜å€Ÿç”¨
        println!("{} {}", r1, r2);
    }  // å€Ÿç”¨ç»“æŸ

    let r3 = &mut s;  // ç°åœ¨å¯ä»¥å¯å˜å€Ÿç”¨
    r3.push_str(" world");
    println!("{}", r3);
}
```

**å½¢å¼åŒ–åˆ†æ**:

- å€Ÿç”¨ä½œç”¨åŸŸï¼š$[\text{start}, \text{end}]$
- å€Ÿç”¨è§„åˆ™ï¼šåŒä¸€ä½œç”¨åŸŸå†…ä¸èƒ½åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å€Ÿç”¨
- ä½œç”¨åŸŸç»“æŸåï¼Œå¯ä»¥åˆ›å»ºæ–°çš„å€Ÿç”¨

### ç¤ºä¾‹ 5ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ£€æµ‹æ‚¬å‚å¼•ç”¨

```rust
// é”™è¯¯ï¼šè¿”å›æ‚¬å‚å¼•ç”¨
// fn dangling_borrow() -> &String {
//     let s = String::from("hello");
//     &s  // é”™è¯¯ï¼šs åœ¨å‡½æ•°ç»“æŸæ—¶è¢«ä¸¢å¼ƒ
// }

// æ­£ç¡®ï¼šä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‚æ•°
fn valid_borrow<'a>(s: &'a String) -> &'a String {
    s  // æ­£ç¡®ï¼šè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸä¸å‚æ•°ç›¸åŒ
}
```

**å½¢å¼åŒ–åˆ†æ**:

- é”™è¯¯æƒ…å†µï¼šè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸè¶…è¿‡è¢«å¼•ç”¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ
- æ­£ç¡®æƒ…å†µï¼šç”Ÿå‘½å‘¨æœŸå‚æ•°ä¿è¯è¿”å›å€¼æœ‰æ•ˆ
- å€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»é”™è¯¯ä»£ç 

### ç¤ºä¾‹ 6ï¼šå¤æ‚å€Ÿç”¨åœºæ™¯

```rust
struct Container {
    data: Vec<i32>,
}

impl Container {
    fn get_first(&self) -> Option<&i32> {
        self.data.first()
    }

    fn add_item(&mut self, item: i32) {
        self.data.push(item);
    }
}

fn complex_borrow() {
    let mut container = Container {
        data: vec![1, 2, 3],
    };

    // é”™è¯¯ï¼šä¸èƒ½åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å€Ÿç”¨
    // let first = container.get_first();
    // container.add_item(4);  // é”™è¯¯ï¼šå€Ÿç”¨å†²çª

    // æ­£ç¡®ï¼šå…ˆä½¿ç”¨ä¸å¯å˜å€Ÿç”¨ï¼Œç„¶åä½¿ç”¨å¯å˜å€Ÿç”¨
    let first = container.get_first();
    println!("{:?}", first);
    container.add_item(4);  // æ­£ç¡®ï¼šå€Ÿç”¨å·²ç»“æŸ
}
```

**å½¢å¼åŒ–åˆ†æ**:

- æ–¹æ³•è°ƒç”¨åˆ›å»ºå€Ÿç”¨
- å€Ÿç”¨æ£€æŸ¥å™¨è·Ÿè¸ªæ‰€æœ‰å€Ÿç”¨
- æ£€æµ‹åˆ°å€Ÿç”¨å†²çªæ—¶æ‹’ç»ç¼–è¯‘

### ç¤ºä¾‹ 3ï¼šå€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»æ•°æ®ç«äº‰ï¼ˆåŸç¤ºä¾‹ä¿ç•™ï¼‰

```rust
use std::thread;

fn data_race_prevention() {
    let mut data = vec![1, 2, 3];

    // é”™è¯¯ï¼šä¸èƒ½åŒæ—¶æœ‰å¯å˜å€Ÿç”¨å’Œä¸å¯å˜å€Ÿç”¨
    // let r1 = &data;
    // thread::spawn(move || {
    //     data.push(4);  // é”™è¯¯ï¼šæ•°æ®ç«äº‰
    // });
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- å€Ÿç”¨æ£€æŸ¥å™¨æ£€æµ‹åˆ°æ½œåœ¨çš„æ•°æ®ç«äº‰
- æ ¹æ®å€Ÿç”¨è§„åˆ™ï¼Œä¸å…è®¸åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å€Ÿç”¨
- å› æ­¤ç¼–è¯‘å™¨æ‹’ç»ç¼–è¯‘ï¼Œé˜²æ­¢æ•°æ®ç«äº‰

## ğŸ’» ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šä¸å¯å˜å€Ÿç”¨

```rust
fn immutable_borrow_example() {
    let x = 5;
    let r1 = &x;  // ä¸å¯å˜å€Ÿç”¨ 1
    let r2 = &x;  // ä¸å¯å˜å€Ÿç”¨ 2ï¼ˆå…è®¸ï¼‰

    println!("{} {}", r1, r2);  // ä¸¤ä¸ªå€Ÿç”¨éƒ½æœ‰æ•ˆ
}
```

**å½¢å¼åŒ–è¡¨ç¤º**ï¼š

$$\text{BorrowType}(r_1) = \text{Immutable} \land \text{BorrowType}(r_2) = \text{Immutable} \land \text{Target}(r_1) = \text{Target}(r_2) = x \rightarrow \text{Valid}(r_1, r_2)$$

### ç¤ºä¾‹ 2ï¼šå¯å˜å€Ÿç”¨å”¯ä¸€æ€§

```rust
fn mutable_borrow_example() {
    let mut x = 5;
    let r1 = &mut x;  // å¯å˜å€Ÿç”¨
    // let r2 = &mut x;  // é”™è¯¯ï¼šä¸èƒ½æœ‰ä¸¤ä¸ªå¯å˜å€Ÿç”¨
    // let r3 = &x;      // é”™è¯¯ï¼šä¸èƒ½åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å€Ÿç”¨

    *r1 = 10;
}
```

**å½¢å¼åŒ–è¡¨ç¤º**ï¼š

$$\text{BorrowType}(r_1) = \text{Mutable} \land \text{Target}(r_1) = x \rightarrow \nexists r_2: \text{BorrowType}(r_2) \in B \land \text{Target}(r_2) = x \land r_2 \neq r_1$$

### ç¤ºä¾‹ 3ï¼šå€Ÿç”¨ä½œç”¨åŸŸ

```rust
fn borrow_scope_example() {
    let mut x = 5;
    {
        let r = &x;  // å€Ÿç”¨å¼€å§‹
        println!("{}", r);
    }  // å€Ÿç”¨ç»“æŸ

    let r2 = &mut x;  // ç°åœ¨å¯ä»¥å¯å˜å€Ÿç”¨
    *r2 = 10;
}
```

**å½¢å¼åŒ–è¡¨ç¤º**ï¼š

$$\text{Scope}(r) = [t_1, t_2] \land t_2 < t_3 \rightarrow \text{Valid}(r_2, t_3)$$

---

## ğŸ”— ç³»ç»Ÿé›†æˆä¸å®é™…åº”ç”¨

### ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„é›†æˆ

å€Ÿç”¨æˆç«‹æ¡ä»¶ $\text{borrow}(x,r)$ è•´å« $\Omega(x)=\text{Owned}$ï¼›ç§»åŠ¨å $x$ å¤±æ•ˆï¼Œæ‰€æœ‰æŒ‡å‘ $x$ çš„å€Ÿç”¨ç¦»å¼€ä½œç”¨åŸŸã€‚æ•°æ®ç«äº‰è‡ªç”±ä¸æ‰€æœ‰æƒå”¯ä¸€æ€§å…±åŒä¿è¯å†…å­˜å®‰å…¨ï¼Œå½¢å¼åŒ–è§ [ownership_model](./ownership_model.md)ã€‚

### ä¸ç”Ÿå‘½å‘¨æœŸçš„é›†æˆ

$\text{Scope}(r) \subseteq \text{lft}(r)$ï¼›NLL ä¸ reborrow çš„çº¦æŸç”±ç”Ÿå‘½å‘¨æœŸä¸ outlives è¡¨è¾¾ã€‚Polonius ä¸ [lifetime_formalization](./lifetime_formalization.md) ä¸­çš„æ¨æ–­ã€çº¦æŸæ±‚è§£ä¸€è‡´ã€‚

### å®é™…åº”ç”¨æ¡ˆä¾‹

1. **å¹¶å‘**ï¼š`Mutex`ã€`RwLock`ã€channel çš„æ¥å£ä¸å€Ÿç”¨ã€`Send`/`Sync` é…åˆï¼Œä¿è¯æ•°æ®ç«äº‰è‡ªç”±ã€‚
2. **è¿­ä»£å™¨**ï¼š`Iter`/`IterMut` çš„ `&T`/`&mut T` ä¸å€Ÿç”¨è§„åˆ™ã€ç”Ÿå‘½å‘¨æœŸå¯¹åº”ã€‚
3. **é—­åŒ…**ï¼š`Fn`/`FnMut`/`FnOnce` çš„æ•è·ä¸å€Ÿç”¨ã€move è¯­ä¹‰å¯¹åº”æ’ä»–/å…±äº«ä¸æ‰€æœ‰æƒè½¬ç§»ã€‚

---

## âœ… è¯æ˜ç›®æ ‡

### å¾…è¯æ˜çš„æ€§è´¨

1. **å€Ÿç”¨è§„åˆ™æ­£ç¡®æ€§**ï¼šå€Ÿç”¨è§„åˆ™ä¿è¯å†…å­˜å®‰å…¨
2. **æ•°æ®ç«äº‰è‡ªç”±**ï¼šå€Ÿç”¨æ£€æŸ¥å™¨ä¿è¯æ•°æ®ç«äº‰è‡ªç”±
3. **å®Œæ•´æ€§**ï¼šæ‰€æœ‰æ•°æ®ç«äº‰éƒ½è¢«æ£€æµ‹åˆ°

### è¯æ˜æ–¹æ³•

1. **å½¢å¼åŒ–éªŒè¯**ï¼šä½¿ç”¨å½¢å¼åŒ–éªŒè¯å·¥å…·
2. **å®šç†è¯æ˜**ï¼šä½¿ç”¨å®šç†è¯æ˜å™¨ï¼ˆå¦‚ Coqã€Isabelleï¼‰
3. **æ¨¡å‹æ£€æŸ¥**ï¼šä½¿ç”¨æ¨¡å‹æ£€æŸ¥å·¥å…·

---

## Rust 1.93 ä¸å¹¶å‘/è£¸æŒ‡é’ˆæ‰©å±•ï¼ˆå½¢å¼åŒ–å ä½ï¼‰

**Def CHAN1ï¼ˆé€šé“æ¶ˆæ¯ä¼ é€’ï¼‰**ï¼š`mpsc::channel` æˆ– `broadcast` å®ç°**æ¶ˆæ¯ä¼ é€’**è¯­ä¹‰ï¼›å‘é€è€…ä¸æ¥æ”¶è€…é—´æ— å…±äº«å†…å­˜ï¼›æ‰€æœ‰æƒéšæ¶ˆæ¯è½¬ç§»ã€‚å½¢å¼åŒ–ï¼š$\text{send}(tx, v) \rightarrow \Omega(v) \mapsto \text{Receiver}$ï¼›æ—  $\&mut$ å…±äº«ï¼Œæ•…æ— æ•°æ®ç«äº‰ã€‚

**å®šç† CHAN-T1**ï¼šé€šé“å®ç°ä¸ºçº¯ Safeï¼›æ¶ˆæ¯ä¼ é€’æ— å…±äº«å¯å˜ï¼›æ»¡è¶³ [borrow_checker_proof](borrow_checker_proof.md) å®šç† 1 æ•°æ®ç«äº‰è‡ªç”±ã€‚ç”± Send çº¦æŸä¸æ‰€æœ‰æƒè½¬ç§»ã€‚

**Def MUTEX1ï¼ˆMutex é”è¯­ä¹‰ï¼‰**ï¼š`Mutex<T>` å°è£…å†…éƒ¨å¯å˜ï¼›`lock()` è¿”å› `MutexGuard` æŒæœ‰å¯å˜å€Ÿç”¨ï¼›guard drop æ—¶é‡Šæ”¾é”ã€‚å½¢å¼åŒ–ï¼š$\text{lock}(m) \rightarrow \&mut T$ ä»…åœ¨æŒé”æœŸé—´æœ‰æ•ˆï¼›äº’æ–¥ä¿è¯æ— å¹¶å‘å†™ã€‚

**å®šç† MUTEX-T1**ï¼š`Mutex` ä¸º Safe æŠ½è±¡ï¼›å†…éƒ¨ `unsafe` å°è£…ï¼›å¯¹å¤–æ»¡è¶³å€Ÿç”¨è§„åˆ™â€”â€”ä»»ä¸€æ—¶åˆ»è‡³å¤šä¸€ä¸ª `MutexGuard` æŒæœ‰ `&mut T`ã€‚ç”± [borrow_checker_proof](borrow_checker_proof.md) è§„åˆ™ 1ã€‚

**Def RAW1ï¼ˆè£¸æŒ‡é’ˆä¸ deref_nullptrï¼‰**ï¼š`*const T`/`*mut T` æ— è‡ªåŠ¨å€Ÿç”¨ï¼›è§£å¼•ç”¨éœ€ `unsafe`ï¼›1.93 `deref_nullptr` deny-by-default ç¦æ­¢è§£å¼•ç”¨å¯èƒ½ä¸º null çš„æŒ‡é’ˆã€‚å½¢å¼åŒ–ï¼š$\text{deref}(p)$ åˆæ³•ä»…å½“ $\text{nonnull}(p)$ï¼›è¿åä¸º UBã€‚

**å®šç† RAW-T1**ï¼šè£¸æŒ‡é’ˆè§£å¼•ç”¨ä¸ä¸å€Ÿç”¨æ£€æŸ¥å™¨å†²çªï¼›å€Ÿç”¨æ£€æŸ¥å™¨ä¸æ£€æŸ¥è£¸æŒ‡é’ˆï¼›`deref_nullptr` lint å‡å°‘ null è§£å¼•ç”¨ UBã€‚ä¸ [type_system_foundations](../type_theory/type_system_foundations.md) Def DEREF-NULL1 è¡”æ¥ã€‚

---

## unsafe å¥‘çº¦ä¸ borrow/ownership è¡”æ¥ï¼ˆPhase 3ï¼‰

**Def UNSAFE1ï¼ˆunsafe å¥‘çº¦ï¼‰**ï¼š`unsafe` å—æ‰¿è¯ºæ»¡è¶³ç¼–è¯‘å™¨æ— æ³•éªŒè¯çš„**å‰ç½®æ¡ä»¶**ï¼›è°ƒç”¨è€…æˆ–å®ç°è€…é¡»ä¿è¯ï¼š$\text{pre}(C) \rightarrow \text{safe}(C)$ï¼Œå…¶ä¸­ $C$ ä¸º unsafe å¥‘çº¦ã€$\text{pre}$ ä¸ºå‰ç½®ã€$\text{safe}$ ä¸ºå®‰å…¨è¯­ä¹‰ã€‚è¿åå‰ç½®ä¸º UBã€‚

**å®šç† UNSAFE-T1ï¼ˆunsafe ä¸ borrow è¡”æ¥ï¼‰**ï¼šè‹¥ unsafe å—å†…äº§ç”Ÿçš„å¼•ç”¨æˆ–è£¸æŒ‡é’ˆæ»¡è¶³å€Ÿç”¨è§„åˆ™çš„å‰ç½®ï¼ˆéæ‚¬å‚ã€éåˆ«åå†²çªï¼‰ï¼Œåˆ™å…¶ä¸ [borrow_checker_proof](borrow_checker_proof.md) å®šç† 1 æ•°æ®ç«äº‰è‡ªç”±ç›¸å®¹ã€‚å½¢å¼åŒ–ï¼š$\text{pre}(C) \land \text{borrow\_compliant}(r) \rightarrow \text{DataRaceFree}(P)$ã€‚ç”± unsafe å¥‘çº¦ä¸å€Ÿç”¨è§„åˆ™æ— å†²çªã€‚

**å®šç† UNSAFE-T2ï¼ˆunsafe ä¸æ‰€æœ‰æƒè¡”æ¥ï¼‰**ï¼š`unsafe` ä¸­å¯¹ `Box::from_raw`ã€`ManuallyDrop` ç­‰ä½¿ç”¨è‹¥ä¿æŒ [ownership_model](ownership_model.md) è§„åˆ™ 2ã€3ï¼ˆå”¯ä¸€æ‰€æœ‰è€…ã€ä½œç”¨åŸŸé‡Šæ”¾ï¼‰ï¼Œåˆ™ä¸å®šç† 3 å†…å­˜å®‰å…¨ç›¸å®¹ã€‚

---

## æ§åˆ¶æµä¸å€Ÿç”¨è¡”æ¥ï¼ˆPhase 5ï¼‰

**Def MATCH1ï¼ˆmatch ç©·å°½æ€§ï¼‰**ï¼š`match e { p_1 => ..., p_n => ... }` æ»¡è¶³**ç©·å°½æ€§**å½“ä¸”ä»…å½“ $\forall v: \tau.\, \exists i: p_i \text{ matches } v$ï¼›ç±»å‹ç³»ç»Ÿä¿è¯ç©·å°½ï¼Œä¸å¯è¾¾åˆ†æ”¯ä¸º `!` ç±»å‹ã€‚

**å®šç† MATCH-T1ï¼ˆç©·å°½æ€§ä¸ä¸å¯è¾¾ï¼‰**ï¼šç©·å°½ match ä¿è¯æ‰€æœ‰å€¼è¢«å¤„ç†ï¼›è‹¥å­˜åœ¨ `_ => unreachable!()` æˆ– `!` åˆ†æ”¯ï¼Œåˆ™ç±»å‹ç³»ç»Ÿä¿è¯è¯¥åˆ†æ”¯ä¸å¯è¾¾ã€‚ä¸ [borrow_checker_proof](borrow_checker_proof.md) è§„åˆ™ 3 ç»“åˆï¼šmatch å„åˆ†æ”¯å†…å€Ÿç”¨ä½œç”¨åŸŸç‹¬ç«‹ï¼Œæ— è·¨åˆ†æ”¯å†²çªã€‚

**Def FOR1ï¼ˆfor è¿­ä»£ä¸å€Ÿç”¨ï¼‰**ï¼š`for x in iter` ç­‰ä»·äº `IntoIterator::into_iter` å–å¾—æ‰€æœ‰æƒæˆ–å€Ÿç”¨ï¼›è¿­ä»£æœŸé—´ `iter` è¢«å¯å˜å€Ÿç”¨ï¼ˆ`IterMut`ï¼‰æˆ–ä¸å¯å˜å€Ÿç”¨ï¼ˆ`Iter`ï¼‰ï¼›è¿­ä»£ä¸­ä¿®æ”¹é›†åˆè¿åå€Ÿç”¨è§„åˆ™ã€‚

**å®šç† FOR-T1ï¼ˆè¿­ä»£ä¸­ä¿®æ”¹é›†åˆï¼‰**ï¼š`for x in &mut v { v.push(...); }` è¢«å€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»â€”â€”`&mut v` ä¸ `v.push` çš„ `&mut self` å†²çªã€‚ç”± [borrow_checker_proof](borrow_checker_proof.md) è§„åˆ™ 1 ç›´æ¥ä¿è¯ã€‚

---

## FFIã€externã€C variadicã€? æ“ä½œç¬¦ï¼ˆPhase 6ï¼‰

**Def EXTERN1ï¼ˆextern ABI è¾¹ç•Œï¼‰**ï¼š`extern "C"` æˆ– `extern "system"` å£°æ˜å‡½æ•°é‡‡ç”¨**å¤–éƒ¨ ABI**ï¼›è°ƒç”¨æ—¶ Rust ä¸éªŒè¯å®å‚ï¼›è°ƒç”¨è€…é¡»ä¿è¯ç±»å‹ä¸å¸ƒå±€ä¸ç›®æ ‡ ABI ä¸€è‡´ï¼›è¿åä¸º UBã€‚

**å®šç† EXTERN-T1**ï¼šextern å‡½æ•°ä¸å€Ÿç”¨æ£€æŸ¥å™¨è¾¹ç•Œï¼šRust ä»…æ£€æŸ¥ Rust ä¾§ï¼›è°ƒç”¨ extern æ—¶ä¼ å…¥çš„å¼•ç”¨è‹¥åœ¨ extern è°ƒç”¨æœŸé—´è¢«å¤–éƒ¨ä»£ç ä¿®æ”¹ï¼Œåˆ™éœ€ `unsafe` å¥‘çº¦ä¿è¯ã€‚ä¸ [borrow_checker_proof](borrow_checker_proof.md) å®šç† 1 ç›¸å®¹â€”â€”extern ä¸å¼•å…¥ Rust å€Ÿç”¨å†²çªã€‚

**Def CVARIADIC1ï¼ˆC variadic 1.93ï¼‰**ï¼š`extern "system" fn(..., ...)` ä¸º 1.93 ç¨³å®šçš„ C é£æ ¼å¯å˜å‚æ•°ï¼›è°ƒç”¨è€…é¡»æŒ‰ C çº¦å®šä¼ é€’å‚æ•°ï¼›`va_list` ç­‰éœ€ FFI æ­£ç¡®ä½¿ç”¨ã€‚

**Def QUERY1ï¼ˆ? æ“ä½œç¬¦ï¼‰**ï¼š`e?` ä¸ºé”™è¯¯ä¼ æ’­è¯­æ³•ç³–ï¼›`e: Result<T, E>` æˆ– `Option<T>`ï¼›`Ok(v)/Some(v)` æå–å€¼ï¼Œ`Err(e)/None` æ—©æœŸè¿”å›ã€‚å½¢å¼åŒ–ï¼š$\text{query}(e) \equiv \text{match } e \text{ with Ok/Some} \rightarrow v \mid \text{Err/None} \rightarrow \text{return}$ã€‚

**å®šç† QUERY-T1**ï¼š`?` ä¸å€Ÿç”¨ï¼š`e` åœ¨ `?` å‰æ±‚å€¼å®Œæˆï¼Œå€Ÿç”¨å¯ç»“æŸï¼›`?` æ‰€åœ¨å‡½æ•°è¿”å›ç±»å‹ä¸ `e` çš„ `E` ç›¸å®¹ï¼›ä¸å½±å“ [borrow_checker_proof](borrow_checker_proof.md) è§„åˆ™ 1ã€2ã€‚

---

## ğŸ“– å‚è€ƒæ–‡çŒ®

### å­¦æœ¯è®ºæ–‡ï¼ˆå›½é™…æƒå¨ï¼‰

1. **RustBelt: Securing the Foundations of the Rust Programming Language** (POPL 2018)
   - ä½œè€…: Ralf Jung, Jacques-Henri Jourdan, Robbert Krebbers, Derek Dreyer
   - é“¾æ¥: <https://plv.mpi-sws.org/rustbelt/popl18/>
   - æ‘˜è¦: å€Ÿç”¨è§„åˆ™å½¢å¼åŒ–ï¼›æ•°æ®ç«äº‰è‡ªç”±è¯æ˜ï¼›Iris åˆ†ç¦»é€»è¾‘
   - ä¸æœ¬ç›®å½•: å€Ÿç”¨è§„åˆ™ã€å®šç† T1 ç›´æ¥å¯¹åº”

2. **Stacked Borrows: An Aliasing Model for Rust** (POPL 2020)
   - ä½œè€…: Ralf Jung, Hoang-Hai Dang, Jeehoon Kang, Derek Dreyer
   - é“¾æ¥: <https://plv.mpi-sws.org/rustbelt/stacked-borrows/>
   - æ‘˜è¦: åˆ«åè§„åˆ™ï¼›&mut å”¯ä¸€æ€§ï¼›è¿åä¸º UBï¼›Miri å®ç°
   - ä¸æœ¬ç›®å½•: è§„åˆ™ 1ï¼ˆäº’æ–¥å€Ÿç”¨ï¼‰ã€RAW1ã€UNSAFE-T1 å¯¹åº”

3. **RustBelt Meets Relaxed Memory** (POPL 2020)
   - é“¾æ¥: <https://plv.mpi-sws.org/rustbelt/rbrlx/>
   - æ‘˜è¦: relaxed memoryã€Arc æ•°æ®ç«äº‰ã€é”ä¸é€šé“åŒæ­¥
   - ä¸æœ¬ç›®å½•: CHAN-T1ã€MUTEX-T1ã€å¹¶å‘è¯­ä¹‰å¯¹åº”

4. **Tree Borrows** (PLDI 2025 â€” Distinguished Paper Award)
   - ä½œè€…: Neven Villani, Johannes Hostert, Derek Dreyer, Ralf Jung
   - é“¾æ¥: [ETH é¡¹ç›®é¡µ](https://plf.inf.ethz.ch/research/pldi25-tree-borrows.html)ã€[ACM PDF](https://dl.acm.org/doi/pdf/10.1145/3735592)ã€[Iris PDF](https://iris-project.org/pdfs/2025-pldi-treeborrows.pdf)ã€[Ralf åšå®¢](https://www.ralfj.de/blog/2025/07/07/tree-borrows-paper.html)
   - æ‘˜è¦: Stacked Borrows æ¼”è¿›ï¼›æ ‘ç»“æ„ï¼›30k crates 54% æ›´å°‘æ‹’ç»ï¼›Rocq å½¢å¼åŒ–è¯æ˜
   - ä¸æœ¬ç›®å½•: å€Ÿç”¨è§„åˆ™ã€RAW1 æ¼”è¿›ï¼›Miri æœªæ¥å¯èƒ½é‡‡ç”¨

5. **Polonius** â€” å½¢å¼åŒ– borrow åˆ†æ
   - é“¾æ¥: <https://rust-lang.github.io/polonius/>
   - ä¸æœ¬ç›®å½•: lifetimeã€borrow è§„åˆ™ï¼›datalog å½¢å¼åŒ–ï¼›NLL åç»§

6. **Prusti / Kani / Miri** â€” éªŒè¯å·¥å…·
   - Prusti: <https://prusti.org/> â€” deductive verification
   - Kani: <https://model-checking.github.io/kani/> â€” model checkingã€UB
   - Miri: <https://github.com/rust-lang/miri> â€” Stacked Borrows å®ç°
   - ä¸æœ¬ç›®å½•: å¯éªŒè¯æœ¬ Def/å®šç†å¯¹åº”çš„ç¨‹åºå±æ€§

### å®˜æ–¹æ–‡æ¡£

- [Rust å€Ÿç”¨æ£€æŸ¥å™¨](https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html)
- [Rust Reference - Undefined behavior](https://doc.rust-lang.org/reference/behavior-considered-undefined.html)
- [Rustonomicon](https://doc.rust-lang.org/nomicon/) â€” å†…å­˜æ¨¡å‹ã€unsafe

### ç›¸å…³ä»£ç 

- [Rust ç¼–è¯‘å™¨å€Ÿç”¨æ£€æŸ¥å™¨](https://github.com/rust-lang/rust/tree/master/compiler/rustc_borrowck)

---

### ç›¸å…³æ€ç»´è¡¨å¾

| ç±»å‹ | ä½ç½® |
| :--- | :--- |
| æ€ç»´å¯¼å›¾ | [MIND_MAP_COLLECTION](../../04_thinking/MIND_MAP_COLLECTION.md) Â§2ã€C01 |
| å¤šç»´çŸ©é˜µ | [MULTI_DIMENSIONAL_CONCEPT_MATRIX](../../04_thinking/MULTI_DIMENSIONAL_CONCEPT_MATRIX.md) Â§1ï¼›[README Â§å…­ç¯‡å¹¶è¡¨](README.md#formal_methods-å…­ç¯‡å¹¶è¡¨) ç¬¬ 2 è¡Œ |
| è¯æ˜æ ‘ | æœ¬æ–‡è¯æ˜ç»“æ„ï¼›[PROOF_GRAPH_NETWORK](../../04_thinking/PROOF_GRAPH_NETWORK.md) |
| å†³ç­–æ ‘ | [DECISION_GRAPH_NETWORK](../../04_thinking/DECISION_GRAPH_NETWORK.md) Â§1 |

*ä¾æ®*ï¼š[HIERARCHICAL_MAPPING_AND_SUMMARY](../HIERARCHICAL_MAPPING_AND_SUMMARY.md) Â§ æ–‡æ¡£â†”æ€ç»´è¡¨å¾ã€‚

---

**ç»´æŠ¤è€…**: Rust Formal Methods Research Team
**æœ€åæ›´æ–°**: 2026-02-12ï¼ˆå›½é™…æƒå¨å¯¹æ ‡è¡¥å…¨ï¼‰
**çŠ¶æ€**: âœ… **å·²å®Œæˆ** (100%)

**å›½é™…æƒå¨å¯¹æ ‡**ï¼š[Stacked Borrows POPL 2020](https://plv.mpi-sws.org/rustbelt/stacked-borrows/)ã€[Tree Borrows PLDI 2025](https://plf.inf.ethz.ch/research/pldi25-tree-borrows.html)ã€[Polonius](https://rust-lang.github.io/polonius/)ï¼›[FLS Ch. 15.4](https://spec.ferrocene.dev/ownership-and-deconstruction.html#borrowing) Borrowingã€[Ch. 19](https://spec.ferrocene.dev/unsafety.html) Unsafetyï¼›Miri å®ç° Stacked Borrowsã€‚
