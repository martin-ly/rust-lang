# Memento å½¢å¼åŒ–åˆ†æ

> **åˆ›å»ºæ—¥æœŸ**: 2026-02-12
> **æœ€åæ›´æ–°**: 2026-02-14
> **Rust ç‰ˆæœ¬**: 1.93.0+ (Edition 2024)
> **çŠ¶æ€**: âœ… å½¢å¼åŒ–å®Œæˆ
> **åˆ†ç±»**: è¡Œä¸ºå‹
> **å®‰å…¨è¾¹ç•Œ**: çº¯ Safe
> **23 æ¨¡å¼çŸ©é˜µ**: [README Â§23 æ¨¡å¼å¤šç»´å¯¹æ¯”çŸ©é˜µ](../README.md#23-æ¨¡å¼å¤šç»´å¯¹æ¯”çŸ©é˜µ) ç¬¬ 18 è¡Œï¼ˆMementoï¼‰

---

## ğŸ“Š ç›®å½•

- [Memento å½¢å¼åŒ–åˆ†æ](#memento-å½¢å¼åŒ–åˆ†æ)
  - [å½¢å¼åŒ–å®šä¹‰](#å½¢å¼åŒ–å®šä¹‰)
  - [Rust å®ç°ä¸ä»£ç ç¤ºä¾‹](#rust-å®ç°ä¸ä»£ç ç¤ºä¾‹)
  - [è¯æ˜æ€è·¯](#è¯æ˜æ€è·¯)
  - [å…¸å‹åœºæ™¯](#å…¸å‹åœºæ™¯)
  - [ç›¸å…³æ¨¡å¼](#ç›¸å…³æ¨¡å¼)
  - [å®ç°å˜ä½“](#å®ç°å˜ä½“)
  - [åä¾‹](#åä¾‹)
  - [é€‰å‹å†³ç­–æ ‘](#é€‰å‹å†³ç­–æ ‘)
  - [ä¸ GoF å¯¹æ¯”](#ä¸-gof-å¯¹æ¯”)
  - [è¾¹ç•Œ](#è¾¹ç•Œ)

---

## å½¢å¼åŒ–å®šä¹‰

**Def 1.1ï¼ˆMemento ç»“æ„ï¼‰**:

è®¾ $M$ ä¸ºå¤‡å¿˜ç±»å‹ï¼Œ$O$ ä¸ºåŸå‘å™¨ç±»å‹ã€‚Memento æ»¡è¶³ï¼š

- $\exists \mathit{save} : O \to M$ï¼Œæ•è· $O$ çŠ¶æ€
- $\exists \mathit{restore} : O \times M \to O$ï¼Œæ¢å¤çŠ¶æ€
- $M$ ä»…ç”± $O$ è§£è¯»ï¼ˆå°è£…ï¼‰ï¼›æˆ–é€šè¿‡ `Clone`/åºåˆ—åŒ–å®ç°

**Axiom MO1**ï¼šå¤‡å¿˜åŒ…å«è¶³å¤ŸçŠ¶æ€ä»¥æ¢å¤ï¼›æ— å¤–éƒ¨ä¾èµ–ã€‚

**Axiom MO2**ï¼šæ¢å¤æ—¶çŠ¶æ€ä¸å½“å‰ä¸Šä¸‹æ–‡å…¼å®¹ï¼›éæ³•çŠ¶æ€ä¼šå¯¼è‡´ä¸å˜å¼è¿åã€‚

**å®šç† MO-T1**ï¼š`Clone` æˆ– `serde` åºåˆ—åŒ–å¯å®ç°ï¼›Rust æ— ç§æœ‰è®¿é—® OOP é£æ ¼ï¼Œè¡¨è¾¾ä¸ºè¿‘ä¼¼ã€‚

*è¯æ˜*ï¼šç”± Axiom MO1ã€MO2ï¼›`Clone` ç”Ÿæˆç‹¬ç«‹å‰¯æœ¬ï¼Œ`serde` åºåˆ—åŒ–/ååºåˆ—åŒ–ä¿è¯çŠ¶æ€å¯æ¢å¤ï¼›Rust æ—  C++ å‹å…ƒ/ç§æœ‰ï¼Œ$M$ å¯è¢«ä»»æ„ä»£ç è¯»å–ï¼Œæ•…ä¸ºè¿‘ä¼¼è¡¨è¾¾ã€‚âˆ

**å¼•ç† MO-L1ï¼ˆçŠ¶æ€ä¸€è‡´æ€§ï¼‰**ï¼šè‹¥ $M = \mathit{save}(O)$ ä¸” $O$ æœªå˜ï¼Œåˆ™ $\mathit{restore}(O, M)$ ä½¿ $O$ å›åˆ° $\mathit{save}$ æ—¶çŠ¶æ€ã€‚

*è¯æ˜*ï¼šç”± Def 1.1ï¼›$M$ æ•è· $O$ çŠ¶æ€ï¼›$\mathit{restore}$ è¦†ç›– $O$ ä¸º $M$ å†…çŠ¶æ€ï¼›æ— å¤–éƒ¨ä¾èµ–æ•…ä¸€è‡´æ€§æˆç«‹ã€‚âˆ

**æ¨è®º MO-C1**ï¼šMemento ä¸ [expressive_inexpressive_matrix](../../05_boundary_system/expressive_inexpressive_matrix.md) è¡¨ä¸€è‡´ï¼›$\mathit{ExprB}(\mathrm{Memento}) = \mathrm{Approx}$ã€‚

**åä¾‹**ï¼šè‹¥ $M$ ä¸ $O$ ç‰ˆæœ¬ä¸å…¼å®¹ï¼ˆå¦‚ $O$ æ–°å¢å­—æ®µï¼‰ï¼Œ`restore` å¯èƒ½äº§ç”Ÿéæ³•çŠ¶æ€ï¼›ç”± Axiom MO2ï¼Œéœ€ç‰ˆæœ¬å…¼å®¹æˆ–é»˜è®¤å€¼ã€‚

---

## Rust å®ç°ä¸ä»£ç ç¤ºä¾‹

```rust
#[derive(Clone)]
struct Memento {
    state: String,
}

struct Originator {
    state: String,
}

impl Originator {
    fn new() -> Self {
        Self { state: String::new() }
    }
    fn save(&self) -> Memento {
        Memento { state: self.state.clone() }
    }
    fn restore(&mut self, m: &Memento) {
        self.state = m.state.clone();
    }
    fn set(&mut self, s: &str) {
        self.state = s.to_string();
    }
}

// ä½¿ç”¨
let mut o = Originator::new();
o.set("A");
let m = o.save();
o.set("B");
o.restore(&m);
assert_eq!(o.state, "A");
```

**å½¢å¼åŒ–å¯¹åº”**ï¼š`Memento` å³ $M$ï¼›`Originator` å³ $O$ï¼›`save` å³ $\mathit{save}$ï¼›`restore` å³ $\mathit{restore}$ã€‚

---

## è¯æ˜æ€è·¯

1. **ä¿å­˜**ï¼š`clone()` äº§ç”Ÿç‹¬ç«‹å‰¯æœ¬ï¼›æ‰€æœ‰æƒè½¬ç§»è‡³ Mementoã€‚
2. **æ¢å¤**ï¼š`restore` è¦†ç›– `self.state`ï¼›éœ€ä¿è¯ Memento ä¸å½“å‰ Originator ç‰ˆæœ¬å…¼å®¹ã€‚

---

## å…¸å‹åœºæ™¯

| åœºæ™¯ | è¯´æ˜ |
| :--- | :--- |
| æ’¤é”€/é‡åš | ç¼–è¾‘å™¨ã€è¡¨å•ã€é…ç½® |
| å¿«ç…§/æ£€æŸ¥ç‚¹ | æ¸¸æˆå­˜æ¡£ã€äº‹åŠ¡å›æ»š |
| å®¡è®¡æ—¥å¿— | çŠ¶æ€å†å²ã€åˆè§„ |

---

## ç›¸å…³æ¨¡å¼

| æ¨¡å¼ | å…³ç³» |
| :--- | :--- |
| [Command](command.md) | æ’¤é”€éœ€ Memento ä¿å­˜çŠ¶æ€ |
| [State](state.md) | ä¿å­˜/æ¢å¤çŠ¶æ€ |
| [Prototype](../01_creational/prototype.md) | Clone å¯ä½œ Memento å®ç° |

---

## å®ç°å˜ä½“

| å˜ä½“ | è¯´æ˜ | é€‚ç”¨ |
| :--- | :--- | :--- |
| `Clone` | ç®€å•ç»“æ„ï¼›å†…å­˜å¤åˆ¶ | å°å¯¹è±¡ã€æ— ç¯ |
| serde | åºåˆ—åŒ–/ååºåˆ—åŒ– | æŒä¹…åŒ–ã€è·¨è¿›ç¨‹ |
| å¿«ç…§ç±»å‹ | æ˜¾å¼ `Snapshot` ç»“æ„ä½“ | ç‰ˆæœ¬å…¼å®¹ã€æ ¡éªŒ |

---

## åä¾‹

**åä¾‹**ï¼š`restore` ä½¿ç”¨éæ³•æˆ–è¿‡æ—¶çŠ¶æ€ â†’ è¿åé¢†åŸŸä¸å˜å¼ã€‚éœ€æ ¡éªŒ Memento ä¸å½“å‰ä¸Šä¸‹æ–‡å…¼å®¹ã€‚

---

## é€‰å‹å†³ç­–æ ‘

```text
éœ€è¦ä¿å­˜/æ¢å¤çŠ¶æ€ï¼Ÿ
â”œâ”€â”€ æ˜¯ â†’ ç®€å•ç»“æ„ï¼Ÿ â†’ Clone
â”‚       â””â”€â”€ éœ€æŒä¹…åŒ–ï¼Ÿ â†’ serde
â”œâ”€â”€ éœ€æ’¤é”€æ“ä½œï¼Ÿ â†’ Command + Memento
â””â”€â”€ éœ€çŠ¶æ€è½¬æ¢ï¼Ÿ â†’ State
```

---

## ä¸ GoF å¯¹æ¯”

| GoF | Rust å¯¹åº” | å·®å¼‚ |
| :--- | :--- | :--- |
| Memento ç§æœ‰ | æ— ï¼›Clone/serde å…¬å¼€ | è¿‘ä¼¼ |
| Originator å°è£… | å¿«ç…§ç±»å‹æˆ– Clone | ç­‰ä»· |
| Caretaker å­˜å‚¨ | Vec<Snapshot> ç­‰ | ç­‰ä»· |

---

## è¾¹ç•Œ

| ç»´åº¦ | åˆ†ç±» |
| :--- | :--- |
| å®‰å…¨ | çº¯ Safe |
| æ”¯æŒ | åŸç”Ÿ |
| è¡¨è¾¾ | è¿‘ä¼¼ï¼ˆæ— ç§æœ‰å°è£…ï¼‰ |
