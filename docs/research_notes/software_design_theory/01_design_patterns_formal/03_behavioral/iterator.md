# Iterator å½¢å¼åŒ–åˆ†æ

> **åˆ›å»ºæ—¥æœŸ**: 2026-02-12
> **æœ€åæ›´æ–°**: 2026-02-14
> **Rust ç‰ˆæœ¬**: 1.93.0+ (Edition 2024)
> **çŠ¶æ€**: âœ… å½¢å¼åŒ–å®Œæˆ
> **åˆ†ç±»**: è¡Œä¸ºå‹
> **å®‰å…¨è¾¹ç•Œ**: çº¯ Safe
> **23 æ¨¡å¼çŸ©é˜µ**: [README Â§23 æ¨¡å¼å¤šç»´å¯¹æ¯”çŸ©é˜µ](../README.md#23-æ¨¡å¼å¤šç»´å¯¹æ¯”çŸ©é˜µ) ç¬¬ 16 è¡Œï¼ˆIteratorï¼‰

---

## ğŸ“Š ç›®å½•

- [Iterator å½¢å¼åŒ–åˆ†æ](#iterator-å½¢å¼åŒ–åˆ†æ)
  - [å½¢å¼åŒ–å®šä¹‰](#å½¢å¼åŒ–å®šä¹‰)
  - [Rust å®ç°ä¸ä»£ç ç¤ºä¾‹](#rust-å®ç°ä¸ä»£ç ç¤ºä¾‹)
  - [è¯æ˜æ€è·¯](#è¯æ˜æ€è·¯)
  - [å…¸å‹åœºæ™¯](#å…¸å‹åœºæ™¯)
  - [ç›¸å…³æ¨¡å¼](#ç›¸å…³æ¨¡å¼)
  - [åä¾‹ï¼šè¿­ä»£ä¸­ä¿®æ”¹é›†åˆ](#åä¾‹è¿­ä»£ä¸­ä¿®æ”¹é›†åˆ)
  - [å®ç°å˜ä½“](#å®ç°å˜ä½“)
  - [ä¸æ ‡å‡†åº“è¡”æ¥](#ä¸æ ‡å‡†åº“è¡”æ¥)
  - [é€‰å‹å†³ç­–æ ‘](#é€‰å‹å†³ç­–æ ‘)
  - [è¾¹ç•Œ](#è¾¹ç•Œ)

---

## å½¢å¼åŒ–å®šä¹‰

**Def 1.1ï¼ˆIterator ç»“æ„ï¼‰**:

è®¾ $I$ ä¸ºè¿­ä»£å™¨ç±»å‹ï¼Œ$T$ ä¸ºå…ƒç´ ç±»å‹ã€‚Iterator æ»¡è¶³ï¼š

- $\exists \mathit{next} : \&mut I \to \mathrm{Option}\langle T \rangle$
- è¿­ä»£å™¨æŒæœ‰åºåˆ—çŠ¶æ€ï¼ˆä½ç½®ã€å¼•ç”¨ç­‰ï¼‰
- æ¶ˆè€—æˆ–å€Ÿç”¨äº§ç”Ÿå…ƒç´ ï¼›æ¯æ¬¡ `next` è‡³å¤šäº§ç”Ÿä¸€ä¸ªå…ƒç´ 

**Axiom IT1**ï¼š`next` æœ€å¤šè¿”å›ä¸€æ¬¡æ¯ä¸ªå…ƒç´ ï¼›æ— é‡å¤ã€æ— é—æ¼ï¼ˆç”±å®ç°ä¿è¯ï¼‰ã€‚

**Axiom IT2**ï¼šè¿­ä»£å™¨å¯å˜å€Ÿç”¨ï¼š`&mut self` æ»¡è¶³å€Ÿç”¨è§„åˆ™ï¼›åŒæ—¶ä»…ä¸€ä¸ªæ´»è·ƒè¿­ä»£å™¨æˆ–ä¸º FusedIteratorã€‚

**å®šç† IT-T1**ï¼š`Iterator` trait ç”±æ ‡å‡†åº“å®šä¹‰ï¼›`for` ç³–è¯­æ³•ä¿è¯ç±»å‹å®‰å…¨ã€‚ç”± [type_system_foundations](../../../type_theory/type_system_foundations.md)ã€‚

**å®šç† IT-T2**ï¼š`&mut self` å¯å˜å€Ÿç”¨ä¿è¯è¿­ä»£å™¨å†…éƒ¨çŠ¶æ€ä¸€è‡´ï¼›ç”± [borrow_checker_proof](../../../formal_methods/borrow_checker_proof.md)ã€‚

**æ¨è®º IT-C1**ï¼šIterator ä¸ºçº¯ Safeï¼›`Iterator` trait æ ‡å‡†åº“å®šä¹‰ï¼Œ`for` ç³–è¯­æ³•ï¼Œæ—  `unsafe`ã€‚ç”± IT-T1ã€IT-T2 åŠ [safe_unsafe_matrix](../../05_boundary_system/safe_unsafe_matrix.md) SBM-T1ã€‚

---

## Rust å®ç°ä¸ä»£ç ç¤ºä¾‹

```rust
struct Counter { count: u32 }

impl Iterator for Counter {
    type Item = u32;
    fn next(&mut self) -> Option<Self::Item> {
        if self.count < 5 {
            let c = self.count;
            self.count += 1;
            Some(c)
        } else {
            None
        }
    }
}

// ä½¿ç”¨
for n in Counter { count: 0 } {
    println!("{}", n);  // 0, 1, 2, 3, 4
}
```

**å½¢å¼åŒ–å¯¹åº”**ï¼š`Counter` å³ $I$ï¼›`Item = u32` å³ $T$ï¼›`next(&mut self)` å³ $\mathit{next}$ã€‚

---

## è¯æ˜æ€è·¯

1. **ç±»å‹å®‰å…¨**ï¼š`Option<T>` è¡¨ç¤ºç»ˆæ­¢ï¼›`for` å¾ªç¯ç±»å‹æ£€æŸ¥ä¿è¯ `Item` ä¸ä½¿ç”¨å¤„ä¸€è‡´ã€‚
2. **æ‰€æœ‰æƒ**ï¼š`next` è¿”å› `Option<T>`ï¼Œå…ƒç´ æ‰€æœ‰æƒè½¬ç§»è‡³è°ƒç”¨è€…ï¼›è¿­ä»£å™¨æŒæœ‰çŠ¶æ€ï¼ˆå¦‚ `count`ï¼‰ï¼Œä¸æŒæœ‰å…ƒç´ ã€‚

---

## å…¸å‹åœºæ™¯

| åœºæ™¯ | è¯´æ˜ |
| :--- | :--- |
| é›†åˆéå† | `Vec`ã€`HashMap`ã€`BTreeMap` ç­‰ |
| æƒ°æ€§æµ | `map`ã€`filter`ã€`take` é“¾å¼ |
| è‡ªå®šä¹‰åºåˆ— | è®¡æ•°å™¨ã€ç”Ÿæˆå™¨ã€æ¸¸æ ‡ |
| é€‚é…å™¨ | `zip`ã€`chain`ã€`enumerate` |

---

## ç›¸å…³æ¨¡å¼

| æ¨¡å¼ | å…³ç³» |
| :--- | :--- |
| [Visitor](visitor.md) | éå†æ–¹å¼ä¸åŒï¼›Iterator é¡ºåºï¼ŒVisitor æ·±åº¦ä¼˜å…ˆ |
| [Composite](../02_structural/composite.md) | å¯å¯¹ Composite å®ç° Iterator |
| [Chain of Responsibility](chain_of_responsibility.md) | é“¾å¼ä¼ é€’ vs è¿­ä»£æ¶ˆè´¹ |

---

## åä¾‹ï¼šè¿­ä»£ä¸­ä¿®æ”¹é›†åˆ

**é”™è¯¯**ï¼šåœ¨ `for x in vec.iter()` å†…å¯¹ `vec` æ‰§è¡Œ `push`/`remove`ã€‚

```rust
let mut v = vec![1, 2, 3];
for x in v.iter() {
    v.push(*x);  // ç¼–è¯‘é”™è¯¯ï¼šåŒæ—¶å­˜åœ¨ borrow ä¸ borrow_mut
}
```

**ç»“è®º**ï¼šAxiom IT2ï¼›å¯å˜å€Ÿç”¨äº’æ–¥ï¼›`iter()` ä¸ `push` ä¸å¯åŒæ—¶æ´»è·ƒã€‚

---

## å®ç°å˜ä½“

| å˜ä½“ | è¯´æ˜ | é€‚ç”¨ |
| :--- | :--- | :--- |
| ç»“æ„ä½“ + next | è‡ªå®šä¹‰è¿­ä»£å™¨ï¼›å®ç° trait | æ–°é›†åˆç±»å‹ |
| é€‚é…å™¨é“¾ | `iter().map().filter()` | æƒ°æ€§è½¬æ¢ |
| æ¶ˆè´¹å™¨ | `collect`ã€`sum`ã€`fold` | èšåˆç»“æœ |

é›¶æˆæœ¬æŠ½è±¡ï¼šæ³›å‹å•æ€åŒ–åï¼Œ`Iterator` é“¾æ— è™šè°ƒç”¨å¼€é”€ã€‚

---

## ä¸æ ‡å‡†åº“è¡”æ¥

`Iterator` trait ä¸ºæ ¸å¿ƒæŠ½è±¡ï¼›`map`ã€`filter`ã€`collect` ç­‰ä¸ºç»„åˆå­ã€‚æ‰€æœ‰ç»„åˆå‡ä¿æŒ Safeã€‚

---

## é€‰å‹å†³ç­–æ ‘

```text
éœ€è¦é¡ºåºéå†é›†åˆ/åºåˆ—ï¼Ÿ
â”œâ”€â”€ æ˜¯ â†’ æ ‡å‡†é›†åˆï¼Ÿ â†’ iter()/into_iter()
â”‚       â””â”€â”€ è‡ªå®šä¹‰åºåˆ—ï¼Ÿ â†’ impl Iterator
â”œâ”€â”€ éœ€æŒ‰ç±»å‹æ–½åŠ ä¸åŒæ“ä½œï¼Ÿ â†’ Visitor
â””â”€â”€ éœ€é“¾å¼ä¼ é€’ï¼Ÿ â†’ Chain of Responsibility
```

---

## è¾¹ç•Œ

| ç»´åº¦ | åˆ†ç±» |
| :--- | :--- |
| å®‰å…¨ | çº¯ Safe |
| æ”¯æŒ | åŸç”Ÿ |
| è¡¨è¾¾ | ç­‰ä»· |
