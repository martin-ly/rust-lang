# ç»„åˆè½¯ä»¶å·¥ç¨‹æœ‰æ•ˆæ€§å®šç†ä¸è¯æ˜

> **åˆ›å»ºæ—¥æœŸ**: 2026-02-12
> **æœ€åæ›´æ–°**: 2026-02-20
> **Rust ç‰ˆæœ¬**: 1.93.0+ (Edition 2024)
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“Š ç›®å½• {#-ç›®å½•}

- [ç»„åˆè½¯ä»¶å·¥ç¨‹æœ‰æ•ˆæ€§å®šç†ä¸è¯æ˜](#ç»„åˆè½¯ä»¶å·¥ç¨‹æœ‰æ•ˆæ€§å®šç†ä¸è¯æ˜)
  - [ğŸ“Š ç›®å½• {#-ç›®å½•}](#-ç›®å½•--ç›®å½•)
  - [å…¬ç†ä¸å®šä¹‰](#å…¬ç†ä¸å®šä¹‰)
  - [å®šç†é™ˆè¿°ä¸è¯æ˜](#å®šç†é™ˆè¿°ä¸è¯æ˜)
    - [å®šç† CE-T1ï¼ˆç»„åˆä¿æŒå†…å­˜å®‰å…¨ï¼‰](#å®šç†-ce-t1ç»„åˆä¿æŒå†…å­˜å®‰å…¨)
    - [å®šç† CE-T2ï¼ˆç»„åˆä¿æŒæ•°æ®ç«äº‰è‡ªç”±ï¼‰](#å®šç†-ce-t2ç»„åˆä¿æŒæ•°æ®ç«äº‰è‡ªç”±)
    - [å®šç† CE-T3ï¼ˆç»„åˆä¿æŒç±»å‹å®‰å…¨ï¼‰](#å®šç†-ce-t3ç»„åˆä¿æŒç±»å‹å®‰å…¨)
  - [å¼•ç†ä¸æ¨è®º](#å¼•ç†ä¸æ¨è®º)
    - [æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯ å±‚æ¬¡æ±‡æ€»](#æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯-å±‚æ¬¡æ±‡æ€»)
  - [å®šç† CE-PAT1ï¼ˆæ¨¡å¼ç»„åˆ CE ä¿æŒï¼‰](#å®šç†-ce-pat1æ¨¡å¼ç»„åˆ-ce-ä¿æŒ)
  - [ä»£ç ç¤ºä¾‹ï¼šæ¨¡å—ç»„åˆ](#ä»£ç ç¤ºä¾‹æ¨¡å—ç»„åˆ)
  - [å®šç†åº”ç”¨ç¤ºä¾‹](#å®šç†åº”ç”¨ç¤ºä¾‹)
  - [éªŒè¯æ–¹æ³•](#éªŒè¯æ–¹æ³•)
  - [ç»„åˆæœ‰æ•ˆæ€§éªŒè¯å·¥ä½œæµï¼ˆå®è´¨æŒ‡å—ï¼‰](#ç»„åˆæœ‰æ•ˆæ€§éªŒè¯å·¥ä½œæµå®è´¨æŒ‡å—)
    - [æ–°å¢æ¨¡å—çº³å…¥ç»„åˆæ—¶çš„æ£€æŸ¥æ¸…å•](#æ–°å¢æ¨¡å—çº³å…¥ç»„åˆæ—¶çš„æ£€æŸ¥æ¸…å•)
    - [ç»„åˆåä¾‹è¯¦è§£ï¼ˆä½•æ—¶å®šç†ä¸æˆç«‹ï¼‰](#ç»„åˆåä¾‹è¯¦è§£ä½•æ—¶å®šç†ä¸æˆç«‹)
    - [å®Œæ•´åº”ç”¨é“¾ç¤ºä¾‹ï¼šä¸‰å±‚æ¶æ„](#å®Œæ•´åº”ç”¨é“¾ç¤ºä¾‹ä¸‰å±‚æ¶æ„)
  - [ä¸ PROOF\_INDEX è¡”æ¥](#ä¸-proof_index-è¡”æ¥)

---

## å…¬ç†ä¸å®šä¹‰

**Def 1.1ï¼ˆæ¨¡å—ç»„åˆï¼‰**:

è®¾ $M_1, \ldots, M_n$ ä¸ºæ¨¡å—ã€‚ç»„åˆ $C = M_1 \oplus \cdots \oplus M_n$ æ»¡è¶³ï¼š

- å„æ¨¡å—é€šè¿‡ `pub` æ¥å£æš´éœ²ï¼Œä¾èµ–é€šè¿‡ `use` æˆ– `mod` å»ºç«‹
- æ— å¾ªç¯ä¾èµ–ï¼š$\mathrm{dep}(M_i)$ çš„ä¼ é€’é—­åŒ…ä¸åŒ…å« $M_i$
- ç±»å‹ç¯å¢ƒï¼š$\Gamma_C = \bigcup_i \Gamma_{M_i}$ ä¸”æ— å†²çª

**Axiom CE0**ï¼šç»„åˆä¸å¼•å…¥æ–°çš„å…¨å±€å¯å˜çŠ¶æ€ï¼›æˆ–æ–°çŠ¶æ€é€šè¿‡ `const`/`static` æ­£ç¡®åˆå§‹åŒ–ã€‚

---

## å®šç†é™ˆè¿°ä¸è¯æ˜

### å®šç† CE-T1ï¼ˆç»„åˆä¿æŒå†…å­˜å®‰å…¨ï¼‰

**é™ˆè¿°**ï¼šè‹¥å„æ¨¡å— $M_i$ æ»¡è¶³ [ownership_model](../../formal_methods/ownership_model.md) å®šç† T2ã€T3ï¼ˆæ‰€æœ‰æƒå”¯ä¸€æ€§ã€å†…å­˜å®‰å…¨ï¼‰ï¼Œåˆ™ç»„åˆ $C = M_1 \oplus \cdots \oplus M_n$ æ»¡è¶³å†…å­˜å®‰å…¨ã€‚

**è¯æ˜æ€è·¯**ï¼š

1. **å½’çº³åŸº**ï¼šå•æ¨¡å— $M_1$ ç”±å‰ææ»¡è¶³ T2ã€T3ã€‚
2. **å½’çº³æ­¥**ï¼šè®¾ $C' = M_1 \oplus \cdots \oplus M_{n-1}$ æ»¡è¶³å†…å­˜å®‰å…¨ã€‚æ·»åŠ  $M_n$ æ—¶ï¼š
   - æ¨¡å—è¾¹ç•Œï¼šå€¼é€šè¿‡å‡½æ•°å‚æ•°/è¿”å›å€¼ä¼ é€’ï¼Œæˆ–é€šè¿‡ `pub` ç»“æ„ä½“å­—æ®µï¼›æ‰€æœ‰æƒè½¬ç§»ç¬¦åˆ T2ã€‚
   - è°ƒç”¨é“¾ï¼š$M_n$ è°ƒç”¨ $C'$ æˆ–åå‘ï¼›å‚æ•°ä¸ºå€¼æˆ–å¼•ç”¨ï¼Œä¸è¿åå€Ÿç”¨è§„åˆ™ã€‚
   - æ— æ–°åˆ†é…æ¨¡å¼ï¼š$M_n$ çš„ `Box`/`Vec` ç­‰ç”±æ‰€æœ‰æƒç®¡ç†ï¼›é‡Šæ”¾ç”± RAII ä¿è¯ã€‚
3. **ç»“è®º**ï¼šç»„åˆä¸å¼•å…¥æ‚¬å‚ã€åŒé‡é‡Šæ”¾ã€æ³„æ¼ï¼›ç”± T2ã€T3 çš„å½’çº³ç»“æ„ã€‚

---

### å®šç† CE-T2ï¼ˆç»„åˆä¿æŒæ•°æ®ç«äº‰è‡ªç”±ï¼‰

**é™ˆè¿°**ï¼šè‹¥å„æ¨¡å—æ»¡è¶³ [borrow_checker_proof](../../formal_methods/borrow_checker_proof.md) å®šç† T1ï¼ˆæ•°æ®ç«äº‰è‡ªç”±ï¼‰ï¼Œä¸”è·¨çº¿ç¨‹ä¼ é€’ä»… Send ç±»å‹ã€å…±äº«ä»… Sync ç±»å‹ï¼Œåˆ™ç»„åˆä¿æŒæ•°æ®ç«äº‰è‡ªç”±ã€‚

**è¯æ˜æ€è·¯**ï¼š

1. **Send/Sync ç»“æ„æ€§è´¨**ï¼šè‹¥ $T$ çš„æ‰€æœ‰å­—æ®µä¸º Sendï¼Œåˆ™ $T$ ä¸º Sendï¼›Sync åŒç†ã€‚ç»„åˆä¸æ”¹å˜å­—æ®µç±»å‹ã€‚
2. **è·¨æ¨¡å—è¾¹ç•Œ**ï¼š`pub fn` çš„ç­¾åè‹¥åŒ…å« `T: Send` çº¦æŸï¼Œåˆ™è°ƒç”¨è€…ä¿è¯ä¼ å…¥ Sendï¼›ç»„åˆåçº¦æŸä»æˆç«‹ã€‚
3. **borrow T1**ï¼šå„æ¨¡å—å†…æ— æ•°æ®ç«äº‰ï¼›è·¨æ¨¡å—è°ƒç”¨åœ¨åŒä¸€çº¿ç¨‹å†…ä¸ºé¡ºåºï¼Œæ— äº¤é”™ï¼›è·¨çº¿ç¨‹ä»…é€šè¿‡ Send ç±»å‹ï¼Œæ— å…±äº«å¯å˜ã€‚
4. **ç»“è®º**ï¼šç»„åˆä¿æŒæ•°æ®ç«äº‰è‡ªç”±ã€‚

---

### å®šç† CE-T3ï¼ˆç»„åˆä¿æŒç±»å‹å®‰å…¨ï¼‰

**é™ˆè¿°**ï¼šè‹¥å„æ¨¡å—è‰¯å‹ï¼Œä¸” [type_system_foundations](../../type_theory/type_system_foundations.md) è¿›å±•æ€§ T1ã€ä¿æŒæ€§ T2ã€ç±»å‹å®‰å…¨ T3 æˆç«‹ï¼Œåˆ™ç»„åˆç¨‹åºè‰¯å‹ä¸”ç±»å‹å®‰å…¨ã€‚

**è¯æ˜æ€è·¯**ï¼š

1. **æ¨¡å—è‰¯å‹**ï¼šå„ $M_i$ é€šè¿‡ `cargo check`ï¼›ç±»å‹æ£€æŸ¥åœ¨æ¨¡å—è¾¹ç•Œé€šè¿‡ `pub` æ¥å£è¿›è¡Œã€‚
2. **ç±»å‹ç¯å¢ƒåˆå¹¶**ï¼š$\Gamma_C$ ä¸ºå„æ¨¡å—å¯¼å‡ºç±»å‹ä¸è°ƒç”¨çš„å¹¶ï¼›æ— å†²çªå›  `mod` è·¯å¾„éš”ç¦»ã€‚
3. **ä¿æŒæ€§**ï¼šè·¨æ¨¡å—è°ƒç”¨æ—¶ï¼Œå®å‚ç±»å‹ä¸å½¢å‚ä¸€è‡´ï¼›è¿”å›å€¼ç±»å‹ä¸è°ƒç”¨å¤„æœŸæœ›ä¸€è‡´ã€‚ç”± type_system T2ã€‚
4. **ç»“è®º**ï¼šç»„åˆåè‰¯å‹ï¼›ç”± T3 ç±»å‹å®‰å…¨ã€‚

---

## å¼•ç†ä¸æ¨è®º

**å¼•ç† CE-L1ï¼ˆæ¨¡å—æ— ç¯ï¼‰**ï¼šè‹¥ $C = M_1 \oplus \cdots \oplus M_n$ æ»¡è¶³ Def 1.1ï¼Œåˆ™ä¾èµ–å›¾ $G$ ä¸º DAGï¼›$M_i \prec^* M_j \land M_j \prec^* M_i \Rightarrow \bot$ã€‚

*è¯æ˜*ï¼šç”± Def 1.1 æ— å¾ªç¯ä¾èµ–ï¼›$\prec^*$ ä¸ºä¼ é€’é—­åŒ…ï¼Œç¯å­˜åœ¨åˆ™ $M_i \prec^* M_i$ï¼ŒçŸ›ç›¾ã€‚âˆ

**æ¨è®º CE-C1**ï¼šç»„åˆ CE-T1ã€CE-T2ã€CE-T3 å¯ç»„åˆï¼›è‹¥ $C$ æ»¡è¶³ CE-T1ã€CE-T2ã€CE-T3ï¼Œåˆ™ $C$ ä¸º Safe ä¸”è‰¯å‹ã€‚

*è¯æ˜*ï¼šç”±å„å®šç†é™ˆè¿°ï¼›å†…å­˜å®‰å…¨ + æ•°æ®ç«äº‰è‡ªç”± + ç±»å‹å®‰å…¨ â‡’ Safeã€‚âˆ

**æ¨è®º CE-C2ï¼ˆç»„åˆåä¾‹ï¼‰**ï¼šè‹¥ $M_n$ çš„ `pub` API æ³„æ¼ `unsafe` æˆ–è¿åå€Ÿç”¨è§„åˆ™ï¼Œåˆ™ CE-T1 æˆ– CE-T2 ä¸æˆç«‹ï¼›ç»„åˆåå¯èƒ½ UBã€‚

### æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯ å±‚æ¬¡æ±‡æ€»

| å±‚æ¬¡ | å†…å®¹ | æœ¬é¡µå¯¹åº” |
| :--- | :--- | :--- |
| **æ¦‚å¿µå®šä¹‰å±‚** | Def 1.1ï¼ˆæ¨¡å—ç»„åˆï¼‰ã€Axiom CE0ï¼ˆæ— æ–°å…¨å±€å¯å˜ï¼‰ | Â§å…¬ç†ä¸å®šä¹‰ |
| **å±æ€§å…³ç³»å±‚** | Def 1.1 â†’ CE-T1/T2/T3 â†’ CE-L1 â†’ CE-C1/C2 â†’ CE-PAT1ï¼›ä¾èµ– ownership T2/T3ã€borrow T1ã€type T1â€“T3 | Â§å®šç†é™ˆè¿°ã€Â§å¼•ç†ä¸æ¨è®º |
| **è§£é‡Šè®ºè¯å±‚** | CE-T1/T2/T3 è¯æ˜æ€è·¯ã€CE-PAT1 å®Œæ•´è¯æ˜ï¼›åä¾‹ï¼šCE-C2 | å„å®šç†èŠ‚ |

---

## å®šç† CE-PAT1ï¼ˆæ¨¡å¼ç»„åˆ CE ä¿æŒï¼‰

**é™ˆè¿°**ï¼šè®¾æ¨¡å¼ $A$ã€$B$ å„è‡ªæ»¡è¶³ CE-T1ã€CE-T2ã€CE-T3ï¼ˆä½œä¸ºç‹¬ç«‹æ¨¡å—ï¼‰ã€‚è‹¥ç»„åˆ $A \circ B$ çš„æ¥å£æ»¡è¶³ [03_integration_theory](03_integration_theory.md) IT-T1ï¼ˆè·¨æ¨¡å—æ‰€æœ‰æƒä¿æŒï¼‰ã€IT-T2ï¼ˆSend/Sync ä¼ é€’ï¼‰ã€IT-L1ï¼ˆç”Ÿå‘½å‘¨æœŸçº¦æŸï¼‰ï¼Œåˆ™ $A \circ B$ ä¿æŒ CE-T1ã€CE-T2ã€CE-T3ã€‚

**è¯æ˜**ï¼š

1. **CE-T1**ï¼š$A$ã€$B$ å„è‡ªå†…å­˜å®‰å…¨ï¼›ç»„åˆæ—¶å€¼/å¼•ç”¨ç» `pub fn` è¾¹ç•Œä¼ é€’ï¼Œæ‰€æœ‰æƒè½¬ç§»ç¬¦åˆ IT-T1ï¼›æ— æ–°åˆ†é…æ³„æ¼ã€æ— æ‚¬å‚ã€‚ç”± ownership T2ã€T3ã€‚
2. **CE-T2**ï¼š$A$ã€$B$ å„è‡ªæ— æ•°æ®ç«äº‰ï¼›è·¨æ¨¡å—è°ƒç”¨é¡ºåºæ‰§è¡Œï¼›è·¨çº¿ç¨‹ä»… Send ç±»å‹ï¼Œç”± IT-T2ã€‚ç”± borrow T1ã€Send/Sync ç»“æ„æ€§è´¨ã€‚
3. **CE-T3**ï¼š$A$ã€$B$ å„è‡ªè‰¯å‹ï¼›è·¨æ¨¡å—å®å‚/å½¢å‚ä¸€è‡´ï¼Œç”± IT-L1 ä¸ type_system ä¿æŒæ€§ã€‚âˆ

**æ¨è®º CE-PAT-C1**ï¼šBuilderâˆ˜Factoryã€Decoratorâˆ˜Strategyã€Observerâˆ˜Commandã€Compositeâˆ˜Visitorã€Repositoryâˆ˜Serviceâˆ˜DTO ç­‰ç»„åˆï¼Œè‹¥æ»¡è¶³ IT-T1/IT-T2/IT-L1ï¼Œåˆ™ä¿æŒ CE-T1â€“T3ã€‚

**ç»„åˆæ¨å¯¼ç¤ºä¾‹ï¼ˆBuilder + Factoryï¼‰**ï¼š

- æ¥å£ï¼š`Factory::create(&self) -> Builder`ï¼›`Builder::build(self) -> T`
- IT-T1ï¼š`create` è¿”å› Builder æ‰€æœ‰æƒè½¬ç§»ï¼›`build` æ¶ˆè´¹ Builder è¿”å› Tï¼Œæ‰€æœ‰æƒé“¾å®Œæ•´
- IT-T2ï¼šè‹¥è·¨çº¿ç¨‹ï¼ŒBuilderã€T éœ€ `Send`ï¼›å•çº¿ç¨‹åˆ™æ— çº¦æŸ
- IT-L1ï¼šæ— è·¨æ¨¡å—å¼•ç”¨è¿”å›ï¼Œä¸æ¶‰åŠ
- **ç»“è®º**ï¼šBuilderâˆ˜Factory ä¿æŒ CE-T1â€“T3ã€‚âˆ

---

## ä»£ç ç¤ºä¾‹ï¼šæ¨¡å—ç»„åˆ

```rust
// crate::module_a
pub struct A { pub x: i32 }
impl A {
    pub fn new(x: i32) -> Self { Self { x } }
    pub fn get(&self) -> i32 { self.x }
}

// crate::module_b
pub struct B { pub a: A }
impl B {
    pub fn new(a: A) -> Self { Self { a } }
    pub fn run(&self) -> i32 { self.a.get() }
}

// ç»„åˆï¼šmain ä½¿ç”¨ A å’Œ B
fn main() {
    let a = A::new(42);
    let b = B::new(a);  // a æ‰€æœ‰æƒè½¬ç§»è‡³ b
    assert_eq!(b.run(), 42);
}
```

**å½¢å¼åŒ–å¯¹åº”**ï¼š`A`ã€`B` ä¸ºæ¨¡å—ï¼›`main` ç»„åˆä¸¤è€…ã€‚æ‰€æœ‰æƒï¼š`a` ç§»å…¥ `B::new`ï¼Œç¬¦åˆ T2ï¼›æ— æ‚¬å‚ã€æ— æ³„æ¼ã€‚

---

## å®šç†åº”ç”¨ç¤ºä¾‹

| å®šç† | åº”ç”¨åœºæ™¯ |
| :--- | :--- |
| CE-T1 | å¤š crate é¡¹ç›®ï¼šå„ crate å†… Safeï¼Œç»„åˆåä»å†…å­˜å®‰å…¨ |
| CE-T2 | è·¨çº¿ç¨‹ï¼šåªæœ‰ `Send` ç±»å‹è·¨çº¿ç¨‹ä¼ é€’ï¼Œ`Sync` ç±»å‹å…±äº« |
| CE-T3 | æ³›å‹æ¨¡å—ï¼š`fn f<T: Trait>(x: T)` ç»„åˆæ—¶ç±»å‹æ£€æŸ¥åœ¨è¾¹ç•Œå®Œæˆ |

---

## éªŒè¯æ–¹æ³•

| å®šç† | éªŒè¯æ‰‹æ®µ |
| :--- | :--- |
| CE-T1 | `cargo build` æ—  unsafe æ³„æ¼ï¼›`Valgrind`/`MIRI` æ— å†…å­˜é”™è¯¯ |
| CE-T2 | `cargo clippy` æ£€æŸ¥ Send/Syncï¼›æ—  `Rc` è·¨çº¿ç¨‹ |
| CE-T3 | `cargo check` é€šè¿‡ï¼›ç±»å‹åœ¨ `pub` è¾¹ç•Œä¸€è‡´ |

ç»„åˆåè¿è¡Œæµ‹è¯•å¥—ä»¶ï¼›æ–°å¢æ¨¡å—éœ€è¡¥è¶³å•å…ƒæµ‹è¯•ã€‚

---

## ç»„åˆæœ‰æ•ˆæ€§éªŒè¯å·¥ä½œæµï¼ˆå®è´¨æŒ‡å—ï¼‰

### æ–°å¢æ¨¡å—çº³å…¥ç»„åˆæ—¶çš„æ£€æŸ¥æ¸…å•

| æ­¥éª¤ | åŠ¨ä½œ | éªŒè¯ CE-T1/T2/T3 |
| :--- | :--- | :--- |
| 1 | ç¡®è®¤ `pub` æ¥å£æ—  `unsafe` æ³„æ¼ | CE-T1 |
| 2 | è·¨çº¿ç¨‹ç±»å‹æ£€æŸ¥ `Send`/`Sync` | CE-T2 |
| 3 | `cargo check` é€šè¿‡ | CE-T3 |
| 4 | `cargo clippy` æ—  Rc è·¨çº¿ç¨‹ã€æ— åŒé‡å€Ÿç”¨ | CE-T2 |
| 5 | å¯é€‰ï¼š`MIRI` æ£€æµ‹æœªå®šä¹‰è¡Œä¸º | CE-T1 |
| 6 | ä¾èµ–å›¾æ— ç¯ï¼š`cargo tree` æ£€æŸ¥ | Def 1.3 |

### ç»„åˆåä¾‹è¯¦è§£ï¼ˆä½•æ—¶å®šç†ä¸æˆç«‹ï¼‰

| åä¾‹ | è¿åå®šç† | å½¢å¼åŒ–è¯´æ˜ |
| :--- | :--- | :--- |
| `pub fn leak_raw(p: *mut T)` | CE-T1 | æ³„æ¼è£¸æŒ‡é’ˆè¿å ownership å”¯ä¸€æ€§ |
| `pub fn spawn_rc(rc: Rc<T>)` | CE-T2 | Rc é Sendï¼Œè·¨çº¿ç¨‹ä¼ é€’å¯¼è‡´ç¼–è¯‘é”™è¯¯ |
| `pub fn bad_return<T>() -> T` | CE-T3 | è¿”å›ç±»å‹æœªçº¦æŸï¼Œè°ƒç”¨å¤„ç±»å‹æ¨æ–­å¤±è´¥ |
| `mod a { use super::b; } mod b { use super::a; }` | å¼•ç† CE-L1 | å¾ªç¯ä¾èµ–ï¼Œç¼–è¯‘å¤±è´¥ |
| æ³›å‹çº¦æŸä¸ä¸€è‡´ | CE-T3 | `impl<T: Trait> Service for T` ä¸ `Service<U>` è¾¹ç•Œå†²çª |

### å®Œæ•´åº”ç”¨é“¾ç¤ºä¾‹ï¼šä¸‰å±‚æ¶æ„

**åœºæ™¯**ï¼šWeb API è®¢å•å¤„ç†ï¼ˆè¡¨ç¤ºå±‚ + ä¸šåŠ¡å±‚ + æ•°æ®å±‚ï¼‰ã€‚

```rust
// å±‚ 1ï¼šDTOï¼ˆè·¨è¾¹ç•Œï¼‰
#[derive(serde::Serialize, serde::Deserialize)]
pub struct PlaceOrderDto { pub items: Vec<ItemDto> }

// å±‚ 2ï¼šDomain + Serviceï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
pub struct Order { id: u64, items: Vec<OrderItem> }
impl Order {
    fn from_dto(d: &PlaceOrderDto) -> Result<Self, String> { /* æ ¡éªŒ */ }
}

pub trait OrderRepository {
    fn save(&mut self, o: &Order) -> Result<(), String>;
}

pub struct OrderService<R: OrderRepository> { repo: R }
impl<R: OrderRepository> OrderService<R> {
    pub fn place_order(&mut self, dto: PlaceOrderDto) -> Result<u64, String> {
        let order = Order::from_dto(&dto)?;
        self.repo.save(&order)?;
        Ok(order.id)
    }
}

// å±‚ 3ï¼šControllerï¼ˆè¡¨ç¤ºå±‚ï¼Œç»„åˆ Serviceï¼‰
pub struct OrderController<S: OrderServiceTrait> { service: S }
impl<S: OrderServiceTrait> OrderController<S> {
    pub fn handle(&mut self, req: PlaceOrderDto) -> Response {
        self.service.place_order(req).into()
    }
}
```

**CE-T1/T2/T3 éªŒè¯**ï¼šå„å±‚ Safeï¼›æ‰€æœ‰æƒæ²¿ DTOâ†’Orderâ†’Repository ä¼ é€’ï¼›æ— å…±äº«å¯å˜ï¼›`cargo check` é€šè¿‡å³ CE-T3ã€‚

---

## ä¸ PROOF_INDEX è¡”æ¥

æœ¬éƒ¨åˆ†å®šç†çº³å…¥ [PROOF_INDEX](../../PROOF_INDEX.md)ï¼ŒæŒ‰ã€Œç»„åˆè½¯ä»¶å·¥ç¨‹ã€é¢†åŸŸåˆ†ç±»ã€‚
