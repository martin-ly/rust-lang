# å†…å­˜åˆ†æç ”ç©¶

> **åˆ›å»ºæ—¥æœŸ**: 2025-11-15
> **æœ€åæ›´æ–°**: 2026-02-20
> **Rust ç‰ˆæœ¬**: 1.93.0+ (Edition 2024)
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“Š ç›®å½•

- [å†…å­˜åˆ†æç ”ç©¶](#å†…å­˜åˆ†æç ”ç©¶)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ ç ”ç©¶ç›®æ ‡](#-ç ”ç©¶ç›®æ ‡)
    - [æ ¸å¿ƒé—®é¢˜](#æ ¸å¿ƒé—®é¢˜)
    - [é¢„æœŸæˆæœ](#é¢„æœŸæˆæœ)
  - [ğŸ“š ç†è®ºåŸºç¡€](#-ç†è®ºåŸºç¡€)
    - [ç›¸å…³æ¦‚å¿µ](#ç›¸å…³æ¦‚å¿µ)
    - [ç†è®ºèƒŒæ™¯](#ç†è®ºèƒŒæ™¯)
    - [å½¢å¼åŒ–è®ºè¯ä¸å®éªŒè¡”æ¥](#å½¢å¼åŒ–è®ºè¯ä¸å®éªŒè¡”æ¥)
  - [ğŸ”¬ å®éªŒè®¾è®¡](#-å®éªŒè®¾è®¡)
    - [1. å†…å­˜åˆ†é…æ¨¡å¼åˆ†æ](#1-å†…å­˜åˆ†é…æ¨¡å¼åˆ†æ)
    - [2. å†…å­˜æ³„æ¼æ£€æµ‹](#2-å†…å­˜æ³„æ¼æ£€æµ‹)
    - [3. å†…å­˜ç¢ç‰‡åŒ–åˆ†æ](#3-å†…å­˜ç¢ç‰‡åŒ–åˆ†æ)
  - [ğŸ’» ä»£ç ç¤ºä¾‹](#-ä»£ç ç¤ºä¾‹)
    - [ç¤ºä¾‹ 1ï¼šå†…å­˜ä½¿ç”¨åˆ†æ](#ç¤ºä¾‹-1å†…å­˜ä½¿ç”¨åˆ†æ)
    - [ç¤ºä¾‹ 2ï¼šVec å¢é•¿æ¨¡å¼åˆ†æ](#ç¤ºä¾‹-2vec-å¢é•¿æ¨¡å¼åˆ†æ)
    - [ç¤ºä¾‹ 3ï¼šå†…å­˜æ³„æ¼æ£€æµ‹](#ç¤ºä¾‹-3å†…å­˜æ³„æ¼æ£€æµ‹)
    - [ç¤ºä¾‹ 4ï¼šå†…å­˜å¸ƒå±€åˆ†æ](#ç¤ºä¾‹-4å†…å­˜å¸ƒå±€åˆ†æ)
  - [ğŸ“Š å®éªŒç»“æœ](#-å®éªŒç»“æœ)
    - [Vec å¢é•¿æ¨¡å¼](#vec-å¢é•¿æ¨¡å¼)
    - [å†…å­˜æ³„æ¼æ£€æµ‹](#å†…å­˜æ³„æ¼æ£€æµ‹)
    - [ç»“æœåˆ†ææ¨¡æ¿](#ç»“æœåˆ†ææ¨¡æ¿)
  - [ğŸ“‹ æ•°æ®æ”¶é›†æ‰§è¡ŒæŒ‡å—](#-æ•°æ®æ”¶é›†æ‰§è¡ŒæŒ‡å—)
    - [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
    - [æ‰§è¡Œæ­¥éª¤](#æ‰§è¡Œæ­¥éª¤)
  - [ğŸ“ å†…å­˜ä¼˜åŒ–å»ºè®®ä¸å·¥å…·æ”¹è¿›](#-å†…å­˜ä¼˜åŒ–å»ºè®®ä¸å·¥å…·æ”¹è¿›)
    - [å†…å­˜ä¼˜åŒ–å»ºè®®](#å†…å­˜ä¼˜åŒ–å»ºè®®)
    - [å·¥å…·æ”¹è¿›](#å·¥å…·æ”¹è¿›)
    - [å†…å­˜æŠ¥å‘Š](#å†…å­˜æŠ¥å‘Š)
  - [ğŸ”— ç³»ç»Ÿé›†æˆä¸å®é™…åº”ç”¨](#-ç³»ç»Ÿé›†æˆä¸å®é™…åº”ç”¨)
    - [ä¸å½¢å¼åŒ–æ–¹æ³•çš„é›†æˆ](#ä¸å½¢å¼åŒ–æ–¹æ³•çš„é›†æˆ)
    - [ä¸å®éªŒç ”ç©¶çš„é›†æˆ](#ä¸å®éªŒç ”ç©¶çš„é›†æˆ)
    - [å®é™…åº”ç”¨æ¡ˆä¾‹](#å®é™…åº”ç”¨æ¡ˆä¾‹)
  - [ğŸ“– å‚è€ƒæ–‡çŒ®](#-å‚è€ƒæ–‡çŒ®)
    - [å­¦æœ¯è®ºæ–‡](#å­¦æœ¯è®ºæ–‡)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [å·¥å…·èµ„æº](#å·¥å…·èµ„æº)

---

## ğŸ¯ ç ”ç©¶ç›®æ ‡

æœ¬ç ”ç©¶æ—¨åœ¨æ·±å…¥åˆ†æ Rust ç¨‹åºçš„å†…å­˜ä½¿ç”¨æ¨¡å¼ï¼ŒåŒ…æ‹¬ï¼š

1. **å†…å­˜åˆ†é…æ¨¡å¼**ï¼šåˆ†æä¸åŒç±»å‹çš„å†…å­˜åˆ†é…è¡Œä¸º
2. **å†…å­˜æ³„æ¼æ£€æµ‹**ï¼šè¯†åˆ«å’Œé¢„é˜²å†…å­˜æ³„æ¼
3. **å†…å­˜ç¢ç‰‡åŒ–**ï¼šåˆ†æå†…å­˜ç¢ç‰‡åŒ–é—®é¢˜
4. **å†…å­˜å®‰å…¨éªŒè¯**ï¼šéªŒè¯ Rust å†…å­˜å®‰å…¨ä¿è¯

### æ ¸å¿ƒé—®é¢˜

1. **Rust ç¨‹åºçš„å†…å­˜ä½¿ç”¨ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ**
2. **å¦‚ä½•æ£€æµ‹å’Œé¢„é˜²å†…å­˜æ³„æ¼ï¼Ÿ**
3. **å†…å­˜ç¢ç‰‡åŒ–å¯¹æ€§èƒ½çš„å½±å“å¦‚ä½•ï¼Ÿ**

### é¢„æœŸæˆæœ

- å»ºç«‹å†…å­˜åˆ†æå·¥å…·å’Œæ–¹æ³•
- è¯†åˆ«å¸¸è§å†…å­˜é—®é¢˜æ¨¡å¼
- æä¾›å†…å­˜ä¼˜åŒ–æœ€ä½³å®è·µ

---

## ğŸ“š ç†è®ºåŸºç¡€

### ç›¸å…³æ¦‚å¿µ

**å†…å­˜åˆ†æï¼ˆMemory Analysisï¼‰**ï¼šé€šè¿‡å·¥å…·å’ŒæŠ€æœ¯åˆ†æç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè¯†åˆ«å†…å­˜é—®é¢˜å’Œä¼˜åŒ–æœºä¼šã€‚

**å…³é”®æ¦‚å¿µ**ï¼š

- **å †å†…å­˜ï¼ˆHeap Memoryï¼‰**ï¼šåŠ¨æ€åˆ†é…çš„å†…å­˜
- **æ ˆå†…å­˜ï¼ˆStack Memoryï¼‰**ï¼šå‡½æ•°è°ƒç”¨æ ˆä½¿ç”¨çš„å†…å­˜
- **å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰**ï¼šå·²åˆ†é…ä½†æ— æ³•é‡Šæ”¾çš„å†…å­˜
- **å†…å­˜ç¢ç‰‡åŒ–ï¼ˆMemory Fragmentationï¼‰**ï¼šå†…å­˜è¢«åˆ†å‰²æˆå°å—ï¼Œæ— æ³•æœ‰æ•ˆåˆ©ç”¨

### ç†è®ºèƒŒæ™¯

**å†…å­˜ç®¡ç†ç†è®º**ï¼š

- **å¼•ç”¨è®¡æ•°**ï¼šé€šè¿‡è®¡æ•°ç®¡ç†å†…å­˜ç”Ÿå‘½å‘¨æœŸ
- **åƒåœ¾å›æ”¶**ï¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼ˆRust ä¸ä½¿ç”¨ï¼‰
- **æ‰€æœ‰æƒç³»ç»Ÿ**ï¼šç¼–è¯‘æ—¶å†…å­˜ç®¡ç†ï¼ˆRust æ ¸å¿ƒç‰¹æ€§ï¼‰

### å½¢å¼åŒ–è®ºè¯ä¸å®éªŒè¡”æ¥

**Def MA1ï¼ˆå†…å­˜å®éªŒéªŒè¯ï¼‰**ï¼šå†…å­˜åˆ†æå®éªŒ $E$ éªŒè¯ [ownership_model](../formal_methods/ownership_model.md) å®šç† T2/T3ï¼Œå½“ä¸”ä»…å½“ $E$ è§‚æµ‹åˆ°æ— æ‚¬å‚ã€æ— åŒé‡é‡Šæ”¾ã€æ— æ³„æ¼ã€‚

**Axiom MA1**ï¼šValgrindã€Miriã€ASan ç­‰å·¥å…·åœ¨æ»¡è¶³å…¶å‰ç½®æ¡ä»¶æ—¶ï¼Œå¯è§‚æµ‹åˆ°å†…å­˜ UB çš„å…¸å‹è¡¨ç°ï¼›å®éªŒä¸èƒ½è¯æ˜å®šç†ï¼Œä½†å¯æä¾›ç»éªŒæ”¯æŒã€‚

**å®šç† MA-T1ï¼ˆè§‚æµ‹è•´æ¶µï¼‰**ï¼šè‹¥ $E$ åœ¨ Valgrind/Miri ä¸‹æ— æ³„æ¼ã€æ— æ‚¬å‚ã€æ— åŒé‡é‡Šæ”¾æŠ¥å‘Šï¼Œåˆ™ $E$ ä¸ ownership T2/T3 çš„ç»“è®ºä¸€è‡´ï¼›åä¹‹åˆ™å­˜åœ¨è¿åã€‚

*è¯æ˜*ï¼šç”± [experiments/README](../experiments/README.md) å®šç† EX-T1ï¼›å·¥å…·è§‚æµ‹ä¸å®šç†ç»“è®ºä¸€è‡´å³éªŒè¯ï¼›åä¾‹å¯å¦å®šçŸ›ç›¾å‡è®¾ã€‚âˆ

**å¼•ç† MA-L1ï¼ˆå·¥å…·ä¸å®šç†å¯¹åº”ï¼‰**ï¼šValgrind æ£€æµ‹å†…å­˜æ³„æ¼ï¼›Miri æ£€æµ‹æœªåˆå§‹åŒ–ã€æ‚¬å‚ï¼›ASan æ£€æµ‹è¶Šç•Œï¼›å„å·¥å…·ä¸ ownership T3 çš„ä¸‰æ€§è´¨ä¸€ä¸€å¯¹åº”ã€‚

*è¯æ˜*ï¼šç”± Axiom MA1ï¼›å·¥å…·åœ¨æ»¡è¶³å‰ç½®æ¡ä»¶æ—¶ï¼Œå¯è§‚æµ‹åˆ°å†…å­˜ UB çš„å…¸å‹è¡¨ç°ï¼›ownership T3 æ€§è´¨ 1â€“3 åˆ†åˆ«å¯¹åº”æ‚¬å‚ã€åŒé‡é‡Šæ”¾ã€æ³„æ¼ã€‚âˆ

**æ¨è®º MA-C1**ï¼šå¾ªç¯å¼•ç”¨ï¼ˆRc/Arcï¼‰å¯¼è‡´çš„é€»è¾‘æ³„æ¼ä¸åœ¨ ownership T3 æ— æ³„æ¼èŒƒå›´å†…ï¼›RAII ä¿è¯ç‰©ç†é‡Šæ”¾ï¼Œé€»è¾‘æ³„æ¼éœ€ç»“æ„åŒ–è®¾è®¡é¿å…ã€‚

| åˆ†æç›®æ ‡ | å½¢å¼åŒ–å®šç† | éªŒè¯æ–¹æ³• |
| :--- | :--- | :--- |
| æ— æ³„æ¼ | ownership T3 æ€§è´¨3 | Valgrindã€Miriã€æ³„æ¼æ£€æµ‹ |
| æ— æ‚¬å‚ | ownership T3 æ€§è´¨1 | Miriã€ASan |
| æ— åŒé‡é‡Šæ”¾ | ownership T3 æ€§è´¨2 | Miri |

**å¼•ç”¨**ï¼š[experiments/README](../experiments/README.md) å®šç† EX-T1ï¼›[formal_methods/README](../formal_methods/README.md) FM-T1ã€‚

---

## ğŸ”¬ å®éªŒè®¾è®¡

### 1. å†…å­˜åˆ†é…æ¨¡å¼åˆ†æ

**æµ‹è¯•ç›®æ ‡**ï¼šåˆ†æä¸åŒç±»å‹æ•°æ®çš„å†…å­˜åˆ†é…æ¨¡å¼

**æµ‹è¯•åœºæ™¯**ï¼š

- `Vec` å¢é•¿æ¨¡å¼åˆ†æ
- `String` å†…å­˜åˆ†é…åˆ†æ
- `HashMap` å†…å­˜ä½¿ç”¨åˆ†æ
- è‡ªå®šä¹‰ç±»å‹å†…å­˜å¸ƒå±€åˆ†æ

### 2. å†…å­˜æ³„æ¼æ£€æµ‹

**æµ‹è¯•ç›®æ ‡**ï¼šæ£€æµ‹å’Œé¢„é˜²å†…å­˜æ³„æ¼

**æµ‹è¯•åœºæ™¯**ï¼š

- å¾ªç¯å¼•ç”¨æ£€æµ‹
- æœªé‡Šæ”¾èµ„æºæ£€æµ‹
- å…¨å±€çŠ¶æ€å†…å­˜æ³„æ¼

### 3. å†…å­˜ç¢ç‰‡åŒ–åˆ†æ

**æµ‹è¯•ç›®æ ‡**ï¼šåˆ†æå†…å­˜ç¢ç‰‡åŒ–é—®é¢˜

**æµ‹è¯•åœºæ™¯**ï¼š

- é¢‘ç¹åˆ†é…/é‡Šæ”¾å¯¼è‡´ç¢ç‰‡åŒ–
- ä¸åŒåˆ†é…å™¨ç¢ç‰‡åŒ–æ¯”è¾ƒ

---

## ğŸ’» ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå†…å­˜ä½¿ç”¨åˆ†æ

```rust
use std::alloc::{GlobalAlloc, Layout, System};
use std::sync::atomic::{AtomicUsize, Ordering};

struct TrackingAllocator;

static ALLOCATED: AtomicUsize = AtomicUsize::new(0);
static DEALLOCATED: AtomicUsize = AtomicUsize::new(0);

unsafe impl GlobalAlloc for TrackingAllocator {
    unsafe fn alloc(&self, layout: Layout) -> *mut u8 {
        let ptr = System.alloc(layout);
        if !ptr.is_null() {
            ALLOCATED.fetch_add(layout.size(), Ordering::Relaxed);
        }
        ptr
    }

    unsafe fn dealloc(&self, ptr: *mut u8, layout: Layout) {
        System.dealloc(ptr, layout);
        DEALLOCATED.fetch_add(layout.size(), Ordering::Relaxed);
    }
}

#[global_allocator]
static GLOBAL: TrackingAllocator = TrackingAllocator;

fn analyze_memory_usage() {
    let allocated = ALLOCATED.load(Ordering::Relaxed);
    let deallocated = DEALLOCATED.load(Ordering::Relaxed);
    let current = allocated.saturating_sub(deallocated);

    println!("å·²åˆ†é…: {} å­—èŠ‚", allocated);
    println!("å·²é‡Šæ”¾: {} å­—èŠ‚", deallocated);
    println!("å½“å‰ä½¿ç”¨: {} å­—èŠ‚", current);
}
```

### ç¤ºä¾‹ 2ï¼šVec å¢é•¿æ¨¡å¼åˆ†æ

```rust
fn analyze_vec_growth() {
    let mut vec = Vec::new();
    let mut capacities = Vec::new();

    for i in 0..100 {
        vec.push(i);
        capacities.push(vec.capacity());
    }

    println!("å®¹é‡å˜åŒ–: {:?}", capacities);

    // åˆ†æå¢é•¿æ¨¡å¼
    for i in 1..capacities.len() {
        if capacities[i] != capacities[i-1] {
            println!("ç´¢å¼• {}: å®¹é‡ä» {} å¢é•¿åˆ° {}",
                i, capacities[i-1], capacities[i]);
        }
    }
}
```

### ç¤ºä¾‹ 3ï¼šå†…å­˜æ³„æ¼æ£€æµ‹

```rust
use std::rc::Rc;
use std::cell::RefCell;

// å¾ªç¯å¼•ç”¨ç¤ºä¾‹ï¼ˆå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼‰
struct Node {
    value: i32,
    children: Vec<Rc<RefCell<Node>>>,
    parent: Option<Rc<RefCell<Node>>>,
}

impl Node {
    fn new(value: i32) -> Rc<RefCell<Node>> {
        Rc::new(RefCell::new(Node {
            value,
            children: Vec::new(),
            parent: None,
        }))
    }

    fn add_child(parent: &Rc<RefCell<Node>>, child: &Rc<RefCell<Node>>) {
        parent.borrow_mut().children.push(Rc::clone(child));
        child.borrow_mut().parent = Some(Rc::clone(parent));
    }
}

// ä½¿ç”¨ Weak æ‰“ç ´å¾ªç¯å¼•ç”¨
use std::rc::Weak;

struct SafeNode {
    value: i32,
    children: Vec<Rc<RefCell<SafeNode>>>,
    parent: Option<Weak<RefCell<SafeNode>>>,
}

impl SafeNode {
    fn new(value: i32) -> Rc<RefCell<SafeNode>> {
        Rc::new(RefCell::new(SafeNode {
            value,
            children: Vec::new(),
            parent: None,
        }))
    }

    fn add_child(parent: &Rc<RefCell<SafeNode>>, child: &Rc<RefCell<SafeNode>>) {
        parent.borrow_mut().children.push(Rc::clone(child));
        child.borrow_mut().parent = Some(Rc::downgrade(parent));
    }
}
```

### ç¤ºä¾‹ 4ï¼šå†…å­˜å¸ƒå±€åˆ†æ

```rust
use std::mem;

struct Example {
    a: u8,
    b: u32,
    c: u8,
}

fn analyze_memory_layout() {
    println!("Example å¤§å°: {} å­—èŠ‚", mem::size_of::<Example>());
    println!("å¯¹é½: {} å­—èŠ‚", mem::align_of::<Example>());

    // ä½¿ç”¨ #[repr(C)] æ§åˆ¶å†…å­˜å¸ƒå±€
}
```

**åˆ†æè¦ç‚¹**ï¼š`size_of`/`align_of` ä¸ [ALIGNMENT_GUIDE](../../02_reference/ALIGNMENT_GUIDE.md) å¯¹é½çŸ¥è¯†è¡”æ¥ï¼›`#[repr(C)]` ç”¨äº FFI ä¸å¸ƒå±€æ§åˆ¶ã€‚

---

## ğŸ“Š å®éªŒç»“æœ

### Vec å¢é•¿æ¨¡å¼

**è§‚å¯Ÿç»“æœ**ï¼š

- Vec é‡‡ç”¨æŒ‡æ•°å¢é•¿ç­–ç•¥ï¼ˆé€šå¸¸ 2 å€å¢é•¿ï¼‰
- åˆå§‹å®¹é‡é€šå¸¸ä¸º 0 æˆ– 4
- å¢é•¿ç­–ç•¥å¹³è¡¡äº†å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½

### å†…å­˜æ³„æ¼æ£€æµ‹

**å‘ç°**ï¼š

- `Rc` å¾ªç¯å¼•ç”¨ç¡®å®ä¼šå¯¼è‡´å†…å­˜æ³„æ¼
- ä½¿ç”¨ `Weak` å¯ä»¥æ‰“ç ´å¾ªç¯å¼•ç”¨
- éœ€è¦ä»”ç»†è®¾è®¡æ•°æ®ç»“æ„é¿å…å¾ªç¯å¼•ç”¨

### ç»“æœåˆ†ææ¨¡æ¿

å°† `valgrind --leak-check=full`ã€`dhat` æˆ–è‡ªå®šä¹‰ `TrackingAllocator` çš„äº§å‡ºå¡«å…¥ä¸‹è¡¨ï¼š

| ç±»åˆ«     | æŒ‡æ ‡                 | å®æµ‹å€¼ | å•ä½ | å¤‡æ³¨              |
| :--- | :--- | :--- | :--- | :--- |
| Vec å¢é•¿ | å®¹é‡åºåˆ—ï¼ˆå‰ 10 æ¬¡ï¼‰ | **\_** | -    | å¦‚ 0,1,2,4,8,...  |
| åˆ†é…     | å·²åˆ†é…ç´¯è®¡           | **\_** | å­—èŠ‚ | TrackingAllocator |
| åˆ†é…     | å½“å‰é©»ç•™             | **\_** | å­—èŠ‚ | å·²åˆ†é…âˆ’å·²é‡Šæ”¾     |
| æ³„æ¼     | valgrind æ³„æ¼å—æ•°    | **\_** | -    | ç›®æ ‡ä¸º 0          |
| æ³„æ¼     | valgrind æ³„æ¼å­—èŠ‚    | **\_** | å­—èŠ‚ | ç›®æ ‡ä¸º 0          |

**ç¤ºä¾‹å¡«å†™**ï¼ˆå…¸å‹ Vec::push 1000 æ¬¡ã€Rc æ— ç¯ã€valgrind 3.18ï¼‰ï¼š

| ç±»åˆ«     | æŒ‡æ ‡                 | ç¤ºä¾‹å€¼ | å•ä½ | å¤‡æ³¨              |
| :--- | :--- | :--- | :--- | :--- |
| Vec å¢é•¿ | å®¹é‡åºåˆ—ï¼ˆå‰ 10 æ¬¡ï¼‰ | 0,1,2,4,8,16,32,64,128,256 | -    | æŒ‡æ•°å¢é•¿          |
| åˆ†é…     | å·²åˆ†é…ç´¯è®¡           | 524,288 | å­—èŠ‚ | 1000 push å     |
| åˆ†é…     | å½“å‰é©»ç•™             | 4,096 | å­—èŠ‚ | å·²åˆ†é…âˆ’å·²é‡Šæ”¾     |
| æ³„æ¼     | valgrind æ³„æ¼å—æ•°    | 0    | -    | ç›®æ ‡ä¸º 0          |
| æ³„æ¼     | valgrind æ³„æ¼å­—èŠ‚    | 0    | å­—èŠ‚ | ç›®æ ‡ä¸º 0          |

**ç»“è®ºå¡«å†™**ï¼šä¸ Vec æŒ‡æ•°å¢é•¿ã€Rc/Weak æ¨¡å¼å¯¹æ¯”ï¼›è‹¥ç”¨ Miri/heaptrackï¼Œå¯æ³¨æ˜ä¸ Rust 1.93 çš„å…¼å®¹æ€§ã€‚

---

## ğŸ“‹ æ•°æ®æ”¶é›†æ‰§è¡ŒæŒ‡å—

### ç¯å¢ƒè¦æ±‚

- **Rust**: 1.93.0+ï¼›**Valgrind**: 3.18+ï¼ˆLinuxï¼‰ï¼›**Miri**: `rustup component add miri`
- **dhat**ï¼š`cargo add dhat` æˆ–ä½¿ç”¨ `#[global_allocator]` + è‡ªå®šä¹‰ TrackingAllocator

### æ‰§è¡Œæ­¥éª¤

1. **Vec å¢é•¿ä¸å¸ƒå±€**ï¼šè¿è¡Œå« `analyze_vec_growth`ã€`analyze_memory_layout` çš„ç¤ºä¾‹ï¼Œè®°å½• `capacity` åºåˆ—ä¸ `size_of`/`align_of`ã€‚
2. **æ³„æ¼æ£€æµ‹**ï¼š`valgrind --leak-check=full --show-leak-kinds=all ./target/release/your_binary`ï¼›æˆ– `MIRIFLAGS="-Zmiri-tag-raw-pointers" cargo miri run`ã€‚
3. **å †åˆ†æ**ï¼š`heaptrack ./target/release/your_binary` æˆ– dhatï¼›è‹¥ç”¨ TrackingAllocatorï¼Œæ‰§è¡Œåè¯»å– `ALLOCATED`/`DEALLOCATED`ã€‚
4. **ç•™å­˜**ï¼šå°†ä¸Šè¿°ç»“æœå½•å…¥ã€Œç»“æœåˆ†ææ¨¡æ¿ã€ã€‚

---

## ğŸ“ å†…å­˜ä¼˜åŒ–å»ºè®®ä¸å·¥å…·æ”¹è¿›

### å†…å­˜ä¼˜åŒ–å»ºè®®

- **Vec**ï¼š`Vec::with_capacity` é¢„åˆ†é…ï¼›é¿å…é¢‘ç¹ `push` è§¦å‘å¤šæ¬¡æ‰©å®¹ã€‚
- **Rc/Arc**ï¼šæœ‰ç¯åˆ™ç”¨ `Weak` ç ´ç¯ï¼›æ— ç¯ä¼˜å…ˆ `Rc`ï¼Œå¤šçº¿ç¨‹ç”¨ `Arc`ã€‚
- **å¸ƒå±€**ï¼š`#[repr(C)]` æ§åˆ¶å¯¹é½ä¸ FFIï¼›`std::mem::size_of` æ’æŸ¥å¤§å¯¹è±¡ã€‚
- **åˆ†é…å™¨**ï¼šRust 1.93 çš„ `thread_local` å…¨å±€åˆ†é…å™¨å¯é™ä½å¤šçº¿ç¨‹åˆ†é…ç«äº‰ã€‚

### å·¥å…·æ”¹è¿›

- **Valgrind**ï¼šå¯ä¸ `--error-limit=no`ã€`--trace-children=yes` è”ç”¨åšé›†æˆæµ‹è¯•ã€‚
- **Miri**ï¼šæŒç»­è·Ÿè¿› `-Zmiri` ä¸ 1.93 çš„å…¼å®¹æ€§ã€‚
- **heaptrack/dhat**ï¼šç”¨äºå®šä½çƒ­ç‚¹åˆ†é…ä¸ç¢ç‰‡åŒ–ï¼›å¯å¯¼å‡ºä¸ã€Œç»“æœåˆ†ææ¨¡æ¿ã€å¯¹æ¥çš„æŒ‡æ ‡ã€‚

### å†…å­˜æŠ¥å‘Š

æŒ‰ã€Œç»“æœåˆ†ææ¨¡æ¿ã€æ•´ç† + å„å·¥å…·æˆªå›¾/æ—¥å¿—æ‘˜è¦ï¼Œå³å¯å½¢æˆå†…å­˜åˆ†ææŠ¥å‘Šï¼›å»ºè®®åŒºåˆ†ã€Œæ— æ³„æ¼éªŒè¯ã€ã€Œå³°å€¼é©»ç•™ã€ã€Œç¢ç‰‡åŒ–ä¸åˆ†é…çƒ­ç‚¹ã€ä¸‰éƒ¨åˆ†ã€‚

---

## ğŸ”— ç³»ç»Ÿé›†æˆä¸å®é™…åº”ç”¨

### ä¸å½¢å¼åŒ–æ–¹æ³•çš„é›†æˆ

- **æ‰€æœ‰æƒæ¨¡å‹**ï¼šè§ [ownership_model.md](../formal_methods/ownership_model.md)ã€‚å†…å­˜åˆ†æä¸­çš„ã€Œç§»åŠ¨/å¤åˆ¶/Dropã€å¯å¯¹ç…§æ‰€æœ‰æƒè§„åˆ™éªŒè¯æ— æ³„æ¼ã€‚
- **å€Ÿç”¨æ£€æŸ¥å™¨**ï¼šè§ [borrow_checker_proof.md](../formal_methods/borrow_checker_proof.md)ã€‚å¼•ç”¨ä¸ç”Ÿå‘½å‘¨æœŸä¸å½±å“å †åˆ†é…é‡ï¼Œä½†å¯é€šè¿‡ Miri ä¸å€Ÿç”¨è§„åˆ™å…±åŒä¿è¯æ—  UBã€‚

### ä¸å®éªŒç ”ç©¶çš„é›†æˆ

- **æ€§èƒ½åŸºå‡†æµ‹è¯•**ï¼šè§ [performance_benchmarks.md](./performance_benchmarks.md)ã€‚å†…å­˜åˆ†é…åŸºå‡†ï¼ˆæ ˆ/å †/é¢„åˆ†é…ï¼‰ä¸æœ¬ç ”ç©¶çš„æ•°æ®æ”¶é›†å¯å…±ç”¨ `cargo bench` ä¸ Criterion è¾“å‡ºã€‚
- **ç¼–è¯‘å™¨ä¼˜åŒ–**ï¼šè§ [compiler_optimizations.md](./compiler_optimizations.md)ã€‚`-C link-dead-code`ã€`opt-level` ä¼šå½±å“å¯æ‰§è¡Œä½“å¤§å°ä¸åˆ†é…å†…è”ï¼Œåˆ†ææ—¶éœ€å›ºå®šç¼–è¯‘é€‰é¡¹ã€‚

### å®é™…åº”ç”¨æ¡ˆä¾‹

- **æœåŠ¡ç«¯**ï¼šç”¨ heaptrack/dhat åšé«˜å³°è´Ÿè½½ä¸‹çš„é©»ç•™ä¸æ³„æ¼å·¡æ£€ï¼›`Arc`/`Weak` ç”¨äºç¼“å­˜ä¸ä¾èµ–å›¾ã€‚
- **åµŒå…¥å¼ / no_std**ï¼šè‡ªå®šä¹‰ `GlobalAlloc` + å›ºå®šæ± ï¼Œç»“åˆ `size_of`/`align_of` åšé™æ€é¢„ç®—ã€‚
- **Rust 1.93**ï¼š`thread_local` åˆ†é…å™¨ã€`MaybeUninit` æ–°æ–¹æ³•å¯æ”¹å˜åˆ†é…çƒ­ç‚¹ï¼Œé‡è·‘å†…å­˜åˆ†æä»¥æ›´æ–°åŸºçº¿ã€‚

---

## ğŸ“– å‚è€ƒæ–‡çŒ®

### å­¦æœ¯è®ºæ–‡

1. **"Memory Safety Without Runtime Overhead"**
   - ä½œè€…: Rust Team
   - æ‘˜è¦: Rust å†…å­˜å®‰å…¨æœºåˆ¶

### å®˜æ–¹æ–‡æ¡£

- [Rust å†…å­˜æ¨¡å‹](https://doc.rust-lang.org/nomicon/)
- [Valgrind æ–‡æ¡£](https://valgrind.org/docs/manual/manual.html)

### å·¥å…·èµ„æº

- [Valgrind](https://valgrind.org/) - å†…å­˜åˆ†æå·¥å…·
- [Miri](https://github.com/rust-lang/miri) - Rust çš„ MIR è§£é‡Šå™¨
- [heaptrack](https://github.com/KDE/heaptrack) - å †å†…å­˜åˆ†æå·¥å…·

---

**ç»´æŠ¤è€…**: Rust Memory Research Team
**æœ€åæ›´æ–°**: 2026-01-26
**çŠ¶æ€**: âœ… **å·²å®Œæˆ** (100%)
