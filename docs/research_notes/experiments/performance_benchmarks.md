# æ€§èƒ½åŸºå‡†æµ‹è¯•

> **åˆ›å»ºæ—¥æœŸ**: 2025-01-27
> **æœ€åæ›´æ–°**: 2025-01-27
> **Rust ç‰ˆæœ¬**: 1.91.0 (Edition 2024) âœ…
> **çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­

---

## ğŸ“Š ç›®å½•

- [æ€§èƒ½åŸºå‡†æµ‹è¯•](#æ€§èƒ½åŸºå‡†æµ‹è¯•)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ ç ”ç©¶ç›®æ ‡](#-ç ”ç©¶ç›®æ ‡)
    - [æ ¸å¿ƒé—®é¢˜](#æ ¸å¿ƒé—®é¢˜)
    - [é¢„æœŸæˆæœ](#é¢„æœŸæˆæœ)
  - [ğŸ“š ç†è®ºåŸºç¡€](#-ç†è®ºåŸºç¡€)
    - [æ€§èƒ½æŒ‡æ ‡](#æ€§èƒ½æŒ‡æ ‡)
    - [åŸºå‡†æµ‹è¯•åŸåˆ™](#åŸºå‡†æµ‹è¯•åŸåˆ™)
    - [ç›¸å…³æ¦‚å¿µ](#ç›¸å…³æ¦‚å¿µ)
    - [ç†è®ºèƒŒæ™¯](#ç†è®ºèƒŒæ™¯)
  - [ğŸ”¬ å®éªŒè®¾è®¡](#-å®éªŒè®¾è®¡)
    - [1. æµ‹è¯•æ¡†æ¶](#1-æµ‹è¯•æ¡†æ¶)
    - [2. æµ‹è¯•åœºæ™¯](#2-æµ‹è¯•åœºæ™¯)
    - [3. æ•°æ®æ”¶é›†](#3-æ•°æ®æ”¶é›†)
  - [ğŸ“Š å®éªŒç»“æœ](#-å®éªŒç»“æœ)
    - [å¾…æµ‹è¯•çš„åœºæ™¯](#å¾…æµ‹è¯•çš„åœºæ™¯)
    - [ç»“æœåˆ†æ](#ç»“æœåˆ†æ)
  - [ğŸ’» ä»£ç ç¤ºä¾‹](#-ä»£ç ç¤ºä¾‹)
    - [ç¤ºä¾‹ 1: åŸºæœ¬åŸºå‡†æµ‹è¯•](#ç¤ºä¾‹-1-åŸºæœ¬åŸºå‡†æµ‹è¯•)
    - [ç¤ºä¾‹ 2: å¯¹æ¯”æµ‹è¯•](#ç¤ºä¾‹-2-å¯¹æ¯”æµ‹è¯•)
    - [ç¤ºä¾‹ 3: å‚æ•°åŒ–æµ‹è¯•](#ç¤ºä¾‹-3-å‚æ•°åŒ–æµ‹è¯•)
  - [ğŸ“– å‚è€ƒæ–‡çŒ®](#-å‚è€ƒæ–‡çŒ®)
    - [å·¥å…·æ–‡æ¡£](#å·¥å…·æ–‡æ¡£)
    - [ç›¸å…³ä»£ç ](#ç›¸å…³ä»£ç )
    - [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
  - [ğŸ”„ ç ”ç©¶è¿›å±•](#-ç ”ç©¶è¿›å±•)
    - [å·²å®Œæˆ âœ…](#å·²å®Œæˆ-)
    - [è¿›è¡Œä¸­ ğŸ”„](#è¿›è¡Œä¸­-)
    - [è®¡åˆ’ä¸­ ğŸ“‹](#è®¡åˆ’ä¸­-)

---

## ğŸ¯ ç ”ç©¶ç›®æ ‡

æœ¬ç ”ç©¶çš„ç›®çš„æ˜¯é€šè¿‡åŸºå‡†æµ‹è¯•è¯„ä¼°ä¸åŒå®ç°çš„æ€§èƒ½ç‰¹å¾ï¼Œä¸ºä¼˜åŒ–æä¾›æ•°æ®æ”¯æŒã€‚

### æ ¸å¿ƒé—®é¢˜

1. **æ€§èƒ½å·®å¼‚**: ä¸åŒå®ç°çš„æ€§èƒ½å·®å¼‚å¦‚ä½•ï¼Ÿ
2. **ç“¶é¢ˆè¯†åˆ«**: å¦‚ä½•è¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Ÿ
3. **ä¼˜åŒ–æ•ˆæœ**: ä¼˜åŒ–çš„æ•ˆæœå¦‚ä½•é‡åŒ–ï¼Ÿ

### é¢„æœŸæˆæœ

- æ€§èƒ½åŸºå‡†æµ‹è¯•æ¡†æ¶
- æ€§èƒ½æ•°æ®å’Œåˆ†ææŠ¥å‘Š
- ä¼˜åŒ–å»ºè®®å’Œå®è·µæŒ‡å—

---

## ğŸ“š ç†è®ºåŸºç¡€

### æ€§èƒ½æŒ‡æ ‡

**æ‰§è¡Œæ—¶é—´ (Execution Time)**: ç¨‹åºæ‰§è¡Œæ‰€éœ€çš„æ—¶é—´ï¼Œé€šå¸¸ä»¥çº³ç§’ã€å¾®ç§’ã€æ¯«ç§’æˆ–ç§’ä¸ºå•ä½ã€‚æ‰§è¡Œæ—¶é—´æ˜¯æ€§èƒ½è¯„ä¼°çš„åŸºæœ¬æŒ‡æ ‡ã€‚

**ååé‡ (Throughput)**: å•ä½æ—¶é—´å†…å¤„ç†çš„æ•°æ®é‡ï¼Œé€šå¸¸ä»¥æ“ä½œ/ç§’ã€å­—èŠ‚/ç§’æˆ–äº‹åŠ¡/ç§’ä¸ºå•ä½ã€‚ååé‡åæ˜ äº†ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚

**å»¶è¿Ÿ (Latency)**: å•ä¸ªæ“ä½œçš„å“åº”æ—¶é—´ï¼Œä»è¯·æ±‚å‘å‡ºåˆ°å“åº”è¿”å›çš„æ—¶é—´ã€‚å»¶è¿Ÿåæ˜ äº†ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚

**èµ„æºä½¿ç”¨ (Resource Usage)**: CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç­‰èµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚èµ„æºä½¿ç”¨åæ˜ äº†ç³»ç»Ÿçš„æ•ˆç‡ã€‚

### åŸºå‡†æµ‹è¯•åŸåˆ™

**å¯é‡å¤æ€§ (Reproducibility)**: åŸºå‡†æµ‹è¯•çš„ç»“æœåº”è¯¥å¯é‡å¤ï¼Œç›¸åŒçš„æµ‹è¯•åº”è¯¥äº§ç”Ÿç›¸ä¼¼çš„ç»“æœã€‚è¿™è¦æ±‚æ§åˆ¶å®éªŒç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚

**ä»£è¡¨æ€§ (Representativeness)**: æµ‹è¯•åº”è¯¥ä»£è¡¨å®é™…ä½¿ç”¨åœºæ™¯ï¼Œæµ‹è¯•æ•°æ®å’Œå·¥ä½œè´Ÿè½½åº”è¯¥åæ˜ çœŸå®çš„ä½¿ç”¨æƒ…å†µã€‚

**å…¬å¹³æ€§ (Fairness)**: æµ‹è¯•åº”è¯¥å…¬å¹³æ¯”è¾ƒä¸åŒå®ç°ï¼Œç¡®ä¿æ‰€æœ‰å®ç°éƒ½åœ¨ç›¸åŒçš„æ¡ä»¶ä¸‹æµ‹è¯•ã€‚

**ç»Ÿè®¡æœ‰æ•ˆæ€§ (Statistical Validity)**: ä½¿ç”¨ç»Ÿè®¡æ–¹æ³•åˆ†æç»“æœï¼Œç¡®ä¿ç»“æœçš„å¯é æ€§å’Œæœ‰æ•ˆæ€§ã€‚

### ç›¸å…³æ¦‚å¿µ

**åŸºå‡†æµ‹è¯• (Benchmarking)**: é€šè¿‡è¿è¡Œæ ‡å‡†åŒ–çš„æµ‹è¯•æ¥è¯„ä¼°ç³»ç»Ÿæ€§èƒ½çš„è¿‡ç¨‹ã€‚åŸºå‡†æµ‹è¯•æä¾›äº†æ€§èƒ½è¯„ä¼°çš„å®¢è§‚æ ‡å‡†ã€‚

**æ€§èƒ½åˆ†æ (Performance Profiling)**: é€šè¿‡åˆ†æç¨‹åºæ‰§è¡Œæ¥è¯†åˆ«æ€§èƒ½ç“¶é¢ˆçš„è¿‡ç¨‹ã€‚æ€§èƒ½åˆ†æå¸®åŠ©ç†è§£ç¨‹åºçš„æ€§èƒ½ç‰¹å¾ã€‚

**æ€§èƒ½ä¼˜åŒ– (Performance Optimization)**: é€šè¿‡æ”¹è¿›ä»£ç ã€ç®—æ³•æˆ–ç³»ç»Ÿé…ç½®æ¥æé«˜æ€§èƒ½çš„è¿‡ç¨‹ã€‚æ€§èƒ½ä¼˜åŒ–åŸºäºæ€§èƒ½åˆ†æçš„ç»“æœã€‚

**ç»Ÿè®¡æ–¹æ³• (Statistical Methods)**: ä½¿ç”¨ç»Ÿè®¡å­¦æ–¹æ³•åˆ†ææ€§èƒ½æ•°æ®ï¼ŒåŒ…æ‹¬å‡å€¼ã€ä¸­ä½æ•°ã€æ ‡å‡†å·®ã€ç½®ä¿¡åŒºé—´ç­‰ã€‚

**é»‘ç›’æµ‹è¯• (Black Box Testing)**: ä¸å…³å¿ƒå†…éƒ¨å®ç°ï¼Œåªå…³æ³¨è¾“å…¥å’Œè¾“å‡ºçš„æµ‹è¯•æ–¹æ³•ã€‚åŸºå‡†æµ‹è¯•é€šå¸¸æ˜¯é»‘ç›’æµ‹è¯•ã€‚

**ç™½ç›’æµ‹è¯• (White Box Testing)**: äº†è§£å†…éƒ¨å®ç°ï¼Œå¯ä»¥é’ˆå¯¹ç‰¹å®šå®ç°ç»†èŠ‚è¿›è¡Œæµ‹è¯•çš„æ–¹æ³•ã€‚

**å¾®åŸºå‡†æµ‹è¯• (Microbenchmarking)**: æµ‹è¯•å°è§„æ¨¡ã€ç‰¹å®šæ“ä½œçš„æ€§èƒ½ã€‚å¾®åŸºå‡†æµ‹è¯•ç”¨äºè¯„ä¼°ç‰¹å®šæ“ä½œçš„æ€§èƒ½ã€‚

**å®åŸºå‡†æµ‹è¯• (Macrobenchmarking)**: æµ‹è¯•æ•´ä¸ªç³»ç»Ÿæˆ–å¤§å‹ç»„ä»¶çš„æ€§èƒ½ã€‚å®åŸºå‡†æµ‹è¯•ç”¨äºè¯„ä¼°æ•´ä½“æ€§èƒ½ã€‚

### ç†è®ºèƒŒæ™¯

**æ€§èƒ½å·¥ç¨‹ (Performance Engineering)**: ç³»ç»ŸåŒ–çš„æ€§èƒ½è¯„ä¼°å’Œä¼˜åŒ–æ–¹æ³•ã€‚æ€§èƒ½å·¥ç¨‹åŒ…æ‹¬æ€§èƒ½å»ºæ¨¡ã€æµ‹è¯•ã€åˆ†æå’Œä¼˜åŒ–ã€‚

**ç»Ÿè®¡æ¨æ–­ (Statistical Inference)**: ä½¿ç”¨ç»Ÿè®¡æ–¹æ³•ä»æ ·æœ¬æ•°æ®æ¨æ–­æ€»ä½“ç‰¹å¾ã€‚åŸºå‡†æµ‹è¯•ä½¿ç”¨ç»Ÿè®¡æ¨æ–­æ¥è¯„ä¼°æ€§èƒ½ã€‚

**å®éªŒè®¾è®¡ (Experimental Design)**: è®¾è®¡å®éªŒæ–¹æ¡ˆä»¥è·å–å¯é å’Œæœ‰æ•ˆçš„å®éªŒç»“æœã€‚åŸºå‡†æµ‹è¯•éœ€è¦è‰¯å¥½çš„å®éªŒè®¾è®¡ã€‚

**æµ‹é‡ç†è®º (Measurement Theory)**: ç ”ç©¶å¦‚ä½•å‡†ç¡®æµ‹é‡ç‰©ç†é‡çš„ç†è®ºã€‚æ€§èƒ½æµ‹é‡éœ€è¦éµå¾ªæµ‹é‡ç†è®ºçš„åŸåˆ™ã€‚

---

## ğŸ”¬ å®éªŒè®¾è®¡

### 1. æµ‹è¯•æ¡†æ¶

ä½¿ç”¨ Criterion.rs ä½œä¸ºåŸºå‡†æµ‹è¯•æ¡†æ¶ï¼š

```rust
use criterion::{black_box, criterion_group, criterion_main, Criterion};

fn benchmark_function(c: &mut Criterion) {
    c.bench_function("function_name", |b| {
        b.iter(|| {
            // è¢«æµ‹è¯•çš„ä»£ç 
            black_box(function_to_test())
        })
    });
}

criterion_group!(benches, benchmark_function);
criterion_main!(benches);
```

### 2. æµ‹è¯•åœºæ™¯

- **å°æ•°æ®**: æµ‹è¯•å°è§„æ¨¡æ•°æ®çš„æ€§èƒ½
- **å¤§æ•°æ®**: æµ‹è¯•å¤§è§„æ¨¡æ•°æ®çš„æ€§èƒ½
- **è¾¹ç•Œæƒ…å†µ**: æµ‹è¯•è¾¹ç•Œæƒ…å†µçš„æ€§èƒ½
- **å…¸å‹åœºæ™¯**: æµ‹è¯•å…¸å‹ä½¿ç”¨åœºæ™¯çš„æ€§èƒ½

### 3. æ•°æ®æ”¶é›†

- **å¤šæ¬¡è¿è¡Œ**: æ¯ä¸ªæµ‹è¯•è¿è¡Œå¤šæ¬¡å–å¹³å‡å€¼
- **ç»Ÿè®¡æ–¹æ³•**: ä½¿ç”¨ç»Ÿè®¡æ–¹æ³•åˆ†æç»“æœ
- **ç¯å¢ƒæ§åˆ¶**: æ§åˆ¶å®éªŒç¯å¢ƒçš„ä¸€è‡´æ€§

---

## ğŸ“Š å®éªŒç»“æœ

### å¾…æµ‹è¯•çš„åœºæ™¯

1. **æ•°æ®ç»“æ„æ€§èƒ½**: ä¸åŒæ•°æ®ç»“æ„çš„æ€§èƒ½æ¯”è¾ƒ
2. **ç®—æ³•æ€§èƒ½**: ä¸åŒç®—æ³•çš„æ€§èƒ½æ¯”è¾ƒ
3. **å¹¶å‘æ€§èƒ½**: ä¸åŒå¹¶å‘æ¨¡å‹çš„æ€§èƒ½æ¯”è¾ƒ
4. **å†…å­˜åˆ†é…**: ä¸åŒå†…å­˜åˆ†é…ç­–ç•¥çš„æ€§èƒ½æ¯”è¾ƒ

### ç»“æœåˆ†æ

- **æ€§èƒ½å¯¹æ¯”**: å¯¹æ¯”ä¸åŒå®ç°çš„æ€§èƒ½
- **ç“¶é¢ˆè¯†åˆ«**: è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
- **ä¼˜åŒ–å»ºè®®**: æä¾›ä¼˜åŒ–å»ºè®®

---

## ğŸ’» ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1: åŸºæœ¬åŸºå‡†æµ‹è¯•

```rust
use criterion::{black_box, criterion_group, criterion_main, Criterion};

fn fibonacci(n: u64) -> u64 {
    match n {
        0 => 0,
        1 => 1,
        n => fibonacci(n - 1) + fibonacci(n - 2),
    }
}

fn benchmark_fibonacci(c: &mut Criterion) {
    c.bench_function("fibonacci 20", |b| {
        b.iter(|| fibonacci(black_box(20)))
    });
}

criterion_group!(benches, benchmark_fibonacci);
criterion_main!(benches);
```

### ç¤ºä¾‹ 2: å¯¹æ¯”æµ‹è¯•

```rust
use criterion::{black_box, criterion_group, criterion_main, Criterion};

fn vec_sum(vec: &[i32]) -> i32 {
    vec.iter().sum()
}

fn vec_sum_fold(vec: &[i32]) -> i32 {
    vec.iter().fold(0, |acc, x| acc + x)
}

fn benchmark_comparison(c: &mut Criterion) {
    let data: Vec<i32> = (0..1000).collect();

    c.bench_function("sum", |b| {
        b.iter(|| vec_sum(black_box(&data)))
    });

    c.bench_function("fold", |b| {
        b.iter(|| vec_sum_fold(black_box(&data)))
    });
}

criterion_group!(benches, benchmark_comparison);
criterion_main!(benches);
```

### ç¤ºä¾‹ 3: å‚æ•°åŒ–æµ‹è¯•

```rust
use criterion::{black_box, criterion_group, criterion_main, Criterion, PlotConfiguration};

fn benchmark_with_size(c: &mut Criterion) {
    let plot_config = PlotConfiguration::default().summary_scale(criterion::AxisScale::Logarithmic);

    let mut group = c.benchmark_group("vector_operations");
    group.plot_config(plot_config);

    for size in [10, 100, 1000, 10000].iter() {
        let data: Vec<i32> = (0..*size).collect();

        group.bench_with_input(
            criterion::BenchmarkId::new("sum", size),
            &data,
            |b, data| b.iter(|| vec_sum(black_box(data))),
        );
    }

    group.finish();
}

criterion_group!(benches, benchmark_with_size);
criterion_main!(benches);
```

---

## ğŸ“– å‚è€ƒæ–‡çŒ®

### å·¥å…·æ–‡æ¡£

- [Criterion.rs æ–‡æ¡£](https://docs.rs/criterion/)
- [Rust åŸºå‡†æµ‹è¯•æŒ‡å—](https://doc.rust-lang.org/unstable-book/library-features/test.html)
- [æ€§èƒ½åˆ†æå·¥å…·](https://doc.rust-lang.org/book/ch14-06-performance.html)

### ç›¸å…³ä»£ç 

- [åŸºå‡†æµ‹è¯•æ¡†æ¶](../../../crates/c08_algorithms/benches/)
- [æ€§èƒ½åˆ†æå·¥å…·](../../../crates/c06_async/benches/)
- [ç®—æ³•å®ç°](../../../crates/c08_algorithms/src/)

### æœ€ä½³å®è·µ

- [Rust æ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://nnethercote.github.io/perf-book/)
- [æ€§èƒ½æµ‹è¯•æœ€ä½³å®è·µ](https://github.com/bheisler/criterion.rs/blob/master/book/src/user_guide/best_practices.md)

---

## ğŸ”„ ç ”ç©¶è¿›å±•

### å·²å®Œæˆ âœ…

- [x] ç ”ç©¶ç›®æ ‡å®šä¹‰
- [x] ç†è®ºåŸºç¡€æ•´ç†ï¼ˆåŒ…æ‹¬ç†è®ºèƒŒæ™¯å’Œç›¸å…³æ¦‚å¿µï¼‰
- [x] å®éªŒè®¾è®¡æ¡†æ¶
- [x] åŸºæœ¬ä»£ç ç¤ºä¾‹

### è¿›è¡Œä¸­ ğŸ”„

- [ ] å…·ä½“å®éªŒè®¾è®¡
- [ ] æ•°æ®æ”¶é›†
- [ ] ç»“æœåˆ†æ

### è®¡åˆ’ä¸­ ğŸ“‹

- [ ] æ€§èƒ½ä¼˜åŒ–å»ºè®®
- [ ] å®é™…åº”ç”¨æ¡ˆä¾‹
- [ ] å·¥å…·æ”¹è¿›

---

**ç»´æŠ¤è€…**: Rust Performance Research Group
**æœ€åæ›´æ–°**: 2025-01-27
**çŠ¶æ€**: ğŸ”„ **è¿›è¡Œä¸­**
