# å…±äº«å†…å­˜æ¨¡å‹

> **åˆ›å»ºæ—¥æœŸ**: 2025-11-11
> **æœ€åæ›´æ–°**: 2025-11-11
> **Rust ç‰ˆæœ¬**: 1.91.0 (Edition 2024) âœ…
> **çŠ¶æ€**: å·²å®Œå–„ âœ…

---

## ğŸ“Š ç›®å½•

- [å…±äº«å†…å­˜æ¨¡å‹](#å…±äº«å†…å­˜æ¨¡å‹)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [1. å½¢å¼åŒ–å®šä¹‰](#1-å½¢å¼åŒ–å®šä¹‰)
    - [1.1 å…±äº«å†…å­˜çš„å½¢å¼åŒ–å®šä¹‰](#11-å…±äº«å†…å­˜çš„å½¢å¼åŒ–å®šä¹‰)
    - [1.2 å…±äº«è®¿é—®çš„å½¢å¼åŒ–å®šä¹‰](#12-å…±äº«è®¿é—®çš„å½¢å¼åŒ–å®šä¹‰)
    - [1.3 å…±äº«å†…å­˜æ¨¡å‹çš„å½¢å¼åŒ–è¯­ä¹‰](#13-å…±äº«å†…å­˜æ¨¡å‹çš„å½¢å¼åŒ–è¯­ä¹‰)
  - [2. æ ¸å¿ƒå®šç†ä¸è¯æ˜](#2-æ ¸å¿ƒå®šç†ä¸è¯æ˜)
    - [2.1 å®šç†1ï¼šæ•°æ®ç«äº‰é¢„é˜²](#21-å®šç†1æ•°æ®ç«äº‰é¢„é˜²)
    - [2.2 å®šç†2ï¼šå†…å­˜å®‰å…¨ä¿è¯](#22-å®šç†2å†…å­˜å®‰å…¨ä¿è¯)
    - [2.3 å®šç†3ï¼šåŒæ­¥åŸè¯­çš„æ­£ç¡®æ€§](#23-å®šç†3åŒæ­¥åŸè¯­çš„æ­£ç¡®æ€§)
  - [3. å…±äº«å†…å­˜çš„ä¿æŠ¤æœºåˆ¶](#3-å…±äº«å†…å­˜çš„ä¿æŠ¤æœºåˆ¶)
    - [3.1 äº’æ–¥é”ä¿æŠ¤](#31-äº’æ–¥é”ä¿æŠ¤)
    - [3.2 è¯»å†™é”ä¿æŠ¤](#32-è¯»å†™é”ä¿æŠ¤)
    - [3.3 åŸå­æ“ä½œä¿æŠ¤](#33-åŸå­æ“ä½œä¿æŠ¤)
  - [4. å…±äº«å†…å­˜çš„æ€§èƒ½ä¼˜åŒ–](#4-å…±äº«å†…å­˜çš„æ€§èƒ½ä¼˜åŒ–)
    - [4.1 å‡å°‘å…±äº«](#41-å‡å°‘å…±äº«)
    - [4.2 ç»†ç²’åº¦é”](#42-ç»†ç²’åº¦é”)
    - [4.3 æ— é”æ•°æ®ç»“æ„](#43-æ— é”æ•°æ®ç»“æ„)
  - [5. å·¥ç¨‹æ¡ˆä¾‹](#5-å·¥ç¨‹æ¡ˆä¾‹)
  - [6. åä¾‹ä¸è¾¹ç•Œ](#6-åä¾‹ä¸è¾¹ç•Œ)
  - [7. æœªæ¥è¶‹åŠ¿](#7-æœªæ¥è¶‹åŠ¿)

---

## 1. å½¢å¼åŒ–å®šä¹‰

### 1.1 å…±äº«å†…å­˜çš„å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 1.1ï¼ˆå…±äº«å†…å­˜ï¼‰**ï¼šå…±äº«å†…å­˜æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®çš„åŒä¸€å—å†…å­˜åŒºåŸŸã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{SharedMemory}(M, T) = \{\text{access}(t, m) \mid t \in T, m \in M\}
$$

å…¶ä¸­ï¼š
- $M$ æ˜¯å†…å­˜åŒºåŸŸé›†åˆ
- $T$ æ˜¯çº¿ç¨‹é›†åˆ
- $\text{access}(t, m)$ è¡¨ç¤ºçº¿ç¨‹ $t$ è®¿é—®å†…å­˜ $m$

**å®šä¹‰ 1.2ï¼ˆå…±äº«çŠ¶æ€ï¼‰**ï¼šå…±äº«çŠ¶æ€æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®çš„çŠ¶æ€ã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{SharedState}(s) \iff \exists t_1, t_2, t_1 \neq t_2: \text{accessible}(s, t_1) \land \text{accessible}(s, t_2)
$$

### 1.2 å…±äº«è®¿é—®çš„å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 1.3ï¼ˆå…±äº«è®¿é—®ï¼‰**ï¼šå…±äº«è®¿é—®æ˜¯å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€å†…å­˜ä½ç½®çš„è®¿é—®ã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{SharedAccess}(m, T) \iff |T| > 1 \land \forall t \in T: \text{access}(t, m)
$$

**è®¿é—®ç±»å‹**ï¼š

1. **è¯»å–è®¿é—®**ï¼š$\text{read}(t, m)$
2. **å†™å…¥è®¿é—®**ï¼š$\text{write}(t, m)$
3. **è¯»å†™è®¿é—®**ï¼š$\text{read}(t, m) \land \text{write}(t, m)$

### 1.3 å…±äº«å†…å­˜æ¨¡å‹çš„å½¢å¼åŒ–è¯­ä¹‰

**å®šä¹‰ 1.4ï¼ˆå…±äº«å†…å­˜è¯­ä¹‰ï¼‰**ï¼šå…±äº«å†…å­˜æ¨¡å‹ $S$ çš„è¯­ä¹‰æ˜¯è®¿é—®æ“ä½œçš„çº¦æŸã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{Semantic}(S) = \{\text{access} \mid \text{access} \text{ satisfies } S\}
$$

---

## 2. æ ¸å¿ƒå®šç†ä¸è¯æ˜

### 2.1 å®šç†1ï¼šæ•°æ®ç«äº‰é¢„é˜²

**å®šç† 2.1ï¼ˆæ•°æ®ç«äº‰é¢„é˜²ï¼‰**ï¼šå¦‚æœæ‰€æœ‰å…±äº«å†…å­˜è®¿é—®éƒ½å—åŒæ­¥åŸè¯­ä¿æŠ¤ï¼Œåˆ™ç³»ç»Ÿæ— æ•°æ®ç«äº‰ã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\forall m \in \text{SharedMemory}, \forall t_1, t_2: \text{protected}(m, t_1, t_2) \implies \neg \text{data\_race}(m, t_1, t_2)
$$

**è¯¦ç»†è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šæ•°æ®ç«äº‰çš„å®šä¹‰

æ•°æ®ç«äº‰éœ€è¦ï¼š
- ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å†…å­˜ä½ç½®
- è‡³å°‘æœ‰ä¸€ä¸ªè®¿é—®æ˜¯å†™æ“ä½œ
- æ²¡æœ‰åŒæ­¥æœºåˆ¶

#### æ­¥éª¤2ï¼šåŒæ­¥åŸè¯­çš„ä¿æŠ¤

å¦‚æœæ‰€æœ‰å…±äº«å†…å­˜è®¿é—®éƒ½å—åŒæ­¥åŸè¯­ä¿æŠ¤ï¼š
- äº’æ–¥é”ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®
- è¯»å†™é”ç¡®ä¿è¯»å¤šå†™å°‘çš„è®¿é—®æ¨¡å¼
- åŸå­æ“ä½œç¡®ä¿æ“ä½œçš„åŸå­æ€§

#### æ­¥éª¤3ï¼šæ•°æ®ç«äº‰é¢„é˜²

ç”±äºåŒæ­¥åŸè¯­çš„ä¿æŠ¤ï¼š
- ä¸¤ä¸ªçº¿ç¨‹ä¸èƒ½åŒæ—¶è¿›è¡Œå†²çªçš„è®¿é—®
- å› æ­¤ï¼Œä¸å­˜åœ¨æ•°æ®ç«äº‰

**ç»“è®º**ï¼šå¦‚æœæ‰€æœ‰å…±äº«å†…å­˜è®¿é—®éƒ½å—åŒæ­¥åŸè¯­ä¿æŠ¤ï¼Œåˆ™ç³»ç»Ÿæ— æ•°æ®ç«äº‰ã€‚$\square$

### 2.2 å®šç†2ï¼šå†…å­˜å®‰å…¨ä¿è¯

**å®šç† 2.2ï¼ˆå†…å­˜å®‰å…¨ä¿è¯ï¼‰**ï¼šRustçš„ç±»å‹ç³»ç»Ÿå’Œæ‰€æœ‰æƒæ¨¡å‹ä¿è¯å…±äº«å†…å­˜çš„å†…å­˜å®‰å…¨ã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{type\_safe}(P) \land \text{ownership\_safe}(P) \implies \text{memory\_safe}(P)
$$

**è¯¦ç»†è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šç±»å‹å®‰å…¨

æ ¹æ®Rustçš„ç±»å‹ç³»ç»Ÿï¼š
- ç±»å‹ç³»ç»Ÿé˜²æ­¢ç±»å‹é”™è¯¯
- ç±»å‹ç³»ç»Ÿé˜²æ­¢æœªå®šä¹‰è¡Œä¸º
- å› æ­¤ï¼Œç±»å‹å®‰å…¨å¾—åˆ°ä¿è¯

#### æ­¥éª¤2ï¼šæ‰€æœ‰æƒå®‰å…¨

æ ¹æ®Rustçš„æ‰€æœ‰æƒæ¨¡å‹ï¼š
- æ‰€æœ‰æƒç³»ç»Ÿé˜²æ­¢æ‚¬å‚æŒ‡é’ˆ
- æ‰€æœ‰æƒç³»ç»Ÿé˜²æ­¢åŒé‡é‡Šæ”¾
- å› æ­¤ï¼Œæ‰€æœ‰æƒå®‰å…¨å¾—åˆ°ä¿è¯

#### æ­¥éª¤3ï¼šå†…å­˜å®‰å…¨

ç”±äºç±»å‹å®‰å…¨å’Œæ‰€æœ‰æƒå®‰å…¨ï¼š
- ä¸å­˜åœ¨æ‚¬å‚æŒ‡é’ˆ
- ä¸å­˜åœ¨å†…å­˜æ³„æ¼
- ä¸å­˜åœ¨ç¼“å†²åŒºæº¢å‡º
- å› æ­¤ï¼Œå†…å­˜å®‰å…¨å¾—åˆ°ä¿è¯

**ç»“è®º**ï¼šRustçš„ç±»å‹ç³»ç»Ÿå’Œæ‰€æœ‰æƒæ¨¡å‹ä¿è¯å…±äº«å†…å­˜çš„å†…å­˜å®‰å…¨ã€‚$\square$

### 2.3 å®šç†3ï¼šåŒæ­¥åŸè¯­çš„æ­£ç¡®æ€§

**å®šç† 2.3ï¼ˆåŒæ­¥åŸè¯­çš„æ­£ç¡®æ€§ï¼‰**ï¼šæ­£ç¡®ä½¿ç”¨çš„åŒæ­¥åŸè¯­ä¿è¯å…±äº«å†…å­˜è®¿é—®çš„æ­£ç¡®æ€§ã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{correct\_use}(\text{SyncPrimitive}) \implies \text{correct}(\text{SharedAccess})
$$

**è¯¦ç»†è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šåŒæ­¥åŸè¯­çš„å®šä¹‰

åŒæ­¥åŸè¯­æä¾›ï¼š
- äº’æ–¥è®¿é—®ï¼ˆMutexï¼‰
- å…±äº«è¯»/ç‹¬å å†™ï¼ˆRwLockï¼‰
- åŸå­æ“ä½œï¼ˆAtomicï¼‰

#### æ­¥éª¤2ï¼šæ­£ç¡®ä½¿ç”¨çš„æ¡ä»¶

æ­£ç¡®ä½¿ç”¨åŒæ­¥åŸè¯­éœ€è¦ï¼š
- æ‰€æœ‰å…±äº«è®¿é—®éƒ½å—ä¿æŠ¤
- é”çš„è·å–å’Œé‡Šæ”¾é…å¯¹
- é¿å…æ­»é”

#### æ­¥éª¤3ï¼šæ­£ç¡®æ€§ä¿è¯

ç”±äºåŒæ­¥åŸè¯­çš„æ­£ç¡®ä½¿ç”¨ï¼š
- å…±äº«è®¿é—®æ˜¯å®‰å…¨çš„
- ä¸å­˜åœ¨æ•°æ®ç«äº‰
- ä¸å­˜åœ¨æ­»é”
- å› æ­¤ï¼Œæ­£ç¡®æ€§å¾—åˆ°ä¿è¯

**ç»“è®º**ï¼šæ­£ç¡®ä½¿ç”¨çš„åŒæ­¥åŸè¯­ä¿è¯å…±äº«å†…å­˜è®¿é—®çš„æ­£ç¡®æ€§ã€‚$\square$

---

## 3. å…±äº«å†…å­˜çš„ä¿æŠ¤æœºåˆ¶

### 3.1 äº’æ–¥é”ä¿æŠ¤

**å®šä¹‰ 3.1ï¼ˆäº’æ–¥é”ä¿æŠ¤ï¼‰**ï¼šäº’æ–¥é”ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å…±äº«å†…å­˜ã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{MutexProtection}(m, M) \iff \forall t_1, t_2: \text{access}(t_1, m) \land \text{access}(t_2, m) \implies t_1 = t_2
$$

**ç¤ºä¾‹**ï¼š

```rust
use std::sync::{Arc, Mutex};
use std::thread;

fn mutex_protection_example() {
    let data = Arc::new(Mutex::new(0));
    let mut handles = vec![];

    for _ in 0..10 {
        let data_clone = Arc::clone(&data);
        let handle = thread::spawn(move || {
            let mut num = data_clone.lock().unwrap();
            *num += 1;
        });
        handles.push(handle);
    }

    for handle in handles {
        handle.join().unwrap();
    }
}
```

### 3.2 è¯»å†™é”ä¿æŠ¤

**å®šä¹‰ 3.2ï¼ˆè¯»å†™é”ä¿æŠ¤ï¼‰**ï¼šè¯»å†™é”å…è®¸å¤šä¸ªè¯»å–è€…æˆ–ä¸€ä¸ªå†™å…¥è€…ã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{RwLockProtection}(m, RW) \iff (\text{MultipleReaders}(m, RW) \lor \text{SingleWriter}(m, RW)) \land \neg (\text{HasReaders}(m, RW) \land \text{HasWriter}(m, RW))
$$

**ç¤ºä¾‹**ï¼š

```rust
use std::sync::{Arc, RwLock};
use std::thread;

fn rwlock_protection_example() {
    let data = Arc::new(RwLock::new(vec![1, 2, 3]));

    // å¤šä¸ªè¯»å–çº¿ç¨‹
    for _ in 0..5 {
        let data_clone = Arc::clone(&data);
        thread::spawn(move || {
            let data = data_clone.read().unwrap();
            println!("Read: {:?}", *data);
        });
    }

    // ä¸€ä¸ªå†™å…¥çº¿ç¨‹
    let data_clone = Arc::clone(&data);
    thread::spawn(move || {
        let mut data = data_clone.write().unwrap();
        data.push(4);
    });
}
```

### 3.3 åŸå­æ“ä½œä¿æŠ¤

**å®šä¹‰ 3.3ï¼ˆåŸå­æ“ä½œä¿æŠ¤ï¼‰**ï¼šåŸå­æ“ä½œæä¾›æ— é”çš„å…±äº«è®¿é—®ã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{AtomicProtection}(m, A) \iff \forall \text{op} \in A: \text{atomic}(\text{op}) \land \text{safe}(\text{op})
$$

**ç¤ºä¾‹**ï¼š

```rust
use std::sync::atomic::{AtomicUsize, Ordering};
use std::thread;

fn atomic_protection_example() {
    let counter = AtomicUsize::new(0);
    let mut handles = vec![];

    for _ in 0..10 {
        let counter_clone = &counter;
        let handle = thread::spawn(move || {
            counter_clone.fetch_add(1, Ordering::SeqCst);
        });
        handles.push(handle);
    }

    for handle in handles {
        handle.join().unwrap();
    }
}
```

---

## 4. å…±äº«å†…å­˜çš„æ€§èƒ½ä¼˜åŒ–

### 4.1 å‡å°‘å…±äº«

**ç­–ç•¥**ï¼šæœ€å°åŒ–å…±äº«çŠ¶æ€çš„ä½œç”¨åŸŸã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{minimize}(\text{SharedState}) \implies \text{reduce}(\text{Contention})
$$

**æ–¹æ³•**ï¼š

1. **å±€éƒ¨åŒ–æ•°æ®**ï¼šå°†æ•°æ®å±€éƒ¨åŒ–åˆ°å•ä¸ªçº¿ç¨‹
2. **å‡å°‘å…±äº«åŒºåŸŸ**ï¼šæœ€å°åŒ–å…±äº«å†…å­˜åŒºåŸŸ
3. **ä½¿ç”¨æ¶ˆæ¯ä¼ é€’**ï¼šä¼˜å…ˆä½¿ç”¨æ¶ˆæ¯ä¼ é€’è€Œéå…±äº«å†…å­˜

### 4.2 ç»†ç²’åº¦é”

**ç­–ç•¥**ï¼šä½¿ç”¨ç»†ç²’åº¦é”å‡å°‘é”ç«äº‰ã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{fine\_grained}(\text{Locks}) \implies \text{reduce}(\text{LockContention})
$$

**æ–¹æ³•**ï¼š

1. **é”åˆ†æ®µ**ï¼šå°†æ•°æ®åˆ†æˆå¤šä¸ªæ®µï¼Œæ¯ä¸ªæ®µæœ‰è‡ªå·±çš„é”
2. **è¯»å†™åˆ†ç¦»**ï¼šä½¿ç”¨è¯»å†™é”åˆ†ç¦»è¯»å†™æ“ä½œ
3. **é”ç²’åº¦ä¼˜åŒ–**ï¼šæ ¹æ®è®¿é—®æ¨¡å¼ä¼˜åŒ–é”ç²’åº¦

### 4.3 æ— é”æ•°æ®ç»“æ„

**ç­–ç•¥**ï¼šä½¿ç”¨æ— é”æ•°æ®ç»“æ„é¿å…é”ç«äº‰ã€‚

å½¢å¼åŒ–è¡¨ç¤ºä¸ºï¼š
$$
\text{lock\_free}(\text{DataStructure}) \implies \text{eliminate}(\text{LockContention})
$$

**æ–¹æ³•**ï¼š

1. **åŸå­æ“ä½œ**ï¼šä½¿ç”¨åŸå­æ“ä½œå®ç°æ— é”æ•°æ®ç»“æ„
2. **CASæ“ä½œ**ï¼šä½¿ç”¨CASæ“ä½œå®ç°æ— é”ç®—æ³•
3. **å†…å­˜åº**ï¼šæ­£ç¡®ä½¿ç”¨å†…å­˜åºä¿è¯å¯è§æ€§

---

## 5. å·¥ç¨‹æ¡ˆä¾‹

### 5.1 å…±äº«è®¡æ•°å™¨çš„å®ç°

```rust
use std::sync::{Arc, Mutex};
use std::thread;

fn shared_counter_example() {
    let counter = Arc::new(Mutex::new(0));
    let mut handles = vec![];

    for _ in 0..10 {
        let counter_clone = Arc::clone(&counter);
        let handle = thread::spawn(move || {
            for _ in 0..100 {
                let mut num = counter_clone.lock().unwrap();
                *num += 1;
            }
        });
        handles.push(handle);
    }

    for handle in handles {
        handle.join().unwrap();
    }

    println!("Final count: {}", *counter.lock().unwrap());
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- å…±äº«å†…å­˜ï¼š`Arc<Mutex<T>>` æä¾›å…±äº«å†…å­˜è®¿é—®
- äº’æ–¥ä¿æŠ¤ï¼š`Mutex` ç¡®ä¿äº’æ–¥è®¿é—®
- å®‰å…¨æ€§ï¼šäº’æ–¥é”ä¿è¯æ— æ•°æ®ç«äº‰

### 5.2 æ— é”é˜Ÿåˆ—çš„å®ç°

```rust
use crossbeam_queue::ArrayQueue;
use std::thread;

fn lockfree_queue_example() {
    let queue = ArrayQueue::new(100);

    // ç”Ÿäº§è€…çº¿ç¨‹
    for i in 0..10 {
        let queue_clone = &queue;
        thread::spawn(move || {
            for j in 0..10 {
                queue_clone.push(i * 10 + j).unwrap();
            }
        });
    }

    // æ¶ˆè´¹è€…çº¿ç¨‹
    for _ in 0..5 {
        let queue_clone = &queue;
        thread::spawn(move || {
            while let Some(item) = queue_clone.pop() {
                println!("Processed: {}", item);
            }
        });
    }
}
```

**å½¢å¼åŒ–åˆ†æ**ï¼š

- æ— é”è®¾è®¡ï¼šä½¿ç”¨åŸå­æ“ä½œå®ç°æ— é”é˜Ÿåˆ—
- æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…é”ç«äº‰ï¼Œæé«˜æ€§èƒ½
- å®‰å…¨æ€§ï¼šåŸå­æ“ä½œä¿è¯æ“ä½œçš„åŸå­æ€§

---

## 6. åä¾‹ä¸è¾¹ç•Œ

### 6.1 å…¸å‹åä¾‹

#### åä¾‹1ï¼šæœªä¿æŠ¤çš„å…±äº«è®¿é—®

```rust
// é—®é¢˜ï¼šæœªä¿æŠ¤çš„å…±äº«è®¿é—®å¯¼è‡´æ•°æ®ç«äº‰
let mut data = vec![1, 2, 3];

thread::spawn(move || {
    data.push(4);  // æ•°æ®ç«äº‰
});

thread::spawn(move || {
    data.push(5);  // æ•°æ®ç«äº‰
});
```

#### åä¾‹2ï¼šæ­»é”

```rust
// é—®é¢˜ï¼šé”çš„é¡ºåºä¸ä¸€è‡´å¯¼è‡´æ­»é”
let lock1 = Arc::new(Mutex::new(0));
let lock2 = Arc::new(Mutex::new(0));

let lock1_clone = Arc::clone(&lock1);
let lock2_clone = Arc::clone(&lock2);

thread::spawn(move || {
    let _guard1 = lock1_clone.lock().unwrap();
    let _guard2 = lock2_clone.lock().unwrap();
});

let lock1_clone2 = Arc::clone(&lock1);
let lock2_clone2 = Arc::clone(&lock2);

thread::spawn(move || {
    let _guard2 = lock2_clone2.lock().unwrap();  // ä¸åŒçš„é”é¡ºåº
    let _guard1 = lock1_clone2.lock().unwrap();  // å¯èƒ½å¯¼è‡´æ­»é”
});
```

#### åä¾‹3ï¼šé”ç«äº‰

```rust
// é—®é¢˜ï¼šç²—ç²’åº¦é”å¯¼è‡´é”ç«äº‰
let data = Arc::new(Mutex::new(HashMap::new()));

// æ‰€æœ‰æ“ä½œéƒ½éœ€è¦è·å–åŒä¸€ä¸ªé”
for i in 0..100 {
    let data_clone = Arc::clone(&data);
    thread::spawn(move || {
        let mut map = data_clone.lock().unwrap();  // é”ç«äº‰
        map.insert(i, i * 2);
    });
}
```

### 6.2 å·¥ç¨‹ç»éªŒ

1. **æœ€å°åŒ–å…±äº«**ï¼šå°½å¯èƒ½å‡å°‘å…±äº«çŠ¶æ€
2. **æ­£ç¡®ä½¿ç”¨é”**ï¼šç¡®ä¿é”çš„è·å–å’Œé‡Šæ”¾é…å¯¹
3. **é¿å…æ­»é”**ï¼šä½¿ç”¨ä¸€è‡´çš„é”é¡ºåº
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨ç»†ç²’åº¦é”æˆ–æ— é”æ•°æ®ç»“æ„

---

## 7. æœªæ¥è¶‹åŠ¿

1. **æ›´æ™ºèƒ½çš„åŒæ­¥åŸè¯­**ï¼šå¼€å‘æ›´æ™ºèƒ½çš„åŒæ­¥åŸè¯­
2. **è‡ªåŠ¨åŒ–éªŒè¯**ï¼šå¼€å‘è‡ªåŠ¨åŒ–éªŒè¯å·¥å…·éªŒè¯å…±äº«å†…å­˜è®¿é—®çš„å®‰å…¨æ€§
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–å…±äº«å†…å­˜è®¿é—®çš„æ€§èƒ½
4. **å·¥å…·æ”¯æŒ**ï¼šæ”¹è¿›å…±äº«å†…å­˜åˆ†æå’Œå¯è§†åŒ–å·¥å…·

---

**åˆ›å»ºæ—¥æœŸ**: 2025-11-11
**æœ€åæ›´æ–°**: 2025-11-11
**ç»´æŠ¤è€…**: Rustè¯­è¨€å½¢å¼åŒ–ç†è®ºé¡¹ç›®ç»„
**çŠ¶æ€**: å·²å®Œå–„ âœ…
