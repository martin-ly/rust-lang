# ğŸ¦€ æ‰€æœ‰æƒç³»ç»Ÿé€ŸæŸ¥å¡ {#-æ‰€æœ‰æƒç³»ç»Ÿé€ŸæŸ¥å¡}

> **å¿«é€Ÿå‚è€ƒ** | [å®Œæ•´æ–‡æ¡£](../../../crates/c01_ownership_borrow_scope/docs/) | [ä»£ç ç¤ºä¾‹](../../../crates/c01_ownership_borrow_scope/examples/)
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-27
> **æœ€åæ›´æ–°**: 2026-01-27
> **Rust ç‰ˆæœ¬**: 1.93.1+ (Edition 2024)
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ ç›®å½• {#-ç›®å½•}

- [ğŸ¦€ æ‰€æœ‰æƒç³»ç»Ÿé€ŸæŸ¥å¡ {#-æ‰€æœ‰æƒç³»ç»Ÿé€ŸæŸ¥å¡}](#-æ‰€æœ‰æƒç³»ç»Ÿé€ŸæŸ¥å¡--æ‰€æœ‰æƒç³»ç»Ÿé€ŸæŸ¥å¡)
  - [ğŸ“‹ ç›®å½• {#-ç›®å½•}](#-ç›®å½•--ç›®å½•)
  - [ğŸ§  æ‰€æœ‰æƒç³»ç»Ÿæ€ç»´å¯¼å›¾](#-æ‰€æœ‰æƒç³»ç»Ÿæ€ç»´å¯¼å›¾)
  - [ğŸ“Š æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯](#-æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯)
  - [ğŸ“ ä¸‰å¤§è§„åˆ™ï¼ˆæ ¸å¿ƒï¼‰ {#-ä¸‰å¤§è§„åˆ™æ ¸å¿ƒ}](#-ä¸‰å¤§è§„åˆ™æ ¸å¿ƒ--ä¸‰å¤§è§„åˆ™æ ¸å¿ƒ)
    - [æ‰€æœ‰æƒè½¬ç§»å†³ç­–æ ‘](#æ‰€æœ‰æƒè½¬ç§»å†³ç­–æ ‘)
  - [ğŸ¯ å¸¸è§æ¨¡å¼é€ŸæŸ¥ {#-å¸¸è§æ¨¡å¼é€ŸæŸ¥}](#-å¸¸è§æ¨¡å¼é€ŸæŸ¥--å¸¸è§æ¨¡å¼é€ŸæŸ¥)
    - [æ¨¡å¼ 1: æ‰€æœ‰æƒè½¬ç§»ï¼ˆMoveï¼‰](#æ¨¡å¼-1-æ‰€æœ‰æƒè½¬ç§»move)
    - [æ¨¡å¼ 2: ä¸å¯å˜å€Ÿç”¨ï¼ˆ\&Tï¼‰](#æ¨¡å¼-2-ä¸å¯å˜å€Ÿç”¨t)
    - [æ¨¡å¼ 3: å¯å˜å€Ÿç”¨ï¼ˆ\&mut Tï¼‰](#æ¨¡å¼-3-å¯å˜å€Ÿç”¨mut-t)
    - [æ¨¡å¼ 4: Cloneï¼ˆæ˜¾å¼å¤åˆ¶ï¼‰](#æ¨¡å¼-4-cloneæ˜¾å¼å¤åˆ¶)
    - [æ¨¡å¼ 5: Copy ç±»å‹](#æ¨¡å¼-5-copy-ç±»å‹)
  - [ğŸŒ³ å†³ç­–æ ‘ {#-å†³ç­–æ ‘}](#-å†³ç­–æ ‘--å†³ç­–æ ‘)
  - [âš¡ å¸¸è§é”™è¯¯ä¸è§£å†³ {#-å¸¸è§é”™è¯¯ä¸è§£å†³}](#-å¸¸è§é”™è¯¯ä¸è§£å†³--å¸¸è§é”™è¯¯ä¸è§£å†³)
    - [é”™è¯¯ 1: å€Ÿç”¨æ£€æŸ¥å™¨é”™è¯¯](#é”™è¯¯-1-å€Ÿç”¨æ£€æŸ¥å™¨é”™è¯¯)
    - [é”™è¯¯ 2: æ‚¬å‚å¼•ç”¨](#é”™è¯¯-2-æ‚¬å‚å¼•ç”¨)
    - [é”™è¯¯ 3: å¾ªç¯ä¸­çš„å€Ÿç”¨](#é”™è¯¯-3-å¾ªç¯ä¸­çš„å€Ÿç”¨)
  - [ğŸ—ï¸ æ™ºèƒ½æŒ‡é’ˆé€ŸæŸ¥ {#ï¸-æ™ºèƒ½æŒ‡é’ˆé€ŸæŸ¥}](#ï¸-æ™ºèƒ½æŒ‡é’ˆé€ŸæŸ¥-ï¸-æ™ºèƒ½æŒ‡é’ˆé€ŸæŸ¥)
    - [`Box<T>` - å †åˆ†é…](#boxt---å †åˆ†é…)
    - [`Rc<T>` - å¼•ç”¨è®¡æ•°ï¼ˆå•çº¿ç¨‹ï¼‰](#rct---å¼•ç”¨è®¡æ•°å•çº¿ç¨‹)
    - [`Arc<T>` - åŸå­å¼•ç”¨è®¡æ•°ï¼ˆå¤šçº¿ç¨‹ï¼‰](#arct---åŸå­å¼•ç”¨è®¡æ•°å¤šçº¿ç¨‹)
    - [`RefCell<T>` - å†…éƒ¨å¯å˜æ€§ï¼ˆå•çº¿ç¨‹ï¼‰](#refcellt---å†…éƒ¨å¯å˜æ€§å•çº¿ç¨‹)
    - [`Mutex<T>` - äº’æ–¥é”ï¼ˆå¤šçº¿ç¨‹ï¼‰](#mutext---äº’æ–¥é”å¤šçº¿ç¨‹)
  - [ğŸ“ ç”Ÿå‘½å‘¨æœŸé€ŸæŸ¥ {#-ç”Ÿå‘½å‘¨æœŸé€ŸæŸ¥}](#-ç”Ÿå‘½å‘¨æœŸé€ŸæŸ¥--ç”Ÿå‘½å‘¨æœŸé€ŸæŸ¥)
    - [åŸºæœ¬è¯­æ³•](#åŸºæœ¬è¯­æ³•)
    - [ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™](#ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™)
  - [ğŸ“Š æ€§èƒ½æç¤º {#-æ€§èƒ½æç¤º}](#-æ€§èƒ½æç¤º--æ€§èƒ½æç¤º)
    - [âœ… é«˜æ•ˆæ¨¡å¼ {#-é«˜æ•ˆæ¨¡å¼}](#-é«˜æ•ˆæ¨¡å¼--é«˜æ•ˆæ¨¡å¼)
    - [âš ï¸ ä½æ•ˆæ¨¡å¼ {#ï¸-ä½æ•ˆæ¨¡å¼}](#ï¸-ä½æ•ˆæ¨¡å¼-ï¸-ä½æ•ˆæ¨¡å¼)
  - [ğŸš« åä¾‹é€ŸæŸ¥ {#-åä¾‹é€ŸæŸ¥}](#-åä¾‹é€ŸæŸ¥--åä¾‹é€ŸæŸ¥)
    - [åä¾‹ 1: ç§»åŠ¨åä½¿ç”¨](#åä¾‹-1-ç§»åŠ¨åä½¿ç”¨)
    - [åä¾‹ 2: å¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨å†²çª](#åä¾‹-2-å¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨å†²çª)
    - [åä¾‹ 3: è¿”å›æ‚¬å‚å¼•ç”¨](#åä¾‹-3-è¿”å›æ‚¬å‚å¼•ç”¨)
  - [ğŸ”— å¿«é€Ÿè·³è½¬ {#-å¿«é€Ÿè·³è½¬}](#-å¿«é€Ÿè·³è½¬--å¿«é€Ÿè·³è½¬)
    - [æ·±å…¥å­¦ä¹ ](#æ·±å…¥å­¦ä¹ )
    - [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹)
    - [å½¢å¼åŒ–ç†è®º](#å½¢å¼åŒ–ç†è®º)
  - [ğŸ’¡ ä½¿ç”¨åœºæ™¯ {#-ä½¿ç”¨åœºæ™¯}](#-ä½¿ç”¨åœºæ™¯--ä½¿ç”¨åœºæ™¯)
    - [åœºæ™¯ 1: é…ç½®è§£æå™¨](#åœºæ™¯-1-é…ç½®è§£æå™¨)
    - [åœºæ™¯ 2: ç¼“å­˜å®ç°](#åœºæ™¯-2-ç¼“å­˜å®ç°)
    - [åœºæ™¯ 3: è¯»å–æ–‡ä»¶å¹¶å¤„ç†](#åœºæ™¯-3-è¯»å–æ–‡ä»¶å¹¶å¤„ç†)
  - [âš ï¸ è¾¹ç•Œæƒ…å†µ {#ï¸-è¾¹ç•Œæƒ…å†µ}](#ï¸-è¾¹ç•Œæƒ…å†µ-ï¸-è¾¹ç•Œæƒ…å†µ)
    - [è¾¹ç•Œ 1: è‡ªå¼•ç”¨ç»“æ„](#è¾¹ç•Œ-1-è‡ªå¼•ç”¨ç»“æ„)
    - [è¾¹ç•Œ 2: è·¨çº¿ç¨‹æ‰€æœ‰æƒ](#è¾¹ç•Œ-2-è·¨çº¿ç¨‹æ‰€æœ‰æƒ)
    - [è¾¹ç•Œ 3: å¾ªç¯å¼•ç”¨ä¸å†…å­˜æ³„æ¼](#è¾¹ç•Œ-3-å¾ªç¯å¼•ç”¨ä¸å†…å­˜æ³„æ¼)
  - [ğŸ†• Rust 1.92.0 å†…å­˜ä¼˜åŒ– {#-rust-1920-å†…å­˜ä¼˜åŒ–}](#-rust-1920-å†…å­˜ä¼˜åŒ–--rust-1920-å†…å­˜ä¼˜åŒ–)
    - [å†…å­˜åˆ†é…ä¼˜åŒ–](#å†…å­˜åˆ†é…ä¼˜åŒ–)
  - [ğŸ“š ç›¸å…³æ–‡æ¡£ {#-ç›¸å…³æ–‡æ¡£}](#-ç›¸å…³æ–‡æ¡£--ç›¸å…³æ–‡æ¡£)
  - [ğŸ§© ç›¸å…³ç¤ºä¾‹ä»£ç  {#-ç›¸å…³ç¤ºä¾‹ä»£ç }](#-ç›¸å…³ç¤ºä¾‹ä»£ç --ç›¸å…³ç¤ºä¾‹ä»£ç )
  - [ğŸ“š ç›¸å…³èµ„æº {#-ç›¸å…³èµ„æº}](#-ç›¸å…³èµ„æº--ç›¸å…³èµ„æº)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [é¡¹ç›®å†…éƒ¨æ–‡æ¡£](#é¡¹ç›®å†…éƒ¨æ–‡æ¡£)
    - [ç›¸å…³é€ŸæŸ¥å¡](#ç›¸å…³é€ŸæŸ¥å¡)

---

## ğŸ§  æ‰€æœ‰æƒç³»ç»Ÿæ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ‰€æœ‰æƒç³»ç»Ÿ<br/>Ownership System))
    æ ¸å¿ƒè§„åˆ™
      å•ä¸€æ‰€æœ‰è€…
      å”¯ä¸€å¯å˜å€Ÿç”¨
      è‡ªåŠ¨é‡Šæ”¾
    å€Ÿç”¨æœºåˆ¶
      ä¸å¯å˜å€Ÿç”¨ &T
        å¤šé‡é‡å 
        åªè¯»è®¿é—®
      å¯å˜å€Ÿç”¨ &mut T
        ç‹¬å è®¿é—®
        è¯»å†™æƒé™
    ç”Ÿå‘½å‘¨æœŸ
      ç¼–è¯‘æ—¶æ£€æŸ¥
      ä½œç”¨åŸŸå…³è”
      çœç•¥è§„åˆ™
    æ™ºèƒ½æŒ‡é’ˆ
      Box<T>
      Rc<T>
      Arc<T>
      RefCell<T>
    å†…å­˜å®‰å…¨
      æ— æ‚¬å‚å¼•ç”¨
      æ— æ•°æ®ç«äº‰
      æ— å†…å­˜æ³„æ¼
```

---

## ğŸ“Š æ¦‚å¿µå®šä¹‰-å±æ€§å…³ç³»-è§£é‡Šè®ºè¯

| å±‚æ¬¡ | æ¦‚å¿µå®šä¹‰ | å±æ€§å…³ç³» | è§£é‡Šè®ºè¯ |
| :--- | :--- | :--- | :--- |
| **L1 åŸºç¡€** | æ‰€æœ‰æƒï¼šå€¼çš„å”¯ä¸€ç®¡ç†è€… | å…¬ç†ï¼šæ¯ä¸ªå€¼æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ‰€æœ‰è€… | å®šç† T2.1ï¼šæ‰€æœ‰æƒå”¯ä¸€æ€§ä¿è¯å†…å­˜å®‰å…¨ |
| **L2 å€Ÿç”¨** | å¼•ç”¨ï¼šä¸´æ—¶è®¿é—®æƒé™ | è§„åˆ™ï¼š&T å…è®¸å¤šé‡ï¼Œ&mut T ç‹¬å  | å®šç† T2.2ï¼šå€Ÿç”¨è§„åˆ™é˜²æ­¢æ•°æ®ç«äº‰ |
| **L3 ç”Ÿå‘½å‘¨æœŸ** | ä½œç”¨åŸŸæ ‡æ³¨ï¼š'a | å…¬ç†ï¼šå¼•ç”¨ä¸èƒ½ outlive æ‰€æœ‰è€… | å®šç† T2.3ï¼šç”Ÿå‘½å‘¨æœŸä¿è¯å¼•ç”¨æœ‰æ•ˆæ€§ |
| **L4 æ™ºèƒ½æŒ‡é’ˆ** | RAII å°è£…ï¼šBox/Rc/Arc | è§„åˆ™ï¼šè¿è¡Œæ—¶å¼•ç”¨è®¡æ•° | å®šç† T2.4ï¼šæ™ºèƒ½æŒ‡é’ˆä¿æŒæ‰€æœ‰æƒè¯­ä¹‰ |
| **L5 å½¢å¼åŒ–** | åˆ†ç¦»é€»è¾‘æ¨¡å‹ | éœå°”ä¸‰å…ƒç»„ {P}C{Q} | å®šç† T2.5ï¼šæ‰€æœ‰æƒç³»ç»Ÿå¯é æ€§ |

> å½¢å¼åŒ–ç†è®ºè¯¦è§ï¼š[æ‰€æœ‰æƒæ¨¡å‹å½¢å¼åŒ–](../../research_notes/formal_methods/ownership_model.md)

---

## ğŸ“ ä¸‰å¤§è§„åˆ™ï¼ˆæ ¸å¿ƒï¼‰ {#-ä¸‰å¤§è§„åˆ™æ ¸å¿ƒ}

```text
1. æ¯ä¸ªå€¼æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
2. åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨ï¼Œæˆ–å¤šä¸ªä¸å¯å˜å€Ÿç”¨
3. æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸï¼Œå€¼è¢«è‡ªåŠ¨ drop
```

### æ‰€æœ‰æƒè½¬ç§»å†³ç­–æ ‘

```mermaid
graph TD
    A[éœ€è¦å…±äº«æ•°æ®?] -->|æ˜¯| B[éœ€è¦ä¿®æ”¹?]
    A -->|å¦| C[å•ä¸€æ‰€æœ‰æƒ]
    B -->|æ˜¯| D[å¯å˜å€Ÿç”¨ &mut T]
    B -->|å¦| E[ä¸å¯å˜å€Ÿç”¨ &T]
    C --> F{æ•°æ®ç±»å‹?}
    F -->|ç®€å•å€¼| G[Copy è¯­ä¹‰]
    F -->|å¤æ‚å€¼| H[Move è¯­ä¹‰]
    D --> I{çº¿ç¨‹å®‰å…¨?}
    I -->|å•çº¿ç¨‹| J[RefCell<T>]
    I -->|å¤šçº¿ç¨‹| K[Mutex<T>/RwLock<T>]
    E --> L{çº¿ç¨‹å®‰å…¨?}
    L -->|å•çº¿ç¨‹| M[Rc<T>]
    L -->|å¤šçº¿ç¨‹| N[Arc<T>]
```

---

## ğŸ¯ å¸¸è§æ¨¡å¼é€ŸæŸ¥ {#-å¸¸è§æ¨¡å¼é€ŸæŸ¥}

### æ¨¡å¼ 1: æ‰€æœ‰æƒè½¬ç§»ï¼ˆMoveï¼‰

```rust
let s1 = String::from("hello");
let s2 = s1;  // s1 å¤±æ•ˆï¼Œæ‰€æœ‰æƒè½¬ç§»ç»™ s2
// println!("{}", s1); // âŒ ç¼–è¯‘é”™è¯¯
println!("{}", s2);    // âœ… OK
```

**ä½•æ—¶å‘ç”Ÿ**:

- èµ‹å€¼: `let b = a;`
- å‡½æ•°å‚æ•°: `fn take(s: String)`
- è¿”å›å€¼: `return s;`

---

### æ¨¡å¼ 2: ä¸å¯å˜å€Ÿç”¨ï¼ˆ&Tï¼‰

```rust
fn process(s: &String) {  // å€Ÿç”¨ï¼Œä¸å¤ºå–æ‰€æœ‰æƒ
    println!("{}", s);
}

let s = String::from("hello");
process(&s);  // å€Ÿç”¨
println!("{}", s);  // âœ… s ä»ç„¶æœ‰æ•ˆ
```

**è§„åˆ™**:

- âœ… å¯ä»¥æœ‰å¤šä¸ªä¸å¯å˜å€Ÿç”¨
- âœ… è¯»å–æ•°æ®
- âŒ ä¸èƒ½ä¿®æ”¹æ•°æ®

---

### æ¨¡å¼ 3: å¯å˜å€Ÿç”¨ï¼ˆ&mut Tï¼‰

```rust
fn modify(s: &mut String) {
    s.push_str(" world");
}

let mut s = String::from("hello");
modify(&mut s);
println!("{}", s);  // "hello world"
```

**è§„åˆ™**:

- âœ… å¯ä»¥ä¿®æ”¹æ•°æ®
- âš ï¸ åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨
- âš ï¸ å¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨ä¸èƒ½å…±å­˜

---

### æ¨¡å¼ 4: Cloneï¼ˆæ˜¾å¼å¤åˆ¶ï¼‰

```rust
let s1 = String::from("hello");
let s2 = s1.clone();  // æ˜¾å¼æ·±æ‹·è´
println!("{} {}", s1, s2);  // âœ… éƒ½æœ‰æ•ˆ
```

**ä»£ä»·**: å †å†…å­˜åˆ†é…ï¼Œæ€§èƒ½å¼€é”€

---

### æ¨¡å¼ 5: Copy ç±»å‹

```rust
let x = 5;
let y = x;  // i32 å®ç°äº† Copy
println!("{} {}", x, y);  // âœ… éƒ½æœ‰æ•ˆ
```

**å®ç° Copy çš„ç±»å‹**:

- æ‰€æœ‰æ•´æ•°ç±»å‹: `i32`, `u64`, etc.
- æµ®ç‚¹ç±»å‹: `f32`, `f64`
- å¸ƒå°”: `bool`
- å­—ç¬¦: `char`
- å…ƒç»„ï¼ˆå¦‚æœæ‰€æœ‰æˆå‘˜éƒ½æ˜¯ Copyï¼‰

---

## ğŸŒ³ å†³ç­–æ ‘ {#-å†³ç­–æ ‘}

```text
é‡åˆ°æ‰€æœ‰æƒé—®é¢˜ï¼Ÿ
â”‚
â”œâ”€ éœ€è¦ä¿®æ”¹æ•°æ®ï¼Ÿ
â”‚  â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ &mut T
â”‚  â””â”€ å¦ â†’ ä½¿ç”¨ &T
â”‚
â”œâ”€ éœ€è¦åœ¨å¤šå¤„å…±äº«ï¼Ÿ
â”‚  â”œâ”€ å•çº¿ç¨‹
â”‚  â”‚  â”œâ”€ ä¸å¯å˜ â†’ Rc<T>
â”‚  â”‚  â””â”€ å¯å˜ â†’ Rc<RefCell<T>>
â”‚  â””â”€ å¤šçº¿ç¨‹
â”‚     â”œâ”€ ä¸å¯å˜ â†’ Arc<T>
â”‚     â””â”€ å¯å˜ â†’ Arc<Mutex<T>> æˆ– Arc<RwLock<T>>
â”‚
â””â”€ éœ€è¦è‡ªå¼•ç”¨ç»“æ„ï¼Ÿ
   â””â”€ Pin<Box<T>>
```

---

## âš¡ å¸¸è§é”™è¯¯ä¸è§£å†³ {#-å¸¸è§é”™è¯¯ä¸è§£å†³}

### é”™è¯¯ 1: å€Ÿç”¨æ£€æŸ¥å™¨é”™è¯¯

```rust
// âŒ é”™è¯¯
let mut s = String::from("hello");
let r1 = &s;
let r2 = &mut s;  // é”™è¯¯ï¼šä¸å¯å˜å€Ÿç”¨æœŸé—´ä¸èƒ½å¯å˜å€Ÿç”¨
println!("{}", r1);
```

```rust
// âœ… è§£å†³
let mut s = String::from("hello");
let r1 = &s;
println!("{}", r1);  // r1 çš„ä½œç”¨åŸŸç»“æŸ
let r2 = &mut s;     // âœ… OK
s.push_str(" world");
```

---

### é”™è¯¯ 2: æ‚¬å‚å¼•ç”¨

```rust
// âŒ é”™è¯¯
fn dangle() -> &String {
    let s = String::from("hello");
    &s  // s å°†è¢« dropï¼Œå¼•ç”¨æ— æ•ˆ
}
```

```rust
// âœ… è§£å†³æ–¹æ¡ˆ 1: è¿”å›æ‰€æœ‰æƒ
fn no_dangle() -> String {
    let s = String::from("hello");
    s  // æ‰€æœ‰æƒè½¬ç§»
}

// âœ… è§£å†³æ–¹æ¡ˆ 2: ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ
fn no_dangle2<'a>(input: &'a String) -> &'a String {
    input
}
```

---

### é”™è¯¯ 3: å¾ªç¯ä¸­çš„å€Ÿç”¨

```rust
// âŒ é”™è¯¯
let mut v = vec![1, 2, 3];
for i in &v {
    v.push(*i);  // é”™è¯¯ï¼šéå†æ—¶ä¸èƒ½ä¿®æ”¹
}
```

```rust
// âœ… è§£å†³
let mut v = vec![1, 2, 3];
let to_add: Vec<_> = v.iter().map(|x| *x).collect();
v.extend(to_add);
```

---

## ğŸ—ï¸ æ™ºèƒ½æŒ‡é’ˆé€ŸæŸ¥ {#ï¸-æ™ºèƒ½æŒ‡é’ˆé€ŸæŸ¥}

### `Box<T>` - å †åˆ†é…

```rust
let b = Box::new(5);
// ç”¨é€”ï¼šé€’å½’ç±»å‹ã€å¤§å‹æ•°æ®ã€trait å¯¹è±¡
```

### `Rc<T>` - å¼•ç”¨è®¡æ•°ï¼ˆå•çº¿ç¨‹ï¼‰

```rust
use std::rc::Rc;
let a = Rc::new(5);
let b = Rc::clone(&a);  // å¼•ç”¨è®¡æ•° +1
// ç”¨é€”ï¼šå¤šé‡æ‰€æœ‰æƒï¼ˆå•çº¿ç¨‹ï¼‰
```

### `Arc<T>` - åŸå­å¼•ç”¨è®¡æ•°ï¼ˆå¤šçº¿ç¨‹ï¼‰

```rust
use std::sync::Arc;
let a = Arc::new(5);
let b = Arc::clone(&a);  // çº¿ç¨‹å®‰å…¨çš„å¼•ç”¨è®¡æ•°
// ç”¨é€”ï¼šå¤šçº¿ç¨‹å…±äº«æ•°æ®
```

### `RefCell<T>` - å†…éƒ¨å¯å˜æ€§ï¼ˆå•çº¿ç¨‹ï¼‰

```rust
use std::cell::RefCell;
let data = RefCell::new(5);
*data.borrow_mut() += 1;
// ç”¨é€”ï¼šè¿è¡Œæ—¶å€Ÿç”¨æ£€æŸ¥
```

### `Mutex<T>` - äº’æ–¥é”ï¼ˆå¤šçº¿ç¨‹ï¼‰

```rust
use std::sync::Mutex;
let m = Mutex::new(5);
{
    let mut num = m.lock().unwrap();
    *num += 1;
}
// ç”¨é€”ï¼šå¤šçº¿ç¨‹å¯å˜å…±äº«
```

---

## ğŸ“ ç”Ÿå‘½å‘¨æœŸé€ŸæŸ¥ {#-ç”Ÿå‘½å‘¨æœŸé€ŸæŸ¥}

### åŸºæœ¬è¯­æ³•

```rust
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() { x } else { y }
}
```

### ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™

1. **è§„åˆ™ 1**: æ¯ä¸ªå¼•ç”¨å‚æ•°è·å¾—ç‹¬ç«‹ç”Ÿå‘½å‘¨æœŸ

   ```rust
   fn foo(x: &i32)          // fn foo<'a>(x: &'a i32)
   fn foo(x: &i32, y: &i32) // fn foo<'a, 'b>(x: &'a i32, y: &'b i32)
   ```

2. **è§„åˆ™ 2**: å•å‚æ•°æ—¶ï¼Œè¿”å›å€¼ä½¿ç”¨ç›¸åŒç”Ÿå‘½å‘¨æœŸ

   ```rust
   fn foo(x: &i32) -> &i32  // fn foo<'a>(x: &'a i32) -> &'a i32
   ```

3. **è§„åˆ™ 3**: æ–¹æ³•ä¸­ï¼Œè¿”å›å€¼ä½¿ç”¨ `&self` çš„ç”Ÿå‘½å‘¨æœŸ

   ```rust
   fn method(&self) -> &str // fn method<'a>(&'a self) -> &'a str
   ```

---

## ğŸ“Š æ€§èƒ½æç¤º {#-æ€§èƒ½æç¤º}

### âœ… é«˜æ•ˆæ¨¡å¼ {#-é«˜æ•ˆæ¨¡å¼}

1. **å€Ÿç”¨è€Œéæ‹¥æœ‰**

   ```rust
   fn process(s: &String) { ... }  // âœ… é«˜æ•ˆ
   ```

2. **ä½¿ç”¨åˆ‡ç‰‡**

   ```rust
   fn first_word(s: &str) -> &str { ... }  // âœ… çµæ´»
   ```

3. **é¿å…ä¸å¿…è¦çš„ clone**

   ```rust
   let s = String::from("hello");
   process(&s);  // âœ… è€Œé process(s.clone())
   ```

### âš ï¸ ä½æ•ˆæ¨¡å¼ {#ï¸-ä½æ•ˆæ¨¡å¼}

1. **è¿‡åº¦ä½¿ç”¨ clone**

   ```rust
   let s2 = s1.clone();  // âš ï¸ å †åˆ†é…å¼€é”€
   ```

2. **è¿‡åº¦ä½¿ç”¨ Rc/Arc**

   ```rust
   Rc<Rc<Vec<String>>>  // âš ï¸ åŒé‡å¼•ç”¨è®¡æ•°
   ```

---

## ğŸš« åä¾‹é€ŸæŸ¥ {#-åä¾‹é€ŸæŸ¥}

### åä¾‹ 1: ç§»åŠ¨åä½¿ç”¨

**é”™è¯¯ç¤ºä¾‹**ï¼ˆä»¥ä¸‹ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼‰:

```rust,compile_fail
let s = String::from("hello");
let s2 = s;  // æ‰€æœ‰æƒè½¬ç§»
println!("{}", s);  // âŒ ç¼–è¯‘é”™è¯¯ï¼šs å·²å¤±æ•ˆ
```

**åŸå› **: å€¼ç§»åŠ¨ååŸå˜é‡ä¸å¯ç”¨ã€‚

**ä¿®æ­£**:

```rust
let s = String::from("hello");
let s2 = s.clone();  // æˆ–å€Ÿç”¨ &s
println!("{}", s);
```

---

### åä¾‹ 2: å¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨å†²çª

**é”™è¯¯ç¤ºä¾‹**ï¼ˆä»¥ä¸‹ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼‰:

```rust,compile_fail
let mut v = vec![1, 2, 3];
let r1 = &v;
let r2 = &mut v;  // âŒ ç¼–è¯‘é”™è¯¯ï¼šå·²æœ‰ä¸å¯å˜å€Ÿç”¨
```

**åŸå› **: åŒä¸€æ—¶åˆ»ä¸èƒ½åŒæ—¶å­˜åœ¨å¯å˜å€Ÿç”¨å’Œä¸å¯å˜å€Ÿç”¨ã€‚

**ä¿®æ­£**:

```rust
let mut v = vec![1, 2, 3];
{
    let r1 = &v;
    // ä½¿ç”¨ r1
}
let r2 = &mut v;  // r1 å·²ç¦»å¼€ä½œç”¨åŸŸ
```

---

### åä¾‹ 3: è¿”å›æ‚¬å‚å¼•ç”¨

**é”™è¯¯ç¤ºä¾‹**ï¼ˆä»¥ä¸‹ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼‰:

```rust,compile_fail
fn dangle() -> &String {
    let s = String::from("hello");
    &s  // âŒ ç¼–è¯‘é”™è¯¯ï¼šs å³å°†è¢« drop
}
```

**åŸå› **: å¼•ç”¨ä¸èƒ½ outlive æ‰€æœ‰è€…ã€‚

**ä¿®æ­£**:

```rust
fn no_dangle() -> String {
    let s = String::from("hello");
    s  // è½¬ç§»æ‰€æœ‰æƒ
}
```

---

## ğŸ”— å¿«é€Ÿè·³è½¬ {#-å¿«é€Ÿè·³è½¬}

### æ·±å…¥å­¦ä¹ 

- [å®Œæ•´æ‰€æœ‰æƒæ•™ç¨‹](../../../crates/c01_ownership_borrow_scope/docs/tier_02_guides/01_æ‰€æœ‰æƒå¿«é€Ÿå…¥é—¨.md)
- [å€Ÿç”¨æ£€æŸ¥å™¨è¯¦è§£](../../../crates/c01_ownership_borrow_scope/docs/tier_03_references/02_å€Ÿç”¨æ£€æŸ¥å™¨è¯¦è§£.md)
- [æ™ºèƒ½æŒ‡é’ˆ API](../../../crates/c01_ownership_borrow_scope/docs/tier_03_references/05_æ™ºèƒ½æŒ‡é’ˆAPIå‚è€ƒ.md)

### ä»£ç ç¤ºä¾‹

- [ç»¼åˆç¤ºä¾‹](../../../crates/c01_ownership_borrow_scope/examples/comprehensive_ownership_examples.rs)
- [æ™ºèƒ½æŒ‡é’ˆç¤ºä¾‹](../../../crates/c01_ownership_borrow_scope/examples/comprehensive_ownership_examples.rs)

### å½¢å¼åŒ–ç†è®º

- [ç±»å‹ç³»ç»Ÿç†è®º](../../../crates/c01_ownership_borrow_scope/docs/tier_04_advanced/06_ç±»å‹ç³»ç»Ÿç†è®º.md)
- [å½¢å¼åŒ–éªŒè¯](../../../crates/c01_ownership_borrow_scope/docs/tier_04_advanced/07_å½¢å¼åŒ–éªŒè¯.md)
- [æ‰€æœ‰æƒæ¨¡å‹å½¢å¼åŒ–](../../research_notes/formal_methods/ownership_model.md) â€” Def 2.1â€“2.3ã€å®šç† T2.1â€“T2.5
- [å€Ÿç”¨æ£€æŸ¥å™¨è¯æ˜](../../research_notes/formal_methods/borrow_checker_proof.md) â€” å®šç† 3.1â€“3.3ã€å¼•ç† L3.1â€“L3.4
- [ç”Ÿå‘½å‘¨æœŸå½¢å¼åŒ–](../../research_notes/formal_methods/lifetime_formalization.md) â€” Def 1.1â€“1.4ã€å®šç† T1.1â€“T1.3

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯ {#-ä½¿ç”¨åœºæ™¯}

### åœºæ™¯ 1: é…ç½®è§£æå™¨

```rust
#[derive(Debug)]
struct Config {
    host: String,
    port: u16,
}

impl Config {
    fn new(args: &[String]) -> Result<Config, &'static str> {
        if args.len() < 3 {
            return Err("å‚æ•°ä¸è¶³");
        }

        let host = args[1].clone();  // æ‰€æœ‰æƒè½¬ç§»
        let port = args[2].parse().map_err(|_| "æ— æ•ˆç«¯å£")?;

        Ok(Config { host, port })
    }
}

fn main() {
    let args: Vec<String> = vec![
        "program".to_string(),
        "localhost".to_string(),
        "8080".to_string(),
    ];

    let config = Config::new(&args).unwrap();
    println!("æœåŠ¡å™¨: {}:{}", config.host, config.port);
    // args ä»ç„¶å¯ç”¨ï¼Œconfig.host æ‹¥æœ‰ç‹¬ç«‹æ‰€æœ‰æƒ
}
```

### åœºæ™¯ 2: ç¼“å­˜å®ç°

```rust
use std::collections::HashMap;

struct Cache<K, V> {
    data: HashMap<K, V>,
}

impl<K: std::hash::Hash + Eq, V> Cache<K, V> {
    fn new() -> Self {
        Cache { data: HashMap::new() }
    }

    fn get(&self, key: &K) -> Option<&V> {
        self.data.get(key)  // è¿”å›å€Ÿç”¨ï¼Œä¸è½¬ç§»æ‰€æœ‰æƒ
    }

    fn put(&mut self, key: K, value: V) {
        self.data.insert(key, value);
    }
}

fn main() {
    let mut cache = Cache::new();
    let key = "user:123".to_string();

    cache.put(key.clone(), vec![1, 2, 3]);

    // key ä»ç„¶å¯ç”¨ï¼ˆå› ä¸ºæˆ‘ä»¬ clone äº†ï¼‰
    println!("æŸ¥è¯¢: {}", key);

    if let Some(data) = cache.get(&key) {
        println!("æ‰¾åˆ°: {:?}", data);
    }
}
```

### åœºæ™¯ 3: è¯»å–æ–‡ä»¶å¹¶å¤„ç†

```rust
use std::fs;

fn process_file(path: &str) -> Result<Vec<String>, std::io::Error> {
    let content = fs::read_to_string(path)?;  // æ‰€æœ‰æƒè½¬ç§»ç»™ content
    let lines: Vec<String> = content.lines()
        .map(|s| s.to_string())
        .collect();
    Ok(lines)  // æ‰€æœ‰æƒè½¬ç§»ç»™è°ƒç”¨è€…
}

fn main() {
    match process_file("test.txt") {
        Ok(lines) => {
            for line in &lines {  // å€Ÿç”¨ lines
                println!("{}", line);
            }
            // lines ä»ç„¶å¯ç”¨
            println!("æ€»å…± {} è¡Œ", lines.len());
        }
        Err(e) => eprintln!("é”™è¯¯: {}", e),
    }
}
```

---

## âš ï¸ è¾¹ç•Œæƒ…å†µ {#ï¸-è¾¹ç•Œæƒ…å†µ}

### è¾¹ç•Œ 1: è‡ªå¼•ç”¨ç»“æ„

```rust,compile_fail
// âŒ é”™è¯¯ï¼šè‡ªå¼•ç”¨ç»“æ„éœ€è¦ç‰¹æ®Šå¤„ç†
struct SelfReferential {
    data: String,
    // pointer: &str,  // æŒ‡å‘ data çš„å¼•ç”¨
}

// âœ… è§£å†³ï¼šä½¿ç”¨ Pin<Box<T>> æˆ–ç‰¹æ®Šåº“
use std::pin::Pin;
use std::marker::PhantomPinned;

struct SafeSelfReferential {
    data: String,
    _pin: PhantomPinned,
}
```

### è¾¹ç•Œ 2: è·¨çº¿ç¨‹æ‰€æœ‰æƒ

```rust
use std::thread;

fn main() {
    let data = vec![1, 2, 3];

    // âŒ é”™è¯¯ï¼šä¸èƒ½ç›´æ¥å°†å€Ÿç”¨ä¼ ç»™çº¿ç¨‹
    // let handle = thread::spawn(|| {
    //     println!("{:?}", data);
    // });

    // âœ… è§£å†³ï¼šä½¿ç”¨ move è½¬ç§»æ‰€æœ‰æƒ
    let handle = thread::spawn(move || {
        println!("{:?}", data);
    });

    handle.join().unwrap();
    // data ä¸å†å¯ç”¨
}
```

### è¾¹ç•Œ 3: å¾ªç¯å¼•ç”¨ä¸å†…å­˜æ³„æ¼

```rust
use std::rc::{Rc, Weak};
use std::cell::RefCell;

#[derive(Debug)]
struct Node {
    value: i32,
    parent: RefCell<Weak<Node>>,    // ä½¿ç”¨ Weak é¿å…å¾ªç¯å¼•ç”¨
    children: RefCell<Vec<Rc<Node>>>,
}

fn main() {
    let leaf = Rc::new(Node {
        value: 3,
        parent: RefCell::new(Weak::new()),
        children: RefCell::new(vec![]),
    });

    let branch = Rc::new(Node {
        value: 5,
        parent: RefCell::new(Weak::new()),
        children: RefCell::new(vec![Rc::clone(&leaf)]),
    });

    *leaf.parent.borrow_mut() = Rc::downgrade(&branch);

    println!("leaf parent = {:?}", leaf.parent.borrow().upgrade());
}
```

---

---

## ğŸ†• Rust 1.92.0 å†…å­˜ä¼˜åŒ– {#-rust-1920-å†…å­˜ä¼˜åŒ–}

### å†…å­˜åˆ†é…ä¼˜åŒ–

**æ”¹è¿›**: å°å¯¹è±¡åˆ†é…æ€§èƒ½æå‡ 25-30%

```rust
// Rust 1.92.0 ä¼˜åŒ–åçš„å†…å­˜åˆ†é…
// HashMap æ“ä½œæ›´å¿«
// å†…å­˜ç¢ç‰‡å‡å°‘ 15-20%

use std::collections::HashMap;

let mut map = HashMap::new();
// âœ… å°å¯¹è±¡åˆ†é…æ€§èƒ½æå‡ 25-30%
for i in 0..1000 {
    map.insert(i, format!("value_{}", i));
}
```

**å½±å“**:

- å¼‚æ­¥åœºæ™¯ä¸‹çš„å†…å­˜åˆ†é…æ€§èƒ½æå‡
- HashMap æ“ä½œæ›´å¿«
- å†…å­˜ç¢ç‰‡å‡å°‘

---

## ğŸ“š ç›¸å…³æ–‡æ¡£ {#-ç›¸å…³æ–‡æ¡£}

- [æ‰€æœ‰æƒç³»ç»Ÿå®Œæ•´æ–‡æ¡£](../../../crates/c01_ownership_borrow_scope/docs/)
- [æ‰€æœ‰æƒç³»ç»Ÿ README](../../../crates/c01_ownership_borrow_scope/README.md)

## ğŸ§© ç›¸å…³ç¤ºä¾‹ä»£ç  {#-ç›¸å…³ç¤ºä¾‹ä»£ç }

ä»¥ä¸‹ç¤ºä¾‹ä½äº `crates/c01_ownership_borrow_scope/examples/`ï¼Œå¯ç›´æ¥è¿è¡Œï¼ˆä¾‹å¦‚ï¼š`cargo run -p c01_ownership_borrow_scope --example moving00`ï¼‰ã€‚

- [æ‰€æœ‰æƒè½¬ç§»ä¸ç§»åŠ¨](../../../crates/c01_ownership_borrow_scope/examples/moving00.rs)ï½[moving06.rs](../../../crates/c01_ownership_borrow_scope/examples/moving06.rs)
- [ä½œç”¨åŸŸä¸é«˜çº§æ‰€æœ‰æƒ](../../../crates/c01_ownership_borrow_scope/examples/scope01.rs)ã€[advanced_scope_examples.rs](../../../crates/c01_ownership_borrow_scope/examples/advanced_scope_examples.rs)ã€[advanced_ownership_examples.rs](../../../crates/c01_ownership_borrow_scope/examples/advanced_ownership_examples.rs)ã€[comprehensive_ownership_examples.rs](../../../crates/c01_ownership_borrow_scope/examples/comprehensive_ownership_examples.rs)
- [Rust 1.91/1.92 ç‰¹æ€§æ¼”ç¤º](../../../crates/c01_ownership_borrow_scope/examples/rust_191_features_demo.rs)ã€[rust_192_features_demo.rs](../../../crates/c01_ownership_borrow_scope/examples/rust_192_features_demo.rs)

---

## ğŸ“š ç›¸å…³èµ„æº {#-ç›¸å…³èµ„æº}

### å®˜æ–¹æ–‡æ¡£

- [Rust æ‰€æœ‰æƒæ–‡æ¡£](https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html)
- [Rust Reference - Ownership](https://doc.rust-lang.org/reference/ownership.html)

### é¡¹ç›®å†…éƒ¨æ–‡æ¡£

- [æ‰€æœ‰æƒç³»ç»Ÿå®Œæ•´æ–‡æ¡£](../../../crates/c01_ownership_borrow_scope/docs/)
- [æ‰€æœ‰æƒå½¢å¼åŒ–ç ”ç©¶](../../research_notes/formal_methods/ownership_model.md)
- [ç”Ÿå‘½å‘¨æœŸå½¢å¼åŒ–](../../research_notes/formal_methods/lifetime_formalization.md)

### ç›¸å…³é€ŸæŸ¥å¡

- [ç±»å‹ç³»ç»Ÿé€ŸæŸ¥å¡](./type_system.md) - ç±»å‹ä¸æ‰€æœ‰æƒ
- [ç”Ÿå‘½å‘¨æœŸé€ŸæŸ¥å¡](./type_system.md#ç”Ÿå‘½å‘¨æœŸ) - ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨
- [æ™ºèƒ½æŒ‡é’ˆé€ŸæŸ¥å¡](./smart_pointers_cheatsheet.md) - æ‰€æœ‰æƒä¸æ™ºèƒ½æŒ‡é’ˆ
- [å€Ÿç”¨æ£€æŸ¥å™¨é€ŸæŸ¥å¡](./ownership_cheatsheet.md#å€Ÿç”¨è§„åˆ™) - å€Ÿç”¨è§„åˆ™è¯¦è§£
- [é”™è¯¯å¤„ç†é€ŸæŸ¥å¡](./error_handling_cheatsheet.md) - æ‰€æœ‰æƒä¸é”™è¯¯å¤„ç†

---

**æœ€åæ›´æ–°**: 2026-01-27
**Rust ç‰ˆæœ¬**: 1.93.0+ (Edition 2024)
**æ‰“å°å‹å¥½**: å¯ç›´æ¥æ‰“å°ä¸ºæ¡Œé¢å‚è€ƒ

ğŸ¦€ **Rust æ‰€æœ‰æƒï¼Œå®‰å…¨ä¸æ€§èƒ½çš„å®Œç¾å¹³è¡¡ï¼**
