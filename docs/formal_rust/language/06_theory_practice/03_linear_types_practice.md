# Rust 线性类型与仿射类型工程实践 {#线性类型实践}

## 📊 目录

- [Rust 线性类型与仿射类型工程实践 {#线性类型实践}](#rust-线性类型与仿射类型工程实践-线性类型实践)
  - [📊 目录](#-目录)
  - [章节导航](#章节导航)
  - [线性类型理论基础](#线性类型理论基础)
  - [仿射类型与可丢弃性](#仿射类型与可丢弃性)
  - [资源唯一性与不可复制](#资源唯一性与不可复制)
  - [工程实现与惯用法](#工程实现与惯用法)
  - [形式化定义与定理](#形式化定义与定理)
  - [工程案例与代码示例](#工程案例与代码示例)
    - [1. Box所有权移动](#1-box所有权移动)
    - [2. 不可复制资源类型](#2-不可复制资源类型)
    - [3. Copy类型与非Copy类型](#3-copy类型与非copy类型)
  - [交叉引用](#交叉引用)

**章节编号**: 06-03  
**主题**: 线性/仿射类型、资源唯一性、工程应用  
**最后更新**: 2024-12-30  
**维护者**: Rust形式化团队

---

## 章节导航

- [Rust 线性类型与仿射类型工程实践 {#线性类型实践}](#rust-线性类型与仿射类型工程实践-线性类型实践)
  - [📊 目录](#-目录)
  - [章节导航](#章节导航)
  - [线性类型理论基础](#线性类型理论基础)
  - [仿射类型与可丢弃性](#仿射类型与可丢弃性)
  - [资源唯一性与不可复制](#资源唯一性与不可复制)
  - [工程实现与惯用法](#工程实现与惯用法)
  - [形式化定义与定理](#形式化定义与定理)
  - [工程案例与代码示例](#工程案例与代码示例)
    - [1. Box所有权移动](#1-box所有权移动)
    - [2. 不可复制资源类型](#2-不可复制资源类型)
    - [3. Copy类型与非Copy类型](#3-copy类型与非copy类型)
  - [交叉引用](#交叉引用)

---

## 线性类型理论基础

- **线性类型（Linear Types）**：每个值只能被使用一次，禁止复制与丢弃。
- **理论意义**：静态保证资源唯一性，防止悬垂指针、二次释放。
- **Rust实现**：所有权系统本质为仿射类型（Affine Types），允许丢弃但禁止隐式复制。

---

## 仿射类型与可丢弃性

- **仿射类型（Affine Types）**：每个值最多被使用一次，可丢弃但不可复制。
- **Copy trait**：实现Copy的类型可隐式复制（如整数、浮点数），大多数资源类型不可Copy。
- **Drop trait**：自定义析构，结合仿射类型保证资源安全释放。

---

## 资源唯一性与不可复制

- **唯一性（Uniqueness）**：Box、Vec、File等资源类型默认不可复制，所有权移动后原变量失效。
- **move语义**：所有权移动后原变量不可再用，防止二次释放。
- **不可变借用/可变借用**：借用期间所有权不移动，生命周期受限。

---

## 工程实现与惯用法

- **Box、Vec、String**：堆分配资源，move后原变量失效。
- **文件/网络/锁**：File、TcpStream、Mutex等不可Copy，所有权严格管理。
- **自定义不可复制类型**：不实现Copy trait，结合Drop实现资源管理。
- **借用与生命周期**：通过&/&mut安全访问资源，静态防悬垂。

---

## 形式化定义与定理

- **定义 3.1 (线性类型唯一性)**

  ```text
  ∀x: Linear, ∃! use(x)
  ```

- **定理 3.1 (仿射类型可丢弃性)**

  ```text
  ∀x: Affine, use(x) ≤ 1
  ```

- **定理 3.2 (所有权移动安全)**

  ```text
  move(x) ⇒ x失效，防止二次释放
  ```

- **定理 3.3 (无悬垂指针/二次释放)**

  ```text
  Rust类型系统 ⊢ ¬(悬垂指针 ∨ 二次释放)
  ```

---

## 工程案例与代码示例

### 1. Box所有权移动

```rust
fn main() {
    let b = Box::new(1);
    let c = b; // move，b失效
    // println!("{}", b); // 编译错误：b已失效
}
```

### 2. 不可复制资源类型

```rust
use std::fs::File;
fn main() {
    let f1 = File::create("foo.txt").unwrap();
    // let f2 = f1; // move，f1失效
    // let f3 = f1; // 编译错误：f1已失效
}
```

### 3. Copy类型与非Copy类型

```rust
fn main() {
    let x = 1; // i32实现Copy
    let y = x; // x仍可用
    let s = String::from("hi");
    let t = s; // move，s失效
}
```

---

## 交叉引用

- [资源管理模型](./01_resource_management.md)
- [RAII模式应用](./02_raii_patterns.md)
- [所有权与借用](../01_ownership_borrowing/)
- [类型系统核心](../03_type_system_core/)
- [并发与性能优化](../05_concurrency/)
- [设计模式与应用案例](../09_design_patterns/)

---

> 本文档为Rust线性/仿射类型工程实践的理论与工程索引，后续章节将递归细化各子主题。

"

---
