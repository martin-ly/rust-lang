# 设计分层：程序设计模型 / 算法设计模型 / 架构设计模型

## 📊 目录

- [设计分层：程序设计模型 / 算法设计模型 / 架构设计模型](#设计分层程序设计模型--算法设计模型--架构设计模型)
  - [📊 目录](#-目录)
  - [📋 目录](#-目录-1)
  - [三层分工](#三层分工)
  - [映射关系](#映射关系)
  - [Rust 1.90 实践](#rust-190-实践)
  - [三层矩阵与实践清单（补充）](#三层矩阵与实践清单补充)
    - [术语/语义对齐速查](#术语语义对齐速查)

## 📋 目录

- [设计分层：程序设计模型 / 算法设计模型 / 架构设计模型](#设计分层程序设计模型--算法设计模型--架构设计模型)
  - [📊 目录](#-目录)
  - [📋 目录](#-目录-1)
  - [三层分工](#三层分工)
  - [映射关系](#映射关系)
  - [Rust 1.90 实践](#rust-190-实践)
  - [三层矩阵与实践清单（补充）](#三层矩阵与实践清单补充)
    - [术语/语义对齐速查](#术语语义对齐速查)

## 三层分工

- 程序设计模型：抽象数据类型、模块化、错误边界、资源所有权。
- 算法设计模型：分治、动态规划、贪心、图/流/几何、概率方法。
- 架构设计模型：CSP/Actor、微服务、中间件、事件风暴、CQRS/ES。
- 扩展：并发/异步语义（结构化并发、背压、取消）横切三层，需要在接口与契约中显式化。

## 映射关系

- 程序层的不变式 → 算法层的正确性与复杂度保证 → 架构层的可观测性与SLO。
- 背压/限流/重试在架构层提供稳定性，在程序层体现为资源边界。
- 类型系统与错误语义应在三层保持一致：错误分类（可重试、不可重试、幂等冲突）。

## Rust 1.90 实践

- 错误边界：`Result` + `thiserror` 分层错误；
- 可观测性：`tracing` 埋点与 `instrument`；
- 并发：以 `tower` 组合 `timeout`/`retry`/`limit`，与 `async-channel` 背压对齐。
- 合同测试：以契约用例覆盖接口语义（超时、取消、重试、幂等），避免层间语义漂移。

## 三层矩阵与实践清单（补充）

| 层次 | 关键关注点 | Rust 实践 | 校验 |
|------|------------|-----------|------|
| 程序 | 所有权/错误边界/资源释放 | `Result`/`thiserror`/`Drop` | 单元/属性测试 |
| 算法 | 复杂度/并行度/内存局部性 | 分片、批处理、W-D 分析 | 基准/剖析 |
| 架构 | 背压/限流/可观测/一致性 | `tower`、有界队列、tracing | e2e SLO 验证 |

### 术语/语义对齐速查

- 取消（Cancellation）：父级到子级的终止意图传播；接口需定义是否幂等与可重入。
- 超时（Timeout）：时限保证；超过即失败并释放资源；可与重试配合。
- 背压（Backpressure）：以容量与速率约束实现稳态；对上游显式反馈。

检查：是否每条通路定义了容量、超时、重试与降级；是否具备可观测性埋点。
