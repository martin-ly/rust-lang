# Tier 4: 测试与基准

> **文档类型**: 高级主题  
> **难度**: ⭐⭐⭐  
> **适用版本**: Rust 1.90+

---

## 单元测试

**测试进程创建**:

```rust
#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_spawn_echo() {
        let output = Command::new("echo")
            .arg("test")
            .output()
            .expect("Failed to spawn");
        
        assert!(output.status.success());
        assert_eq!(output.stdout, b"test\n");
    }
    
    #[test]
    fn test_spawn_failure() {
        let result = Command::new("nonexistent").spawn();
        assert!(result.is_err());
    }
}
```

---

## 集成测试

**进程通信测试**:

```rust
#[tokio::test]
async fn test_process_communication() {
    let mut child = Command::new("cat")
        .stdin(Stdio::piped())
        .stdout(Stdio::piped())
        .spawn()
        .unwrap();
    
    let mut stdin = child.stdin.take().unwrap();
    stdin.write_all(b"hello").await.unwrap();
    drop(stdin);
    
    let output = child.wait_with_output().await.unwrap();
    assert_eq!(output.stdout, b"hello");
}
```

---

## 性能基准

**基准测试**:

```rust
use criterion::{criterion_group, criterion_main, Criterion};

fn benchmark_process(c: &mut Criterion) {
    c.bench_function("spawn_simple", |b| {
        b.iter(|| Command::new("true").status())
    });
}

criterion_group!(benches, benchmark_process);
criterion_main!(benches);
```

---

**文档维护**: Documentation Team  
**创建日期**: 2025-10-22
