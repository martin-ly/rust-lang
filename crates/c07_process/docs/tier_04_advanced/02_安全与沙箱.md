# Tier 4: 安全与沙箱

> **文档类型**: 高级主题  
> **难度**: ⭐⭐⭐⭐  
> **适用版本**: Rust 1.90+

---

## 进程隔离

**权限降级 (Unix)**:

```rust
#[cfg(unix)]
use std::os::unix::process::CommandExt;
use nix::unistd::{User, Group};

#[cfg(unix)]
fn drop_privileges(cmd: &mut Command, user: &str) -> Result<()> {
    let user = User::from_name(user)?
        .ok_or("User not found")?;
    
    cmd.uid(user.uid.as_raw());
    cmd.gid(user.gid.as_raw());
    
    Ok(())
}
```

---

## 资源限制

**限制CPU和内存 (Unix)**:

```rust
#[cfg(unix)]
use nix::sys::resource::{setrlimit, Resource};

#[cfg(unix)]
fn set_resource_limits() -> Result<()> {
    // 限制CPU时间（秒）
    setrlimit(Resource::RLIMIT_CPU, 10, 10)?;
    
    // 限制内存（字节）
    setrlimit(Resource::RLIMIT_AS, 100 * 1024 * 1024, 100 * 1024 * 1024)?;
    
    Ok(())
}
```

---

## 命名空间 (Linux)

**容器化进程**:

```rust
#[cfg(target_os = "linux")]
use nix::sched::{unshare, CloneFlags};

#[cfg(target_os = "linux")]
fn create_namespace() -> Result<()> {
    // 创建新的命名空间
    unshare(
        CloneFlags::CLONE_NEWPID |  // 进程命名空间
        CloneFlags::CLONE_NEWNS |   // 挂载命名空间
        CloneFlags::CLONE_NEWNET    // 网络命名空间
    )?;
    
    Ok(())
}
```

---

**参考**: [跨平台实践](../tier_02_guides/04_跨平台实践.md)

---

**文档维护**: Documentation Team  
**创建日期**: 2025-10-22
