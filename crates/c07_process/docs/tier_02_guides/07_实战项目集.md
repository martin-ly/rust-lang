# ⚙️ C07: Process & System Programming - 实战项目集

> **创建日期**: 2025-10-25  
> **文档版本**: v1.0  
> **适用模块**: C07 进程和系统编程  
> **目标**: 通过实战项目掌握进程管理和系统编程

---

## 📋 项目概览

| # | 项目名称 | 难度 | 预计时间 | 核心概念 |
|---|----------|------|---------|---------|
| 1 | [命令执行器](#项目1-命令执行器) | ⭐ | 1-2小时 | Command、stdin/stdout |
| 2 | [管道通信](#项目2-管道通信) | ⭐⭐ | 2-3小时 | Stdio、进程间通信 |
| 3 | [进程池管理器](#项目3-进程池管理器) | ⭐⭐⭐ | 3-4小时 | 进程管理、错误处理 |

---

## 项目1: 命令执行器

### 📖 项目说明

**难度**: ⭐  
**预计时间**: 1-2小时

### 核心代码

```rust
use std::process::{Command, Stdio};
use std::io::{self, Write};

fn main() {
    println!("===== 命令执行器 =====\n");
    
    loop {
        print!("$ ");
        io::stdout().flush().unwrap();
        
        let mut input = String::new();
        io::stdin().read_line(&mut input).unwrap();
        
        let input = input.trim();
        
        if input == "exit" {
            break;
        }
        
        let parts: Vec<&str> = input.split_whitespace().collect();
        if parts.is_empty() {
            continue;
        }
        
        let cmd = parts[0];
        let args = &parts[1..];
        
        match Command::new(cmd)
            .args(args)
            .stdout(Stdio::inherit())
            .stderr(Stdio::inherit())
            .spawn()
        {
            Ok(mut child) => {
                match child.wait() {
                    Ok(status) => {
                        println!("退出码: {}\n", status);
                    }
                    Err(e) => {
                        println!("❌ 等待失败: {}\n", e);
                    }
                }
            }
            Err(e) => {
                println!("❌ 执行失败: {}\n", e);
            }
        }
    }
}
```

---

## 项目2: 管道通信

### 📖 项目说明2

**难度**: ⭐⭐  
**预计时间**: 2-3小时

### 核心代码2

```rust
use std::process::{Command, Stdio};
use std::io::Write;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    println!("===== 管道通信测试 =====\n");
    
    // 示例1: 向进程写入数据
    {
        println!("示例1: stdin 写入");
        
        let mut child = Command::new("grep")
            .arg("rust")
            .stdin(Stdio::piped())
            .stdout(Stdio::piped())
            .spawn()?;
        
        let stdin = child.stdin.as_mut().unwrap();
        stdin.write_all(b"hello world\n")?;
        stdin.write_all(b"rust programming\n")?;
        stdin.write_all(b"python code\n")?;
        
        let output = child.wait_with_output()?;
        println!("输出:\n{}\n", String::from_utf8_lossy(&output.stdout));
    }
    
    // 示例2: 管道链
    {
        println!("示例2: 命令管道");
        
        let ps = Command::new("ps")
            .arg("aux")
            .stdout(Stdio::piped())
            .spawn()?;
        
        let grep = Command::new("grep")
            .arg("rust")
            .stdin(ps.stdout.unwrap())
            .stdout(Stdio::piped())
            .spawn()?;
        
        let output = grep.wait_with_output()?;
        println!("结果:\n{}", String::from_utf8_lossy(&output.stdout));
    }
    
    Ok(())
}
```

---

## 项目3: 进程池管理器

### 📖 项目说明3

**难度**: ⭐⭐⭐  
**预计时间**: 3-4小时

### 核心代码3

```rust
use std::process::{Command, Child};
use std::collections::HashMap;
use std::io;

struct ProcessPool {
    processes: HashMap<String, Child>,
}

impl ProcessPool {
    fn new() -> Self {
        ProcessPool {
            processes: HashMap::new(),
        }
    }
    
    fn spawn(&mut self, name: String, cmd: &str, args: &[&str]) -> io::Result<()> {
        let child = Command::new(cmd)
            .args(args)
            .spawn()?;
        
        self.processes.insert(name, child);
        Ok(())
    }
    
    fn kill(&mut self, name: &str) -> io::Result<()> {
        if let Some(child) = self.processes.get_mut(name) {
            child.kill()?;
            println!("❌ 终止进程: {}", name);
        }
        Ok(())
    }
    
    fn wait(&mut self, name: &str) -> io::Result<()> {
        if let Some(mut child) = self.processes.remove(name) {
            let status = child.wait()?;
            println!("✅ 进程 {} 退出: {}", name, status);
        }
        Ok(())
    }
    
    fn list(&self) {
        println!("当前进程:");
        for (name, child) in &self.processes {
            println!("  - {}: PID {}", name, child.id());
        }
    }
}

fn main() -> io::Result<()> {
    println!("===== 进程池管理器 =====\n");
    
    let mut pool = ProcessPool::new();
    
    // 启动多个进程
    pool.spawn("sleep1".to_string(), "sleep", &["5"])?;
    pool.spawn("sleep2".to_string(), "sleep", &["10"])?;
    
    pool.list();
    
    // 等待进程
    pool.wait("sleep1")?;
    
    // 终止进程
    pool.kill("sleep2")?;
    
    Ok(())
}
```

---

## 📝 总结

### 关键概念

| 概念 | 项目1 | 项目2 | 项目3 |
|------|-------|-------|-------|
| Command | ✅✅✅ | ✅✅✅ | ✅✅✅ |
| Stdio | ✅✅ | ✅✅✅ | ✅ |
| 进程管理 | ✅ | ✅✅ | ✅✅✅ |
| 进程间通信 | ❌ | ✅✅✅ | ✅ |

---

**文档版本**: v1.0  
**创建日期**: 2025-10-25

**🎯 掌握进程管理，构建系统级应用！🦀**-
