# C10 Networks æµ‹è¯•æŒ‡å—

> é€‚ç”¨èŒƒå›´ï¼šRust 1.90+ï¼ŒTokio 1.35+ã€‚æ–‡æ¡£é£æ ¼éµå¾ª [`STYLE.md`](../docs/STYLE.md)ã€‚

## ğŸ“‹ ç›®å½•

- [C10 Networks æµ‹è¯•æŒ‡å—](#c10-networks-æµ‹è¯•æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ æ¦‚è¿°](#-æ¦‚è¿°)
    - [æµ‹è¯•ç±»å‹](#æµ‹è¯•ç±»å‹)
    - [æµ‹è¯•ç»“æ„](#æµ‹è¯•ç»“æ„)
  - [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
    - [è¿è¡Œæ‰€æœ‰æµ‹è¯•](#è¿è¡Œæ‰€æœ‰æµ‹è¯•)
    - [è¿è¡Œç‰¹å®šæµ‹è¯•](#è¿è¡Œç‰¹å®šæµ‹è¯•)
    - [æµ‹è¯•é…ç½®](#æµ‹è¯•é…ç½®)
  - [ğŸ“ æµ‹è¯•æ–‡ä»¶è¯´æ˜](#-æµ‹è¯•æ–‡ä»¶è¯´æ˜)
    - [å•å…ƒæµ‹è¯•](#å•å…ƒæµ‹è¯•)
    - [é›†æˆæµ‹è¯•](#é›†æˆæµ‹è¯•)
    - [æ€§èƒ½æµ‹è¯•](#æ€§èƒ½æµ‹è¯•)
    - [å®‰å…¨æµ‹è¯•](#å®‰å…¨æµ‹è¯•)
    - [åè®®æµ‹è¯•](#åè®®æµ‹è¯•)
    - [DNSæµ‹è¯•](#dnsæµ‹è¯•)
    - [æµ‹è¯•è¿è¡Œå™¨](#æµ‹è¯•è¿è¡Œå™¨)
  - [âš™ï¸ æµ‹è¯•é…ç½®](#ï¸-æµ‹è¯•é…ç½®)
    - [ç¯å¢ƒå˜é‡](#ç¯å¢ƒå˜é‡)
    - [æµ‹è¯•ç‰¹æ€§](#æµ‹è¯•ç‰¹æ€§)
  - [ğŸ”§ æµ‹è¯•å·¥å…·](#-æµ‹è¯•å·¥å…·)
    - [æµ‹è¯•è¿è¡Œå™¨](#æµ‹è¯•è¿è¡Œå™¨-1)
    - [æµ‹è¯•æŠ¥å‘Š](#æµ‹è¯•æŠ¥å‘Š)
    - [æ€§èƒ½åŸºå‡†](#æ€§èƒ½åŸºå‡†)
  - [â“ å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)
    - [Q: å¦‚ä½•è·³è¿‡ç½‘ç»œæµ‹è¯•ï¼Ÿ](#q-å¦‚ä½•è·³è¿‡ç½‘ç»œæµ‹è¯•)
    - [Q: å¦‚ä½•è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼Ÿ](#q-å¦‚ä½•è¿è¡Œæ€§èƒ½æµ‹è¯•)
    - [Q: å¦‚ä½•è°ƒè¯•æµ‹è¯•å¤±è´¥ï¼Ÿ](#q-å¦‚ä½•è°ƒè¯•æµ‹è¯•å¤±è´¥)
    - [Q: å¦‚ä½•æ·»åŠ æ–°æµ‹è¯•ï¼Ÿ](#q-å¦‚ä½•æ·»åŠ æ–°æµ‹è¯•)
    - [Q: æµ‹è¯•è¦†ç›–ç‡å¦‚ä½•æŸ¥çœ‹ï¼Ÿ](#q-æµ‹è¯•è¦†ç›–ç‡å¦‚ä½•æŸ¥çœ‹)

## ğŸ¯ æ¦‚è¿°

C10 Networks æä¾›äº†å…¨é¢çš„æµ‹è¯•å¥—ä»¶ï¼Œç¡®ä¿åº“çš„åŠŸèƒ½æ­£ç¡®æ€§ã€æ€§èƒ½è¡¨ç°å’Œå®‰å…¨æ€§ã€‚æµ‹è¯•è¦†ç›–äº†ä»åŸºç¡€çš„æ•°æ®åŒ…å¤„ç†åˆ°å¤æ‚çš„ç½‘ç»œåè®®å®ç°ã€‚

### æµ‹è¯•ç±»å‹

- **å•å…ƒæµ‹è¯•**: æµ‹è¯•å•ä¸ªæ¨¡å—å’Œå‡½æ•°çš„åŠŸèƒ½
- **é›†æˆæµ‹è¯•**: æµ‹è¯•æ¨¡å—é—´çš„åä½œå’Œæ•´ä½“åŠŸèƒ½
- **æ€§èƒ½æµ‹è¯•**: éªŒè¯æ€§èƒ½æŒ‡æ ‡å’ŒåŸºå‡†æµ‹è¯•
- **å®‰å…¨æµ‹è¯•**: æ£€æŸ¥å®‰å…¨æœºåˆ¶å’Œé˜²æŠ¤æªæ–½
- **åè®®æµ‹è¯•**: éªŒè¯ç½‘ç»œåè®®çš„æ­£ç¡®å®ç°
- **DNSæµ‹è¯•**: æµ‹è¯•DNSè§£æåŠŸèƒ½

### æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ unit_tests.rs          # å•å…ƒæµ‹è¯•
â”œâ”€â”€ integration_tests.rs   # é›†æˆæµ‹è¯•
â”œâ”€â”€ performance_tests.rs   # æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ security_tests.rs      # å®‰å…¨æµ‹è¯•
â”œâ”€â”€ protocol_tests.rs     # åè®®æµ‹è¯•
â”œâ”€â”€ dns_tests.rs          # DNSæµ‹è¯•
â”œâ”€â”€ test_runner.rs        # æµ‹è¯•è¿è¡Œå™¨
â””â”€â”€ README.md             # æµ‹è¯•æŒ‡å—
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆåŒ…æ‹¬æ–‡æ¡£æµ‹è¯•ï¼‰
cargo test --all

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¾“å‡º
cargo test -- --nocapture
```

### è¿è¡Œç‰¹å®šæµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
cargo test --test unit_tests

# è¿è¡Œé›†æˆæµ‹è¯•
cargo test --test integration_tests

# è¿è¡Œæ€§èƒ½æµ‹è¯•
cargo test --test performance_tests

# è¿è¡Œå®‰å…¨æµ‹è¯•
cargo test --test security_tests

# è¿è¡Œåè®®æµ‹è¯•
cargo test --test protocol_tests

# è¿è¡ŒDNSæµ‹è¯•
cargo test --test dns_tests

# è¿è¡Œæµ‹è¯•è¿è¡Œå™¨
cargo test --test test_runner
```

### æµ‹è¯•é…ç½®

```bash
# è·³è¿‡ç½‘ç»œæµ‹è¯•
C10_SKIP_NETWORK_TESTS=1 cargo test

# å¯ç”¨DNSæµ‹è¯•
C10_DNS_TESTS=1 cargo test --test dns_tests

# è¿è¡Œç‰¹å®šæµ‹è¯•å‡½æ•°
cargo test test_packet_creation

# è¿è¡ŒåŒ…å«ç‰¹å®šå­—ç¬¦ä¸²çš„æµ‹è¯•
cargo test -- packet
```

## ğŸ“ æµ‹è¯•æ–‡ä»¶è¯´æ˜

### å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: `unit_tests.rs`

æµ‹è¯•å„ä¸ªæ¨¡å—çš„åŸºæœ¬åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- é”™è¯¯å¤„ç†æ¨¡å—æµ‹è¯•
- æ•°æ®åŒ…åˆ›å»ºå’Œæ“ä½œæµ‹è¯•
- HTTPåè®®åŸºæœ¬åŠŸèƒ½æµ‹è¯•
- WebSocketåè®®åŸºæœ¬åŠŸèƒ½æµ‹è¯•
- å¥—æ¥å­—é…ç½®æµ‹è¯•
- æ•°æ®åŒ…åºåˆ—åŒ–æµ‹è¯•

**è¿è¡Œæ–¹å¼**:
```bash
cargo test --test unit_tests
```

### é›†æˆæµ‹è¯•

**æ–‡ä»¶**: `integration_tests.rs`

æµ‹è¯•æ¨¡å—é—´çš„åä½œå’Œæ•´ä½“åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- TCP/UDPå¥—æ¥å­—é›†æˆæµ‹è¯•
- HTTP/WebSocketåè®®é›†æˆæµ‹è¯•
- TCPè¿æ¥ç®¡ç†å’Œè¿æ¥æ± æµ‹è¯•
- æ•°æ®åŒ…å¤„ç†æµæ°´çº¿æµ‹è¯•
- é”™è¯¯å¤„ç†å’Œæ¢å¤æµ‹è¯•
- å¹¶å‘å¤„ç†æµ‹è¯•
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- è¶…æ—¶å¤„ç†æµ‹è¯•
- å†…å­˜ä½¿ç”¨æµ‹è¯•

**è¿è¡Œæ–¹å¼**:
```bash
cargo test --test integration_tests
```

### æ€§èƒ½æµ‹è¯•

**æ–‡ä»¶**: `performance_tests.rs`

éªŒè¯æ€§èƒ½æŒ‡æ ‡å’ŒåŸºå‡†æµ‹è¯•ï¼ŒåŒ…æ‹¬ï¼š

- æ•°æ®åŒ…åˆ›å»ºæ€§èƒ½æµ‹è¯•
- æ•°æ®åŒ…æ„å»ºå™¨æ€§èƒ½æµ‹è¯•
- æ•°æ®åŒ…ç»Ÿè®¡æ€§èƒ½æµ‹è¯•
- HTTPè¯·æ±‚/å“åº”åˆ›å»ºæ€§èƒ½æµ‹è¯•
- WebSocketå¸§åˆ›å»ºæ€§èƒ½æµ‹è¯•
- WebSocketæ¡æ‰‹è¯·æ±‚æ€§èƒ½æµ‹è¯•
- æ•°æ®åŒ…åºåˆ—åŒ–/ååºåˆ—åŒ–æ€§èƒ½æµ‹è¯•
- å†…å­˜åˆ†é…æ€§èƒ½æµ‹è¯•
- å¹¶å‘æ•°æ®åŒ…å¤„ç†æ€§èƒ½æµ‹è¯•
- å¤§æ•°æ®åŒ…å¤„ç†æ€§èƒ½æµ‹è¯•
- æ•°æ®åŒ…è¿‡æ»¤å™¨æ€§èƒ½æµ‹è¯•
- é”™è¯¯å¤„ç†æ€§èƒ½æµ‹è¯•
- æ•°æ®åŒ…ç±»å‹æ¯”è¾ƒæ€§èƒ½æµ‹è¯•

**è¿è¡Œæ–¹å¼**:
```bash
cargo test --test performance_tests
```

### å®‰å…¨æµ‹è¯•

**æ–‡ä»¶**: `security_tests.rs`

æ£€æŸ¥å®‰å…¨æœºåˆ¶å’Œé˜²æŠ¤æªæ–½ï¼ŒåŒ…æ‹¬ï¼š

- æ¶æ„æ•°æ®åŒ…æ£€æµ‹æµ‹è¯•
- HTTPå®‰å…¨å¤´éƒ¨éªŒè¯æµ‹è¯•
- WebSocketå®‰å…¨éªŒè¯æµ‹è¯•
- è¾“å…¥éªŒè¯å’Œæ¸…ç†æµ‹è¯•
- æ•°æ®åŒ…å¤§å°é™åˆ¶æµ‹è¯•
- åºåˆ—å·å®‰å…¨æµ‹è¯•
- é”™è¯¯å¤„ç†å®‰å…¨æµ‹è¯•
- ç½‘ç»œé”™è¯¯å®‰å…¨æµ‹è¯•
- æ•°æ®åŒ…ç±»å‹å®‰å…¨æµ‹è¯•
- ACMEç®¡ç†å™¨å®‰å…¨æµ‹è¯•
- æ•°æ®åŒ…è¿‡æ»¤å®‰å…¨æµ‹è¯•
- å¹¶å‘å®‰å…¨æµ‹è¯•
- å†…å­˜å®‰å…¨æµ‹è¯•
- è¾¹ç•Œæ¡ä»¶å®‰å…¨æµ‹è¯•
- åè®®å®‰å…¨æµ‹è¯•

**è¿è¡Œæ–¹å¼**:
```bash
cargo test --test security_tests
```

### åè®®æµ‹è¯•

**æ–‡ä»¶**: `protocol_tests.rs`

éªŒè¯ç½‘ç»œåè®®çš„æ­£ç¡®å®ç°ï¼ŒåŒ…æ‹¬ï¼š

- HTTPåè®®å®ç°æµ‹è¯•
- HTTPæ–¹æ³•æšä¸¾æµ‹è¯•
- HTTPçŠ¶æ€ç æµ‹è¯•
- HTTPç‰ˆæœ¬æµ‹è¯•
- WebSocketåè®®å®ç°æµ‹è¯•
- WebSocketæ¡æ‰‹è¯·æ±‚æµ‹è¯•
- WebSocketæ“ä½œç æµ‹è¯•
- TCPåè®®å®ç°æµ‹è¯•
- TCPçŠ¶æ€æœºæµ‹è¯•
- TCPæ‹¥å¡æ§åˆ¶æµ‹è¯•
- å¥—æ¥å­—é…ç½®æµ‹è¯•
- åè®®æ•°æ®åŒ…æµ‹è¯•
- åè®®é”™è¯¯å¤„ç†æµ‹è¯•
- åè®®å…¼å®¹æ€§æµ‹è¯•
- åè®®æ€§èƒ½æµ‹è¯•
- åè®®è¾¹ç•Œæ¡ä»¶æµ‹è¯•

**è¿è¡Œæ–¹å¼**:
```bash
cargo test --test protocol_tests
```

### DNSæµ‹è¯•

**æ–‡ä»¶**: `dns_tests.rs`

æµ‹è¯•DNSè§£æåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- ç³»ç»ŸDNSè§£ææµ‹è¯•
- DNS IPæŸ¥æ‰¾æµ‹è¯•
- DNS DoH/DoTæµ‹è¯•

**è¿è¡Œæ–¹å¼**:
```bash
# éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡
C10_DNS_TESTS=1 cargo test --test dns_tests
```

### æµ‹è¯•è¿è¡Œå™¨

**æ–‡ä»¶**: `test_runner.rs`

æä¾›ç»Ÿä¸€çš„æµ‹è¯•è¿è¡Œæ¥å£ï¼ŒåŒ…æ‹¬ï¼š

- æµ‹è¯•è¿è¡Œå™¨é…ç½®
- æµ‹è¯•ç»“æœç®¡ç†
- æµ‹è¯•å¥—ä»¶ç»“æœç»Ÿè®¡
- æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
- æµ‹è¯•é…ç½®éªŒè¯

**è¿è¡Œæ–¹å¼**:
```bash
cargo test --test test_runner
```

## âš™ï¸ æµ‹è¯•é…ç½®

### ç¯å¢ƒå˜é‡

| ç¯å¢ƒå˜é‡ | æè¿° | é»˜è®¤å€¼ |
| --- | --- | --- |
| `C10_SKIP_NETWORK_TESTS` | è·³è¿‡ç½‘ç»œç›¸å…³æµ‹è¯• | `0` |
| `C10_DNS_TESTS` | å¯ç”¨DNSæµ‹è¯• | `0` |
| `C10_TCP_ADDRESS` | TCPæµ‹è¯•åœ°å€ | `127.0.0.1:8080` |
| `C10_TCP_TIMEOUT` | TCPè¶…æ—¶æ—¶é—´ | `30ç§’` |
| `C10_TCP_BUFFER_SIZE` | TCPç¼“å†²åŒºå¤§å° | `8192å­—èŠ‚` |
| `C10_TCP_KEEP_ALIVE` | å¯ç”¨TCP Keep-Alive | `true` |
| `C10_TCP_NODELAY` | å¯ç”¨TCP_NODELAY | `true` |
| `C10_WS_DEMO_HOST` | WebSocketæµ‹è¯•ä¸»æœº | `example.com` |
| `C10_WS_DEMO_PATH` | WebSocketæµ‹è¯•è·¯å¾„ | `/chat` |
| `C10_WS_DEMO_KEY` | WebSocketæµ‹è¯•å¯†é’¥ | è‡ªåŠ¨ç”Ÿæˆ |
| `C10_P2P_LISTEN_ADDR` | P2Pç›‘å¬åœ°å€ | `/ip4/0.0.0.0/tcp/0` |
| `C10_P2P_TOPIC` | P2Pè®¢é˜…ä¸»é¢˜ | `c10-demo` |
| `C10_P2P_PUBLISH_INTERVAL` | P2På‘å¸ƒé—´éš” | `5ç§’` |

### æµ‹è¯•ç‰¹æ€§

| ç‰¹æ€§ | æè¿° | æµ‹è¯•æ–‡ä»¶ |
| --- | --- | --- |
| `sniff` | æŠ“åŒ…åŠŸèƒ½æµ‹è¯• | `integration_tests.rs` |
| `offline` | ç¦»çº¿åˆ†ææµ‹è¯• | `integration_tests.rs` |
| `pcap_live` | å®æ—¶æŠ“åŒ…æµ‹è¯• | `integration_tests.rs` |
| `tls` | TLSåŠŸèƒ½æµ‹è¯• | `security_tests.rs` |

## ğŸ”§ æµ‹è¯•å·¥å…·

### æµ‹è¯•è¿è¡Œå™¨

æµ‹è¯•è¿è¡Œå™¨æä¾›äº†ç»Ÿä¸€çš„æµ‹è¯•æ‰§è¡Œæ¥å£ï¼š

```rust
use c10_networks::tests::test_runner::{TestRunner, TestRunnerConfig};

let config = TestRunnerConfig {
    run_unit_tests: true,
    run_integration_tests: true,
    run_performance_tests: true,
    run_security_tests: true,
    run_protocol_tests: true,
    run_dns_tests: true,
    skip_network_tests: false,
    verbose: false,
    timeout: Some(std::time::Duration::from_secs(300)),
};

let runner = TestRunner::new(config);
let results = runner.run_all_tests();
```

### æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•æŠ¥å‘Šç”Ÿæˆå™¨å¯ä»¥ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šï¼š

```rust
use c10_networks::tests::test_runner::TestReportGenerator;

let report = TestReportGenerator::generate_report(&results);
println!("{}", report);
```

### æ€§èƒ½åŸºå‡†

æ€§èƒ½æµ‹è¯•æä¾›äº†è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡ï¼š

```rust
// æ€§èƒ½æµ‹è¯•ç»“æœç¤ºä¾‹
println!("æ•°æ®åŒ…åˆ›å»ºæ€§èƒ½: {} ns/packet", avg_time);
println!("HTTPè¯·æ±‚åˆ›å»ºæ€§èƒ½: {} ns/request", avg_time);
println!("WebSocketå¸§åˆ›å»ºæ€§èƒ½: {} ns/frame", avg_time);
```

## â“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•è·³è¿‡ç½‘ç»œæµ‹è¯•ï¼Ÿ

A: è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
C10_SKIP_NETWORK_TESTS=1 cargo test
```

### Q: å¦‚ä½•è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼Ÿ

A: è¿è¡Œæ€§èƒ½æµ‹è¯•å¥—ä»¶ï¼š
```bash
cargo test --test performance_tests
```

### Q: å¦‚ä½•è°ƒè¯•æµ‹è¯•å¤±è´¥ï¼Ÿ

A: ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è°ƒè¯•ï¼š

1. **æ˜¾ç¤ºè¯¦ç»†è¾“å‡º**:
   ```bash
   cargo test --test unit_tests -- --nocapture
   ```

2. **è¿è¡Œå•ä¸ªæµ‹è¯•**:
   ```bash
   cargo test test_packet_creation -- --nocapture
   ```

3. **ä½¿ç”¨è°ƒè¯•æ¨¡å¼**:
   ```bash
   cargo test --test unit_tests -- --nocapture --test-threads=1
   ```

### Q: å¦‚ä½•æ·»åŠ æ–°æµ‹è¯•ï¼Ÿ

A: åœ¨ç›¸åº”çš„æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„æµ‹è¯•å‡½æ•°ï¼š

```rust
#[test]
fn test_new_functionality() {
    // æµ‹è¯•ä»£ç 
    assert!(condition);
}
```

### Q: æµ‹è¯•è¦†ç›–ç‡å¦‚ä½•æŸ¥çœ‹ï¼Ÿ

A: ä½¿ç”¨ `tarpaulin` å·¥å…·æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ï¼š

```bash
# å®‰è£… tarpaulin
cargo install cargo-tarpaulin

# è¿è¡Œè¦†ç›–ç‡æµ‹è¯•
cargo tarpaulin --out Html

# æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š
open tarpaulin-report.html
```

---

**æµ‹è¯•æŒ‡å—å®Œæˆï¼** ğŸ‰

ç°åœ¨æ‚¨å·²ç»äº†è§£äº† C10 Networks çš„å®Œæ•´æµ‹è¯•ä½“ç³»ï¼Œå¯ä»¥å¼€å§‹ç¼–å†™å’Œè¿è¡Œæµ‹è¯•äº†ã€‚

*æœ€åæ›´æ–°: 2025å¹´1æœˆ*
*æ–‡æ¡£ç‰ˆæœ¬: v1.0*
*ç»´æŠ¤è€…: C10 Networks å¼€å‘å›¢é˜Ÿ*
