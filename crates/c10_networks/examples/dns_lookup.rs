//! DNS æŸ¥è¯¢ç¤ºä¾‹
//!
//! è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ c10_networks åº“è¿›è¡Œ DNS æŸ¥è¯¢
//!
//! ## ğŸ“– ç†è®ºåŸºç¡€
//!
//! DNS (åŸŸåç³»ç»Ÿ) æ˜¯äº’è”ç½‘çš„ç›®å½•æœåŠ¡ï¼Œå°†åŸŸåæ˜ å°„åˆ° IP åœ°å€ï¼š
//!
//! - **åˆ†å±‚ç»“æ„**: æ ‘çŠ¶åŸŸåç©ºé—´
//! - **é€’å½’æŸ¥è¯¢**: å®¢æˆ·ç«¯å‘ DNS æœåŠ¡å™¨æŸ¥è¯¢
//! - **è¿­ä»£æŸ¥è¯¢**: DNS æœåŠ¡å™¨ä¹‹é—´çš„æŸ¥è¯¢
//! - **ç¼“å­˜æœºåˆ¶**: æé«˜æŸ¥è¯¢æ•ˆç‡
//!
//! ## ğŸ”¬ å®ç°åŸç†
//!
//! ### DNS è®°å½•ç±»å‹
//!
//! - **A è®°å½•**: IPv4 åœ°å€è®°å½•
//! - **AAAA è®°å½•**: IPv6 åœ°å€è®°å½•
//! - **MX è®°å½•**: é‚®ä»¶äº¤æ¢è®°å½•
//! - **TXT è®°å½•**: æ–‡æœ¬è®°å½•
//! - **SRV è®°å½•**: æœåŠ¡è®°å½•
//! - **PTR è®°å½•**: æŒ‡é’ˆè®°å½•ï¼ˆé€†å‘è§£æï¼‰
//!
//! ### DNS è§£æå™¨ç±»å‹
//!
//! - **ç³»ç»Ÿè§£æå™¨**: ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ DNS æœåŠ¡å™¨
//! - **DoH è§£æå™¨**: ä½¿ç”¨ DNS over HTTPS
//! - **DoT è§£æå™¨**: ä½¿ç”¨ DNS over TLS
//! - **è‡ªå®šä¹‰è§£æå™¨**: ä½¿ç”¨æŒ‡å®šçš„ DNS æœåŠ¡å™¨
//!
//! ## ğŸš€ ä½¿ç”¨åœºæ™¯
//!
//! - **åŸŸåè§£æ**: å°†åŸŸåè½¬æ¢ä¸º IP åœ°å€
//! - **é‚®ä»¶æœåŠ¡**: æŸ¥æ‰¾é‚®ä»¶æœåŠ¡å™¨
//! - **æœåŠ¡å‘ç°**: å‘ç°ç½‘ç»œæœåŠ¡
//! - **è´Ÿè½½å‡è¡¡**: åŸºäº DNS çš„è´Ÿè½½å‡è¡¡
//!
//! ## âš ï¸ æ³¨æ„äº‹é¡¹
//!
//! - **ç¼“å­˜ç­–ç•¥**: åˆç†è®¾ç½® DNS ç¼“å­˜
//! - **è¶…æ—¶å¤„ç†**: å¤„ç† DNS æŸ¥è¯¢è¶…æ—¶
//! - **é”™è¯¯å¤„ç†**: å¤„ç† DNS æŸ¥è¯¢é”™è¯¯
//! - **å®‰å…¨è€ƒè™‘**: æ³¨æ„ DNS åŠ«æŒå’Œæ±¡æŸ“
//!
//! ## ğŸ”§ è¿è¡Œæ–¹å¼
//!
//! ```bash
//! # è¿è¡Œ DNS æŸ¥è¯¢ç¤ºä¾‹
//! cargo run --example dns_lookup
//! ```

use c10_networks::protocol::dns::{DnsResolver, presets};

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    println!("ğŸš€ å¯åŠ¨ DNS æŸ¥è¯¢ç¤ºä¾‹...");

    // 1) ä½¿ç”¨ç³»ç»Ÿè§£æå™¨è¿›è¡Œ A/AAAA è®°å½•æŸ¥è¯¢
    println!("\nğŸ“¡ ä½¿ç”¨ç³»ç»Ÿè§£æå™¨æŸ¥è¯¢ A/AAAA è®°å½•:");
    let sys = DnsResolver::from_system().await?;
    let ips = sys.lookup_ips("example.com").await?;
    println!("   åŸŸå: example.com");
    println!("   IP åœ°å€: {:?}", ips);
    println!("   è¯´æ˜: A è®°å½•è¿”å› IPv4 åœ°å€ï¼ŒAAAA è®°å½•è¿”å› IPv6 åœ°å€");

    // 2) ä½¿ç”¨ Cloudflare DoH è§£æå™¨è¿›è¡Œ TXT è®°å½•æŸ¥è¯¢
    println!("\nğŸ”’ ä½¿ç”¨ Cloudflare DoH è§£æå™¨æŸ¥è¯¢ TXT è®°å½•:");
    let (cfg, opts) = presets::cloudflare_doh();
    let doh = DnsResolver::from_config(cfg, opts).await?;
    let txt = doh.lookup_txt("example.com").await?;
    println!("   åŸŸå: example.com");
    println!("   TXT è®°å½•: {:?}", txt);
    println!("   è¯´æ˜: TXT è®°å½•é€šå¸¸ç”¨äºåŸŸåéªŒè¯ã€SPF è®°å½•ç­‰");

    // 3) MX è®°å½•æŸ¥è¯¢ï¼ˆé‚®ä»¶äº¤æ¢è®°å½•ï¼‰
    println!("\nğŸ“§ æŸ¥è¯¢ MX è®°å½•ï¼ˆé‚®ä»¶äº¤æ¢è®°å½•ï¼‰:");
    let mx = doh.lookup_mx("gmail.com").await.unwrap_or_default();
    println!("   åŸŸå: gmail.com");
    println!("   MX è®°å½•: {:?}", mx);
    println!("   è¯´æ˜: MX è®°å½•æŒ‡å®šäº†å¤„ç†è¯¥åŸŸåé‚®ä»¶çš„é‚®ä»¶æœåŠ¡å™¨");

    // 4) SRV è®°å½•æŸ¥è¯¢ï¼ˆæœåŠ¡è®°å½•ï¼‰
    println!("\nğŸ” æŸ¥è¯¢ SRV è®°å½•ï¼ˆæœåŠ¡è®°å½•ï¼‰:");
    let srv = doh
        .lookup_srv("_xmpp-server._tcp.google.com")
        .await
        .unwrap_or_default();
    println!("   æœåŠ¡: _xmpp-server._tcp.google.com");
    println!("   SRV è®°å½•æ•°é‡: {}", srv.len());
    println!("   è¯´æ˜: SRV è®°å½•ç”¨äºæŒ‡å®šæä¾›ç‰¹å®šæœåŠ¡çš„æœåŠ¡å™¨");

    // 5) é€†å‘è§£æï¼ˆPTR è®°å½•ï¼‰
    println!("\nğŸ”„ é€†å‘è§£æï¼ˆPTR è®°å½•ï¼‰:");
    if let Some(ip) = ips.first() {
        let names = sys.reverse_lookup(*ip).await.unwrap_or_default();
        println!("   IP åœ°å€: {:?}", ip);
        println!("   åŸŸå: {:?}", names);
        println!("   è¯´æ˜: PTR è®°å½•ç”¨äºå°† IP åœ°å€åå‘è§£æä¸ºåŸŸå");
    } else {
        println!("   æ— æ³•è¿›è¡Œé€†å‘è§£æï¼šæ²¡æœ‰å¯ç”¨çš„ IP åœ°å€");
    }

    println!("\nâœ… DNS æŸ¥è¯¢ç¤ºä¾‹å®Œæˆï¼");
    Ok(())
}
