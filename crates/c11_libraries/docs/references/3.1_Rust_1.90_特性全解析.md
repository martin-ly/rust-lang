# 3.1 Rust 1.90 ç‰¹æ€§å…¨è§£æ (2025)

> **æ–‡æ¡£å®šä½**: Rust 1.90 ç‰ˆæœ¬æ ¸å¿ƒç‰¹æ€§æ·±åº¦è§£æ  
> **é€‚ç”¨äººç¾¤**: æ‰€æœ‰ Rust å¼€å‘è€…  
> **å…³è”æ–‡æ¡£**: [1.2 æœ¯è¯­è¡¨](../1.2_æœ¯è¯­è¡¨.md) | [3.2 å¼€æºåº“ç”Ÿæ€å…¨æ™¯å›¾](3.2_å¼€æºåº“ç”Ÿæ€å…¨æ™¯å›¾.md)

**Rust ç‰ˆæœ¬**: 1.90  
**å‘å¸ƒæ—¶é—´**: 2025-10-21  
**æ–‡æ¡£çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ“‹ ç›®å½•

- [3.1 Rust 1.90 ç‰¹æ€§å…¨è§£æ (2025)](#31-rust-190-ç‰¹æ€§å…¨è§£æ-2025)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [3.1.1 ç‰ˆæœ¬æ¦‚è§ˆ](#311-ç‰ˆæœ¬æ¦‚è§ˆ)
    - [3.1.1.1 Rust 1.90 é‡Œç¨‹ç¢‘](#3111-rust-190-é‡Œç¨‹ç¢‘)
    - [3.1.1.2 Rust 2021 Edition æ ¸å¿ƒç‰¹æ€§](#3112-rust-2021-edition-æ ¸å¿ƒç‰¹æ€§)
  - [3.1.2 è¯­è¨€ç‰¹æ€§](#312-è¯­è¨€ç‰¹æ€§)
    - [3.1.2.1 async fn in trait (ç¨³å®šäº 1.75)](#3121-async-fn-in-trait-ç¨³å®šäº-175)
    - [3.1.2.2 RPITIT (ç¨³å®šäº 1.75)](#3122-rpitit-ç¨³å®šäº-175)
    - [3.1.2.3 GAT (æ³›å‹å…³è”ç±»å‹, ç¨³å®šäº 1.65)](#3123-gat-æ³›å‹å…³è”ç±»å‹-ç¨³å®šäº-165)
    - [3.1.2.4 Const Generics (ç¨³å®šäº 1.51, æŒç»­æ”¹è¿›)](#3124-const-generics-ç¨³å®šäº-151-æŒç»­æ”¹è¿›)
  - [3.1.3 ç¼–è¯‘å™¨æ”¹è¿›](#313-ç¼–è¯‘å™¨æ”¹è¿›)
    - [3.1.3.1 ç¼–è¯‘é€Ÿåº¦ä¼˜åŒ–](#3131-ç¼–è¯‘é€Ÿåº¦ä¼˜åŒ–)
    - [3.1.3.2 æ”¹è¿›çš„é”™è¯¯æ¶ˆæ¯](#3132-æ”¹è¿›çš„é”™è¯¯æ¶ˆæ¯)
    - [3.1.3.3 è¯Šæ–­å·¥å…·æ”¹è¿›](#3133-è¯Šæ–­å·¥å…·æ”¹è¿›)
  - [3.1.4 æ ‡å‡†åº“æ›´æ–°](#314-æ ‡å‡†åº“æ›´æ–°)
    - [3.1.4.1 æ–°å¢ API](#3141-æ–°å¢-api)
    - [3.1.4.2 æ€§èƒ½ä¼˜åŒ–](#3142-æ€§èƒ½ä¼˜åŒ–)
  - [3.1.5 å·¥å…·é“¾å‡çº§](#315-å·¥å…·é“¾å‡çº§)
    - [3.1.5.1 Cargo æ”¹è¿›](#3151-cargo-æ”¹è¿›)
    - [3.1.5.2 Clippy æ›´æ–°](#3152-clippy-æ›´æ–°)
    - [3.1.5.3 Rustfmt æ”¹è¿›](#3153-rustfmt-æ”¹è¿›)
  - [3.1.6 ç”Ÿæ€ç³»ç»Ÿæ›´æ–°](#316-ç”Ÿæ€ç³»ç»Ÿæ›´æ–°)
    - [3.1.6.1 ä¸»è¦åº“ç‰ˆæœ¬ (2025-10-21)](#3161-ä¸»è¦åº“ç‰ˆæœ¬-2025-10-21)
    - [3.1.6.2 æ–°å…´åº“ (2025)](#3162-æ–°å…´åº“-2025)
  - [3.1.7 è¿ç§»æŒ‡å—](#317-è¿ç§»æŒ‡å—)
    - [3.1.7.1 ä» Rust 1.80 è¿ç§»](#3171-ä»-rust-180-è¿ç§»)
    - [3.1.7.2 å¸¸è§è¿ç§»é—®é¢˜](#3172-å¸¸è§è¿ç§»é—®é¢˜)
    - [3.1.7.3 ç ´åæ€§å˜æ›´](#3173-ç ´åæ€§å˜æ›´)
  - [3.1.8 å‚è€ƒèµ„æº](#318-å‚è€ƒèµ„æº)
    - [3.1.8.1 å®˜æ–¹èµ„æº](#3181-å®˜æ–¹èµ„æº)
    - [3.1.8.2 ç¤¾åŒºèµ„æº](#3182-ç¤¾åŒºèµ„æº)
    - [3.1.8.3 æ·±åº¦å­¦ä¹ ](#3183-æ·±åº¦å­¦ä¹ )
  - [âœ… æ€»ç»“](#-æ€»ç»“)
    - [æ ¸å¿ƒè¦ç‚¹](#æ ¸å¿ƒè¦ç‚¹)
    - [ç‰ˆæœ¬ç‰¹æ€§é€ŸæŸ¥](#ç‰ˆæœ¬ç‰¹æ€§é€ŸæŸ¥)
    - [ä¸‹ä¸€æ­¥è¡ŒåŠ¨](#ä¸‹ä¸€æ­¥è¡ŒåŠ¨)

---

## 3.1.1 ç‰ˆæœ¬æ¦‚è§ˆ

### 3.1.1.1 Rust 1.90 é‡Œç¨‹ç¢‘

**Rust 1.90** æ˜¯ 2025 å¹´ 10 æœˆå‘å¸ƒçš„ç¨³å®šç‰ˆæœ¬ï¼Œæ ‡å¿—ç€ Rust è¯­è¨€çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚

**æ ¸å¿ƒç‰¹æ€§æ€»è§ˆ**:

| ç‰¹æ€§ | çŠ¶æ€ | å½±å“èŒƒå›´ | é‡è¦æ€§ |
|------|------|----------|--------|
| async fn in trait | âœ… ç¨³å®š (1.75+) | å¼‚æ­¥ç¼–ç¨‹ | â­â­â­â­â­ |
| RPITIT | âœ… ç¨³å®š (1.75+) | Trait è®¾è®¡ | â­â­â­â­â­ |
| GAT | âœ… ç¨³å®š (1.65+) | é«˜çº§ç±»å‹ | â­â­â­â­â­ |
| Const Generics | âœ… ç¨³å®š (1.51+) | æ³›å‹ç¼–ç¨‹ | â­â­â­â­ |
| æ”¹è¿›çš„é”™è¯¯ä¿¡æ¯ | âœ… æŒç»­æ”¹è¿› | å¼€å‘ä½“éªŒ | â­â­â­â­â­ |
| ç¼–è¯‘é€Ÿåº¦ä¼˜åŒ– | âœ… æŒç»­æ”¹è¿› | å¼€å‘æ•ˆç‡ | â­â­â­â­ |

**ç‰ˆæœ¬æ—¶é—´çº¿**:

```mermaid
timeline
    title Rust è¯­è¨€é‡è¦ç‰¹æ€§ç¨³å®šåŒ–æ—¶é—´çº¿
    2021 : Rust 2021 Edition
         : Const Generics (1.51)
    2022 : GAT ç¨³å®š (1.65)
    2023 : async fn in trait (1.75)
         : RPITIT (1.75)
    2024 : ç¼–è¯‘å™¨æ€§èƒ½ä¼˜åŒ–
         : æ”¹è¿›çš„é”™è¯¯æ¶ˆæ¯
    2025 : Rust 1.90 (å½“å‰)
         : ç”Ÿæ€ç³»ç»Ÿæˆç†Ÿ
```

### 3.1.1.2 Rust 2021 Edition æ ¸å¿ƒç‰¹æ€§

Rust 1.90 åŸºäº **Rust 2021 Edition**ï¼Œä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š

**1. Disjoint Capture in Closures**:

```rust
// Rust 2018: æ•è·æ•´ä¸ª struct
let a = SomeStruct { x: 10, y: 20 };
let c = || {
    println!("{}", a.x); // æ•è·æ•´ä¸ª a
};
// c(); a.y æ— æ³•è®¿é—®

// Rust 2021: åªæ•è·ä½¿ç”¨çš„å­—æ®µ
let a = SomeStruct { x: 10, y: 20 };
let c = || {
    println!("{}", a.x); // åªæ•è· a.x
};
c();
println!("{}", a.y); // âœ… å¯ä»¥è®¿é—® a.y
```

**2. IntoIterator for Arrays**:

```rust
// Rust 2021: æ•°ç»„è‡ªåŠ¨å®ç° IntoIterator
let arr = [1, 2, 3];
for x in arr {  // ç›´æ¥è¿­ä»£ï¼Œæ— éœ€ &arr æˆ– arr.iter()
    println!("{}", x);
}
```

**3. Cargo Resolver V2**:

```toml
# Cargo.toml
[package]
edition = "2024"  # è‡ªåŠ¨å¯ç”¨ Resolver V3
```

**ç‰¹ç‚¹**:

- æ›´ä¸€è‡´çš„ä¾èµ–è§£æ
- é¿å…é‡å¤ç¼–è¯‘ç›¸åŒä¾èµ–çš„ä¸åŒç‰¹æ€§ç»„åˆ
- æ›´å¿«çš„æ„å»ºé€Ÿåº¦

---

## 3.1.2 è¯­è¨€ç‰¹æ€§

### 3.1.2.1 async fn in trait (ç¨³å®šäº 1.75)

**å®šä¹‰**: å…è®¸åœ¨ trait ä¸­ç›´æ¥ä½¿ç”¨ `async fn`ï¼Œæ— éœ€ `#[async_trait]` å®ã€‚

**æ ¸å¿ƒä»·å€¼**:

1. âœ… é›¶æˆæœ¬æŠ½è±¡ (æ— å®å±•å¼€)
2. âœ… æ›´å¥½çš„ç¼–è¯‘æ€§èƒ½
3. âœ… æ›´æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
4. âœ… åŸç”Ÿè¯­è¨€æ”¯æŒ

**ç¤ºä¾‹**:

```rust
// âœ… Rust 1.75+ åŸç”Ÿæ”¯æŒ
trait AsyncDatabase {
    async fn connect(&self, url: &str) -> Result<Connection>;
    async fn query(&self, sql: &str) -> Result<Vec<Row>>;
}

struct PostgresDb;

impl AsyncDatabase for PostgresDb {
    async fn connect(&self, url: &str) -> Result<Connection> {
        // å®ç°è¿æ¥é€»è¾‘
        tokio_postgres::connect(url, tokio_postgres::NoTls).await
    }
    
    async fn query(&self, sql: &str) -> Result<Vec<Row>> {
        // å®ç°æŸ¥è¯¢é€»è¾‘
        Ok(vec![])
    }
}

// ä½¿ç”¨
async fn use_db(db: &impl AsyncDatabase) {
    let conn = db.connect("postgres://localhost").await?;
    let rows = db.query("SELECT * FROM users").await?;
}
```

**å¯¹æ¯”æ—§æ–¹æ¡ˆ**:

```rust
// âŒ Rust 1.74 åŠä¹‹å‰: éœ€è¦ async-trait å®
use async_trait::async_trait;

#[async_trait]
trait AsyncDatabase {
    async fn connect(&self, url: &str) -> Result<Connection>;
}

#[async_trait]
impl AsyncDatabase for PostgresDb {
    async fn connect(&self, url: &str) -> Result<Connection> {
        // ...
    }
}
```

**é™åˆ¶**:

- `dyn Trait` éœ€è¦é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£
- è¿”å›çš„ Future é»˜è®¤ä¸æ˜¯ `Send`

**è§£å†³æ–¹æ¡ˆ**:

```rust
// è¦æ±‚è¿”å›çš„ Future æ˜¯ Send
trait AsyncDatabase: Send + Sync {
    async fn query(&self, sql: &str) -> Result<Vec<Row>>
    where
        Self: Send;  // ç¡®ä¿ Future æ˜¯ Send
}

// ä½¿ç”¨ dyn Trait
async fn use_dyn_db(db: &dyn AsyncDatabase) {
    // éœ€è¦ object-safe trait
}
```

**ç›¸å…³**: [1.2 æœ¯è¯­è¡¨ - async fn in trait](../1.2_æœ¯è¯­è¡¨.md#1221-async-fn-in-trait)

---

### 3.1.2.2 RPITIT (ç¨³å®šäº 1.75)

**å®šä¹‰**: Return Position Impl Trait in Traitï¼Œå…è®¸ trait æ–¹æ³•è¿”å› `impl Trait`ã€‚

**æ ¸å¿ƒä»·å€¼**:

1. âœ… ç±»å‹æ¨å¯¼
2. âœ… é›¶æˆæœ¬æŠ½è±¡
3. âœ… ç®€åŒ– API
4. âœ… è¿­ä»£å™¨å‹å¥½

**ç¤ºä¾‹**:

```rust
trait ConfigBuilder {
    // âœ… è¿”å› impl Trait
    fn builder() -> impl Builder;
    fn with_timeout(self, timeout: Duration) -> impl ConfigBuilder;
    fn with_retry(self, max_retries: u32) -> impl ConfigBuilder;
}

struct AppConfigBuilder {
    timeout: Option<Duration>,
    max_retries: Option<u32>,
}

impl ConfigBuilder for AppConfigBuilder {
    fn builder() -> impl Builder {
        AppConfigBuilder {
            timeout: None,
            max_retries: None,
        }
    }
    
    fn with_timeout(mut self, timeout: Duration) -> impl ConfigBuilder {
        self.timeout = Some(timeout);
        self
    }
    
    fn with_retry(mut self, max_retries: u32) -> impl ConfigBuilder {
        self.max_retries = Some(max_retries);
        self
    }
}

// ä½¿ç”¨
let config = AppConfigBuilder::builder()
    .with_timeout(Duration::from_secs(30))
    .with_retry(3)
    .build();
```

**è¿­ä»£å™¨ç¤ºä¾‹**:

```rust
trait DataSource {
    // è¿”å›å¤æ‚çš„è¿­ä»£å™¨é“¾
    fn fetch_items(&self) -> impl Iterator<Item = String> {
        vec!["item1".to_string(), "item2".to_string()]
            .into_iter()
            .filter(|s| s.len() > 3)
            .map(|s| s.to_uppercase())
    }
}
```

**å¯¹æ¯” GAT**:

| ç‰¹æ€§ | RPITIT | GAT |
|------|--------|-----|
| è¯­æ³• | `fn foo() -> impl Trait` | `type Output<'a>; fn foo() -> Self::Output<'_>` |
| å¤æ‚åº¦ | â­â­ ç®€å• | â­â­â­â­ å¤æ‚ |
| é€‚ç”¨åœºæ™¯ | ç®€å•è¿”å›ç±»å‹æŠ½è±¡ | é«˜çº§ç±»å‹å…³ç³» |
| ç”Ÿå‘½å‘¨æœŸ | è‡ªåŠ¨æ¨å¯¼ | æ˜¾å¼æŒ‡å®š |

**ç›¸å…³**: [1.2 æœ¯è¯­è¡¨ - RPITIT](../1.2_æœ¯è¯­è¡¨.md#1222-rpitit)

---

### 3.1.2.3 GAT (æ³›å‹å…³è”ç±»å‹, ç¨³å®šäº 1.65)

**å®šä¹‰**: Generic Associated Typesï¼Œå…³è”ç±»å‹å¯ä»¥æœ‰æ³›å‹å‚æ•°ã€‚

**æ ¸å¿ƒä»·å€¼**:

1. âœ… ç”Ÿå‘½å‘¨æœŸå‚æ•°åŒ–
2. âœ… ç±»å‹å‚æ•°åŒ–
3. âœ… é«˜çº§æŠ½è±¡èƒ½åŠ›
4. âœ… å®ç°å¤æ‚çš„ç±»å‹å…³ç³»

**ç¤ºä¾‹ 1: è¿æ¥æ± æŠ½è±¡**:

```rust
trait Pool {
    // GAT: å…³è”ç±»å‹æœ‰ç”Ÿå‘½å‘¨æœŸå‚æ•°
    type Connection<'pool> where Self: 'pool;
    
    async fn acquire(&self) -> Result<Self::Connection<'_>>;
}

struct PostgresPool {
    // ...
}

struct PooledConnection<'pool> {
    pool: &'pool PostgresPool,
    conn: tokio_postgres::Client,
}

impl Pool for PostgresPool {
    type Connection<'pool> = PooledConnection<'pool>;
    
    async fn acquire(&self) -> Result<Self::Connection<'_>> {
        // è·å–è¿æ¥
        let conn = self.get_connection().await?;
        Ok(PooledConnection {
            pool: self,
            conn,
        })
    }
}

// ä½¿ç”¨
async fn use_pool(pool: &impl Pool) {
    let conn = pool.acquire().await?;
    // conn çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šåˆ° pool
    // conn è¢« drop æ—¶è‡ªåŠ¨å½’è¿˜åˆ° pool
}
```

**ç¤ºä¾‹ 2: Lending Iterator (å€Ÿç”¨è¿­ä»£å™¨)**:

```rust
trait LendingIterator {
    type Item<'a> where Self: 'a;
    
    fn next(&mut self) -> Option<Self::Item<'_>>;
}

struct WindowsMut<'data, T> {
    data: &'data mut [T],
    window_size: usize,
    position: usize,
}

impl<'data, T> LendingIterator for WindowsMut<'data, T> {
    type Item<'a> = &'a mut [T] where Self: 'a;
    
    fn next(&mut self) -> Option<Self::Item<'_>> {
        if self.position + self.window_size <= self.data.len() {
            let start = self.position;
            let end = start + self.window_size;
            self.position += 1;
            Some(&mut self.data[start..end])
        } else {
            None
        }
    }
}

// ä½¿ç”¨
let mut data = vec![1, 2, 3, 4, 5];
let mut windows = WindowsMut {
    data: &mut data,
    window_size: 3,
    position: 0,
};

while let Some(window) = windows.next() {
    // window æ˜¯å¯å˜å€Ÿç”¨ï¼Œæ¯æ¬¡è¿­ä»£éƒ½æ˜¯ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸ
    window[0] += 10;
}
```

**ç¤ºä¾‹ 3: å¼‚æ­¥è¿­ä»£å™¨**:

```rust
trait AsyncIterator {
    type Item<'a> where Self: 'a;
    
    async fn next(&mut self) -> Option<Self::Item<'_>>;
}

struct DbCursor {
    conn: tokio_postgres::Client,
}

impl AsyncIterator for DbCursor {
    type Item<'a> = tokio_postgres::Row;
    
    async fn next(&mut self) -> Option<Self::Item<'_>> {
        // ä»æ•°æ®åº“è·å–ä¸‹ä¸€è¡Œ
        self.conn.query_one("SELECT ...", &[]).await.ok()
    }
}
```

**ç›¸å…³**: [1.2 æœ¯è¯­è¡¨ - GAT](../1.2_æœ¯è¯­è¡¨.md#1223-æ³›å‹å…³è”ç±»å‹-gat)

---

### 3.1.2.4 Const Generics (ç¨³å®šäº 1.51, æŒç»­æ”¹è¿›)

**å®šä¹‰**: å…è®¸æ³›å‹å‚æ•°ä¸ºç¼–è¯‘æ—¶å¸¸é‡å€¼ã€‚

**Rust 1.90 æ”¹è¿›**:

- âœ… æ›´å¤šçš„å¸¸é‡è¡¨è¾¾å¼æ”¯æŒ
- âœ… æ›´å¥½çš„é”™è¯¯æ¶ˆæ¯
- âœ… æ€§èƒ½ä¼˜åŒ–

**ç¤ºä¾‹ 1: å›ºå®šå¤§å°ç¼“å†²åŒº**:

```rust
struct Buffer<const N: usize> {
    data: [u8; N],
    len: usize,
}

impl<const N: usize> Buffer<N> {
    fn new() -> Self {
        Self {
            data: [0; N],
            len: 0,
        }
    }
    
    fn push(&mut self, byte: u8) -> Result<(), &'static str> {
        if self.len < N {
            self.data[self.len] = byte;
            self.len += 1;
            Ok(())
        } else {
            Err("Buffer full")
        }
    }
    
    fn capacity() -> usize {
        N
    }
}

// ä½¿ç”¨
let mut buf: Buffer<1024> = Buffer::new();
buf.push(42)?;
assert_eq!(Buffer::<1024>::capacity(), 1024);
```

**ç¤ºä¾‹ 2: SIMD å‘é‡**:

```rust
#[repr(align(16))]
struct SimdVector<T, const N: usize> {
    data: [T; N],
}

impl<T: Copy, const N: usize> SimdVector<T, N> {
    fn new(value: T) -> Self {
        Self {
            data: [value; N],
        }
    }
    
    fn add(&self, other: &Self) -> Self
    where
        T: std::ops::Add<Output = T>,
    {
        let mut result = Self::new(self.data[0]);
        for i in 0..N {
            result.data[i] = self.data[i] + other.data[i];
        }
        result
    }
}

// ä½¿ç”¨
let v1: SimdVector<f32, 4> = SimdVector::new(1.0);
let v2: SimdVector<f32, 4> = SimdVector::new(2.0);
let v3 = v1.add(&v2);
```

**ç¤ºä¾‹ 3: ç±»å‹å®‰å…¨é…ç½®**:

```rust
struct Config<const MAX_CONNECTIONS: usize = 16> {
    pool_size: usize,
}

impl<const MAX: usize> Config<MAX> {
    fn new(pool_size: usize) -> Result<Self, String> {
        if pool_size > MAX {
            Err(format!(
                "Pool size {} exceeds maximum {}",
                pool_size, MAX
            ))
        } else {
            Ok(Self { pool_size })
        }
    }
    
    fn validate(&self) -> bool {
        self.pool_size <= MAX && self.pool_size > 0
    }
}

// ä½¿ç”¨
let config: Config<32> = Config::new(16)?;
assert!(config.validate());

// ç¼–è¯‘æ—¶é”™è¯¯
// let bad_config: Config<10> = Config::new(20)?;  // è¿è¡Œæ—¶é”™è¯¯
```

**ç›¸å…³**: [1.2 æœ¯è¯­è¡¨ - Const Generics](../1.2_æœ¯è¯­è¡¨.md#1224-const-generics)

---

## 3.1.3 ç¼–è¯‘å™¨æ”¹è¿›

### 3.1.3.1 ç¼–è¯‘é€Ÿåº¦ä¼˜åŒ–

**Rust 1.90 ç¼–è¯‘å™¨æ€§èƒ½æ”¹è¿›**:

| ä¼˜åŒ–é¡¹ | æ”¹è¿›å¹…åº¦ | é€‚ç”¨åœºæ™¯ |
|--------|---------|---------|
| å¢é‡ç¼–è¯‘ | +30% | æ—¥å¸¸å¼€å‘ |
| å¹¶è¡Œå‰ç«¯ | +25% | å¤§å‹é¡¹ç›® |
| LLVM åç«¯ | +15% | Release æ„å»º |
| å®å±•å¼€ | +20% | å®å¯†é›†ä»£ç  |

**ç¤ºä¾‹: ä¼˜åŒ–ç¼–è¯‘é…ç½®**:

```toml
# Cargo.toml

[profile.dev]
# å¼€å‘ç¯å¢ƒ: å¿«é€Ÿç¼–è¯‘
opt-level = 0
debug = true
incremental = true

[profile.release]
# ç”Ÿäº§ç¯å¢ƒ: æœ€ä¼˜æ€§èƒ½
opt-level = 3
lto = "fat"          # é“¾æ¥æ—¶ä¼˜åŒ–
codegen-units = 1    # å•ä¸€ä»£ç ç”Ÿæˆå•å…ƒ
strip = true         # å»é™¤ç¬¦å·ä¿¡æ¯

[profile.dev.package."*"]
# ä¾èµ–åº“ä½¿ç”¨ä¼˜åŒ–
opt-level = 2
```

### 3.1.3.2 æ”¹è¿›çš„é”™è¯¯æ¶ˆæ¯

**Rust 1.90 é”™è¯¯æ¶ˆæ¯æ”¹è¿›**:

**ç¤ºä¾‹ 1: ç”Ÿå‘½å‘¨æœŸé”™è¯¯**:

```rust
// é”™è¯¯ä»£ç 
fn longest(x: &str, y: &str) -> &str {
    if x.len() > y.len() { x } else { y }
}

// Rust 1.90 é”™è¯¯æ¶ˆæ¯:
// error[E0106]: missing lifetime specifier
//  --> src/main.rs:1:38
//   |
// 1 | fn longest(x: &str, y: &str) -> &str {
//   |               ----     ----     ^ expected named lifetime parameter
//   |
//   = help: this function's return type contains a borrowed value,
//           but the signature does not say whether it is borrowed from `x` or `y`
//   = note: consider introducing a named lifetime parameter
// help: consider using a named lifetime parameter:
//   |
// 1 | fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
//   |           ++++     ++          ++          ++
```

**ç¤ºä¾‹ 2: Trait é™åˆ¶é”™è¯¯**:

```rust
// é”™è¯¯ä»£ç 
async fn process<T>(data: T) {
    tokio::spawn(async move {
        // ä½¿ç”¨ data
    });
}

// Rust 1.90 é”™è¯¯æ¶ˆæ¯:
// error[E0277]: `T` cannot be sent between threads safely
//  --> src/main.rs:3:5
//   |
// 3 |     tokio::spawn(async move {
//   |     ^^^^^^^^^^^^ `T` cannot be sent between threads safely
//   |
//   = help: the trait `Send` is not implemented for `T`
// help: consider restricting type parameter `T`:
//   |
// 1 | async fn process<T: Send>(data: T) {
//   |                   ++++++
```

### 3.1.3.3 è¯Šæ–­å·¥å…·æ”¹è¿›

**æ–°å¢è¯Šæ–­é€‰é¡¹**:

```bash
# æ˜¾ç¤ºè¯¦ç»†çš„ç¼–è¯‘è¿‡ç¨‹
cargo build -v

# æ—¶é—´åˆ†æ
cargo build --timings

# æ˜¾ç¤ºç¼–è¯‘å›¾
cargo build --build-plan

# æ£€æŸ¥æœªä½¿ç”¨çš„ä¾èµ–
cargo +nightly udeps
```

**Rust Analyzer æ”¹è¿›** (2025):

- âœ… æ›´å¿«çš„ä»£ç è¡¥å…¨
- âœ… æ›´å‡†ç¡®çš„ç±»å‹æ¨å¯¼
- âœ… å†…è”å®å±•å¼€æç¤º
- âœ… æ”¹è¿›çš„é‡æ„æ”¯æŒ

---

## 3.1.4 æ ‡å‡†åº“æ›´æ–°

### 3.1.4.1 æ–°å¢ API

**Rust 1.90 æ–°å¢æ ‡å‡†åº“ API** (æŒç»­æ›´æ–°):

**1. Option/Result å¢å¼º**:

```rust
// æ–°å¢: Option::is_some_and
let x = Some(2);
assert!(x.is_some_and(|x| x > 1));

// æ–°å¢: Result::inspect
let result: Result<i32, String> = Ok(42);
result
    .inspect(|x| println!("Got value: {}", x))
    .inspect_err(|e| eprintln!("Got error: {}", e));
```

**2. Iterator å¢å¼º**:

```rust
// æ–°å¢: iterator.next_chunk()
let mut iter = [1, 2, 3, 4, 5].into_iter();
let chunk: [i32; 3] = iter.next_chunk().unwrap();
assert_eq!(chunk, [1, 2, 3]);
```

**3. å­—ç¬¦ä¸²å¤„ç†**:

```rust
// æ”¹è¿›çš„å­—ç¬¦ä¸²åˆ†å‰²
let s = "hello world";
let (first, rest) = s.split_once(' ').unwrap();
assert_eq!(first, "hello");
assert_eq!(rest, "world");
```

### 3.1.4.2 æ€§èƒ½ä¼˜åŒ–

**æ ‡å‡†åº“æ€§èƒ½æ”¹è¿›**:

| ç»„ä»¶ | æ”¹è¿› | å½±å“ |
|------|------|------|
| HashMap | æ›´å¿«çš„å“ˆå¸Œç®—æ³• | +15% |
| String | ä¼˜åŒ–çš„æ ¼å¼åŒ– | +10% |
| Vec | æ”¹è¿›çš„å¢é•¿ç­–ç•¥ | +8% |
| Arc/Mutex | æ›´å¿«çš„åŸå­æ“ä½œ | +12% |

---

## 3.1.5 å·¥å…·é“¾å‡çº§

### 3.1.5.1 Cargo æ”¹è¿›

**Cargo 1.90 æ–°ç‰¹æ€§**:

**1. å·¥ä½œåŒºä¾èµ–ç»§æ‰¿**:

```toml
# æ ¹å·¥ä½œåŒº Cargo.toml
[workspace.dependencies]
tokio = { version = "1.48", features = ["full"] }
serde = { version = "1.0", features = ["derive"] }

# å­åŒ… Cargo.toml
[dependencies]
tokio = { workspace = true }
serde = { workspace = true }
```

**2. Sparse Registry (ç¨€ç–ç´¢å¼•)**:

```toml
# .cargo/config.toml
[registries.crates-io]
protocol = "sparse"  # æ›´å¿«çš„ä¾èµ–è§£æ
```

**3. æ”¹è¿›çš„ç‰¹æ€§è§£æ**:

- âœ… æ›´æ™ºèƒ½çš„ç‰¹æ€§ä¼ æ’­
- âœ… é¿å…ç‰¹æ€§å†²çª
- âœ… æ›´å¿«çš„ä¾èµ–è§£æé€Ÿåº¦

### 3.1.5.2 Clippy æ›´æ–°

**æ–°å¢ Lint è§„åˆ™**:

```rust
// 1. needless_pass_by_ref_mut
fn process(data: &mut Vec<i32>) {  // âš ï¸ è­¦å‘Š: ä¸éœ€è¦å¯å˜å¼•ç”¨
    println!("{:?}", data);
}

// ä¿®å¤
fn process(data: &Vec<i32>) {
    println!("{:?}", data);
}

// 2. redundant_type_annotations
let x: i32 = 42;  // âš ï¸ è­¦å‘Š: ç±»å‹æ³¨è§£å†—ä½™
let x = 42i32;    // âœ… æ¨è

// 3. manual_let_else
let Some(x) = option else {  // âœ… Rust 1.65+ ç‰¹æ€§
    return;
};
```

### 3.1.5.3 Rustfmt æ”¹è¿›

**æ–°æ ¼å¼åŒ–é€‰é¡¹**:

```toml
# rustfmt.toml
edition = "2021"
max_width = 100
use_small_heuristics = "Max"
imports_granularity = "Crate"
group_imports = "StdExternalCrate"
```

---

## 3.1.6 ç”Ÿæ€ç³»ç»Ÿæ›´æ–°

### 3.1.6.1 ä¸»è¦åº“ç‰ˆæœ¬ (2025-10-21)

**å¼‚æ­¥è¿è¡Œæ—¶**:

| åº“ | ç‰ˆæœ¬ | ä¸»è¦ç‰¹æ€§ |
|----|------|---------|
| Tokio | 1.48.0 | æ”¹è¿›çš„ work-stealingï¼Œæ›´å¿«çš„ spawn |
| async-std | 1.13.0 | æ ‡å‡†åº“å…¼å®¹çš„å¼‚æ­¥ API |
| smol | 2.0+ | è½»é‡çº§å¼‚æ­¥è¿è¡Œæ—¶ |

**Web æ¡†æ¶**:

| åº“ | ç‰ˆæœ¬ | ä¸»è¦ç‰¹æ€§ |
|----|------|---------|
| Axum | 0.8.0 | æ”¹è¿›çš„ç±»å‹æ¨å¯¼ï¼Œæ›´å¥½çš„é”™è¯¯å¤„ç† |
| Actix-web | 4.9.0 | æ›´å¿«çš„è·¯ç”±ï¼Œæ”¹è¿›çš„ä¸­é—´ä»¶ |
| Rocket | 0.5.1 | ç¨³å®šçš„å¼‚æ­¥æ”¯æŒ |

**æ•°æ®åº“**:

| åº“ | ç‰ˆæœ¬ | ä¸»è¦ç‰¹æ€§ |
|----|------|---------|
| sqlx | 0.8.6 | ç¼–è¯‘æ—¶ SQL æ£€æŸ¥ï¼Œæ›´å¥½çš„æ€§èƒ½ |
| sea-orm | 2.0.0-rc.9 | å¼‚æ­¥ ORMï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ |
| diesel | 2.2.4 | ç±»å‹å®‰å…¨çš„ SQLï¼Œæ€§èƒ½ä¼˜åŒ– |

**åºåˆ—åŒ–**:

| åº“ | ç‰ˆæœ¬ | ä¸»è¦ç‰¹æ€§ |
|----|------|---------|
| serde | 1.0.228 | æ›´å¿«çš„åºåˆ—åŒ–ï¼Œæ›´å¥½çš„é”™è¯¯ |
| serde_json | 1.0.145 | JSON è§£ææ€§èƒ½æå‡ |

### 3.1.6.2 æ–°å…´åº“ (2025)

**å‰ç«¯æ¡†æ¶**:

**1. Leptos** (0.7+):

```rust
use leptos::*;

#[component]
fn Counter() -> impl IntoView {
    let (count, set_count) = create_signal(0);
    
    view! {
        <button on:click=move |_| set_count.update(|n| *n += 1)>
            "Count: " {count}
        </button>
    }
}
```

**ç‰¹ç‚¹**:

- âœ… ç»†ç²’åº¦å“åº”å¼
- âœ… æœåŠ¡ç«¯æ¸²æŸ“
- âœ… å…¨æ ˆ Rust

**2. Dioxus** (0.6+):

```rust
use dioxus::prelude::*;

fn app() -> Element {
    let mut count = use_signal(|| 0);
    
    rsx! {
        button { 
            onclick: move |_| count += 1,
            "Count: {count}"
        }
    }
}
```

**ç‰¹ç‚¹**:

- âœ… è·¨å¹³å° (Web, Desktop, Mobile)
- âœ… React-like API
- âœ… çƒ­é‡è½½

**æ•°æ®å¤„ç†**:

**1. Polars** (0.44+):

```rust
use polars::prelude::*;

let df = df! {
    "name" => ["Alice", "Bob", "Charlie"],
    "age" => [25, 30, 35],
}?;

let result = df
    .lazy()
    .filter(col("age").gt(25))
    .select([col("name")])
    .collect()?;
```

**ç‰¹ç‚¹**:

- âœ… é«˜æ€§èƒ½ DataFrame
- âœ… ç±»ä¼¼ Pandas API
- âœ… æ”¯æŒ Arrow æ ¼å¼

**2. DataFusion** (43+):

```rust
use datafusion::prelude::*;

let ctx = SessionContext::new();
ctx.register_csv("users", "users.csv", CsvReadOptions::new()).await?;

let df = ctx.sql("SELECT name, age FROM users WHERE age > 25").await?;
df.show().await?;
```

**ç‰¹ç‚¹**:

- âœ… SQL æŸ¥è¯¢å¼•æ“
- âœ… æ”¯æŒå¤§æ•°æ®å¤„ç†
- âœ… å¯æ‰©å±•

---

## 3.1.7 è¿ç§»æŒ‡å—

### 3.1.7.1 ä» Rust 1.80 è¿ç§»

**æ£€æŸ¥æ¸…å•**:

1. âœ… **æ›´æ–° Rust ç‰ˆæœ¬**:

    ```bash
    rustup update stable
    rustc --version  # ç¡®è®¤ 1.90+
    ```

2. âœ… **æ›´æ–°ä¾èµ–ç‰ˆæœ¬**:

    ```bash
    cargo update
    cargo outdated  # æ£€æŸ¥è¿‡æ—¶çš„ä¾èµ–
    ```

3. âœ… **è¿è¡Œ Clippy**:

    ```bash
    cargo clippy -- -D warnings
    ```

4. âœ… **è¿è¡Œæµ‹è¯•**:

    ```bash
    cargo test
    cargo test --all-features
    ```

5. âœ… **æ›´æ–° CI/CD**:

    ```yaml
    # .github/workflows/ci.yml
    - uses: actions-rust-lang/setup-rust-toolchain@v1
    with:
        toolchain: 1.90
    ```

### 3.1.7.2 å¸¸è§è¿ç§»é—®é¢˜

**Q1: async fn in trait å¦‚ä½•ä½¿ç”¨?**

A: ç›´æ¥åœ¨ trait ä¸­ä½¿ç”¨ `async fn`ï¼Œç§»é™¤ `#[async_trait]` å®ï¼š

```rust
// æ—§ä»£ç 
#[async_trait]
trait Database {
    async fn query(&self) -> Result<Vec<Row>>;
}

// æ–°ä»£ç  (Rust 1.75+)
trait Database {
    async fn query(&self) -> Result<Vec<Row>>;
}
```

**Q2: RPITIT æœ‰ä»€ä¹ˆé™åˆ¶?**

A: ä¸æ”¯æŒ `dyn Trait`ï¼Œå¦‚éœ€åŠ¨æ€åˆ†å‘ï¼Œä½¿ç”¨å…³è”ç±»å‹ï¼š

```rust
// âŒ ä¸æ”¯æŒ
trait Iterator {
    fn next(&mut self) -> impl Option<Self::Item>;
}
let iter: &dyn Iterator = ...;  // é”™è¯¯

// âœ… ä½¿ç”¨å…³è”ç±»å‹
trait Iterator {
    type Item;
    fn next(&mut self) -> Option<Self::Item>;
}
```

**Q3: ç¼–è¯‘æ—¶é—´å¢åŠ æ€ä¹ˆåŠ?**

A: ä¼˜åŒ–ç¼–è¯‘é…ç½®ï¼š

```toml
[profile.dev]
opt-level = 1  # ç¨å¾®ä¼˜åŒ–
incremental = true
[profile.dev.package."*"]
opt-level = 2  # ä¾èµ–åº“æ›´å¤šä¼˜åŒ–
```

### 3.1.7.3 ç ´åæ€§å˜æ›´

**Rust 1.90 æ²¡æœ‰é‡å¤§ç ´åæ€§å˜æ›´**ï¼Œä½†æ³¨æ„ï¼š

1. âš ï¸ æŸäº›è¿‡æ—¶çš„ API å¯èƒ½è¢«å¼ƒç”¨
2. âš ï¸ Clippy æ–°å¢çš„ lint å¯èƒ½æŠ¥å‘Šæ›´å¤šè­¦å‘Š
3. âš ï¸ ä¾èµ–åº“å¯èƒ½æœ‰ breaking changes

---

## 3.1.8 å‚è€ƒèµ„æº

### 3.1.8.1 å®˜æ–¹èµ„æº

**æ ¸å¿ƒæ–‡æ¡£**:

- [Rust å®˜æ–¹ç½‘ç«™](https://www.rust-lang.org/)
- [Rust å®˜æ–¹åšå®¢](https://blog.rust-lang.org/)
- [Rust Release Notes](https://github.com/rust-lang/rust/releases)
- [Rust Edition Guide](https://doc.rust-lang.org/edition-guide/)
- [Rust Reference](https://doc.rust-lang.org/reference/)

**å­¦ä¹ èµ„æº**:

- [The Rust Book](https://doc.rust-lang.org/book/)
- [Rust by Example](https://doc.rust-lang.org/rust-by-example/)
- [Rustlings](https://github.com/rust-lang/rustlings)

### 3.1.8.2 ç¤¾åŒºèµ„æº

**æ–°é—»å’Œæ›´æ–°**:

- [This Week in Rust](https://this-week-in-rust.org/)
- [Rust Reddit](https://www.reddit.com/r/rust/)
- [Rust Users Forum](https://users.rust-lang.org/)

**åº“å’Œå·¥å…·**:

- [Awesome Rust](https://github.com/rust-unofficial/awesome-rust)
- [Crates.io](https://crates.io/)
- [Lib.rs](https://lib.rs/)

### 3.1.8.3 æ·±åº¦å­¦ä¹ 

**é«˜çº§ä¸»é¢˜**:

- [Rust Nomicon](https://doc.rust-lang.org/nomicon/) - Unsafe Rust
- [Rust Async Book](https://rust-lang.github.io/async-book/)
- [Rust Performance Book](https://nnethercote.github.io/perf-book/)

**å†…éƒ¨æœºåˆ¶**:

- [rustc-dev-guide](https://rustc-dev-guide.rust-lang.org/)
- [MIR (Mid-level IR)](https://blog.rust-lang.org/2016/04/19/MIR.html)

---

## âœ… æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

**Rust 1.90 (2025-10-21) çš„ 5 å¤§äº®ç‚¹**:

1. âœ… **async fn in trait** - åŸç”Ÿå¼‚æ­¥ trait æ”¯æŒ
2. âœ… **RPITIT** - trait æ–¹æ³•è¿”å› impl Trait
3. âœ… **GAT** - æ³›å‹å…³è”ç±»å‹
4. âœ… **ç¼–è¯‘å™¨ä¼˜åŒ–** - ç¼–è¯‘é€Ÿåº¦æå‡ 20-30%
5. âœ… **ç”Ÿæ€æˆç†Ÿ** - ä¸»æµåº“å…¨é¢æ”¯æŒ

### ç‰ˆæœ¬ç‰¹æ€§é€ŸæŸ¥

| ç‰¹æ€§ | ç¨³å®šç‰ˆæœ¬ | ä½¿ç”¨ç‡ | æ¨èåº¦ |
|------|---------|--------|--------|
| async fn in trait | 1.75+ | â­â­â­â­â­ | å¼ºçƒˆæ¨è |
| RPITIT | 1.75+ | â­â­â­â­ | æ¨è |
| GAT | 1.65+ | â­â­â­â­ | æ¨è |
| Const Generics | 1.51+ | â­â­â­â­â­ | å¼ºçƒˆæ¨è |

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… å‡çº§åˆ° Rust 1.90
2. âœ… æ›´æ–°é¡¹ç›®ä¾èµ–
3. âœ… é‡‡ç”¨æ–°è¯­è¨€ç‰¹æ€§
4. âœ… ä¼˜åŒ–ç¼–è¯‘é…ç½®
5. âœ… æ¢ç´¢æ–°å…´åº“

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-21  
**ç»´æŠ¤å›¢é˜Ÿ**: Rust å­¦ä¹ ç¤¾åŒº

---

**âœ… Rust 1.90 ç‰¹æ€§å…¨è§£æå®Œæˆï¼** ğŸ‰
