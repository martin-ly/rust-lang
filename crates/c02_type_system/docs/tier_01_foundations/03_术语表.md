# 1.2 Rust 类型系统 - 术语表

> **文档类型**: Tier 1 - 基础层  
> **文档定位**: 核心术语快速参考  
> **使用方式**: 通过术语索引快速查找定义，理解核心概念  
> **最后更新**: 2025-10-22

---

## 📊 目录

- [1.2 Rust 类型系统 - 术语表](#12-rust-类型系统---术语表)
  - [📊 目录](#-目录)
  - [📋 术语索引](#-术语索引)
  - [泛型 (Generics)](#泛型-generics)
  - [Trait](#trait)
  - [Trait对象 (Trait Object)](#trait对象-trait-object)
  - [关联类型 (Associated Type)](#关联类型-associated-type)
  - [Newtype 模式](#newtype-模式)
  - [零大小类型 (ZST)](#零大小类型-zst)
  - [PhantomData](#phantomdata)
  - [Never类型 (!)](#never类型-)
  - [Pin](#pin)
  - [类型推导 (Type Inference)](#类型推导-type-inference)
  - [Deref强制转换](#deref强制转换)
  - [孤儿规则 (Orphan Rule)](#孤儿规则-orphan-rule)
  - [协变与逆变 (Variance)](#协变与逆变-variance)
  - [单态化 (Monomorphization)](#单态化-monomorphization)
  - [生命周期 (Lifetime)](#生命周期-lifetime)
  - [GAT (Generic Associated Types)](#gat-generic-associated-types)
  - [HRTB (Higher-Rank Trait Bounds)](#hrtb-higher-rank-trait-bounds)
  - [Sized Trait](#sized-trait)
  - [Send 和 Sync](#send-和-sync)
  - [其他术语](#其他术语)
    - [DST (Dynamically Sized Type)](#dst-dynamically-sized-type)
    - [Const Generic](#const-generic)
    - [Type Alias](#type-alias)
    - [Turbofish](#turbofish)
  - [📚 延伸阅读](#-延伸阅读)
    - [Tier 1 (基础层)](#tier-1-基础层)
    - [Tier 2 (指南层)](#tier-2-指南层)
    - [Tier 3 (参考层)](#tier-3-参考层)
    - [Tier 4 (高级层)](#tier-4-高级层)

## 📋 术语索引

**快速导航**:

[A](#关联类型-associated-type) | [D](#deref强制转换) | [G](#泛型-generics) | [N](#newtype-模式) | [P](#phantomdata) | [T](#trait) | [Z](#零大小类型-zst) | [其他](#其他术语)

---

## 泛型 (Generics)

**定义**: 类型参数化，允许代码适用于多种类型。

**语法**:

```rust
fn largest<T: PartialOrd>(list: &[T]) -> &T {
    // ...
}

struct Point<T> {
    x: T,
    y: T,
}

enum Option<T> {
    Some(T),
    None,
}
```

**单态化**: 编译时为每个具体类型生成代码，零成本抽象

**相关文档**:

- [泛型编程指南](../tier_02_guides/03_泛型编程指南.md)
- [高级泛型模式](../tier_04_advanced/02_高级泛型模式.md)

---

## Trait

**定义**: 定义类型的共同行为，类似于其他语言的接口。

**语法**:

```rust
trait Summary {
    fn summarize(&self) -> String;
}

impl Summary for Article {
    fn summarize(&self) -> String {
        format!("{}, by {}", self.headline, self.author)
    }
}
```

**Trait Bounds**: 约束泛型类型必须实现特定 trait

**相关文档**:

- [Trait 系统指南](../tier_02_guides/04_Trait系统指南.md)
- [分派机制参考](../tier_03_references/03_分派机制参考.md)

---

## Trait对象 (Trait Object)

**定义**: 运行时多态，通过 `dyn Trait` 实现。

**语法**:

```rust
fn print_summary(item: &dyn Summary) {
    println!("{}", item.summarize());
}

let items: Vec<Box<dyn Summary>> = vec![
    Box::new(article),
    Box::new(tweet),
];
```

**限制**: trait 必须是对象安全的（不能有泛型方法、返回 Self 等）

**相关文档**:

- [Trait 系统指南](../tier_02_guides/04_Trait系统指南.md)
- [分派机制参考](../tier_03_references/03_分派机制参考.md)

---

## 关联类型 (Associated Type)

**定义**: Trait 中定义的类型占位符。

**vs 泛型参数**: 每个类型只能有一个实现

**示例**:

```rust
trait Iterator {
    type Item; // 关联类型
    fn next(&mut self) -> Option<Self::Item>;
}

impl Iterator for Counter {
    type Item = u32;
    fn next(&mut self) -> Option<u32> { /* ... */ }
}
```

**相关文档**:

- [Trait 系统指南](../tier_02_guides/04_Trait系统指南.md)
- [高级泛型模式](../tier_04_advanced/02_高级泛型模式.md)

---

## Newtype 模式

**定义**: 用单元素元组结构体包装现有类型。

**用途**:

- 类型安全
- 绕过孤儿规则
- 隐藏实现细节

**示例**:

```rust
struct Meters(f64);
struct Seconds(f64);

fn calculate_speed(distance: Meters, time: Seconds) -> f64 {
    distance.0 / time.0
}
```

**相关文档**:

- [基础类型指南](../tier_02_guides/01_基础类型指南.md)
- [设计模式集](../tier_04_advanced/05_设计模式集.md)

---

## 零大小类型 (ZST)

**定义**: 不占用内存的类型。

**示例**:

```rust
struct Unit; // ZST
struct Marker<T>(PhantomData<T>); // ZST

let x: () = (); // unit 类型，ZST
```

**用途**:

- 类型标记
- 状态机状态
- 零成本抽象

**相关文档**:

- [基础类型指南](../tier_02_guides/01_基础类型指南.md)
- [性能优化参考](../tier_03_references/05_性能优化参考.md)

---

## PhantomData

**定义**: 零大小类型标记，告诉编译器类型参数的使用。

**用途**:

- 标记生命周期
- 标记所有权
- 控制协变/逆变

**示例**:

```rust
use std::marker::PhantomData;

struct Slice<'a, T> {
    start: *const T,
    end: *const T,
    phantom: PhantomData<&'a T>,
}
```

**相关文档**:

- [高级泛型模式](../tier_04_advanced/02_高级泛型模式.md)
- [类型型变参考](../tier_03_references/02_类型型变参考.md)

---

## Never类型 (!)

**定义**: 表示永不返回的类型。

**用途**:

- panic 函数
- 无限循环
- 程序退出

**示例**:

```rust
fn exit() -> ! {
    std::process::exit(0);
}

fn forever() -> ! {
    loop {}
}
```

**特性**: 可以强制转换为任何类型

**相关文档**:

- [基础类型指南](../tier_02_guides/01_基础类型指南.md)

---

## Pin

**定义**: 保证值在内存中不会移动。

**用途**:

- 自引用结构
- async/await
- FFI

**示例**:

```rust
use std::pin::Pin;

fn use_pinned(pinned: Pin<&mut T>) {
    // pinned 保证不会移动
}
```

**相关文档**:

- [安全性参考](../tier_03_references/04_安全性参考.md)

---

## 类型推导 (Type Inference)

**定义**: 编译器自动推导变量类型。

**示例**:

```rust
let x = 5; // 推导为 i32
let s = String::from("hello"); // 推导为 String
let v = vec![1, 2, 3]; // 推导为 Vec<i32>
```

**Turbofish 语法**: `::<>` 显式指定类型

```rust
let numbers = Vec::<i32>::new();
let result = parse::<i32>("42");
```

**相关文档**:

- [基础类型指南](../tier_02_guides/01_基础类型指南.md)

---

## Deref强制转换

**定义**: 编译器自动插入解引用操作。

**规则**:

- `&T` to `&U` (当 `T: Deref<Target=U>`)
- `&mut T` to `&mut U` (当 `T: DerefMut<Target=U>`)
- `&mut T` to `&U` (当 `T: Deref<Target=U>`)

**示例**:

```rust
fn hello(name: &str) {
    println!("Hello, {}", name);
}

let s = String::from("Rust");
hello(&s); // &String -> &str (Deref 强制转换)
```

**相关文档**:

- [类型转换参考](../tier_03_references/01_类型转换参考.md)

---

## 孤儿规则 (Orphan Rule)

**定义**: 只能为本地类型或本地 trait 实现 trait。

**限制**:

- 不能为外部类型实现外部 trait
- 防止依赖冲突

**绕过**: 使用 newtype 模式

```rust
struct Wrapper(Vec<String>);

impl fmt::Display for Wrapper {
    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
        write!(f, "[{}]", self.0.join(", "))
    }
}
```

**相关文档**:

- [Trait 系统指南](../tier_02_guides/04_Trait系统指南.md)

---

## 协变与逆变 (Variance)

**定义**: 类型参数的子类型关系。

**协变** (Covariance): `T <: U` ⇒ `F<T> <: F<U>`  
**逆变** (Contravariance): `T <: U` ⇒ `F<U> <: F<T>`  
**不变** (Invariance): 无子类型关系

**Rust 中**:

- `&'a T` 对 `'a` 和 `T` 协变
- `&'a mut T` 对 `'a` 协变，对 `T` 不变
- `fn(T)` 对 `T` 逆变

**相关文档**:

- [类型型变参考](../tier_03_references/02_类型型变参考.md)
- [类型理论深度](../tier_04_advanced/01_类型理论深度.md)

---

## 单态化 (Monomorphization)

**定义**: 编译时为泛型生成具体类型的代码。

**优点**:

- 零运行时开销
- 可以内联优化

**缺点**:

- 代码膨胀
- 编译时间增加

**示例**:

```rust
fn add<T: Add<Output=T>>(a: T, b: T) -> T {
    a + b
}

// 编译后生成两份代码
let x = add(1, 2);     // add_i32
let y = add(1.0, 2.0); // add_f64
```

**相关文档**:

- [性能优化参考](../tier_03_references/05_性能优化参考.md)
- [分派机制参考](../tier_03_references/03_分派机制参考.md)

---

## 生命周期 (Lifetime)

**定义**: 引用有效的作用域范围。

**语法**:

```rust
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() { x } else { y }
}

struct ImportantExcerpt<'a> {
    part: &'a str,
}
```

**省略规则**: 编译器可以自动推导生命周期

**相关文档**:

- [生命周期指南](../tier_02_guides/05_生命周期指南.md)

---

## GAT (Generic Associated Types)

**定义**: 泛型关联类型，允许关联类型带有泛型参数。

**示例**:

```rust
trait Container {
    type Item<'a> where Self: 'a; // GAT
    fn get<'a>(&'a self) -> Self::Item<'a>;
}

impl Container for Vec<String> {
    type Item<'a> = &'a String;
    fn get<'a>(&'a self) -> &'a String {
        &self[0]
    }
}
```

**Rust 版本**: 1.65+ 稳定

**相关文档**:

- [高级泛型模式](../tier_04_advanced/02_高级泛型模式.md)

---

## HRTB (Higher-Rank Trait Bounds)

**定义**: 高阶 trait 约束，允许在 trait 约束中使用 `for<'a>`。

**示例**:

```rust
fn call_with_ref<F>(f: F)
where
    F: for<'a> Fn(&'a str) -> &'a str,
{
    let result = f("hello");
    println!("{}", result);
}
```

**用途**: 处理任意生命周期的情况

**相关文档**:

- [高级泛型模式](../tier_04_advanced/02_高级泛型模式.md)

---

## Sized Trait

**定义**: 标记类型是否在编译时已知大小。

**特点**:

- 大多数类型自动实现 `Sized`
- `?Sized` 表示可能是动态大小类型（DST）

**示例**:

```rust
// 泛型默认约束 Sized
fn foo<T>(x: T) {} // 等价于 fn foo<T: Sized>(x: T)

// 允许 DST
fn foo<T: ?Sized>(x: &T) {}
```

**相关文档**:

- [基础类型指南](../tier_02_guides/01_基础类型指南.md)

---

## Send 和 Sync

**定义**: 标记类型的线程安全性。

**Send**: 可以在线程间传递所有权  
**Sync**: 可以在线程间共享引用

**自动实现**: 大多数类型自动实现

**手动实现**: 使用 `unsafe impl`

```rust
// 大多数类型自动实现
struct MyType { /* ... */ }

// 不实现 Send/Sync 的类型
use std::rc::Rc;
let rc = Rc::new(5); // Rc 不是 Send/Sync
```

**相关文档**:

- [安全性参考](../tier_03_references/04_安全性参考.md)

---

## 其他术语

### DST (Dynamically Sized Type)

**定义**: 动态大小类型，编译时大小未知。

**示例**: `str`, `[T]`, `dyn Trait`

**使用**: 必须通过引用或智能指针访问

```rust
let s: &str = "hello"; // OK
let arr: &[i32] = &[1, 2, 3]; // OK
let obj: &dyn Trait = &value; // OK
```

### Const Generic

**定义**: 常量泛型，允许泛型参数是常量。

**示例**:

```rust
struct Array<T, const N: usize> {
    data: [T; N],
}

fn create_array<T, const N: usize>() -> [T; N] {
    // ...
}
```

**Rust 版本**: 1.51+ 部分支持，1.90+ 完全增强

### Type Alias

**定义**: 类型别名，为类型创建新名称。

**示例**:

```rust
type Kilometers = i32;
type Result<T> = std::result::Result<T, std::io::Error>;
```

### Turbofish

**定义**: 使用 `::<>` 显式指定泛型参数。

**示例**:

```rust
let v = Vec::<i32>::new();
let x = parse::<i32>("42");
```

---

## 📚 延伸阅读

### Tier 1 (基础层)

- [项目概览](./01_项目概览.md) - 项目整体介绍
- [主索引导航](./02_主索引导航.md) - 完整文档索引
- [常见问题](./04_常见问题.md) - FAQ

### Tier 2 (指南层)

- [基础类型指南](../tier_02_guides/01_基础类型指南.md)
- [泛型编程指南](../tier_02_guides/03_泛型编程指南.md)
- [Trait 系统指南](../tier_02_guides/04_Trait系统指南.md)
- [生命周期指南](../tier_02_guides/05_生命周期指南.md)

### Tier 3 (参考层)

- [类型转换参考](../tier_03_references/01_类型转换参考.md)
- [类型型变参考](../tier_03_references/02_类型型变参考.md)
- [分派机制参考](../tier_03_references/03_分派机制参考.md)

### Tier 4 (高级层)

- [类型理论深度](../tier_04_advanced/01_类型理论深度.md)
- [高级泛型模式](../tier_04_advanced/02_高级泛型模式.md)
- [类型系统形式化](../tier_04_advanced/03_类型系统形式化.md)

---

**需要更多帮助？**

- 查看 [示例代码](../../examples/)
- 运行 [测试用例](../../tests/)
- 阅读 [常见问题](./04_常见问题.md)

---

**最后更新**: 2025-10-22  
**适用版本**: Rust 1.90+  
**文档类型**: 📚 参考资料
