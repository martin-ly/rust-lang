# 1.3 Rust ç±»å‹ç³»ç»Ÿ - å¸¸è§é—®é¢˜è§£ç­”

> **æ–‡æ¡£ç±»å‹**: Tier 1 - åŸºç¡€å±‚
> **æ–‡æ¡£å®šä½**: ç±»å‹ç³»ç»Ÿå®è·µä¸­çš„å¸¸è§é—®é¢˜å¿«é€Ÿè§£ç­”
> **ä½¿ç”¨æ–¹å¼**: é‡åˆ°é—®é¢˜æ—¶å¿«é€ŸæŸ¥æ‰¾è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µ
> **æœ€åæ›´æ–°**: 2025-12-11

---

## ğŸ“Š ç›®å½•

- [1.3 Rust ç±»å‹ç³»ç»Ÿ - å¸¸è§é—®é¢˜è§£ç­”](#13-rust-ç±»å‹ç³»ç»Ÿ---å¸¸è§é—®é¢˜è§£ç­”)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [ğŸ“‹ é—®é¢˜ç´¢å¼•](#-é—®é¢˜ç´¢å¼•)
  - [ç±»å‹åŸºç¡€](#ç±»å‹åŸºç¡€)
    - [Q1: Rust çš„ç±»å‹ç³»ç»Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ](#q1-rust-çš„ç±»å‹ç³»ç»Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹)
    - [Q2: ä½•æ—¶ä½¿ç”¨ newtype æ¨¡å¼ï¼Ÿ](#q2-ä½•æ—¶ä½¿ç”¨-newtype-æ¨¡å¼)
    - [Q3: ä»€ä¹ˆæ˜¯é›¶å¤§å°ç±»å‹ï¼ˆZSTï¼‰ï¼Œä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ](#q3-ä»€ä¹ˆæ˜¯é›¶å¤§å°ç±»å‹zstä¸ºä»€ä¹ˆé‡è¦)
  - [æ³›å‹](#æ³›å‹)
    - [Q4: æ³›å‹ vs trait å¯¹è±¡ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ](#q4-æ³›å‹-vs-trait-å¯¹è±¡å¦‚ä½•é€‰æ‹©)
    - [Q5: å¦‚ä½•ç†è§£ç”Ÿå‘½å‘¨æœŸä¸æ³›å‹çš„å…³ç³»ï¼Ÿ](#q5-å¦‚ä½•ç†è§£ç”Ÿå‘½å‘¨æœŸä¸æ³›å‹çš„å…³ç³»)
    - [Q6: const æ³›å‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ](#q6-const-æ³›å‹æœ‰ä»€ä¹ˆç”¨)
  - [Trait](#trait)
    - [Q7: å¦‚ä½•å®ç°æ¡ä»¶ trait å®ç°ï¼Ÿ](#q7-å¦‚ä½•å®ç°æ¡ä»¶-trait-å®ç°)
    - [Q8: å…³è”ç±»å‹ vs æ³›å‹å‚æ•°ï¼Ÿ](#q8-å…³è”ç±»å‹-vs-æ³›å‹å‚æ•°)
    - [Q9: ä»€ä¹ˆæ˜¯ trait å¯¹è±¡å®‰å…¨ï¼Ÿ](#q9-ä»€ä¹ˆæ˜¯-trait-å¯¹è±¡å®‰å…¨)
  - [ç±»å‹è½¬æ¢](#ç±»å‹è½¬æ¢)
    - [Q10: From/Into vs As è½¬æ¢ï¼Ÿ](#q10-frominto-vs-as-è½¬æ¢)
    - [Q11: Deref å¼ºåˆ¶è½¬æ¢å¦‚ä½•å·¥ä½œï¼Ÿ](#q11-deref-å¼ºåˆ¶è½¬æ¢å¦‚ä½•å·¥ä½œ)
  - [ç”Ÿå‘½å‘¨æœŸ](#ç”Ÿå‘½å‘¨æœŸ)
    - [Q12: ä½•æ—¶éœ€è¦æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼Ÿ](#q12-ä½•æ—¶éœ€è¦æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ³¨è§£)
    - [Q13: å¦‚ä½•ç†è§£ 'static ç”Ÿå‘½å‘¨æœŸï¼Ÿ](#q13-å¦‚ä½•ç†è§£-static-ç”Ÿå‘½å‘¨æœŸ)
    - [Q14: å¦‚ä½•å¤„ç†è‡ªå¼•ç”¨ç»“æ„ä½“ï¼Ÿ](#q14-å¦‚ä½•å¤„ç†è‡ªå¼•ç”¨ç»“æ„ä½“)
  - [é«˜çº§ç±»å‹](#é«˜çº§ç±»å‹)
    - [Q15: å¦‚ä½•ä½¿ç”¨ Never ç±»å‹ (!)ï¼Ÿ](#q15-å¦‚ä½•ä½¿ç”¨-never-ç±»å‹-)
    - [Q16: å¦‚ä½•ç†è§£ Pin å’Œ Unpinï¼Ÿ](#q16-å¦‚ä½•ç†è§£-pin-å’Œ-unpin)
    - [Q17: å¦‚ä½•ä½¿ç”¨ PhantomDataï¼Ÿ](#q17-å¦‚ä½•ä½¿ç”¨-phantomdata)
  - [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
    - [Q18: æ³›å‹å’Œ trait å¯¹è±¡çš„æ€§èƒ½å·®å¼‚ï¼Ÿ](#q18-æ³›å‹å’Œ-trait-å¯¹è±¡çš„æ€§èƒ½å·®å¼‚)
    - [Q19: å¦‚ä½•é¿å…æ³›å‹ä»£ç è†¨èƒ€ï¼Ÿ](#q19-å¦‚ä½•é¿å…æ³›å‹ä»£ç è†¨èƒ€)
    - [Q20: é›¶å¤§å°ç±»å‹å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ](#q20-é›¶å¤§å°ç±»å‹å¦‚ä½•ä¼˜åŒ–æ€§èƒ½)
  - [ğŸ“š å»¶ä¼¸é˜…è¯»](#-å»¶ä¼¸é˜…è¯»)
    - [Tier 1 (åŸºç¡€å±‚)](#tier-1-åŸºç¡€å±‚)
    - [Tier 2 (æŒ‡å—å±‚)](#tier-2-æŒ‡å—å±‚)
    - [Tier 3 (å‚è€ƒå±‚)](#tier-3-å‚è€ƒå±‚)
    - [Tier 4 (é«˜çº§å±‚)](#tier-4-é«˜çº§å±‚)

## ğŸ“‹ é—®é¢˜ç´¢å¼•

**æŒ‰ç±»åˆ«å¿«é€Ÿè·³è½¬**:

- [ç±»å‹åŸºç¡€](#ç±»å‹åŸºç¡€) - åŸºç¡€ç±»å‹ç›¸å…³é—®é¢˜
- [æ³›å‹](#æ³›å‹) - æ³›å‹ç¼–ç¨‹ç›¸å…³é—®é¢˜
- [Trait](#trait) - Trait ç³»ç»Ÿç›¸å…³é—®é¢˜
- [ç±»å‹è½¬æ¢](#ç±»å‹è½¬æ¢) - ç±»å‹è½¬æ¢ç›¸å…³é—®é¢˜
- [ç”Ÿå‘½å‘¨æœŸ](#ç”Ÿå‘½å‘¨æœŸ) - ç”Ÿå‘½å‘¨æœŸç›¸å…³é—®é¢˜
- [é«˜çº§ç±»å‹](#é«˜çº§ç±»å‹) - é«˜çº§ç±»å‹ç›¸å…³é—®é¢˜
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–) - æ€§èƒ½ç›¸å…³é—®é¢˜

---

## ç±»å‹åŸºç¡€

### Q1: Rust çš„ç±»å‹ç³»ç»Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ

**A**: Rust é‡‡ç”¨å¼ºé™æ€ç±»å‹ç³»ç»Ÿï¼š

**æ ¸å¿ƒç‰¹ç‚¹**:

- âœ… **é™æ€ç±»å‹**: ç¼–è¯‘æ—¶ç¡®å®šæ‰€æœ‰ç±»å‹
- âœ… **ç±»å‹æ¨å¯¼**: è‡ªåŠ¨æ¨å¯¼å˜é‡ç±»å‹
- âœ… **é›¶æˆæœ¬æŠ½è±¡**: æ³›å‹æ— è¿è¡Œæ—¶å¼€é”€
- âœ… **ç±»å‹å®‰å…¨**: é˜²æ­¢ç±»å‹é”™è¯¯

**ç¤ºä¾‹**:

```rust
// ç±»å‹æ¨å¯¼
let x = 5; // i32
let y = 5.0; // f64

// æ˜¾å¼ç±»å‹æ ‡æ³¨
let x: i32 = 5;
let s: String = String::from("hello");
```

**ç›¸å…³æ–‡æ¡£**: [åŸºç¡€ç±»å‹æŒ‡å—](../tier_02_guides/01_åŸºç¡€ç±»å‹æŒ‡å—.md)

---

### Q2: ä½•æ—¶ä½¿ç”¨ newtype æ¨¡å¼ï¼Ÿ

**A**: ä¸ºç±»å‹å®‰å…¨å’Œè¯­ä¹‰æ¸…æ™°ï¼š

**ä½¿ç”¨åœºæ™¯**:

1. **ç±»å‹å®‰å…¨**: é˜²æ­¢æ··æ·†ç›¸ä¼¼ç±»å‹
2. **å®ç°å¤–éƒ¨ trait**: å­¤å„¿è§„åˆ™ç»•è¿‡
3. **éšè—å®ç°ç»†èŠ‚**: å°è£…

**ç¤ºä¾‹**:

```rust
// é˜²æ­¢æ··æ·†
struct Meters(f64);
struct Seconds(f64);

fn calculate_speed(distance: Meters, time: Seconds) -> f64 {
    distance.0 / time.0
}

// å®ç°å¤–éƒ¨ trait
struct Wrapper(Vec<String>);

impl fmt::Display for Wrapper {
    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
        write!(f, "[{}]", self.0.join(", "))
    }
}
```

**ç›¸å…³æ–‡æ¡£**: [è®¾è®¡æ¨¡å¼é›†](../tier_04_advanced/05_è®¾è®¡æ¨¡å¼é›†.md)

---

### Q3: ä»€ä¹ˆæ˜¯é›¶å¤§å°ç±»å‹ï¼ˆZSTï¼‰ï¼Œä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ

**A**: é›¶å¤§å°ç±»å‹ä¸å ç”¨å†…å­˜ï¼Œä½†åœ¨ç±»å‹ç³»ç»Ÿä¸­æœ‰æ„ä¹‰ï¼š

**ç”¨é€”**:

1. **ç±»å‹æ ‡è®°**: æ ‡è®°ç±»å‹çŠ¶æ€
2. **é›¶æˆæœ¬æŠ½è±¡**: ç¼–è¯‘æœŸè¡Œä¸ºï¼Œæ— è¿è¡Œæ—¶å¼€é”€
3. **çŠ¶æ€æœº**: ç±»å‹çº§åˆ«çš„çŠ¶æ€ç®¡ç†

**ç¤ºä¾‹**:

```rust
use std::marker::PhantomData;

// ç±»å‹çŠ¶æ€æ¨¡å¼
struct Locked;
struct Unlocked;

struct Database<State = Locked> {
    connection: Connection,
    _state: PhantomData<State>,
}

impl Database<Locked> {
    fn unlock(self, password: &str) -> Result<Database<Unlocked>, Error> {
        // éªŒè¯å¯†ç 
        Ok(Database {
            connection: self.connection,
            _state: PhantomData,
        })
    }
}

impl Database<Unlocked> {
    fn query(&self, sql: &str) -> Result<Vec<Row>, Error> {
        // åªæœ‰è§£é”çŠ¶æ€æ‰èƒ½æŸ¥è¯¢
        self.connection.execute(sql)
    }
}
```

**ç›¸å…³æ–‡æ¡£**: [æ€§èƒ½ä¼˜åŒ–å‚è€ƒ](../tier_03_references/05_æ€§èƒ½ä¼˜åŒ–å‚è€ƒ.md)

---

## æ³›å‹

### Q4: æ³›å‹ vs trait å¯¹è±¡ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ

**A**: æ ¹æ®æ€§èƒ½å’Œçµæ´»æ€§éœ€æ±‚é€‰æ‹©ï¼š

| ç‰¹æ€§ | æ³›å‹ `<T>` | Trait å¯¹è±¡ `dyn Trait` |
|------|-----------|---------------------|
| **å¤šæ€æ—¶æœº** | ç¼–è¯‘æ—¶ | è¿è¡Œæ—¶ |
| **æ€§èƒ½** | é›¶æˆæœ¬ï¼ˆå•æ€åŒ–ï¼‰ | è™šå‡½æ•°è°ƒç”¨å¼€é”€ |
| **ä»£ç å¤§å°** | è†¨èƒ€ï¼ˆæ¯ä¸ªç±»å‹ä¸€ä»½ï¼‰ | ç´§å‡‘ |
| **çµæ´»æ€§** | ç¼–è¯‘æ—¶ç¡®å®š | è¿è¡Œæ—¶é€‰æ‹© |
| **è¿”å›ç±»å‹** | å…·ä½“ç±»å‹ | ç»Ÿä¸€æ¥å£ |

**æ³›å‹ç¤ºä¾‹**:

```rust
fn process<T: Display>(item: T) {
    println!("{}", item);
}
// ç¼–è¯‘åä¸ºæ¯ä¸ªå…·ä½“ç±»å‹ç”Ÿæˆä»£ç 
```

**Trait å¯¹è±¡ç¤ºä¾‹**:

```rust
fn process(item: &dyn Display) {
    println!("{}", item);
}
// è¿è¡Œæ—¶åŠ¨æ€åˆ†æ´¾
```

**é€‰æ‹©å»ºè®®**:

- æ€§èƒ½å…³é”® â†’ æ³›å‹
- éœ€è¦é›†åˆå­˜å‚¨ä¸åŒç±»å‹ â†’ Trait å¯¹è±¡
- ç¼–è¯‘æ—¶é—´é‡è¦ â†’ Trait å¯¹è±¡

**ç›¸å…³æ–‡æ¡£**: [åˆ†æ´¾æœºåˆ¶å‚è€ƒ](../tier_03_references/03_åˆ†æ´¾æœºåˆ¶å‚è€ƒ.md)

---

### Q5: å¦‚ä½•ç†è§£ç”Ÿå‘½å‘¨æœŸä¸æ³›å‹çš„å…³ç³»ï¼Ÿ

**A**: ç”Ÿå‘½å‘¨æœŸæ˜¯æ³›å‹çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼š

**æ¦‚å¿µ**:

- æ³›å‹: ç±»å‹çš„å‚æ•°åŒ–
- ç”Ÿå‘½å‘¨æœŸ: å¼•ç”¨æœ‰æ•ˆæœŸçš„å‚æ•°åŒ–

**è¯­æ³•å¯¹æ¯”**:

```rust
// ç±»å‹æ³›å‹
fn foo<T>(x: T) -> T { x }

// ç”Ÿå‘½å‘¨æœŸæ³›å‹
fn foo<'a>(x: &'a str) -> &'a str { x }

// ç»„åˆä½¿ç”¨
fn foo<'a, T>(x: &'a T) -> &'a T { x }
```

**ç»“æ„ä½“ç¤ºä¾‹**:

```rust
struct Container<'a, T> {
    item: &'a T,
}

impl<'a, T> Container<'a, T> {
    fn new(item: &'a T) -> Self {
        Container { item }
    }
}
```

**ç›¸å…³æ–‡æ¡£**: [ç”Ÿå‘½å‘¨æœŸæŒ‡å—](../tier_02_guides/05_ç”Ÿå‘½å‘¨æœŸæŒ‡å—.md)

---

### Q6: const æ³›å‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

**A**: å…è®¸æ³›å‹å‚æ•°æ˜¯å¸¸é‡ï¼Œç‰¹åˆ«é€‚åˆæ•°ç»„å¤§å°ï¼š

**åŸºæœ¬ç”¨æ³•**:

```rust
struct Array<T, const N: usize> {
    data: [T; N],
}

fn create_array<T: Default, const N: usize>() -> [T; N] {
    [T::default(); N]
}

// ä½¿ç”¨
let arr: Array<i32, 10> = Array { data: [0; 10] };
let arr2 = create_array::<i32, 5>();
```

**é«˜çº§ç”¨æ³•** (Rust 1.90+):

```rust
// const æ³›å‹è¡¨è¾¾å¼
fn split_array<T, const N: usize, const M: usize>(
    arr: [T; N + M]
) -> ([T; N], [T; M]) {
    // ...
}
```

**ç›¸å…³æ–‡æ¡£**: [é«˜çº§æ³›å‹æ¨¡å¼](../tier_04_advanced/02_é«˜çº§æ³›å‹æ¨¡å¼.md)

---

## Trait

### Q7: å¦‚ä½•å®ç°æ¡ä»¶ trait å®ç°ï¼Ÿ

**A**: ä½¿ç”¨ where å­å¥å’Œ trait boundsï¼š

**ç¤ºä¾‹**:

```rust
use std::fmt::Display;

// åªä¸ºå®ç°äº† Display çš„ç±»å‹å®ç°
struct Wrapper<T>(T);

impl<T: Display> Display for Wrapper<T> {
    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
        write!(f, "Wrapper({})", self.0)
    }
}

// blanket implementation
impl<T: Display> ToString for T {
    fn to_string(&self) -> String {
        format!("{}", self)
    }
}
```

**å¤šé‡çº¦æŸ**:

```rust
fn notify<T>(item: &T)
where
    T: Display + Clone,
{
    println!("{}", item);
    let _copy = item.clone();
}
```

**ç›¸å…³æ–‡æ¡£**: [Trait ç³»ç»ŸæŒ‡å—](../tier_02_guides/04_Traitç³»ç»ŸæŒ‡å—.md)

---

### Q8: å…³è”ç±»å‹ vs æ³›å‹å‚æ•°ï¼Ÿ

**A**: æ ¹æ®çº¦æŸæ•°é‡é€‰æ‹©ï¼š

**å…³è”ç±»å‹** (ä¸€ä¸ªå®ç°ä¸€ç§ç±»å‹):

```rust
trait Iterator {
    type Item; // å…³è”ç±»å‹
    fn next(&mut self) -> Option<Self::Item>;
}

impl Iterator for Counter {
    type Item = u32;
    fn next(&mut self) -> Option<u32> { /* ... */ }
}
```

**æ³›å‹å‚æ•°** (ä¸€ä¸ªå®ç°å¤šç§ç±»å‹):

```rust
trait Add<Rhs = Self> {
    type Output;
    fn add(self, rhs: Rhs) -> Self::Output;
}

// å¯ä»¥ä¸ºåŒä¸€ç±»å‹å®ç°å¤šæ¬¡
impl Add<i32> for Point { /* ... */ }
impl Add<f64> for Point { /* ... */ }
```

**é€‰æ‹©å»ºè®®**:

- æ¯ä¸ªç±»å‹åªæœ‰ä¸€ç§å®ç° â†’ å…³è”ç±»å‹
- éœ€è¦å¤šç§å®ç° â†’ æ³›å‹å‚æ•°

**ç›¸å…³æ–‡æ¡£**: [Trait ç³»ç»ŸæŒ‡å—](../tier_02_guides/04_Traitç³»ç»ŸæŒ‡å—.md)

---

### Q9: ä»€ä¹ˆæ˜¯ trait å¯¹è±¡å®‰å…¨ï¼Ÿ

**A**: ä¸æ˜¯æ‰€æœ‰ trait éƒ½èƒ½ç”¨ä½œ trait å¯¹è±¡ï¼š

**å¯¹è±¡å®‰å…¨è¦æ±‚**:

1. âŒ ä¸èƒ½æœ‰æ³›å‹æ–¹æ³•
2. âŒ ä¸èƒ½è¿”å› Self
3. âœ… æ–¹æ³•å¿…é¡»æœ‰æ¥æ”¶è€… (&self, &mut self, etc.)

**ä¸å®‰å…¨ç¤ºä¾‹**:

```rust
trait NotObjectSafe {
    fn generic<T>(&self, t: T); // æ³›å‹æ–¹æ³•
    fn returns_self(&self) -> Self; // è¿”å› Self
}

// ç¼–è¯‘é”™è¯¯ï¼šä¸èƒ½åˆ›å»º trait å¯¹è±¡
// let obj: Box<dyn NotObjectSafe> = ...;
```

**å®‰å…¨ç¤ºä¾‹**:

```rust
trait ObjectSafe {
    fn method(&self) -> i32;
    fn another(&mut self, x: i32);
}

// OK: å¯ä»¥åˆ›å»º trait å¯¹è±¡
let obj: Box<dyn ObjectSafe> = Box::new(MyType);
```

**ç›¸å…³æ–‡æ¡£**: [Trait ç³»ç»ŸæŒ‡å—](../tier_02_guides/04_Traitç³»ç»ŸæŒ‡å—.md)

---

## ç±»å‹è½¬æ¢

### Q10: From/Into vs As è½¬æ¢ï¼Ÿ

**A**: ä¸åŒçš„è½¬æ¢åœºæ™¯ï¼š

**From/Into** (ç±»å‹ä¹‹é—´è½¬æ¢):

```rust
// From
impl From<i32> for MyType {
    fn from(x: i32) -> Self {
        MyType(x)
    }
}

let x: MyType = MyType::from(42);
let x: MyType = 42.into(); // Into è‡ªåŠ¨å®ç°
```

**As** (æ•°å€¼ç±»å‹è½¬æ¢):

```rust
let x: i32 = 42;
let y: i64 = x as i64; // æ•°å€¼ç±»å‹è½¬æ¢
let ptr: *const i32 = &x;
let addr = ptr as usize; // æŒ‡é’ˆè½¬æ¢
```

**TryFrom/TryInto** (å¯èƒ½å¤±è´¥çš„è½¬æ¢):

```rust
use std::convert::TryFrom;

impl TryFrom<i32> for PositiveNumber {
    type Error = &'static str;

    fn try_from(value: i32) -> Result<Self, Self::Error> {
        if value > 0 {
            Ok(PositiveNumber(value))
        } else {
            Err("Number must be positive")
        }
    }
}
```

**é€‰æ‹©å»ºè®®**:

- æ— æŸè½¬æ¢ â†’ From/Into
- æ•°å€¼/æŒ‡é’ˆè½¬æ¢ â†’ as
- å¯èƒ½å¤±è´¥çš„è½¬æ¢ â†’ TryFrom/TryInto

**ç›¸å…³æ–‡æ¡£**: [ç±»å‹è½¬æ¢å‚è€ƒ](../tier_03_references/01_ç±»å‹è½¬æ¢å‚è€ƒ.md)

---

### Q11: Deref å¼ºåˆ¶è½¬æ¢å¦‚ä½•å·¥ä½œï¼Ÿ

**A**: ç¼–è¯‘å™¨è‡ªåŠ¨æ’å…¥è§£å¼•ç”¨æ“ä½œï¼š

**è§„åˆ™**:

1. `&T` to `&U` (å½“ `T: Deref<Target=U>`)
2. `&mut T` to `&mut U` (å½“ `T: DerefMut<Target=U>`)
3. `&mut T` to `&U` (å½“ `T: Deref<Target=U>`)

**ç¤ºä¾‹**:

```rust
fn hello(name: &str) {
    println!("Hello, {}", name);
}

let s = String::from("Rust");
hello(&s); // &String -> &str (Deref å¼ºåˆ¶è½¬æ¢)

// ç­‰ä»·äº
hello(&(*s)); // æ‰‹åŠ¨è§£å¼•ç”¨
```

**è‡ªå®šä¹‰ Deref**:

```rust
use std::ops::Deref;

struct MyBox<T>(T);

impl<T> Deref for MyBox<T> {
    type Target = T;

    fn deref(&self) -> &T {
        &self.0
    }
}

let x = MyBox(5);
assert_eq!(5, *x); // è°ƒç”¨ deref()
```

**ç›¸å…³æ–‡æ¡£**: [ç±»å‹è½¬æ¢å‚è€ƒ](../tier_03_references/01_ç±»å‹è½¬æ¢å‚è€ƒ.md)

---

## ç”Ÿå‘½å‘¨æœŸ

### Q12: ä½•æ—¶éœ€è¦æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼Ÿ

**A**: å½“ç¼–è¯‘å™¨æ— æ³•æ¨å¯¼ç”Ÿå‘½å‘¨æœŸæ—¶ï¼š

**ä¸éœ€è¦æ³¨è§£** (ç¼–è¯‘å™¨å¯ä»¥æ¨å¯¼):

```rust
fn first_word(s: &str) -> &str {
    // ç¼–è¯‘å™¨åº”ç”¨çœç•¥è§„åˆ™
    s.split_whitespace().next().unwrap()
}
```

**éœ€è¦æ³¨è§£** (å¤šä¸ªå¼•ç”¨å‚æ•°):

```rust
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() { x } else { y }
}
```

**ç»“æ„ä½“ä¸­çš„å¼•ç”¨**:

```rust
struct ImportantExcerpt<'a> {
    part: &'a str, // å¿…é¡»æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ
}
```

**ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™**:

1. æ¯ä¸ªå¼•ç”¨å‚æ•°è·å¾—ç‹¬ç«‹ç”Ÿå‘½å‘¨æœŸ
2. åªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸæ—¶ï¼Œèµ‹äºˆæ‰€æœ‰è¾“å‡º
3. æ–¹æ³•çš„ &self ç”Ÿå‘½å‘¨æœŸèµ‹äºˆæ‰€æœ‰è¾“å‡º

**ç›¸å…³æ–‡æ¡£**: [ç”Ÿå‘½å‘¨æœŸæŒ‡å—](../tier_02_guides/05_ç”Ÿå‘½å‘¨æœŸæŒ‡å—.md)

---

### Q13: å¦‚ä½•ç†è§£ 'static ç”Ÿå‘½å‘¨æœŸï¼Ÿ

**A**: 'static è¡¨ç¤ºæ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½æœ‰æ•ˆï¼š

**ç”¨é€”**:

1. å­—ç¬¦ä¸²å­—é¢é‡
2. å…¨å±€å˜é‡
3. Trait å¯¹è±¡çº¦æŸ

**ç¤ºä¾‹**:

```rust
// å­—ç¬¦ä¸²å­—é¢é‡è‡ªåŠ¨æ˜¯ 'static
let s: &'static str = "hello";

// å…¨å±€å˜é‡
static GLOBAL: i32 = 42;

// Trait å¯¹è±¡çº¦æŸ (ä¸åŒ…å«é 'static å¼•ç”¨)
fn take_static_trait(obj: Box<dyn MyTrait + 'static>) {
    // ...
}
```

**æ³¨æ„**: 'static ä¸æ„å‘³ç€ä¸å¯å˜ï¼š

```rust
static mut COUNTER: i32 = 0;

unsafe {
    COUNTER += 1; // å¯ä»¥ä¿®æ”¹ï¼ˆéœ€è¦ unsafeï¼‰
}
```

**ç›¸å…³æ–‡æ¡£**: [ç”Ÿå‘½å‘¨æœŸæŒ‡å—](../tier_02_guides/05_ç”Ÿå‘½å‘¨æœŸæŒ‡å—.md)

---

### Q14: å¦‚ä½•å¤„ç†è‡ªå¼•ç”¨ç»“æ„ä½“ï¼Ÿ

**A**: ä½¿ç”¨ Pin å’Œ unsafeï¼š

**é—®é¢˜**:

```rust
// ç¼–è¯‘é”™è¯¯ï¼šä¸èƒ½æœ‰è‡ªå¼•ç”¨
struct SelfReferential {
    data: String,
    ptr: *const String, // æŒ‡å‘ data
}
```

**è§£å†³æ–¹æ¡ˆ 1: ä½¿ç”¨ç´¢å¼•**:

```rust
struct Better {
    data: Vec<String>,
    index: usize, // ä½¿ç”¨ç´¢å¼•ä»£æ›¿æŒ‡é’ˆ
}
```

**è§£å†³æ–¹æ¡ˆ 2: ä½¿ç”¨ Pin**:

```rust
use std::pin::Pin;

struct SelfRef {
    data: String,
    ptr: *const String,
}

impl SelfRef {
    fn new(data: String) -> Pin<Box<Self>> {
        let mut boxed = Box::pin(SelfRef {
            data,
            ptr: std::ptr::null(),
        });
        let ptr = &boxed.data as *const String;
        unsafe {
            let mut_ref = Pin::get_unchecked_mut(Pin::as_mut(&mut boxed));
            mut_ref.ptr = ptr;
        }
        boxed
    }
}
```

**ç›¸å…³æ–‡æ¡£**: [å®‰å…¨æ€§å‚è€ƒ](../tier_03_references/04_å®‰å…¨æ€§å‚è€ƒ.md)

---

## é«˜çº§ç±»å‹

### Q15: å¦‚ä½•ä½¿ç”¨ Never ç±»å‹ (!)ï¼Ÿ

**A**: è¡¨ç¤ºæ°¸ä¸è¿”å›çš„å‡½æ•°ï¼š

**ä½¿ç”¨åœºæ™¯**:

```rust
// æ°¸ä¸è¿”å›çš„å‡½æ•°
fn exit_program() -> ! {
    std::process::exit(0);
}

// panic
fn crash() -> ! {
    panic!("This function never returns");
}

// æ— é™å¾ªç¯
fn forever() -> ! {
    loop {
        // ...
    }
}
```

**åœ¨ match ä¸­**:

```rust
let result: Result<i32, String> = Ok(42);

let value = match result {
    Ok(v) => v,
    Err(e) => panic!("Error: {}", e), // ! å¯ä»¥åŒ¹é…ä»»ä½•ç±»å‹
};
```

**å®éªŒæ€§åŠŸèƒ½** (Rust 1.90):

```rust
#![feature(never_type)]

let x: ! = loop {};
let y: i32 = x; // ! å¯ä»¥å¼ºåˆ¶è½¬æ¢ä¸ºä»»ä½•ç±»å‹
```

**ç›¸å…³æ–‡æ¡£**: [åŸºç¡€ç±»å‹æŒ‡å—](../tier_02_guides/01_åŸºç¡€ç±»å‹æŒ‡å—.md)

---

### Q16: å¦‚ä½•ç†è§£ Pin å’Œ Unpinï¼Ÿ

**A**: ç”¨äºé˜²æ­¢å€¼åœ¨å†…å­˜ä¸­ç§»åŠ¨ï¼š

**ä½¿ç”¨åœºæ™¯**:

- è‡ªå¼•ç”¨ç»“æ„
- async/awaitï¼ˆFuture çŠ¶æ€æœºï¼‰
- FFI ä¸­çš„å›ºå®šåœ°å€

**åŸºæœ¬ç”¨æ³•**:

```rust
use std::pin::Pin;

struct SelfReferential {
    data: String,
    ptr: *const String,
}

fn use_pinned(pinned: Pin<&mut SelfReferential>) {
    // pinned ä¿è¯ä¸ä¼šç§»åŠ¨
}
```

**Unpin**:

- å¤§å¤šæ•°ç±»å‹é»˜è®¤å®ç° Unpin
- å¯ä»¥å®‰å…¨åœ°ä» Pin ä¸­å–å‡º
- !Unpin è¡¨ç¤ºä¸èƒ½ç§»åŠ¨

```rust
// å¤§å¤šæ•°ç±»å‹å®ç° Unpin
assert_impl_all!(String: Unpin);
assert_impl_all!(Vec<i32>: Unpin);

// PhantomPinned æ ‡è®°ä¸º !Unpin
use std::marker::PhantomPinned;

struct NotUnpin {
    data: String,
    _pin: PhantomPinned,
}
```

**ç›¸å…³æ–‡æ¡£**: [å®‰å…¨æ€§å‚è€ƒ](../tier_03_references/04_å®‰å…¨æ€§å‚è€ƒ.md)

---

### Q17: å¦‚ä½•ä½¿ç”¨ PhantomDataï¼Ÿ

**A**: æ ‡è®°ç±»å‹å‚æ•°çš„å­˜åœ¨ï¼š

**ä½¿ç”¨åœºæ™¯**:

```rust
use std::marker::PhantomData;

// æ ‡è®°ç”Ÿå‘½å‘¨æœŸ
struct Slice<'a, T> {
    start: *const T,
    end: *const T,
    phantom: PhantomData<&'a T>, // æ ‡è®° 'a çš„ä½¿ç”¨
}

// æ ‡è®°æ‰€æœ‰æƒ
struct Vec<T> {
    ptr: *mut T,
    len: usize,
    cap: usize,
    phantom: PhantomData<T>, // æ ‡è®°æ‹¥æœ‰ T
}

// ç±»å‹çŠ¶æ€æ¨¡å¼
struct Locked;
struct Unlocked;

struct Database<State = Locked> {
    connection: Connection,
    _state: PhantomData<State>,
}
```

**ä½œç”¨**:

- ç¼–è¯‘å™¨ç†è§£ç±»å‹å…³ç³»
- åå˜/é€†å˜æ§åˆ¶
- Drop æ£€æŸ¥

**ç›¸å…³æ–‡æ¡£**: [é«˜çº§æ³›å‹æ¨¡å¼](../tier_04_advanced/02_é«˜çº§æ³›å‹æ¨¡å¼.md)

---

## æ€§èƒ½ä¼˜åŒ–

### Q18: æ³›å‹å’Œ trait å¯¹è±¡çš„æ€§èƒ½å·®å¼‚ï¼Ÿ

**A**: æ³›å‹ï¼ˆå•æ€åŒ–ï¼‰vs åŠ¨æ€åˆ†æ´¾ï¼š

**åŸºå‡†æµ‹è¯•** (100ä¸‡æ¬¡è°ƒç”¨):

| æ–¹å¼ | æ—¶é—´ | ç›¸å¯¹æ€§èƒ½ |
|------|------|---------|
| æ³›å‹ | 5ms | åŸºå‡† (1.0x) |
| Trait å¯¹è±¡ | 8ms | 0.625x |
| ç›´æ¥è°ƒç”¨ | 5ms | 1.0x |

**æ³›å‹** (é›¶æˆæœ¬):

```rust
fn process<T: Display>(item: T) {
    println!("{}", item); // é™æ€åˆ†æ´¾ï¼Œå¯å†…è”
}
```

**Trait å¯¹è±¡** (è™šå‡½æ•°å¼€é”€):

```rust
fn process(item: &dyn Display) {
    println!("{}", item); // åŠ¨æ€åˆ†æ´¾ï¼Œè™šè¡¨æŸ¥æ‰¾
}
```

**é€‰æ‹©å»ºè®®**:

- æ€§èƒ½å…³é”®è·¯å¾„ â†’ æ³›å‹
- ä»£ç å¤§å°é‡è¦ â†’ Trait å¯¹è±¡
- è¿è¡Œæ—¶å¤šæ€éœ€æ±‚ â†’ Trait å¯¹è±¡

**ç›¸å…³æ–‡æ¡£**: [æ€§èƒ½ä¼˜åŒ–å‚è€ƒ](../tier_03_references/05_æ€§èƒ½ä¼˜åŒ–å‚è€ƒ.md)

---

### Q19: å¦‚ä½•é¿å…æ³›å‹ä»£ç è†¨èƒ€ï¼Ÿ

**A**: å¤šç§ç­–ç•¥ç»“åˆä½¿ç”¨ï¼š

**1. ä½¿ç”¨ trait å¯¹è±¡**:

```rust
// è†¨èƒ€ç‰ˆæœ¬
fn process_many<T: Display>(items: Vec<T>) {
    for item in items {
        process_generic(item); // æ¯ä¸ªç±»å‹éƒ½ç”Ÿæˆä»£ç 
    }
}

// ç´§å‡‘ç‰ˆæœ¬
fn process_many(items: Vec<Box<dyn Display>>) {
    for item in items {
        process_trait_object(&*item); // å…±äº«ä¸€ä»½ä»£ç 
    }
}
```

**2. æå–éæ³›å‹éƒ¨åˆ†**:

```rust
// æ³›å‹å…¥å£ï¼ˆå¾ˆå°ï¼‰
fn process<T: Display>(item: T) {
    process_impl(&item as &dyn Display); // è½¬ä¸º trait å¯¹è±¡
}

// éæ³›å‹å®ç°ï¼ˆå…±äº«ï¼‰
fn process_impl(item: &dyn Display) {
    // å®é™…é€»è¾‘
    println!("{}", item);
}
```

**3. ä½¿ç”¨ const æ³›å‹åˆå¹¶**:

```rust
// è†¨èƒ€
fn create_array_10() -> [i32; 10] { [0; 10] }
fn create_array_20() -> [i32; 20] { [0; 20] }

// åˆå¹¶
fn create_array<const N: usize>() -> [i32; N] {
    [0; N]
}
```

**ç›¸å…³æ–‡æ¡£**: [æ€§èƒ½ä¼˜åŒ–å‚è€ƒ](../tier_03_references/05_æ€§èƒ½ä¼˜åŒ–å‚è€ƒ.md)

---

### Q20: é›¶å¤§å°ç±»å‹å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ

**A**: ç¼–è¯‘å™¨å®Œå…¨æ¶ˆé™¤é›¶å¤§å°ç±»å‹çš„å†…å­˜å¼€é”€ï¼š

**ç¤ºä¾‹**:

```rust
use std::marker::PhantomData;

// ç±»å‹çŠ¶æ€æ¨¡å¼ï¼ˆé›¶è¿è¡Œæ—¶å¼€é”€ï¼‰
struct Empty;
struct NonEmpty;

struct Stack<State> {
    data: Vec<i32>,
    _state: PhantomData<State>, // é›¶å¤§å°
}

impl Stack<Empty> {
    fn new() -> Self {
        Stack {
            data: Vec::new(),
            _state: PhantomData,
        }
    }

    fn push(self, value: i32) -> Stack<NonEmpty> {
        let mut data = self.data;
        data.push(value);
        Stack {
            data,
            _state: PhantomData,
        }
    }
}

impl Stack<NonEmpty> {
    fn pop(self) -> (i32, Stack<Empty>) {
        let mut data = self.data;
        let value = data.pop().unwrap();
        (value, Stack {
            data,
            _state: PhantomData,
        })
    }
}
```

**æ€§èƒ½éªŒè¯**:

```rust
// é›¶è¿è¡Œæ—¶å¼€é”€ï¼Œç¼–è¯‘æœŸå¼ºåˆ¶ç±»å‹å®‰å…¨
let stack = Stack::new(); // Empty
// stack.pop(); // ç¼–è¯‘é”™è¯¯ï¼ç©ºæ ˆä¸èƒ½ pop
let stack = stack.push(42); // NonEmpty
let (value, stack) = stack.pop(); // å›åˆ° Empty
```

**å†…å­˜å¸ƒå±€**:

```rust
assert_eq!(
    std::mem::size_of::<Stack<Empty>>(),
    std::mem::size_of::<Vec<i32>>()
); // PhantomData ä¸å ç©ºé—´
```

**ç›¸å…³æ–‡æ¡£**: [æ€§èƒ½ä¼˜åŒ–å‚è€ƒ](../tier_03_references/05_æ€§èƒ½ä¼˜åŒ–å‚è€ƒ.md)

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

### Tier 1 (åŸºç¡€å±‚)

- [é¡¹ç›®æ¦‚è§ˆ](./01_é¡¹ç›®æ¦‚è§ˆ.md) - é¡¹ç›®æ•´ä½“ä»‹ç»
- [ä¸»ç´¢å¼•å¯¼èˆª](./02_ä¸»ç´¢å¼•å¯¼èˆª.md) - å®Œæ•´æ–‡æ¡£ç´¢å¼•
- [æœ¯è¯­è¡¨](./03_æœ¯è¯­è¡¨.md) - æ ¸å¿ƒæœ¯è¯­

### Tier 2 (æŒ‡å—å±‚)

- [åŸºç¡€ç±»å‹æŒ‡å—](../tier_02_guides/01_åŸºç¡€ç±»å‹æŒ‡å—.md)
- [å¤åˆç±»å‹æŒ‡å—](../tier_02_guides/02_å¤åˆç±»å‹æŒ‡å—.md)
- [æ³›å‹ç¼–ç¨‹æŒ‡å—](../tier_02_guides/03_æ³›å‹ç¼–ç¨‹æŒ‡å—.md)
- [Trait ç³»ç»ŸæŒ‡å—](../tier_02_guides/04_Traitç³»ç»ŸæŒ‡å—.md)
- [ç”Ÿå‘½å‘¨æœŸæŒ‡å—](../tier_02_guides/05_ç”Ÿå‘½å‘¨æœŸæŒ‡å—.md)

### Tier 3 (å‚è€ƒå±‚)

- [ç±»å‹è½¬æ¢å‚è€ƒ](../tier_03_references/01_ç±»å‹è½¬æ¢å‚è€ƒ.md)
- [ç±»å‹å‹å˜å‚è€ƒ](../tier_03_references/02_ç±»å‹å‹å˜å‚è€ƒ.md)
- [åˆ†æ´¾æœºåˆ¶å‚è€ƒ](../tier_03_references/03_åˆ†æ´¾æœºåˆ¶å‚è€ƒ.md)
- [å®‰å…¨æ€§å‚è€ƒ](../tier_03_references/04_å®‰å…¨æ€§å‚è€ƒ.md)
- [æ€§èƒ½ä¼˜åŒ–å‚è€ƒ](../tier_03_references/05_æ€§èƒ½ä¼˜åŒ–å‚è€ƒ.md)

### Tier 4 (é«˜çº§å±‚)

- [ç±»å‹ç†è®ºæ·±åº¦](../tier_04_advanced/01_ç±»å‹ç†è®ºæ·±åº¦.md)
- [é«˜çº§æ³›å‹æ¨¡å¼](../tier_04_advanced/02_é«˜çº§æ³›å‹æ¨¡å¼.md)
- [ç±»å‹ç³»ç»Ÿå½¢å¼åŒ–](../tier_04_advanced/03_ç±»å‹ç³»ç»Ÿå½¢å¼åŒ–.md)
- [è·¨è¯­è¨€å¯¹æ¯”](../tier_04_advanced/04_è·¨è¯­è¨€å¯¹æ¯”.md)
- [è®¾è®¡æ¨¡å¼é›†](../tier_04_advanced/05_è®¾è®¡æ¨¡å¼é›†.md)

---

**éœ€è¦æ›´å¤šå¸®åŠ©ï¼Ÿ**

- æŸ¥çœ‹ [ç¤ºä¾‹ä»£ç ](../../examples/)
- è¿è¡Œ [æµ‹è¯•ç”¨ä¾‹](../../tests/)
- æŸ¥é˜… [æœ¯è¯­è¡¨](./03_æœ¯è¯­è¡¨.md)
- æµè§ˆ [æ·±åº¦åˆ†æ](../analysis/)

---

**æœ€åæ›´æ–°**: 2025-12-11
**é€‚ç”¨ç‰ˆæœ¬**: Rust 1.92.0+
**æ–‡æ¡£ç±»å‹**: ğŸ“š é—®é¢˜è§£ç­”
