# Cargo å·¥ä½œç©ºé—´ç®¡ç†

## ğŸ“‹ ç›®å½•

- [Cargo å·¥ä½œç©ºé—´ç®¡ç†](#cargo-å·¥ä½œç©ºé—´ç®¡ç†)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ å·¥ä½œç©ºé—´æ¦‚è§ˆ](#-å·¥ä½œç©ºé—´æ¦‚è§ˆ)
  - [1. å·¥ä½œç©ºé—´åŸºç¡€](#1-å·¥ä½œç©ºé—´åŸºç¡€)
    - [1.1 ä»€ä¹ˆæ˜¯å·¥ä½œç©ºé—´](#11-ä»€ä¹ˆæ˜¯å·¥ä½œç©ºé—´)
    - [1.2 åˆ›å»ºå·¥ä½œç©ºé—´](#12-åˆ›å»ºå·¥ä½œç©ºé—´)
    - [1.3 å·¥ä½œç©ºé—´ç»“æ„](#13-å·¥ä½œç©ºé—´ç»“æ„)
  - [2. æˆå‘˜ç®¡ç†](#2-æˆå‘˜ç®¡ç†)
    - [2.1 æ·»åŠ æˆå‘˜](#21-æ·»åŠ æˆå‘˜)
    - [2.2 æ’é™¤æˆå‘˜](#22-æ’é™¤æˆå‘˜)
    - [2.3 æˆå‘˜è·¯å¾„](#23-æˆå‘˜è·¯å¾„)
  - [3. ä¾èµ–ç»§æ‰¿](#3-ä¾èµ–ç»§æ‰¿)
    - [3.1 workspace.dependencies](#31-workspacedependencies)
    - [3.2 æˆå‘˜ç»§æ‰¿ä¾èµ–](#32-æˆå‘˜ç»§æ‰¿ä¾èµ–)
    - [3.3 ç‰ˆæœ¬ç®¡ç†](#33-ç‰ˆæœ¬ç®¡ç†)
  - [4. åŒ…å…ƒæ•°æ®ç»§æ‰¿](#4-åŒ…å…ƒæ•°æ®ç»§æ‰¿)
    - [4.1 workspace.package](#41-workspacepackage)
    - [4.2 å…ƒæ•°æ®è¦†ç›–](#42-å…ƒæ•°æ®è¦†ç›–)
  - [5. å†…éƒ¨ä¾èµ–](#5-å†…éƒ¨ä¾èµ–)
    - [5.1 æˆå‘˜é—´ä¾èµ–](#51-æˆå‘˜é—´ä¾èµ–)
    - [5.2 è·¯å¾„ä¾èµ–](#52-è·¯å¾„ä¾èµ–)
    - [5.3 ç‰ˆæœ¬åŒæ­¥](#53-ç‰ˆæœ¬åŒæ­¥)
  - [6. æ„å»ºç®¡ç†](#6-æ„å»ºç®¡ç†)
    - [6.1 ç»Ÿä¸€æ„å»º](#61-ç»Ÿä¸€æ„å»º)
    - [6.2 é€‰æ‹©æ€§æ„å»º](#62-é€‰æ‹©æ€§æ„å»º)
    - [6.3 æ„å»ºä¼˜åŒ–](#63-æ„å»ºä¼˜åŒ–)
  - [7. æµ‹è¯•ç®¡ç†](#7-æµ‹è¯•ç®¡ç†)
    - [7.1 å·¥ä½œç©ºé—´æµ‹è¯•](#71-å·¥ä½œç©ºé—´æµ‹è¯•)
    - [7.2 é›†æˆæµ‹è¯•](#72-é›†æˆæµ‹è¯•)
    - [7.3 æµ‹è¯•ç­–ç•¥](#73-æµ‹è¯•ç­–ç•¥)
  - [8. å‘å¸ƒç®¡ç†](#8-å‘å¸ƒç®¡ç†)
    - [8.1 å‘å¸ƒé¡ºåº](#81-å‘å¸ƒé¡ºåº)
    - [8.2 ç‰ˆæœ¬åŒæ­¥](#82-ç‰ˆæœ¬åŒæ­¥)
    - [8.3 å‘å¸ƒè‡ªåŠ¨åŒ–](#83-å‘å¸ƒè‡ªåŠ¨åŒ–)
  - [9. å·¥ä½œç©ºé—´æœ€ä½³å®è·µ](#9-å·¥ä½œç©ºé—´æœ€ä½³å®è·µ)
    - [9.1 ç›®å½•ç»„ç»‡](#91-ç›®å½•ç»„ç»‡)
    - [9.2 ä¾èµ–ç­–ç•¥](#92-ä¾èµ–ç­–ç•¥)
    - [9.3 ç‰ˆæœ¬ç­–ç•¥](#93-ç‰ˆæœ¬ç­–ç•¥)
  - [10. å¸¸è§æ¨¡å¼](#10-å¸¸è§æ¨¡å¼)
    - [10.1 å•ä½“ä»“åº“](#101-å•ä½“ä»“åº“)
    - [10.2 åº“+å·¥å…·](#102-åº“å·¥å…·)
    - [10.3 å¾®æœåŠ¡](#103-å¾®æœåŠ¡)
  - [ğŸ“Š å·¥ä½œç©ºé—´å¯¹æ¯”](#-å·¥ä½œç©ºé—´å¯¹æ¯”)
  - [ğŸ” å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)
  - [ğŸ“– å»¶ä¼¸é˜…è¯»](#-å»¶ä¼¸é˜…è¯»)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## ğŸ¯ å·¥ä½œç©ºé—´æ¦‚è§ˆ

Cargo å·¥ä½œç©ºé—´ï¼ˆWorkspaceï¼‰æ˜¯ç®¡ç†å¤šä¸ªç›¸å…³åŒ…çš„æœºåˆ¶ï¼š

```mermaid
graph TD
    A[Workspace] --> B[å…±äº« Cargo.lock]
    A --> C[å…±äº« target/]
    A --> D[ç»Ÿä¸€ä¾èµ–ç‰ˆæœ¬]
    A --> E[å†…éƒ¨ä¾èµ–]

    B --> B1[å¯é‡ç°æ„å»º]
    C --> C1[å‡å°‘ç£ç›˜å ç”¨]
    D --> D1[ç‰ˆæœ¬ä¸€è‡´æ€§]
    E --> E1[å¼€å‘ä¾¿åˆ©]
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

- **å·¥ä½œç©ºé—´**: å¤šä¸ªåŒ…çš„å®¹å™¨
- **æˆå‘˜**: å·¥ä½œç©ºé—´ä¸­çš„åŒ…
- **ç»§æ‰¿**: å…±äº«é…ç½®å’Œä¾èµ–
- **ç»Ÿä¸€**: å•ä¸€ Cargo.lock å’Œæ„å»ºç›®å½•

---

## 1. å·¥ä½œç©ºé—´åŸºç¡€

### 1.1 ä»€ä¹ˆæ˜¯å·¥ä½œç©ºé—´

**å®šä¹‰**: å·¥ä½œç©ºé—´æ˜¯ä¸€ç»„å…±äº«ä»¥ä¸‹èµ„æºçš„åŒ…ï¼š

- `Cargo.lock` - ä¾èµ–é”å®šæ–‡ä»¶
- `target/` - æ„å»ºè¾“å‡ºç›®å½•
- ä¾èµ–ç‰ˆæœ¬ - ç»Ÿä¸€çš„ä¾èµ–è§£æ

**ä¼˜åŠ¿**ï¼š

| ä¼˜åŠ¿     | è¯´æ˜                     |
| -------- | ------------------------ |
| ç‰ˆæœ¬ç»Ÿä¸€ | æ‰€æœ‰æˆå‘˜ä½¿ç”¨ç›¸åŒä¾èµ–ç‰ˆæœ¬ |
| æ„å»ºåŠ é€Ÿ | å…±äº«ç¼–è¯‘ç¼“å­˜             |
| å¼€å‘ä¾¿åˆ© | åŒæ—¶ä¿®æ”¹å¤šä¸ªåŒ…           |
| ç£ç›˜èŠ‚çœ | é¿å…é‡å¤ç¼–è¯‘             |

### 1.2 åˆ›å»ºå·¥ä½œç©ºé—´

**æ­¥éª¤ 1: åˆ›å»ºæ ¹ç›®å½•**:

```bash
mkdir my-workspace
cd my-workspace
```

**æ­¥éª¤ 2: åˆ›å»ºå·¥ä½œç©ºé—´é…ç½®**:

```toml
# Cargo.toml
[workspace]
members = [
    "crate-a",
    "crate-b",
]
resolver = "3"  # Rust 1.93.0+ æ¨è
```

**æ­¥éª¤ 3: åˆ›å»ºæˆå‘˜åŒ…**:

```bash
cargo new crate-a --lib
cargo new crate-b --bin
```

**ç»“æœ**ï¼š

```text
my-workspace/
â”œâ”€â”€ Cargo.toml       # å·¥ä½œç©ºé—´é…ç½®
â”œâ”€â”€ Cargo.lock       # å…±äº«é”å®šæ–‡ä»¶
â”œâ”€â”€ target/          # å…±äº«æ„å»ºç›®å½•
â”œâ”€â”€ crate-a/
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/
â””â”€â”€ crate-b/
    â”œâ”€â”€ Cargo.toml
    â””â”€â”€ src/
```

### 1.3 å·¥ä½œç©ºé—´ç»“æ„

**æ¨èç»“æ„**ï¼š

```text
my-workspace/
â”œâ”€â”€ Cargo.toml              # å·¥ä½œç©ºé—´æ ¹
â”œâ”€â”€ Cargo.lock              # ä¾èµ–é”å®š
â”œâ”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ .gitignore
â”œâ”€â”€ crates/                 # æˆå‘˜ç›®å½•
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒåº“
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”œâ”€â”€ utils/              # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â””â”€â”€ cli/                # CLI åº”ç”¨
â”‚       â”œâ”€â”€ Cargo.toml
â”‚       â””â”€â”€ src/
â”œâ”€â”€ examples/               # å…±äº«ç¤ºä¾‹
â”œâ”€â”€ tests/                  # é›†æˆæµ‹è¯•
â””â”€â”€ docs/                   # æ–‡æ¡£
```

---

## 2. æˆå‘˜ç®¡ç†

### 2.1 æ·»åŠ æˆå‘˜

**æ˜¾å¼åˆ—ä¸¾**ï¼š

```toml
[workspace]
members = [
    "crate-a",
    "crate-b",
    "crates/core",
    "crates/utils",
]
```

**é€šé…ç¬¦æ¨¡å¼**ï¼š

```toml
[workspace]
members = [
    "crates/*",      # crates ç›®å½•ä¸‹æ‰€æœ‰åŒ…
]
```

**æ··åˆä½¿ç”¨**ï¼š

```toml
[workspace]
members = [
    "core",          # æ ¹ç›®å½•æˆå‘˜
    "crates/*",      # é€šé…ç¬¦
    "tools/cli",     # ç‰¹å®šè·¯å¾„
]
```

### 2.2 æ’é™¤æˆå‘˜

```toml
[workspace]
members = ["crates/*"]

exclude = [
    "crates/experimental",  # æ’é™¤å®éªŒæ€§åŒ…
    "crates/old-*",         # æ’é™¤æ—§ç‰ˆæœ¬
    "target",               # æ’é™¤æ„å»ºç›®å½•
]
```

**ä½¿ç”¨åœºæ™¯**ï¼š

- å®éªŒæ€§é¡¹ç›®
- åºŸå¼ƒçš„åŒ…
- ä¸´æ—¶é¡¹ç›®
- ç¬¬ä¸‰æ–¹åŒ…

### 2.3 æˆå‘˜è·¯å¾„

**ç›¸å¯¹è·¯å¾„**ï¼š

```toml
[workspace]
members = [
    ".",              # å½“å‰ç›®å½•
    "sub/package",    # å­ç›®å½•
    "../sibling",     # å…„å¼Ÿç›®å½•ï¼ˆä¸æ¨èï¼‰
]
```

**æ³¨æ„äº‹é¡¹**ï¼š

```toml
# âœ… å¥½ï¼šæˆå‘˜åœ¨å·¥ä½œç©ºé—´ç›®å½•å†…
members = ["crates/core"]

# âŒ é¿å…ï¼šæˆå‘˜åœ¨å·¥ä½œç©ºé—´å¤–
members = ["../external"]  # å¯èƒ½å¯¼è‡´é—®é¢˜
```

---

## 3. ä¾èµ–ç»§æ‰¿

### 3.1 workspace.dependencies

**Rust 1.93.0+ æ–°ç‰¹æ€§**ï¼ˆè‡ª Rust 1.90 å¼•å…¥ï¼ŒæŒç»­æ›´æ–°ï¼‰ï¼š

```toml
# å·¥ä½œç©ºé—´æ ¹ Cargo.toml
[workspace]
members = ["crate-a", "crate-b"]
resolver = "3"

[workspace.dependencies]
# å®šä¹‰å…±äº«ä¾èµ–
serde = { version = "1.0", features = ["derive"] }
tokio = { version = "1.48", features = ["full"] }
anyhow = "1.0"
thiserror = "1.0"

# å†…éƒ¨ä¾èµ–
crate-a = { path = "./crate-a" }
```

**ä¼˜åŠ¿**ï¼š

- å•ç‚¹ç»´æŠ¤ç‰ˆæœ¬
- ç¡®ä¿ç‰ˆæœ¬ä¸€è‡´
- ç®€åŒ–æˆå‘˜é…ç½®
- å‡å°‘é‡å¤

### 3.2 æˆå‘˜ç»§æ‰¿ä¾èµ–

```toml
# crate-a/Cargo.toml
[package]
name = "crate-a"
version = "0.1.0"

[dependencies]
# ç»§æ‰¿å·¥ä½œç©ºé—´ä¾èµ–
serde.workspace = true
tokio.workspace = true

# æ·»åŠ æˆå‘˜ç‰¹å®šç‰¹æ€§
tokio = { workspace = true, features = ["rt"] }

# å¯é€‰ä¾èµ–
anyhow = { workspace = true, optional = true }
```

**è¯­æ³•è¯´æ˜**ï¼š

```toml
# ç®€å•ç»§æ‰¿
serde.workspace = true

# ç­‰ä»·äºï¼ˆè‡ªåŠ¨å±•å¼€ï¼‰
serde = { version = "1.0", features = ["derive"] }
```

### 3.3 ç‰ˆæœ¬ç®¡ç†

**é›†ä¸­ç®¡ç†**ï¼š

```toml
# å·¥ä½œç©ºé—´æ ¹
[workspace.dependencies]
# æ‰€æœ‰æˆå‘˜ä½¿ç”¨è¿™äº›ç‰ˆæœ¬
serde = "1.0.198"
tokio = "1.48.0"

# æˆå‘˜ A
[dependencies]
serde.workspace = true  # ä½¿ç”¨ 1.0.198

# æˆå‘˜ B
[dependencies]
serde.workspace = true  # ä½¿ç”¨ 1.0.198
```

**ç‰ˆæœ¬æ›´æ–°**ï¼š

```bash
# åªéœ€åœ¨æ ¹ç›®å½•æ›´æ–°
# vim Cargo.toml
[workspace.dependencies]
serde = "1.0.199"  # æ›´æ–°ç‰ˆæœ¬

# æ‰€æœ‰æˆå‘˜è‡ªåŠ¨ä½¿ç”¨æ–°ç‰ˆæœ¬
cargo update
```

---

## 4. åŒ…å…ƒæ•°æ®ç»§æ‰¿

### 4.1 workspace.package

```toml
# å·¥ä½œç©ºé—´æ ¹ Cargo.toml
[workspace.package]
version = "0.1.0"
edition = "2024"
rust-version = "1.93"
authors = ["Your Name <you@example.com>"]
license = "MIT OR Apache-2.0"
repository = "https://github.com/user/repo"
homepage = "https://example.com"
documentation = "https://docs.rs"
```

**æˆå‘˜ç»§æ‰¿**ï¼š

```toml
# crate-a/Cargo.toml
[package]
name = "crate-a"
version.workspace = true
edition.workspace = true
license.workspace = true
authors.workspace = true

# å¯ä»¥è¦†ç›–ç‰¹å®šå­—æ®µ
description = "Crate A specific description"
```

### 4.2 å…ƒæ•°æ®è¦†ç›–

```toml
# crate-b/Cargo.toml
[package]
name = "crate-b"
version.workspace = true  # ç»§æ‰¿
edition.workspace = true  # ç»§æ‰¿

# è¦†ç›–
version = "0.2.0"         # ä½¿ç”¨ä¸åŒç‰ˆæœ¬
license = "MIT"           # ä½¿ç”¨ä¸åŒè®¸å¯è¯
```

**è¦†ç›–åœºæ™¯**ï¼š

- ç‹¬ç«‹ç‰ˆæœ¬å·
- ç‰¹æ®Šè®¸å¯è¯
- è‡ªå®šä¹‰ä½œè€…
- ä¸åŒæ–‡æ¡£é“¾æ¥

---

## 5. å†…éƒ¨ä¾èµ–

### 5.1 æˆå‘˜é—´ä¾èµ–

```toml
# å·¥ä½œç©ºé—´æ ¹
[workspace]
members = ["core", "utils", "app"]

[workspace.dependencies]
core = { path = "./core" }
utils = { path = "./utils" }
```

```toml
# app/Cargo.toml
[dependencies]
core.workspace = true
utils.workspace = true
```

### 5.2 è·¯å¾„ä¾èµ–

**åŸºæœ¬è¯­æ³•**ï¼š

```toml
# app/Cargo.toml
[dependencies]
# ç›´æ¥è·¯å¾„ä¾èµ–
core = { path = "../core" }

# å¸¦ç‰ˆæœ¬å·ï¼ˆå‘å¸ƒæ—¶éœ€è¦ï¼‰
core = { path = "../core", version = "0.1" }

# å¸¦ç‰¹æ€§
core = { path = "../core", features = ["async"] }
```

### 5.3 ç‰ˆæœ¬åŒæ­¥

**å‘å¸ƒå‡†å¤‡**ï¼š

```toml
# å¼€å‘æ—¶
[dependencies]
core = { path = "../core" }

# å‘å¸ƒæ—¶
[dependencies]
core = { version = "0.1", path = "../core" }
```

**è‡ªåŠ¨å¤„ç†**ï¼š

```bash
# Cargo è‡ªåŠ¨å¤„ç†è·¯å¾„ä¾èµ–
cargo publish

# è­¦å‘Šï¼šç¡®ä¿ core å·²å‘å¸ƒæˆ–ä½¿ç”¨ path
```

---

## 6. æ„å»ºç®¡ç†

### 6.1 ç»Ÿä¸€æ„å»º

```bash
# æ„å»ºæ‰€æœ‰æˆå‘˜
cargo build --workspace

# å‘å¸ƒæ„å»º
cargo build --workspace --release

# æ£€æŸ¥æ‰€æœ‰æˆå‘˜
cargo check --workspace
```

### 6.2 é€‰æ‹©æ€§æ„å»º

```bash
# æ„å»ºç‰¹å®šåŒ…
cargo build -p crate-a
cargo build -p crate-b

# æ„å»ºå¤šä¸ªåŒ…
cargo build -p crate-a -p crate-b

# æ’é™¤ç‰¹å®šåŒ…
cargo build --workspace --exclude crate-c
```

### 6.3 æ„å»ºä¼˜åŒ–

```toml
# å·¥ä½œç©ºé—´æ ¹ Cargo.toml
[profile.dev]
# åº”ç”¨åˆ°æ‰€æœ‰æˆå‘˜
opt-level = 1

[profile.dev.package."*"]
# ä¼˜åŒ–æ‰€æœ‰ä¾èµ–
opt-level = 2

[profile.release]
lto = "fat"
codegen-units = 1
```

**æˆå‘˜ç‰¹å®šä¼˜åŒ–**ï¼š

```toml
# crate-a/Cargo.toml
[profile.release]
# è¦†ç›–å·¥ä½œç©ºé—´è®¾ç½®
opt-level = 3
```

---

## 7. æµ‹è¯•ç®¡ç†

### 7.1 å·¥ä½œç©ºé—´æµ‹è¯•

```bash
# æµ‹è¯•æ‰€æœ‰æˆå‘˜
cargo test --workspace

# æµ‹è¯•ç‰¹å®šåŒ…
cargo test -p crate-a

# æµ‹è¯•ç‰¹å®šåŠŸèƒ½
cargo test --workspace --features json
cargo test --workspace --all-features

# è¯¦ç»†è¾“å‡º
cargo test --workspace -- --nocapture
```

### 7.2 é›†æˆæµ‹è¯•

**å·¥ä½œç©ºé—´çº§é›†æˆæµ‹è¯•**ï¼š

```text
my-workspace/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ tests/              # å·¥ä½œç©ºé—´çº§æµ‹è¯•
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â””â”€â”€ integration_test.rs
â””â”€â”€ crates/
    â”œâ”€â”€ core/
    â”‚   â””â”€â”€ tests/      # åŒ…çº§æµ‹è¯•
    â””â”€â”€ utils/
        â””â”€â”€ tests/
```

```rust
// tests/integration_test.rs
use core::*;
use utils::*;

#[test]
fn test_workspace_integration() {
    // æµ‹è¯•å¤šä¸ªæˆå‘˜çš„é›†æˆ
}
```

### 7.3 æµ‹è¯•ç­–ç•¥

```yaml
# CI é…ç½®
jobs:
  test:
    steps:
      # æµ‹è¯•æ‰€æœ‰æˆå‘˜
      - run: cargo test --workspace

      # æµ‹è¯•ç‰¹æ€§ç»„åˆ
      - run: cargo test --workspace --no-default-features
      - run: cargo test --workspace --all-features

      # æ–‡æ¡£æµ‹è¯•
      - run: cargo test --workspace --doc
```

---

## 8. å‘å¸ƒç®¡ç†

### 8.1 å‘å¸ƒé¡ºåº

**ä¾èµ–é¡ºåº**ï¼š

```text
core (æ— ä¾èµ–)
  â†“
utils (ä¾èµ– core)
  â†“
app (ä¾èµ– core, utils)
```

**å‘å¸ƒè„šæœ¬**ï¼š

```bash
#!/bin/bash
# publish.sh

# 1. å‘å¸ƒ core
cd core
cargo publish
cd ..

# 2. ç­‰å¾… crates.io æ›´æ–°
sleep 30

# 3. å‘å¸ƒ utils
cd utils
cargo publish
cd ..

# 4. ç­‰å¾…
sleep 30

# 5. å‘å¸ƒ app
cd app
cargo publish
cd ..
```

### 8.2 ç‰ˆæœ¬åŒæ­¥

**ç»Ÿä¸€ç‰ˆæœ¬**ï¼š

```toml
# å·¥ä½œç©ºé—´æ ¹
[workspace.package]
version = "0.2.0"

# æ‰€æœ‰æˆå‘˜
[package]
version.workspace = true
```

**ç‹¬ç«‹ç‰ˆæœ¬**ï¼š

```toml
# core - ç¨³å®šåº“
[package]
version = "1.0.0"

# utils - å¿«é€Ÿè¿­ä»£
[package]
version = "0.3.0"

# app - åº”ç”¨ç‰ˆæœ¬
[package]
version = "2.1.0"
```

### 8.3 å‘å¸ƒè‡ªåŠ¨åŒ–

```yaml
# .github/workflows/publish.yml
name: Publish

on:
  push:
    tags:
      - "v*"

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Publish core
        run: |
          cd core
          cargo publish --token ${{ secrets.CARGO_TOKEN }}

      - name: Wait
        run: sleep 30

      - name: Publish utils
        run: |
          cd utils
          cargo publish --token ${{ secrets.CARGO_TOKEN }}
```

---

## 9. å·¥ä½œç©ºé—´æœ€ä½³å®è·µ

### 9.1 ç›®å½•ç»„ç»‡

**âœ… æ¨è**ï¼š

```text
workspace/
â”œâ”€â”€ Cargo.toml          # å·¥ä½œç©ºé—´æ ¹
â”œâ”€â”€ crates/             # æˆå‘˜ç›®å½•
â”‚   â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ utils/
â”‚   â””â”€â”€ app/
â”œâ”€â”€ tests/              # é›†æˆæµ‹è¯•
â”œâ”€â”€ examples/           # å…±äº«ç¤ºä¾‹
â””â”€â”€ docs/               # æ–‡æ¡£
```

**âŒ é¿å…**ï¼š

```text
workspace/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/                # æ··æ·†ï¼šæ˜¯æ ¹åŒ…è¿˜æ˜¯å·¥ä½œç©ºé—´ï¼Ÿ
â”œâ”€â”€ crate-a/
â””â”€â”€ crate-b/
```

### 9.2 ä¾èµ–ç­–ç•¥

```toml
# âœ… å¥½ï¼šä½¿ç”¨å·¥ä½œç©ºé—´ä¾èµ–
[workspace.dependencies]
serde = "1.0"

# æˆå‘˜ç»§æ‰¿
[dependencies]
serde.workspace = true

# âŒ å·®ï¼šæ¯ä¸ªæˆå‘˜ç‹¬ç«‹å£°æ˜
[dependencies]
serde = "1.0"  # å¯èƒ½ç‰ˆæœ¬ä¸ä¸€è‡´
```

### 9.3 ç‰ˆæœ¬ç­–ç•¥

**ç­–ç•¥ 1: ç»Ÿä¸€ç‰ˆæœ¬**:

```toml
[workspace.package]
version = "0.1.0"  # æ‰€æœ‰æˆå‘˜åŒç‰ˆæœ¬
```

**é€‚ç”¨**: ç´§å¯†è€¦åˆçš„é¡¹ç›®

**ç­–ç•¥ 2: ç‹¬ç«‹ç‰ˆæœ¬**:

```toml
# core: v1.0.0 - ç¨³å®š API
# utils: v0.5.0 - å¿«é€Ÿè¿­ä»£
# app: v2.0.0 - åº”ç”¨ç‰ˆæœ¬
```

**é€‚ç”¨**: ç‹¬ç«‹å‘å¸ƒçš„åŒ…

---

## 10. å¸¸è§æ¨¡å¼

### 10.1 å•ä½“ä»“åº“

**åœºæ™¯**: å¤šä¸ªç›¸å…³é¡¹ç›®

```text
monorepo/
â”œâ”€â”€ Cargo.toml
â””â”€â”€ crates/
    â”œâ”€â”€ project-a/      # é¡¹ç›® A
    â”œâ”€â”€ project-b/      # é¡¹ç›® B
    â””â”€â”€ shared/         # å…±äº«ä»£ç 
```

```toml
[workspace]
members = ["crates/*"]

[workspace.dependencies]
shared = { path = "./crates/shared" }
```

### 10.2 åº“+å·¥å…·

**åœºæ™¯**: åº“ + CLI å·¥å…·

```text
project/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ lib/                # æ ¸å¿ƒåº“
â”‚   â””â”€â”€ Cargo.toml
â””â”€â”€ cli/                # CLI å·¥å…·
    â””â”€â”€ Cargo.toml
```

```toml
# cli/Cargo.toml
[dependencies]
lib = { path = "../lib" }
clap = "4.5"
```

### 10.3 å¾®æœåŠ¡

**åœºæ™¯**: å¤šä¸ªå¾®æœåŠ¡

```text
services/
â”œâ”€â”€ Cargo.toml
â””â”€â”€ services/
    â”œâ”€â”€ common/         # å…±äº«åº“
    â”œâ”€â”€ api-gateway/    # API ç½‘å…³
    â”œâ”€â”€ auth-service/   # è®¤è¯æœåŠ¡
    â””â”€â”€ data-service/   # æ•°æ®æœåŠ¡
```

```toml
[workspace]
members = ["services/*"]

[workspace.dependencies]
common = { path = "./services/common" }
tokio = { version = "1.48", features = ["full"] }
```

---

## ğŸ“Š å·¥ä½œç©ºé—´å¯¹æ¯”

| ç‰¹æ€§       | å•åŒ…       | å·¥ä½œç©ºé—´ |
| ---------- | ---------- | -------- |
| Cargo.lock | å„è‡ªç‹¬ç«‹   | å…±äº«     |
| target/    | å„è‡ªç‹¬ç«‹   | å…±äº«     |
| ä¾èµ–ç‰ˆæœ¬   | å¯èƒ½ä¸ä¸€è‡´ | ç»Ÿä¸€     |
| æ„å»ºé€Ÿåº¦   | è¾ƒæ…¢       | è¾ƒå¿«     |
| ç£ç›˜å ç”¨   | è¾ƒå¤§       | è¾ƒå°     |
| ç®¡ç†å¤æ‚åº¦ | ç®€å•       | ä¸­ç­‰     |
| é€‚ç”¨åœºæ™¯   | ç‹¬ç«‹é¡¹ç›®   | ç›¸å…³é¡¹ç›® |

---

## ğŸ” å¸¸è§é—®é¢˜

**Q1: ä½•æ—¶ä½¿ç”¨å·¥ä½œç©ºé—´ï¼Ÿ**

```text
âœ… ä½¿ç”¨å·¥ä½œç©ºé—´ï¼š
- å¤šä¸ªç›¸å…³åŒ…
- å…±äº«ä¾èµ–
- åŒæ—¶å¼€å‘

âŒ ä¸éœ€è¦å·¥ä½œç©ºé—´ï¼š
- å•ä¸€åŒ…
- å®Œå…¨ç‹¬ç«‹çš„é¡¹ç›®
```

**Q2: å¦‚ä½•å¤„ç†ç‰ˆæœ¬å†²çªï¼Ÿ**

```toml
# ä½¿ç”¨ patch è¦†ç›–
[patch.crates-io]
problematic-dep = { path = "./local-fix" }
```

**Q3: å·¥ä½œç©ºé—´èƒ½åµŒå¥—å—ï¼Ÿ**

```text
âŒ ä¸æ”¯æŒï¼šCargo ä¸æ”¯æŒåµŒå¥—å·¥ä½œç©ºé—´
âœ… æ›¿ä»£ï¼šä½¿ç”¨å¹³é¢ç»“æ„ + é€»è¾‘åˆ†ç»„
```

---

## ğŸ“– å»¶ä¼¸é˜…è¯»

### å®˜æ–¹æ–‡æ¡£

- [Workspaces](https://doc.rust-lang.org/cargo/reference/workspaces.html)
- [Workspace Dependencies](https://doc.rust-lang.org/cargo/reference/workspaces.html#the-dependencies-table)
- [Resolver Version 3](https://doc.rust-lang.org/cargo/reference/resolver.html)

### ç›¸å…³æ–‡æ¡£

- [03\_ä¾èµ–ç®¡ç†è¯¦è§£.md](./03_ä¾èµ–ç®¡ç†è¯¦è§£.md)
- [08\_æœ€ä½³å®è·µæŒ‡å—.md](./08_æœ€ä½³å®è·µæŒ‡å—.md)
- [10\_å®æˆ˜æ¡ˆä¾‹é›†.md](./10_å®æˆ˜æ¡ˆä¾‹é›†.md) - æ¡ˆä¾‹ 4

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-01-26
**é€‚ç”¨ç‰ˆæœ¬**: Rust 1.93.0+

_å·¥ä½œç©ºé—´è®©å¤šåŒ…ç®¡ç†å˜å¾—ç®€å•é«˜æ•ˆã€‚_ ğŸ¦€ğŸ—ï¸
