# Cargo æ„å»ºæµç¨‹å¯è§†åŒ–

**ç‰ˆæœ¬**: Rust 1.90 / Cargo 1.90  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-19

---

## ğŸ“Š å®Œæ•´æ„å»ºæµç¨‹å›¾

```mermaid
graph TD
    A[cargo build] --> B[è¯»å– Cargo.toml]
    B --> C[ä¾èµ–è§£æ]
    C --> D[ä¸‹è½½ä¾èµ–]
    D --> E[æ„å»ºä¾èµ–]
    E --> F{å¢é‡ç¼–è¯‘æ£€æŸ¥}
    F -->|æœ‰ç¼“å­˜| G[ä½¿ç”¨ç¼“å­˜]
    F -->|æ— ç¼“å­˜| H[å®Œæ•´ç¼–è¯‘]
    G --> I[é“¾æ¥]
    H --> I
    I --> J[è¿è¡Œæ„å»ºè„šæœ¬]
    J --> K[ç”ŸæˆäºŒè¿›åˆ¶]
    K --> L[æ„å»ºå®Œæˆ]
    
    style A fill:#e1f5ff
    style L fill:#c8e6c9
    style G fill:#fff9c4
```

---

## ğŸ” è¯¦ç»†æ„å»ºé˜¶æ®µ

### é˜¶æ®µ 1: åˆå§‹åŒ–

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. è¯»å–é¡¹ç›®é…ç½®                        â”‚
â”‚     â”œâ”€â”€ Cargo.toml                     â”‚
â”‚     â”œâ”€â”€ Cargo.lock                     â”‚
â”‚     â””â”€â”€ .cargo/config.toml             â”‚
â”‚                                        â”‚
â”‚  2. ç¡®å®šæ„å»ºç›®æ ‡                        â”‚
â”‚     â”œâ”€â”€ Target: x86_64-pc-windows-msvc â”‚
â”‚     â”œâ”€â”€ Profile: dev/release           â”‚
â”‚     â””â”€â”€ Features: ["full", "async"]    â”‚
â”‚                                        â”‚
â”‚  3. åˆå§‹åŒ–æ„å»ºç¯å¢ƒ                      â”‚
â”‚     â”œâ”€â”€ è®¾ç½®ç¯å¢ƒå˜é‡                    â”‚
â”‚     â”œâ”€â”€ å‡†å¤‡æ„å»ºç›®å½•                    â”‚
â”‚     â””â”€â”€ åŠ è½½å·¥å…·é“¾                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### é˜¶æ®µ 2: ä¾èµ–å¤„ç†

```mermaid
graph LR
    A[ä¾èµ–åˆ—è¡¨] --> B[ç‰ˆæœ¬è§£æ]
    B --> C[æ£€æŸ¥ç¼“å­˜]
    C -->|å‘½ä¸­| D[ä½¿ç”¨æœ¬åœ°]
    C -->|æœªå‘½ä¸­| E[ä¸‹è½½]
    E --> F[éªŒè¯æ ¡éªŒå’Œ]
    F --> G[è§£å‹]
    G --> H[å‡†å¤‡æ„å»º]
    D --> H
    
    style A fill:#e1f5ff
    style H fill:#c8e6c9
```

**ç¼“å­˜ä½ç½®**:

```text
~/.cargo/registry/
â”œâ”€â”€ cache/          # ä¸‹è½½çš„ .crate æ–‡ä»¶
â”œâ”€â”€ src/            # è§£å‹çš„æºä»£ç 
â””â”€â”€ index/          # ç´¢å¼•ä¿¡æ¯
```

---

### é˜¶æ®µ 3: ç¼–è¯‘æµç¨‹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç¼–è¯‘å™¨è°ƒç”¨æµç¨‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: å®å±•å¼€
  æºä»£ç  â†’ å®å¤„ç†å™¨ â†’ å±•å¼€åä»£ç 
  
Step 2: HIR ç”Ÿæˆ
  å±•å¼€åä»£ç  â†’ è§£æå™¨ â†’ AST â†’ HIR
  
Step 3: MIR ç”Ÿæˆ
  HIR â†’ ç±»å‹æ£€æŸ¥ â†’ MIR â†’ å€Ÿç”¨æ£€æŸ¥
  
Step 4: LLVM IR ç”Ÿæˆ
  MIR â†’ LLVM Backend â†’ LLVM IR
  
Step 5: ç›®æ ‡ä»£ç ç”Ÿæˆ
  LLVM IR â†’ ä¼˜åŒ– â†’ ç›®æ ‡æœºå™¨ç 
  
Step 6: é“¾æ¥
  æ‰€æœ‰ç›®æ ‡æ–‡ä»¶ â†’ é“¾æ¥å™¨ â†’ æœ€ç»ˆäºŒè¿›åˆ¶
```

---

### é˜¶æ®µ 4: å¢é‡ç¼–è¯‘

```mermaid
graph TD
    A[æºæ–‡ä»¶å˜æ›´æ£€æµ‹] --> B{æ–‡ä»¶å·²ä¿®æ”¹?}
    B -->|å¦| C[ä½¿ç”¨ç¼“å­˜]
    B -->|æ˜¯| D{ä¾èµ–åˆ†æ}
    D -->|ä»…æœ¬åœ°å½±å“| E[éƒ¨åˆ†é‡ç¼–è¯‘]
    D -->|å½±å“ä¾èµ–| F[çº§è”ç¼–è¯‘]
    E --> G[æ›´æ–°ç¼“å­˜]
    F --> G
    C --> H[å®Œæˆ]
    G --> H
    
    style A fill:#e1f5ff
    style H fill:#c8e6c9
```

**å¢é‡ç¼–è¯‘ç¼“å­˜ç»“æ„**:

```text
target/debug/incremental/
â””â”€â”€ my_project-3pqh9vz6wzg0p/
    â”œâ”€â”€ s-xxx-dep-graph.bin
    â”œâ”€â”€ s-xxx-work-products.bin
    â””â”€â”€ ...
```

---

## âš™ï¸ Profile é…ç½®è¯¦è§£

### Dev vs Release å¯¹æ¯”

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Dev Profile                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ opt-level = 0         # æ— ä¼˜åŒ–ï¼Œå¿«é€Ÿç¼–è¯‘            â”‚
â”‚ debug = true          # åŒ…å«è°ƒè¯•ä¿¡æ¯                â”‚
â”‚ incremental = true    # å¯ç”¨å¢é‡ç¼–è¯‘                â”‚
â”‚ lto = false           # ä¸ä½¿ç”¨ LTO                  â”‚
â”‚ codegen-units = 256   # å¹¶è¡Œç¼–è¯‘å•å…ƒå¤š              â”‚
â”‚                                                     â”‚
â”‚ ç¼–è¯‘æ—¶é—´: âš¡ å¿« (åŸºå‡† 1x)                            â”‚
â”‚ è¿è¡Œæ—¶é—´: ğŸŒ æ…¢ (åŸºå‡† 10-100x)                      â”‚
â”‚ äºŒè¿›åˆ¶å¤§å°: ğŸ“¦ å¤§ (å«è°ƒè¯•ç¬¦å·)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Release Profile                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ opt-level = 3         # æœ€å¤§ä¼˜åŒ–                    â”‚
â”‚ debug = false         # ä¸å«è°ƒè¯•ä¿¡æ¯                â”‚
â”‚ incremental = false   # ç¦ç”¨å¢é‡ç¼–è¯‘                â”‚
â”‚ lto = "fat"           # å…¨å±€é“¾æ¥æ—¶ä¼˜åŒ–              â”‚
â”‚ codegen-units = 1     # å•ä¸ªç¼–è¯‘å•å…ƒ                â”‚
â”‚ strip = true          # å»é™¤ç¬¦å·                    â”‚
â”‚ panic = "abort"       # Panic æ—¶ä¸­æ­¢                â”‚
â”‚                                                     â”‚
â”‚ ç¼–è¯‘æ—¶é—´: ğŸŒ æ…¢ (åŸºå‡† 5-10x)                        â”‚
â”‚ è¿è¡Œæ—¶é—´: âš¡ å¿« (åŸºå‡† 1x)                           â”‚
â”‚ äºŒè¿›åˆ¶å¤§å°: ğŸ“¦ å° (ä¼˜åŒ–å)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ ç¼–è¯‘æ€§èƒ½ä¼˜åŒ–

### ä¼˜åŒ–ç­–ç•¥å¯¹æ¯”

```text
ç­–ç•¥                ç¼–è¯‘æ—¶é—´    è¿è¡Œæ€§èƒ½    äºŒè¿›åˆ¶å¤§å°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Debug (é»˜è®¤)        âš¡âš¡âš¡âš¡âš¡     âš«âš«âš«âš«âš«    ğŸ“¦ğŸ“¦ğŸ“¦ğŸ“¦ğŸ“¦
opt-level=1         âš¡âš¡âš¡âš¡      âš«âš«âš«âš«      ğŸ“¦ğŸ“¦ğŸ“¦ğŸ“¦
opt-level=2         âš¡âš¡âš¡        âš«âš«âš«       ğŸ“¦ğŸ“¦ğŸ“¦
opt-level=3         âš¡âš¡          âš«âš«        ğŸ“¦ğŸ“¦
opt-level=3+lto     âš¡            âš«         ğŸ“¦

âš¡ = å¿«    âš« = å¥½    ğŸ“¦ = å°
```

---

## ğŸ”§ å¹¶è¡Œç¼–è¯‘

### codegen-units å½±å“

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           codegen-units = 16 (é»˜è®¤)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”                   â”‚
â”‚  â”‚Unitâ”‚ â”‚Unitâ”‚ â”‚Unitâ”‚ â”‚Unitâ”‚ ... (16ä¸ªå¹¶è¡Œ)    â”‚
â”‚  â”‚ 1  â”‚ â”‚ 2  â”‚ â”‚ 3  â”‚ â”‚ 4  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                 â”‚
â”‚  ä¼˜ç‚¹: âš¡ ç¼–è¯‘å¿«                                 â”‚
â”‚  ç¼ºç‚¹: âš« ä¼˜åŒ–å—é™                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           codegen-units = 1 (Release)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚        Single Unit            â”‚              â”‚
â”‚  â”‚     (å…¨å±€ä¼˜åŒ–)                 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                 â”‚
â”‚  ä¼˜ç‚¹: âš« æœ€ä½³ä¼˜åŒ–                               â”‚
â”‚  ç¼ºç‚¹: âš¡ ç¼–è¯‘æ…¢                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ LTO (é“¾æ¥æ—¶ä¼˜åŒ–) è¯¦è§£

### LTO ç±»å‹å¯¹æ¯”

```mermaid
graph TD
    A[ä»£ç ç”Ÿæˆ] --> B{LTO ç±»å‹}
    B -->|no LTO| C[ç›´æ¥é“¾æ¥]
    B -->|thin LTO| D[è½»é‡ä¼˜åŒ–]
    B -->|fat LTO| E[å…¨å±€ä¼˜åŒ–]
    
    C --> F[è¾“å‡ºäºŒè¿›åˆ¶]
    D --> G[ä¼˜åŒ– + è¾“å‡º]
    E --> H[æ·±åº¦ä¼˜åŒ– + è¾“å‡º]
    
    style C fill:#ffcdd2
    style D fill:#fff9c4
    style E fill:#c8e6c9
```

**æ€§èƒ½æ•°æ®**:

```text
é…ç½®            ç¼–è¯‘æ—¶é—´    è¿è¡Œæ€§èƒ½    äºŒè¿›åˆ¶å¤§å°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
lto = false     1.0x        1.0x        1.0x
lto = "thin"    1.5x        0.85x       0.90x
lto = "fat"     3.0x        0.75x       0.80x
```

---

## ğŸ“¦ æ„å»ºäº§ç‰©ç»“æ„

### target/ ç›®å½•è¯¦è§£

```text
target/
â”œâ”€â”€ debug/                    # Debug æ„å»º
â”‚   â”œâ”€â”€ my-project.exe        # å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â”œâ”€â”€ my-project.pdb        # è°ƒè¯•ç¬¦å· (Windows)
â”‚   â”œâ”€â”€ deps/                 # ä¾èµ–ç¼–è¯‘äº§ç‰©
â”‚   â”‚   â”œâ”€â”€ libserde-xxx.rlib
â”‚   â”‚   â”œâ”€â”€ libtokio-xxx.rlib
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ build/                # æ„å»ºè„šæœ¬è¾“å‡º
â”‚   â”œâ”€â”€ incremental/          # å¢é‡ç¼–è¯‘ç¼“å­˜
â”‚   â””â”€â”€ examples/             # ç¤ºä¾‹ç¨‹åº
â”‚
â”œâ”€â”€ release/                  # Release æ„å»º
â”‚   â”œâ”€â”€ my-project.exe        # ä¼˜åŒ–åå¯æ‰§è¡Œæ–‡ä»¶
â”‚   â””â”€â”€ deps/
â”‚
â””â”€â”€ .fingerprint/             # ä¾èµ–æŒ‡çº¹
```

---

## ğŸš€ æ„å»ºä¼˜åŒ–å®æˆ˜

### æœ€ä½³ Profile é…ç½®

```toml
# Cargo.toml - ä¼˜åŒ–é…ç½®ç¤ºä¾‹

# å¼€å‘æ„å»ºï¼šå¹³è¡¡é€Ÿåº¦å’Œè°ƒè¯•ä½“éªŒ
[profile.dev]
opt-level = 1           # è½»é‡ä¼˜åŒ–
debug = true            # ä¿ç•™è°ƒè¯•ä¿¡æ¯
incremental = true      # å¯ç”¨å¢é‡ç¼–è¯‘

# å‘å¸ƒæ„å»ºï¼šæœ€å¤§æ€§èƒ½
[profile.release]
opt-level = 3           # æœ€å¤§ä¼˜åŒ–
lto = "fat"             # å…¨å±€ LTO
codegen-units = 1       # å•ç¼–è¯‘å•å…ƒ
strip = true            # å»é™¤ç¬¦å·
panic = "abort"         # Panic ä¸­æ­¢

# ä¾èµ–ä¼˜åŒ–ï¼šæå‡ dev æ„å»ºæ€§èƒ½
[profile.dev.package."*"]
opt-level = 2           # ä¾èµ–ä½¿ç”¨æ›´é«˜ä¼˜åŒ–

# æµ‹è¯•æ„å»ºï¼šå¿«é€Ÿæµ‹è¯•
[profile.test]
opt-level = 1
debug = true

# åŸºå‡†æµ‹è¯•ï¼šæ€§èƒ½æµ‹è¯•
[profile.bench]
opt-level = 3
lto = true
```

---

## ğŸ› æ„å»ºé—®é¢˜è¯Šæ–­

### å¸¸è§é—®é¢˜ 1: ç¼–è¯‘æ…¢

```bash
# è¯Šæ–­å‘½ä»¤
cargo build --timings

# ç”Ÿæˆ cargo-timing.html æŠ¥å‘Š
# æŸ¥çœ‹å„é˜¶æ®µè€—æ—¶
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. å¯ç”¨å¢é‡ç¼–è¯‘
2. å¢åŠ  codegen-units
3. ä½¿ç”¨ sccache ç¼“å­˜

### å¸¸è§é—®é¢˜ 2: äºŒè¿›åˆ¶è¿‡å¤§

```bash
# æŸ¥çœ‹äºŒè¿›åˆ¶å¤§å°
cargo bloat --release

# åˆ†æå„ crate å ç”¨
cargo bloat --release --crates
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. å¯ç”¨ LTO
2. ä½¿ç”¨ `strip = true`
3. ä¼˜åŒ–ä¾èµ–ç‰¹æ€§

---

## ğŸ“š ç›¸å…³èµ„æº

- [æ„å»ºç³»ç»Ÿè¯¦è§£](../06_æ„å»ºç³»ç»Ÿè¯¦è§£.md)
- [æœ€ä½³å®è·µæŒ‡å—](../08_æœ€ä½³å®è·µæŒ‡å—.md)
- [Cargo Book - Profiles](https://doc.rust-lang.org/cargo/reference/profiles.html)

---

**ç»´æŠ¤çŠ¶æ€**: ğŸŸ¢ æ´»è·ƒç»´æŠ¤ä¸­  
**æœ€åæ›´æ–°**: 2025-10-19
