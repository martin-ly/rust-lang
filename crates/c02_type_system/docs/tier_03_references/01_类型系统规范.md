# 3.1 Rust ç±»å‹ç³»ç»Ÿ - ç±»å‹ç³»ç»Ÿè§„èŒƒ

> **æ–‡æ¡£ç±»å‹**: Tier 3 - å‚è€ƒå±‚
> **æ–‡æ¡£å®šä½**: Rust ç±»å‹ç³»ç»Ÿçš„å®Œæ•´è§„èŒƒå‚è€ƒ
> **é€‚ç”¨å¯¹è±¡**: é«˜çº§å¼€å‘è€…ã€ç¼–è¯‘å™¨å¼€å‘è€…
> **å‰ç½®çŸ¥è¯†**: [åŸºç¡€ç±»å‹æŒ‡å—](../tier_02_guides/01_åŸºç¡€ç±»å‹æŒ‡å—.md)
> **æœ€åæ›´æ–°**: 2025-12-11
> **Rustç‰ˆæœ¬**: 1.92.0+

---

## ğŸ“‹ ç›®å½•

- [3.1 Rust ç±»å‹ç³»ç»Ÿ - ç±»å‹ç³»ç»Ÿè§„èŒƒ](#31-rust-ç±»å‹ç³»ç»Ÿ---ç±»å‹ç³»ç»Ÿè§„èŒƒ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ æ¦‚è¿°](#-æ¦‚è¿°)
    - [è§„èŒƒèŒƒå›´](#è§„èŒƒèŒƒå›´)
  - [1. ç±»å‹ç³»ç»ŸåŸºç¡€è§„èŒƒ](#1-ç±»å‹ç³»ç»ŸåŸºç¡€è§„èŒƒ)
    - [1.1 ç±»å‹åˆ†ç±»](#11-ç±»å‹åˆ†ç±»)
    - [1.2 ç±»å‹å¤§å°è§„èŒƒ](#12-ç±»å‹å¤§å°è§„èŒƒ)
  - [2. ç±»å‹æ¨æ–­è§„èŒƒ](#2-ç±»å‹æ¨æ–­è§„èŒƒ)
    - [2.1 å±€éƒ¨ç±»å‹æ¨æ–­](#21-å±€éƒ¨ç±»å‹æ¨æ–­)
    - [2.2 å‡½æ•°ç±»å‹æ¨æ–­](#22-å‡½æ•°ç±»å‹æ¨æ–­)
    - [2.3 çº¦æŸä¼ æ’­](#23-çº¦æŸä¼ æ’­)
  - [3. ç±»å‹æ£€æŸ¥è§„èŒƒ](#3-ç±»å‹æ£€æŸ¥è§„èŒƒ)
    - [3.1 ç±»å‹åŒ¹é…è§„åˆ™](#31-ç±»å‹åŒ¹é…è§„åˆ™)
    - [3.2 å­ç±»å‹å…³ç³»](#32-å­ç±»å‹å…³ç³»)
    - [3.3 ç±»å‹å¼ºåˆ¶è½¬æ¢](#33-ç±»å‹å¼ºåˆ¶è½¬æ¢)
  - [4. ç±»å‹è½¬æ¢è§„èŒƒ](#4-ç±»å‹è½¬æ¢è§„èŒƒ)
    - [4.1 æ˜¾å¼è½¬æ¢](#41-æ˜¾å¼è½¬æ¢)
    - [4.2 From/Into Trait](#42-frominto-trait)
    - [4.3 TryFrom/TryInto](#43-tryfromtryinto)
  - [5. æ³›å‹ç³»ç»Ÿè§„èŒƒ](#5-æ³›å‹ç³»ç»Ÿè§„èŒƒ)
    - [5.1 æ³›å‹å‚æ•°è§„èŒƒ](#51-æ³›å‹å‚æ•°è§„èŒƒ)
    - [5.2 Trait Bound è§„èŒƒ](#52-trait-bound-è§„èŒƒ)
    - [5.3 å…³è”ç±»å‹è§„èŒƒ](#53-å…³è”ç±»å‹è§„èŒƒ)
  - [6. Trait ç³»ç»Ÿè§„èŒƒ](#6-trait-ç³»ç»Ÿè§„èŒƒ)
    - [6.1 Trait å®šä¹‰è§„èŒƒ](#61-trait-å®šä¹‰è§„èŒƒ)
    - [6.2 Trait å®ç°è§„èŒƒ](#62-trait-å®ç°è§„èŒƒ)
    - [6.3 å¯¹è±¡å®‰å…¨è§„èŒƒ](#63-å¯¹è±¡å®‰å…¨è§„èŒƒ)
  - [7. ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿè§„èŒƒ](#7-ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿè§„èŒƒ)
    - [7.1 ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è§„èŒƒ](#71-ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è§„èŒƒ)
    - [7.2 ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™](#72-ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™)
    - [7.3 ç”Ÿå‘½å‘¨æœŸçº¦æŸ](#73-ç”Ÿå‘½å‘¨æœŸçº¦æŸ)
  - [8. ç±»å‹å®‰å…¨ä¿è¯](#8-ç±»å‹å®‰å…¨ä¿è¯)
    - [8.1 å†…å­˜å®‰å…¨](#81-å†…å­˜å®‰å…¨)
    - [8.2 ç±»å‹å®‰å…¨](#82-ç±»å‹å®‰å…¨)
  - [9. ç¼–è¯‘å™¨è¡Œä¸ºè§„èŒƒ](#9-ç¼–è¯‘å™¨è¡Œä¸ºè§„èŒƒ)
    - [9.1 ç±»å‹æ£€æŸ¥é˜¶æ®µ](#91-ç±»å‹æ£€æŸ¥é˜¶æ®µ)
    - [9.2 é”™è¯¯æŠ¥å‘Šè§„èŒƒ](#92-é”™è¯¯æŠ¥å‘Šè§„èŒƒ)
  - [10. å‚è€ƒèµ„æº](#10-å‚è€ƒèµ„æº)
    - [10.1 å®˜æ–¹æ–‡æ¡£](#101-å®˜æ–¹æ–‡æ¡£)
    - [10.2 ç›¸å…³æ–‡æ¡£](#102-ç›¸å…³æ–‡æ¡£)

---

## ğŸ¯ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾› Rust ç±»å‹ç³»ç»Ÿçš„å®Œæ•´è§„èŒƒå‚è€ƒï¼ŒåŒ…æ‹¬ç±»å‹æ¨æ–­ã€ç±»å‹æ£€æŸ¥ã€ç±»å‹è½¬æ¢ç­‰æ ¸å¿ƒæœºåˆ¶çš„è§„èŒƒå®šä¹‰ã€‚

### è§„èŒƒèŒƒå›´

- ç±»å‹ç³»ç»ŸåŸºç¡€è§„åˆ™
- ç±»å‹æ¨æ–­ç®—æ³•
- ç±»å‹æ£€æŸ¥è§„åˆ™
- ç±»å‹è½¬æ¢è§„åˆ™
- æ³›å‹å’Œ Trait ç³»ç»Ÿè§„èŒƒ
- ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿè§„èŒƒ

---

## 1. ç±»å‹ç³»ç»ŸåŸºç¡€è§„èŒƒ

### 1.1 ç±»å‹åˆ†ç±»

Rust ç±»å‹ç³»ç»Ÿçš„åŸºæœ¬åˆ†ç±»ï¼š

```rust
// æ ‡é‡ç±»å‹
let i: i32 = 42;
let f: f64 = 3.14;
let b: bool = true;
let c: char = 'a';

// å¤åˆç±»å‹
let t: (i32, f64) = (42, 3.14);
let a: [i32; 3] = [1, 2, 3];

// å¼•ç”¨ç±»å‹
let r: &i32 = &42;
let mr: &mut i32 = &mut 42;

// æŒ‡é’ˆç±»å‹
let bp: Box<i32> = Box::new(42);
let rp: *const i32 = &42;
```

### 1.2 ç±»å‹å¤§å°è§„èŒƒ

**Sized ç±»å‹**:

- ç¼–è¯‘æ—¶å·²çŸ¥å¤§å°
- å¯ä»¥å­˜å‚¨åœ¨æ ˆä¸Š
- å®ç°äº† `Sized` trait

**Unsized ç±»å‹ (DST)**:

- è¿è¡Œæ—¶å¤§å°
- å¿…é¡»é€šè¿‡æŒ‡é’ˆä½¿ç”¨
- å¦‚ `str`, `[T]`, `dyn Trait`

```rust
// Sized ç±»å‹
struct Point {
    x: i32,
    y: i32,
}  // å¤§å°: 8 å­—èŠ‚

// Unsized ç±»å‹
let s: &str = "hello";  // é€šè¿‡å¼•ç”¨ä½¿ç”¨
let slice: &[i32] = &[1, 2, 3];  // é€šè¿‡åˆ‡ç‰‡ä½¿ç”¨
```

---

## 2. ç±»å‹æ¨æ–­è§„èŒƒ

### 2.1 å±€éƒ¨ç±»å‹æ¨æ–­

ç¼–è¯‘å™¨æ¨æ–­å±€éƒ¨å˜é‡ç±»å‹ï¼š

```rust
let x = 42;  // æ¨æ–­ä¸º i32
let y = 3.14;  // æ¨æ–­ä¸º f64
let z = "hello";  // æ¨æ–­ä¸º &str
```

### 2.2 å‡½æ•°ç±»å‹æ¨æ–­

å‡½æ•°å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹æ¨æ–­ï¼š

```rust
// éœ€è¦ç±»å‹æ³¨è§£
fn add<T>(a: T, b: T) -> T
where
    T: std::ops::Add<Output = T>,
{
    a + b
}

// è°ƒç”¨æ—¶æ¨æ–­
let result = add(1, 2);  // T æ¨æ–­ä¸º i32
let result2 = add(1.0, 2.0);  // T æ¨æ–­ä¸º f64
```

### 2.3 çº¦æŸä¼ æ’­

ç±»å‹çº¦æŸåœ¨æ¨æ–­ä¸­ä¼ æ’­ï¼š

```rust
fn process<T: Clone>(item: T) -> T {
    item.clone()
}

let x = process(42);  // T æ¨æ–­ä¸º i32ï¼Œå¿…é¡»å®ç° Clone
```

---

## 3. ç±»å‹æ£€æŸ¥è§„èŒƒ

### 3.1 ç±»å‹åŒ¹é…è§„åˆ™

ç±»å‹å¿…é¡»å®Œå…¨åŒ¹é…ï¼š

```rust
fn takes_i32(x: i32) {}

let x: i32 = 42;
takes_i32(x);  // âœ… ç±»å‹åŒ¹é…

let y: i64 = 42;
// takes_i32(y);  // âŒ ç±»å‹ä¸åŒ¹é…
```

### 3.2 å­ç±»å‹å…³ç³»

Rust ä¸­çš„å­ç±»å‹å…³ç³»ï¼š

```rust
// ç”Ÿå‘½å‘¨æœŸå­ç±»å‹
fn longer<'a, 'b: 'a>(x: &'a str, y: &'b str) -> &'a str {
    x
}

// 'b: 'a è¡¨ç¤º 'b æ˜¯ 'a çš„å­ç±»å‹ï¼ˆ'b ç”Ÿå‘½å‘¨æœŸæ›´é•¿ï¼‰
```

### 3.3 ç±»å‹å¼ºåˆ¶è½¬æ¢

è‡ªåŠ¨ç±»å‹å¼ºåˆ¶è½¬æ¢ï¼š

```rust
// &String è‡ªåŠ¨å¼ºåˆ¶è½¬æ¢ä¸º &str
fn takes_str(s: &str) {}

let string = String::from("hello");
takes_str(&string);  // âœ… è‡ªåŠ¨å¼ºåˆ¶è½¬æ¢

// &Vec<T> è‡ªåŠ¨å¼ºåˆ¶è½¬æ¢ä¸º &[T]
fn takes_slice(s: &[i32]) {}

let vec = vec![1, 2, 3];
takes_slice(&vec);  // âœ… è‡ªåŠ¨å¼ºåˆ¶è½¬æ¢
```

---

## 4. ç±»å‹è½¬æ¢è§„èŒƒ

### 4.1 æ˜¾å¼è½¬æ¢

ä½¿ç”¨ `as` å…³é”®å­—ï¼š

```rust
let x: i32 = 42;
let y: i64 = x as i64;  // æ˜¾å¼è½¬æ¢
let z: f64 = x as f64;  // æ˜¾å¼è½¬æ¢
```

### 4.2 From/Into Trait

æ ‡å‡†è½¬æ¢ Traitï¼š

```rust
use std::convert::From;

// å®ç° From
impl From<i32> for MyType {
    fn from(value: i32) -> Self {
        MyType(value)
    }
}

// è‡ªåŠ¨è·å¾— Into
let my: MyType = 42.into();
```

### 4.3 TryFrom/TryInto

å¯èƒ½å¤±è´¥çš„è½¬æ¢ï¼š

```rust
use std::convert::TryFrom;

impl TryFrom<i32> for SmallInt {
    type Error = String;

    fn try_from(value: i32) -> Result<Self, Self::Error> {
        if value < 0 || value > 100 {
            Err("Value out of range".to_string())
        } else {
            Ok(SmallInt(value))
        }
    }
}
```

---

## 5. æ³›å‹ç³»ç»Ÿè§„èŒƒ

### 5.1 æ³›å‹å‚æ•°è§„èŒƒ

æ³›å‹å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸå’Œçº¦æŸï¼š

```rust
// ç”Ÿå‘½å‘¨æœŸå‚æ•°
struct Ref<'a, T> {
    value: &'a T,
}

// ç±»å‹å‚æ•°
struct Container<T> {
    value: T,
}

// å¸¸é‡å‚æ•°ï¼ˆRust 1.51+ï¼‰
struct Array<T, const N: usize> {
    data: [T; N],
}
```

### 5.2 Trait Bound è§„èŒƒ

Trait Bound çš„è¯­æ³•å’Œè¯­ä¹‰ï¼š

```rust
// åŸºæœ¬ Bound
fn process<T: Clone>(item: T) -> T {
    item.clone()
}

// å¤šä¸ª Bound
fn process<T: Clone + Debug>(item: T) {
    println!("{:?}", item.clone());
}

// where å­å¥
fn complex<T, U>(t: T, u: U) -> T
where
    T: Clone + Debug,
    U: Clone,
{
    // ...
}
```

### 5.3 å…³è”ç±»å‹è§„èŒƒ

å…³è”ç±»å‹çš„ä½¿ç”¨è§„èŒƒï¼š

```rust
trait Iterator {
    type Item;

    fn next(&mut self) -> Option<Self::Item>;
}

// å®ç°æ—¶æŒ‡å®šå…³è”ç±»å‹
impl Iterator for Counter {
    type Item = u32;

    fn next(&mut self) -> Option<Self::Item> {
        // ...
    }
}
```

---

## 6. Trait ç³»ç»Ÿè§„èŒƒ

### 6.1 Trait å®šä¹‰è§„èŒƒ

Trait å®šä¹‰çš„åŸºæœ¬è§„åˆ™ï¼š

```rust
// åŸºæœ¬ Trait
trait MyTrait {
    fn method(&self);
}

// å¸¦é»˜è®¤å®ç°
trait MyTrait {
    fn method(&self) {
        // é»˜è®¤å®ç°
    }
}

// å¸¦å…³è”ç±»å‹
trait MyTrait {
    type Associated;
    fn method(&self) -> Self::Associated;
}
```

### 6.2 Trait å®ç°è§„èŒƒ

å®ç° Trait çš„è§„åˆ™ï¼š

```rust
// ä¸ºç±»å‹å®ç° Trait
impl MyTrait for MyType {
    fn method(&self) {
        // å®ç°
    }
}

// æ¡ä»¶å®ç°
impl<T: Clone> MyTrait for Vec<T> {
    fn method(&self) {
        // å®ç°
    }
}
```

### 6.3 å¯¹è±¡å®‰å…¨è§„èŒƒ

Trait å¯¹è±¡å®‰å…¨çš„è¦æ±‚ï¼š

```rust
// å¯¹è±¡å®‰å…¨çš„ Trait
trait Safe {
    fn method(&self);  // âœ… ä½¿ç”¨ &self
}

// ä¸å®‰å…¨çš„ Trait
trait Unsafe {
    fn method() -> Self;  // âŒ è¿”å› Self
    fn generic<T>(&self, t: T);  // âŒ æ³›å‹æ–¹æ³•
}
```

---

## 7. ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿè§„èŒƒ

### 7.1 ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è§„èŒƒ

ç”Ÿå‘½å‘¨æœŸå‚æ•°çš„è¯­æ³•ï¼š

```rust
// å‡½æ•°ä¸­çš„ç”Ÿå‘½å‘¨æœŸ
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() { x } else { y }
}

// ç»“æ„ä½“ä¸­çš„ç”Ÿå‘½å‘¨æœŸ
struct Ref<'a, T> {
    value: &'a T,
}

// impl å—ä¸­çš„ç”Ÿå‘½å‘¨æœŸ
impl<'a, T> Ref<'a, T> {
    fn new(value: &'a T) -> Self {
        Ref { value }
    }
}
```

### 7.2 ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™

ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ç”Ÿå‘½å‘¨æœŸçš„è§„åˆ™ï¼š

1. æ¯ä¸ªå¼•ç”¨å‚æ•°éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸå‚æ•°
2. å¦‚æœåªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œå®ƒè¢«èµ‹äºˆæ‰€æœ‰è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°
3. å¦‚æœæ–¹æ³•æœ‰ `&self` æˆ– `&mut self`ï¼Œ`self` çš„ç”Ÿå‘½å‘¨æœŸè¢«èµ‹äºˆæ‰€æœ‰è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°

### 7.3 ç”Ÿå‘½å‘¨æœŸçº¦æŸ

ç”Ÿå‘½å‘¨æœŸä¹‹é—´çš„å…³ç³»ï¼š

```rust
// ç”Ÿå‘½å‘¨æœŸçº¦æŸ
struct Ref<'a, 'b: 'a, T> {
    value: &'a T,
    other: &'b T,
}

// 'b: 'a è¡¨ç¤º 'b ç”Ÿå‘½å‘¨æœŸè‡³å°‘å’Œ 'a ä¸€æ ·é•¿
```

---

## 8. ç±»å‹å®‰å…¨ä¿è¯

### 8.1 å†…å­˜å®‰å…¨

ç±»å‹ç³»ç»Ÿä¿è¯å†…å­˜å®‰å…¨ï¼š

```rust
// é˜²æ­¢ä½¿ç”¨åé‡Šæ”¾
fn invalid() {
    let r;
    {
        let x = 5;
        // r = &x;  // âŒ ç¼–è¯‘é”™è¯¯ï¼šx ç”Ÿå‘½å‘¨æœŸä¸å¤Ÿé•¿
    }
    // println!("{}", r);
}

// é˜²æ­¢æ•°æ®ç«äº‰
fn no_data_race() {
    let mut data = vec![1, 2, 3];
    let first = &data[0];
    // data.push(4);  // âŒ ç¼–è¯‘é”™è¯¯ï¼šä¸èƒ½åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å¼•ç”¨
    println!("{}", first);
}
```

### 8.2 ç±»å‹å®‰å…¨

ç±»å‹ç³»ç»Ÿé˜²æ­¢ç±»å‹é”™è¯¯ï¼š

```rust
fn type_safe() {
    let x: i32 = 42;
    // let y: String = x;  // âŒ ç¼–è¯‘é”™è¯¯ï¼šç±»å‹ä¸åŒ¹é…
    let y: String = x.to_string();  // âœ… æ˜¾å¼è½¬æ¢
}
```

---

## 9. ç¼–è¯‘å™¨è¡Œä¸ºè§„èŒƒ

### 9.1 ç±»å‹æ£€æŸ¥é˜¶æ®µ

ç¼–è¯‘å™¨çš„ç±»å‹æ£€æŸ¥æµç¨‹ï¼š

1. **è¯æ³•åˆ†æ**: å°†æºä»£ç è½¬æ¢ä¸º token
2. **è¯­æ³•åˆ†æ**: æ„å»ºæŠ½è±¡è¯­æ³•æ ‘ (AST)
3. **åç§°è§£æ**: è§£ææ ‡è¯†ç¬¦å’Œè·¯å¾„
4. **ç±»å‹æ¨æ–­**: æ¨æ–­ç±»å‹
5. **ç±»å‹æ£€æŸ¥**: éªŒè¯ç±»å‹æ­£ç¡®æ€§
6. **å€Ÿç”¨æ£€æŸ¥**: éªŒè¯å€Ÿç”¨è§„åˆ™
7. **ä»£ç ç”Ÿæˆ**: ç”Ÿæˆç›®æ ‡ä»£ç 

### 9.2 é”™è¯¯æŠ¥å‘Šè§„èŒƒ

ç±»å‹é”™è¯¯çš„æŠ¥å‘Šæ ¼å¼ï¼š

```rust
// ç¤ºä¾‹é”™è¯¯
error[E0308]: mismatched types
  --> src/main.rs:3:5
   |
 3 |     let x: i32 = "hello";
   |         ^ expected `i32`, found `&str`
```

---

## 10. å‚è€ƒèµ„æº

### 10.1 å®˜æ–¹æ–‡æ¡£

- [Rust Reference - Type System](https://doc.rust-lang.org/reference/type-system.html)
- [Rust Reference - Type Inference](https://doc.rust-lang.org/reference/type-inference.html)
- [Rust Reference - Traits](https://doc.rust-lang.org/reference/items/traits.html)

### 10.2 ç›¸å…³æ–‡æ¡£

- [ç±»å‹è½¬æ¢å‚è€ƒ](./01_ç±»å‹è½¬æ¢å‚è€ƒ.md)
- [ç±»å‹å‹å˜å‚è€ƒ](./02_ç±»å‹å‹å˜å‚è€ƒ.md)
- [åˆ†æ´¾æœºåˆ¶å‚è€ƒ](./03_åˆ†æ´¾æœºåˆ¶å‚è€ƒ.md)

---

**æœ€åæ›´æ–°**: 2025-12-11
**Rustç‰ˆæœ¬**: 1.92.0+
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
