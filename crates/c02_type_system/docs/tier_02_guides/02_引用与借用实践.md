# 2.2 Rust ç±»å‹ç³»ç»Ÿ - å¼•ç”¨ä¸å€Ÿç”¨å®è·µæŒ‡å—

> **æ–‡æ¡£ç±»å‹**: Tier 2 - æŒ‡å—å±‚
> **æ–‡æ¡£å®šä½**: ç±»å‹ç³»ç»Ÿä¸­çš„å¼•ç”¨ä¸å€Ÿç”¨å®è·µ
> **é€‚ç”¨å¯¹è±¡**: ä¸­çº§å¼€å‘è€…
> **å‰ç½®çŸ¥è¯†**: [æ‰€æœ‰æƒå®è·µæŒ‡å—](./01_æ‰€æœ‰æƒå®è·µæŒ‡å—.md)
> **é¢„è®¡å­¦ä¹ æ—¶é—´**: 6-8 å°æ—¶
> **æœ€åæ›´æ–°**: 2025-12-11
> **Rustç‰ˆæœ¬**: 1.92.0+

---

## ğŸ“‹ ç›®å½•

- [2.2 Rust ç±»å‹ç³»ç»Ÿ - å¼•ç”¨ä¸å€Ÿç”¨å®è·µæŒ‡å—](#22-rust-ç±»å‹ç³»ç»Ÿ---å¼•ç”¨ä¸å€Ÿç”¨å®è·µæŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ å­¦ä¹ ç›®æ ‡](#-å­¦ä¹ ç›®æ ‡)
  - [ğŸ“Š ç« èŠ‚æ¦‚è§ˆ](#-ç« èŠ‚æ¦‚è§ˆ)
  - [1. å¼•ç”¨ç±»å‹ç³»ç»Ÿ](#1-å¼•ç”¨ç±»å‹ç³»ç»Ÿ)
    - [1.1 ä¸å¯å˜å¼•ç”¨ (\&T)](#11-ä¸å¯å˜å¼•ç”¨-t)
    - [1.2 å¯å˜å¼•ç”¨ (\&mut T)](#12-å¯å˜å¼•ç”¨-mut-t)
    - [1.3 å¼•ç”¨ç±»å‹è§„åˆ™](#13-å¼•ç”¨ç±»å‹è§„åˆ™)
  - [2. å€Ÿç”¨æ£€æŸ¥å™¨](#2-å€Ÿç”¨æ£€æŸ¥å™¨)
    - [2.1 å€Ÿç”¨è§„åˆ™](#21-å€Ÿç”¨è§„åˆ™)
    - [2.2 ä½œç”¨åŸŸä¸å€Ÿç”¨](#22-ä½œç”¨åŸŸä¸å€Ÿç”¨)
    - [2.3 å€Ÿç”¨æ£€æŸ¥ç¤ºä¾‹](#23-å€Ÿç”¨æ£€æŸ¥ç¤ºä¾‹)
  - [3. å¼•ç”¨åœ¨ç±»å‹ç³»ç»Ÿä¸­çš„åº”ç”¨](#3-å¼•ç”¨åœ¨ç±»å‹ç³»ç»Ÿä¸­çš„åº”ç”¨)
    - [3.1 ç»“æ„ä½“ä¸­çš„å¼•ç”¨](#31-ç»“æ„ä½“ä¸­çš„å¼•ç”¨)
    - [3.2 æšä¸¾ä¸­çš„å¼•ç”¨](#32-æšä¸¾ä¸­çš„å¼•ç”¨)
    - [3.3 å‡½æ•°å‚æ•°ä¸­çš„å¼•ç”¨](#33-å‡½æ•°å‚æ•°ä¸­çš„å¼•ç”¨)
  - [4. ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨](#4-ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨)
    - [4.1 ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨](#41-ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨)
    - [4.2 ç”Ÿå‘½å‘¨æœŸçœç•¥](#42-ç”Ÿå‘½å‘¨æœŸçœç•¥)
    - [4.3 ç”Ÿå‘½å‘¨æœŸçº¦æŸ](#43-ç”Ÿå‘½å‘¨æœŸçº¦æŸ)
  - [5. å¼•ç”¨ä¸æ³›å‹](#5-å¼•ç”¨ä¸æ³›å‹)
    - [5.1 æ³›å‹å¼•ç”¨å‚æ•°](#51-æ³›å‹å¼•ç”¨å‚æ•°)
    - [5.2 å¼•ç”¨ç±»å‹çº¦æŸ](#52-å¼•ç”¨ç±»å‹çº¦æŸ)
    - [5.3 é«˜çº§å¼•ç”¨æ¨¡å¼](#53-é«˜çº§å¼•ç”¨æ¨¡å¼)
  - [6. æ™ºèƒ½æŒ‡é’ˆä¸å¼•ç”¨](#6-æ™ºèƒ½æŒ‡é’ˆä¸å¼•ç”¨)
    - [6.1 Box ä¸å¼•ç”¨](#61-box-ä¸å¼•ç”¨)
    - [6.2 Rc ä¸å¼•ç”¨](#62-rc-ä¸å¼•ç”¨)
    - [6.3 RefCell ä¸å†…éƒ¨å¯å˜æ€§](#63-refcell-ä¸å†…éƒ¨å¯å˜æ€§)
  - [7. å¼•ç”¨æ¨¡å¼åŒ¹é…](#7-å¼•ç”¨æ¨¡å¼åŒ¹é…)
    - [7.1 åŒ¹é…å¼•ç”¨](#71-åŒ¹é…å¼•ç”¨)
    - [7.2 ref å…³é”®å­—](#72-ref-å…³é”®å­—)
    - [7.3 å¼•ç”¨è§£æ„](#73-å¼•ç”¨è§£æ„)
  - [8. å®æˆ˜æ¡ˆä¾‹](#8-å®æˆ˜æ¡ˆä¾‹)
    - [8.1 æ¡ˆä¾‹1: ç¼“å­˜ç³»ç»Ÿ](#81-æ¡ˆä¾‹1-ç¼“å­˜ç³»ç»Ÿ)
    - [8.2 æ¡ˆä¾‹2: è¿­ä»£å™¨å®ç°](#82-æ¡ˆä¾‹2-è¿­ä»£å™¨å®ç°)
    - [8.3 æ¡ˆä¾‹3: æ•°æ®è®¿é—®å±‚](#83-æ¡ˆä¾‹3-æ•°æ®è®¿é—®å±‚)
  - [9. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#9-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
    - [é—®é¢˜1: å€Ÿç”¨æ£€æŸ¥å™¨é”™è¯¯](#é—®é¢˜1-å€Ÿç”¨æ£€æŸ¥å™¨é”™è¯¯)
    - [é—®é¢˜2: ç”Ÿå‘½å‘¨æœŸä¸åŒ¹é…](#é—®é¢˜2-ç”Ÿå‘½å‘¨æœŸä¸åŒ¹é…)
    - [é—®é¢˜3: å¯å˜å¼•ç”¨å†²çª](#é—®é¢˜3-å¯å˜å¼•ç”¨å†²çª)
  - [10. æ€»ç»“ä¸æœ€ä½³å®è·µ](#10-æ€»ç»“ä¸æœ€ä½³å®è·µ)
    - [æ ¸å¿ƒåŸåˆ™](#æ ¸å¿ƒåŸåˆ™)
    - [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
    - [ä¸‹ä¸€æ­¥å­¦ä¹ ](#ä¸‹ä¸€æ­¥å­¦ä¹ )

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬æ–‡æ¡£åï¼Œä½ å°†èƒ½å¤Ÿï¼š

- âœ… æ·±å…¥ç†è§£å¼•ç”¨ç±»å‹ç³»ç»Ÿ
- âœ… æŒæ¡å€Ÿç”¨æ£€æŸ¥å™¨çš„å·¥ä½œåŸç†
- âœ… ç†è§£ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨çš„å…³ç³»
- âœ… æŒæ¡å¼•ç”¨åœ¨æ³›å‹ä¸­çš„åº”ç”¨
- âœ… è®¾è®¡åˆç†çš„å¼•ç”¨API
- âœ… è§£å†³å¸¸è§çš„å€Ÿç”¨ç›¸å…³é—®é¢˜

---

## ğŸ“Š ç« èŠ‚æ¦‚è§ˆ

| ç« èŠ‚                      | å†…å®¹     | éš¾åº¦     | é¢„è®¡æ—¶é—´ |
| :--- | :--- | :--- | :--- || 1. å¼•ç”¨ç±»å‹ç³»ç»Ÿ           | åŸºç¡€æ¦‚å¿µ | â­â­     | 1h       |
| 2. å€Ÿç”¨æ£€æŸ¥å™¨             | æ ¸å¿ƒæœºåˆ¶ | â­â­â­   | 1.5h     |
| 3. å¼•ç”¨åœ¨ç±»å‹ç³»ç»Ÿä¸­çš„åº”ç”¨ | å®è·µåº”ç”¨ | â­â­â­   | 1.5h     |
| 4. ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨         | é«˜çº§ä¸»é¢˜ | â­â­â­â­ | 1.5h     |
| 5. å¼•ç”¨ä¸æ³›å‹             | é«˜çº§ä¸»é¢˜ | â­â­â­â­ | 1h       |
| 6. æ™ºèƒ½æŒ‡é’ˆä¸å¼•ç”¨         | å®è·µåº”ç”¨ | â­â­â­   | 1h       |
| 7. å¼•ç”¨æ¨¡å¼åŒ¹é…           | å®è·µåº”ç”¨ | â­â­â­   | 1h       |
| 8. å®æˆ˜æ¡ˆä¾‹               | ç»¼åˆåº”ç”¨ | â­â­â­â­ | 2h       |
| 9. å¸¸è§é—®é¢˜               | é—®é¢˜è§£å†³ | â­â­     | 0.5h     |
| 10. æ€»ç»“                  | çŸ¥è¯†æ•´åˆ | â­       | 0.5h     |

---

## 1. å¼•ç”¨ç±»å‹ç³»ç»Ÿ

### 1.1 ä¸å¯å˜å¼•ç”¨ (&T)

ä¸å¯å˜å¼•ç”¨å…è®¸è¯»å–æ•°æ®ä½†ä¸å…è®¸ä¿®æ”¹ï¼š

```rust
fn main() {
    let s = String::from("hello");
    let r1 = &s;  // ä¸å¯å˜å¼•ç”¨
    let r2 = &s;  // å¯ä»¥å¤šä¸ªä¸å¯å˜å¼•ç”¨

    println!("{} {}", r1, r2);  // âœ… å¯ä»¥åŒæ—¶ä½¿ç”¨
}
```

**ç±»å‹ç³»ç»Ÿä¿è¯**:

```rust
fn calculate_length(s: &String) -> usize {
    s.len()  // å€Ÿç”¨ï¼Œä¸è·å–æ‰€æœ‰æƒ
}

fn main() {
    let s = String::from("hello");
    let len = calculate_length(&s);
    println!("The length of '{}' is {}.", s, len);  // âœ… s ä»ç„¶æœ‰æ•ˆ
}
```

### 1.2 å¯å˜å¼•ç”¨ (&mut T)

å¯å˜å¼•ç”¨å…è®¸ä¿®æ”¹æ•°æ®ï¼Œä½†åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªï¼š

```rust
fn main() {
    let mut s = String::from("hello");
    let r1 = &mut s;  // å¯å˜å¼•ç”¨
    r1.push_str(" world");
    println!("{}", r1);

    // âŒ ä¸èƒ½åŒæ—¶æœ‰å¤šä¸ªå¯å˜å¼•ç”¨
    // let r2 = &mut s;
}
```

**ç‹¬å æ€§ä¿è¯**:

```rust
fn change(s: &mut String) {
    s.push_str(" world");
}

fn main() {
    let mut s = String::from("hello");
    change(&mut s);
    println!("{}", s);  // "hello world"
}
```

### 1.3 å¼•ç”¨ç±»å‹è§„åˆ™

ç±»å‹ç³»ç»Ÿå¼ºåˆ¶æ‰§è¡Œçš„è§„åˆ™ï¼š

1. **ä»»æ„æ•°é‡çš„ä¸å¯å˜å¼•ç”¨** æˆ– **ä¸€ä¸ªå¯å˜å¼•ç”¨**
2. **å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆ**

```rust
fn main() {
    let mut s = String::from("hello");

    let r1 = &s;      // âœ… ä¸å¯å˜å¼•ç”¨
    let r2 = &s;      // âœ… å¦ä¸€ä¸ªä¸å¯å˜å¼•ç”¨
    println!("{} {}", r1, r2);

    // r1 å’Œ r2 çš„ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
    let r3 = &mut s;  // âœ… ç°åœ¨å¯ä»¥åˆ›å»ºå¯å˜å¼•ç”¨
    r3.push_str(" world");
}
```

---

## 2. å€Ÿç”¨æ£€æŸ¥å™¨

### 2.1 å€Ÿç”¨è§„åˆ™

å€Ÿç”¨æ£€æŸ¥å™¨åœ¨ç¼–è¯‘æœŸéªŒè¯ï¼š

```rust
fn main() {
    let mut s = String::from("hello");

    // âœ… è§„åˆ™1: å¤šä¸ªä¸å¯å˜å¼•ç”¨
    let r1 = &s;
    let r2 = &s;

    // âŒ è§„åˆ™2: ä¸èƒ½åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å¼•ç”¨
    // let r3 = &mut s;
    // println!("{} {} {}", r1, r2, r3);

    println!("{} {}", r1, r2);  // r1, r2 ä½œç”¨åŸŸç»“æŸ

    // âœ… ç°åœ¨å¯ä»¥åˆ›å»ºå¯å˜å¼•ç”¨
    let r3 = &mut s;
    r3.push_str(" world");
}
```

### 2.2 ä½œç”¨åŸŸä¸å€Ÿç”¨

å¼•ç”¨çš„ä½œç”¨åŸŸå†³å®šå€Ÿç”¨æ£€æŸ¥ï¼š

```rust
fn main() {
    let mut s = String::from("hello");

    {
        let r1 = &s;  // ä¸å¯å˜å¼•ç”¨
        println!("{}", r1);
    }  // r1 çš„ä½œç”¨åŸŸç»“æŸ

    let r2 = &mut s;  // âœ… ç°åœ¨å¯ä»¥åˆ›å»ºå¯å˜å¼•ç”¨
    r2.push_str(" world");
}
```

### 2.3 å€Ÿç”¨æ£€æŸ¥ç¤ºä¾‹

**ç¤ºä¾‹1: æ‚¬å‚å¼•ç”¨æ£€æµ‹**:

```rust
fn main() {
    let reference_to_nothing;
    {
        let s = String::from("hello");
        // reference_to_nothing = &s;  // âŒ ç¼–è¯‘é”™è¯¯ï¼šs çš„ç”Ÿå‘½å‘¨æœŸä¸å¤Ÿé•¿
    }
    // println!("{}", reference_to_nothing);
}
```

**ç¤ºä¾‹2: æ•°æ®ç«äº‰æ£€æµ‹**:

```rust
fn main() {
    let mut data = vec![1, 2, 3];

    let first = &data[0];  // ä¸å¯å˜å¼•ç”¨
    // data.push(4);  // âŒ ç¼–è¯‘é”™è¯¯ï¼šä¸èƒ½åœ¨æœ‰ä¸å¯å˜å¼•ç”¨æ—¶ä¿®æ”¹
    println!("{}", first);
}
```

---

## 3. å¼•ç”¨åœ¨ç±»å‹ç³»ç»Ÿä¸­çš„åº”ç”¨

### 3.1 ç»“æ„ä½“ä¸­çš„å¼•ç”¨

ç»“æ„ä½“å¯ä»¥åŒ…å«å¼•ç”¨å­—æ®µï¼š

```rust
struct Book<'a> {
    title: &'a str,
    author: &'a str,
}

fn main() {
    let title = String::from("Rust Book");
    let author = String::from("Rust Team");

    let book = Book {
        title: &title,
        author: &author,
    };

    println!("{} by {}", book.title, book.author);
}
```

### 3.2 æšä¸¾ä¸­çš„å¼•ç”¨

æšä¸¾å˜ä½“å¯ä»¥åŒ…å«å¼•ç”¨ï¼š

```rust
enum Message<'a> {
    Text(&'a str),
    Number(&'a i32),
}

fn main() {
    let text = String::from("hello");
    let num = 42;

    let msg = Message::Text(&text);
    match msg {
        Message::Text(s) => println!("{}", s),
        _ => {}
    }
}
```

### 3.3 å‡½æ•°å‚æ•°ä¸­çš„å¼•ç”¨

å‡½æ•°å¯ä»¥æ¥å—å¼•ç”¨å‚æ•°ï¼š

```rust
// ä¸å¯å˜å¼•ç”¨å‚æ•°
fn print_string(s: &String) {
    println!("{}", s);
}

// å¯å˜å¼•ç”¨å‚æ•°
fn modify_string(s: &mut String) {
    s.push_str(" world");
}

// è¿”å›å¼•ç”¨ï¼ˆéœ€è¦ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼‰
fn get_first_word(s: &str) -> &str {
    s.split_whitespace().next().unwrap_or("")
}

fn main() {
    let mut s = String::from("hello");
    print_string(&s);
    modify_string(&mut s);
    let word = get_first_word(&s);
    println!("{}", word);
}
```

---

## 4. ç”Ÿå‘½å‘¨æœŸä¸å¼•ç”¨

### 4.1 ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

æ˜ç¡®å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå…³ç³»ï¼š

```rust
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() {
        x
    } else {
        y
    }
}

fn main() {
    let string1 = String::from("long string");
    {
        let string2 = String::from("xyz");
        let result = longest(string1.as_str(), string2.as_str());
        println!("The longest string is {}", result);
    }
}
```

### 4.2 ç”Ÿå‘½å‘¨æœŸçœç•¥

ç¼–è¯‘å™¨å¯ä»¥æ¨æ–­ä¸€äº›ç”Ÿå‘½å‘¨æœŸï¼š

```rust
// çœç•¥ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨
fn first_word(s: &str) -> &str {
    let bytes = s.as_bytes();
    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[0..i];
        }
    }
    &s[..]
}

// ç­‰ä»·äºï¼ˆæ˜¾å¼æ ‡æ³¨ï¼‰
fn first_word_explicit<'a>(s: &'a str) -> &'a str {
    // ... ç›¸åŒå®ç°
    &s[..]
}
```

### 4.3 ç”Ÿå‘½å‘¨æœŸçº¦æŸ

ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼š

```rust
struct ImportantExcerpt<'a> {
    part: &'a str,
}

impl<'a> ImportantExcerpt<'a> {
    fn level(&self) -> i32 {
        3
    }

    fn announce_and_return_part(&self, announcement: &str) -> &str {
        println!("Attention! {}", announcement);
        self.part
    }
}

fn main() {
    let novel = String::from("Call me Ishmael. Some years ago...");
    let first_sentence = novel.split('.').next().expect("Could not find a '.'");
    let i = ImportantExcerpt {
        part: first_sentence,
    };
    println!("{}", i.announce_and_return_part("hello"));
}
```

---

## 5. å¼•ç”¨ä¸æ³›å‹

### 5.1 æ³›å‹å¼•ç”¨å‚æ•°

æ³›å‹å‡½æ•°å¯ä»¥æ¥å—å¼•ç”¨ï¼š

```rust
fn largest<T: PartialOrd>(list: &[T]) -> Option<&T> {
    let mut largest = list.get(0)?;

    for item in list.iter() {
        if item > largest {
            largest = item;
        }
    }

    Some(largest)
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];
    if let Some(largest) = largest(&number_list) {
        println!("The largest number is {}", largest);
    }
}
```

### 5.2 å¼•ç”¨ç±»å‹çº¦æŸ

å¯¹å¼•ç”¨ç±»å‹æ·»åŠ çº¦æŸï¼š

```rust
use std::fmt::Display;

fn print_ref<T: Display>(item: &T) {
    println!("{}", item);
}

fn main() {
    let s = String::from("hello");
    print_ref(&s);

    let num = 42;
    print_ref(&num);
}
```

### 5.3 é«˜çº§å¼•ç”¨æ¨¡å¼

**å¼•ç”¨é“¾**:

```rust
fn get_first_char(s: &String) -> Option<char> {
    s.chars().next()
}

fn main() {
    let s = String::from("hello");
    if let Some(c) = get_first_char(&s) {
        println!("First char: {}", c);
    }
}
```

---

## 6. æ™ºèƒ½æŒ‡é’ˆä¸å¼•ç”¨

### 6.1 Box ä¸å¼•ç”¨

`Box<T>` å¯ä»¥è§£å¼•ç”¨ï¼š

```rust
fn main() {
    let x = 5;
    let y = Box::new(x);

    assert_eq!(5, x);
    assert_eq!(5, *y);  // è§£å¼•ç”¨
}
```

### 6.2 Rc ä¸å¼•ç”¨

`Rc<T>` æä¾›å…±äº«å¼•ç”¨ï¼š

```rust
use std::rc::Rc;

fn main() {
    let data = Rc::new(String::from("hello"));

    let data1 = Rc::clone(&data);
    let data2 = Rc::clone(&data);

    // æ‰€æœ‰å¼•ç”¨éƒ½æŒ‡å‘åŒä¸€æ•°æ®
    println!("{}", data);
    println!("{}", data1);
    println!("{}", data2);
}
```

### 6.3 RefCell ä¸å†…éƒ¨å¯å˜æ€§

`RefCell<T>` æä¾›è¿è¡Œæ—¶å€Ÿç”¨æ£€æŸ¥ï¼š

```rust
use std::cell::RefCell;

fn main() {
    let data = RefCell::new(5);

    {
        let mut borrow = data.borrow_mut();
        *borrow += 1;
    }  // borrow ç¦»å¼€ä½œç”¨åŸŸ

    println!("{}", data.borrow());
}
```

---

## 7. å¼•ç”¨æ¨¡å¼åŒ¹é…

### 7.1 åŒ¹é…å¼•ç”¨

æ¨¡å¼åŒ¹é…å¯ä»¥åŒ¹é…å¼•ç”¨ï¼š

```rust
fn main() {
    let s = String::from("hello");
    let r = &s;

    match r {
        &ref s_ref => {  // åŒ¹é…å¼•ç”¨
            println!("{}", s_ref);
        }
    }
}
```

### 7.2 ref å…³é”®å­—

ä½¿ç”¨ `ref` å…³é”®å­—ï¼š

```rust
fn main() {
    let s = Some(String::from("hello"));

    match s {
        Some(ref s_ref) => {  // ref è·å–å¼•ç”¨
            println!("{}", s_ref);
        }
        None => {}
    }

    // s ä»ç„¶æœ‰æ•ˆ
    println!("{:?}", s);
}
```

### 7.3 å¼•ç”¨è§£æ„

è§£æ„å¼•ç”¨ï¼š

```rust
struct Point {
    x: i32,
    y: i32,
}

fn main() {
    let point = Point { x: 0, y: 0 };
    let r = &point;

    let &Point { x, y } = r;  // è§£æ„å¼•ç”¨
    println!("({}, {})", x, y);
}
```

---

## 8. å®æˆ˜æ¡ˆä¾‹

### 8.1 æ¡ˆä¾‹1: ç¼“å­˜ç³»ç»Ÿ

```rust
use std::collections::HashMap;

struct Cache<'a> {
    data: HashMap<String, &'a str>,
}

impl<'a> Cache<'a> {
    fn new() -> Self {
        Cache {
            data: HashMap::new(),
        }
    }

    fn get(&self, key: &str) -> Option<&'a str> {
        self.data.get(key).copied()
    }

    fn insert(&mut self, key: String, value: &'a str) {
        self.data.insert(key, value);
    }
}

fn main() {
    let mut cache = Cache::new();
    let value = "cached_value";
    cache.insert(String::from("key1"), value);

    if let Some(v) = cache.get("key1") {
        println!("Found: {}", v);
    }
}
```

### 8.2 æ¡ˆä¾‹2: è¿­ä»£å™¨å®ç°

```rust
struct SliceIter<'a, T> {
    slice: &'a [T],
    index: usize,
}

impl<'a, T> Iterator for SliceIter<'a, T> {
    type Item = &'a T;

    fn next(&mut self) -> Option<Self::Item> {
        if self.index < self.slice.len() {
            let item = &self.slice[self.index];
            self.index += 1;
            Some(item)
        } else {
            None
        }
    }
}

fn main() {
    let data = vec![1, 2, 3, 4, 5];
    let iter = SliceIter {
        slice: &data,
        index: 0,
    };

    for item in iter {
        println!("{}", item);
    }
}
```

### 8.3 æ¡ˆä¾‹3: æ•°æ®è®¿é—®å±‚

```rust
struct Database<'a> {
    records: Vec<&'a str>,
}

impl<'a> Database<'a> {
    fn new() -> Self {
        Database {
            records: Vec::new(),
        }
    }

    fn add_record(&mut self, record: &'a str) {
        self.records.push(record);
    }

    fn get_record(&self, index: usize) -> Option<&'a str> {
        self.records.get(index).copied()
    }
}

fn main() {
    let record1 = "Record 1";
    let record2 = "Record 2";

    let mut db = Database::new();
    db.add_record(record1);
    db.add_record(record2);

    if let Some(record) = db.get_record(0) {
        println!("{}", record);
    }
}
```

---

## 9. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: å€Ÿç”¨æ£€æŸ¥å™¨é”™è¯¯

**é”™è¯¯ä»£ç **:

```rust
let mut vec = vec![1, 2, 3];
let first = &vec[0];
vec.push(4);  // âŒ ç¼–è¯‘é”™è¯¯
println!("{}", first);
```

**è§£å†³æ–¹æ¡ˆ**:

```rust
let mut vec = vec![1, 2, 3];
let first = vec[0];  // å¤åˆ¶å€¼
vec.push(4);
println!("{}", first);
```

### é—®é¢˜2: ç”Ÿå‘½å‘¨æœŸä¸åŒ¹é…

**é”™è¯¯ä»£ç **:

```rust
fn longest(x: &str, y: &str) -> &str {  // âŒ ç¼ºå°‘ç”Ÿå‘½å‘¨æœŸå‚æ•°
    if x.len() > y.len() { x } else { y }
}
```

**è§£å†³æ–¹æ¡ˆ**:

```rust
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() { x } else { y }
}
```

### é—®é¢˜3: å¯å˜å¼•ç”¨å†²çª

**é”™è¯¯ä»£ç **:

```rust
let mut s = String::from("hello");
let r1 = &mut s;
let r2 = &mut s;  // âŒ ç¼–è¯‘é”™è¯¯
```

**è§£å†³æ–¹æ¡ˆ**:

```rust
let mut s = String::from("hello");
{
    let r1 = &mut s;
    r1.push_str(" world");
}  // r1 ä½œç”¨åŸŸç»“æŸ
let r2 = &mut s;  // âœ… ç°åœ¨å¯ä»¥äº†
```

---

## 10. æ€»ç»“ä¸æœ€ä½³å®è·µ

### æ ¸å¿ƒåŸåˆ™

1. **å€Ÿç”¨é¿å…æ‰€æœ‰æƒè½¬ç§»**: ä½¿ç”¨å¼•ç”¨å…±äº«æ•°æ®
2. **å€Ÿç”¨è§„åˆ™å¿…é¡»éµå®ˆ**: ç¼–è¯‘æœŸå¼ºåˆ¶æ‰§è¡Œ
3. **ç”Ÿå‘½å‘¨æœŸä¿è¯å®‰å…¨**: å¼•ç”¨æ€»æ˜¯æœ‰æ•ˆ
4. **æ˜ç¡®ç”Ÿå‘½å‘¨æœŸå…³ç³»**: éœ€è¦æ—¶ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‚æ•°

### æœ€ä½³å®è·µ

1. **ä¼˜å…ˆä½¿ç”¨ä¸å¯å˜å¼•ç”¨**: `&T` æ¯” `&mut T` æ›´çµæ´»
2. **æ˜ç¡®ç”Ÿå‘½å‘¨æœŸæ„å›¾**: éœ€è¦æ—¶æ˜¾å¼æ ‡æ³¨
3. **åˆç†ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ**: éœ€è¦å…±äº«æ‰€æœ‰æƒæ—¶ä½¿ç”¨ `Rc`/`Arc`
4. **è®¾è®¡æ¸…æ™°çš„API**: å‡½æ•°ç­¾åæ˜ç¡®å€Ÿç”¨è¯­ä¹‰

### ä¸‹ä¸€æ­¥å­¦ä¹ 

- [æ³›å‹ç¼–ç¨‹æŒ‡å—](./03_æ³›å‹ç¼–ç¨‹æŒ‡å—.md)
- [Traitç³»ç»ŸæŒ‡å—](./04_Traitç³»ç»ŸæŒ‡å—.md)
- [ç”Ÿå‘½å‘¨æœŸæŒ‡å—](./05_ç”Ÿå‘½å‘¨æœŸæŒ‡å—.md)

---

**æœ€åæ›´æ–°**: 2025-12-11
**Rustç‰ˆæœ¬**: 1.92.0+
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
