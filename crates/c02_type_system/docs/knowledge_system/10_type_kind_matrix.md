# 类型种类对比矩阵

> **文档类型**: 📊 对比矩阵 | 🔍 多维分析  
> **创建日期**: 2025-10-19  
> **Rust 版本**: 1.90+

---

## 📋 类型种类对比表

| 类型种类 | 大小 | 内存布局 | Copy | 性能 | 使用场景 |
|---------|------|---------|------|------|---------|
| **基本类型** (`i32`, `bool`) | 固定 | 栈 | ✓ | ⭐⭐⭐⭐⭐ | 数值计算、标志位 |
| **元组** `(T, U)` | 固定 | 栈 | 条件 | ⭐⭐⭐⭐⭐ | 临时组合、多返回值 |
| **数组** `[T; N]` | 固定 | 栈 | 条件 | ⭐⭐⭐⭐⭐ | 固定大小集合 |
| **切片** `[T]` | 动态 | DST | ✗ | ⭐⭐⭐⭐ | 动态视图 |
| **字符串** `str` | 动态 | DST | ✗ | ⭐⭐⭐⭐ | 文本处理 |
| **结构体** `struct` | 固定 | 栈 | 条件 | ⭐⭐⭐⭐⭐ | 数据组合 |
| **枚举** `enum` | 固定 | 栈 | 条件 | ⭐⭐⭐⭐⭐ | 变体类型 |
| **引用** `&T`, `&mut T` | 固定(8) | 栈 | ✓ | ⭐⭐⭐⭐⭐ | 借用 |
| **智能指针** `Box<T>` | 固定(8) | 堆 | ✗ | ⭐⭐⭐⭐ | 堆分配 |
| **`Vec<T>`** | 固定(24) | 堆 | ✗ | ⭐⭐⭐⭐ | 动态数组 |
| **`String`** | 固定(24) | 堆 | ✗ | ⭐⭐⭐⭐ | 可变文本 |
| **特征对象** `dyn Trait` | 动态 | DST | ✗ | ⭐⭐⭐ | 运行时多态 |
| **泛型** `T` | 取决于具体类型 | 单态化 | 取决于T | ⭐⭐⭐⭐⭐ | 编译时多态 |

---

## 🔍 详细对比

### 基本类型 vs 复合类型

```rust
// 基本类型: 简单、高效
let x: i32 = 42;          // 4 bytes, 栈, Copy
let y: f64 = 3.14;        // 8 bytes, 栈, Copy

// 复合类型: 组合多个值
let point = (10, 20);     // 8 bytes, 栈, Copy(if T: Copy)
let arr = [1, 2, 3];      // 12 bytes, 栈, Copy
```

### 固定大小 vs 动态大小

| 维度 | 固定大小 (Sized) | 动态大小 (DST) |
|------|----------------|---------------|
| **编译时大小** | 已知 | 未知 |
| **直接使用** | ✓ | ✗ (需通过指针) |
| **作为泛型参数** | ✓ (默认) | ✓ (?Sized) |
| **示例** | `i32`, `[i32; 3]` | `[i32]`, `str`, `dyn Trait` |

```rust
// Sized: 可以直接使用
let x: i32 = 42;
let arr: [i32; 3] = [1, 2, 3];

// DST: 必须通过指针
let slice: &[i32] = &arr[..];      // 胖指针: 指针 + 长度
let s: &str = "hello";             // 胖指针: 指针 + 长度
let obj: &dyn Display = &42;       // 胖指针: 指针 + vtable
```

### 栈分配 vs 堆分配

| 维度 | 栈分配 | 堆分配 |
|------|-------|-------|
| **速度** | 快 | 慢 |
| **大小限制** | 有限 (~1-8MB) | 大 |
| **生命周期** | 作用域绑定 | 手动管理/智能指针 |
| **示例** | 基本类型、数组、结构体 | `Box`, `Vec`, `String`, `Rc` |

```rust
// 栈分配: 快速但有限
let x = [0; 100];  // 400 bytes 栈
// let y = [0; 1_000_000];  // 可能栈溢出

// 堆分配: 灵活但较慢
let v = vec![0; 1_000_000];  // 堆分配，无栈溢出风险
let s = Box::new([0; 1_000_000]);
```

---

## 📊 性能对比矩阵

| 操作 | i32 | `Box<i32>` | `Rc<i32>` | `Arc<i32>` | `Vec<i32>` |
|------|-----|----------|---------|----------|----------|
| **创建** | O(1) 栈 | O(1) 堆 | O(1) 堆+RC | O(1) 堆+原子 | O(n) 堆 |
| **克隆** | O(1) 复制 | ✗ Move | O(1) RC++ | O(1) 原子++ | O(n) |
| **销毁** | O(1) 无操作 | O(1) 释放 | O(1) RC-- | O(1) 原子-- | O(n) |
| **内存占用** | 4 bytes | 8+4 bytes | 8+4+8 bytes | 8+4+16 bytes | 24+cap*4 bytes |

---

## 💡 选择指南

### 根据需求选择类型

```text
决策树:

需要存储数据?
├─ 单个值?
│  ├─ 数值/简单类型 → i32, f64, bool
│  ├─ 堆分配 → Box<T>
│  └─ 可选 → Option<T>
│
├─ 多个值?
│  ├─ 固定数量 → (T, U) 或 [T; N]
│  ├─ 动态数量 → Vec<T>
│  └─ 键值对 → HashMap<K, V>
│
└─ 需要共享?
   ├─ 单线程 → Rc<T>
   └─ 多线程 → Arc<T>
```

---

**完整矩阵文档**: 参见 `knowledge_system/` 目录下其他矩阵文档
