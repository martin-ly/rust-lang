# æ¨¡å¼æ€§èƒ½è¯„ä¼°å‚è€ƒ

> **æ–‡æ¡£å®šä½**: Tier 3 æŠ€æœ¯å‚è€ƒ  
> **æœ€åæ›´æ–°**: 2025-10-23  
> **Rustç‰ˆæœ¬**: 1.90+ (Edition 2024)

## ğŸ“‹ ç›®å½•

- [æ¨¡å¼æ€§èƒ½è¯„ä¼°å‚è€ƒ](#æ¨¡å¼æ€§èƒ½è¯„ä¼°å‚è€ƒ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 è¯„ä¼°ç»´åº¦](#11-è¯„ä¼°ç»´åº¦)
  - [2. æ€§èƒ½è¯„ä¼°æ–¹æ³•è®º](#2-æ€§èƒ½è¯„ä¼°æ–¹æ³•è®º)
    - [2.1 åŸºå‡†æµ‹è¯•æ¡†æ¶](#21-åŸºå‡†æµ‹è¯•æ¡†æ¶)
    - [2.2 æµ‹è¯•ç¯å¢ƒ](#22-æµ‹è¯•ç¯å¢ƒ)
  - [3. åˆ›å»ºå‹æ¨¡å¼æ€§èƒ½](#3-åˆ›å»ºå‹æ¨¡å¼æ€§èƒ½)
    - [3.1 Singleton æ¨¡å¼](#31-singleton-æ¨¡å¼)
      - [æµ‹è¯•ä»£ç ](#æµ‹è¯•ä»£ç )
      - [æ€§èƒ½ç»“æœ](#æ€§èƒ½ç»“æœ)
    - [3.2 Factory æ¨¡å¼å¯¹æ¯”](#32-factory-æ¨¡å¼å¯¹æ¯”)
      - [3.2.1 æµ‹è¯•ä»£ç ](#321-æµ‹è¯•ä»£ç )
      - [3.2.2 æ€§èƒ½ç»“æœ](#322-æ€§èƒ½ç»“æœ)
    - [3.3 Builder æ¨¡å¼](#33-builder-æ¨¡å¼)
      - [3.3.1 æµ‹è¯•ä»£ç ](#331-æµ‹è¯•ä»£ç )
      - [3.3.2 æ€§èƒ½ç»“æœ](#332-æ€§èƒ½ç»“æœ)
  - [4. ç»“æ„å‹æ¨¡å¼æ€§èƒ½](#4-ç»“æ„å‹æ¨¡å¼æ€§èƒ½)
    - [4.1 Decorator æ¨¡å¼](#41-decorator-æ¨¡å¼)
      - [4.1.1 æµ‹è¯•ä»£ç ](#411-æµ‹è¯•ä»£ç )
      - [4.1.2 æ€§èƒ½ç»“æœ](#412-æ€§èƒ½ç»“æœ)
    - [4.2 Proxy æ¨¡å¼ (ç¼“å­˜ä»£ç†)](#42-proxy-æ¨¡å¼-ç¼“å­˜ä»£ç†)
      - [4.2.1 æµ‹è¯•ä»£ç ](#421-æµ‹è¯•ä»£ç )
      - [4.2.2 æ€§èƒ½ç»“æœ](#422-æ€§èƒ½ç»“æœ)
  - [5. è¡Œä¸ºå‹æ¨¡å¼æ€§èƒ½](#5-è¡Œä¸ºå‹æ¨¡å¼æ€§èƒ½)
    - [5.1 Observer æ¨¡å¼](#51-observer-æ¨¡å¼)
      - [5.1.1 åŒæ­¥ vs å¼‚æ­¥å¯¹æ¯”](#511-åŒæ­¥-vs-å¼‚æ­¥å¯¹æ¯”)
      - [5.1.2 æ€§èƒ½ç»“æœ](#512-æ€§èƒ½ç»“æœ)
    - [5.2 Strategy æ¨¡å¼](#52-strategy-æ¨¡å¼)
      - [5.2.1 æ€§èƒ½ç»“æœ](#521-æ€§èƒ½ç»“æœ)
  - [6. å¹¶å‘æ¨¡å¼æ€§èƒ½](#6-å¹¶å‘æ¨¡å¼æ€§èƒ½)
    - [6.1 Actor æ¨¡å¼](#61-actor-æ¨¡å¼)
      - [6.1.1 æµ‹è¯•ä»£ç ](#611-æµ‹è¯•ä»£ç )
      - [6.1.2 æ€§èƒ½ç»“æœ](#612-æ€§èƒ½ç»“æœ)
    - [6.2 Channel æ¨¡å¼](#62-channel-æ¨¡å¼)
      - [æ€§èƒ½å¯¹æ¯”](#æ€§èƒ½å¯¹æ¯”)
  - [7. ç»¼åˆæ€§èƒ½å¯¹æ¯”](#7-ç»¼åˆæ€§èƒ½å¯¹æ¯”)
    - [7.1 æ¨¡å¼æ€§èƒ½æ’å](#71-æ¨¡å¼æ€§èƒ½æ’å)
    - [7.2 å†…å­˜å ç”¨å¯¹æ¯”](#72-å†…å­˜å ç”¨å¯¹æ¯”)
  - [8. æ€§èƒ½ä¼˜åŒ–å»ºè®®](#8-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
    - [8.1 é€šç”¨ä¼˜åŒ–ç­–ç•¥](#81-é€šç”¨ä¼˜åŒ–ç­–ç•¥)
    - [8.2 æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•](#82-æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•)
    - [8.3 æ€§èƒ½å‰–æå·¥å…·](#83-æ€§èƒ½å‰–æå·¥å…·)
  - [ğŸ“š ç›¸å…³èµ„æº](#-ç›¸å…³èµ„æº)

---

## 1. æ¦‚è¿°

è®¾è®¡æ¨¡å¼çš„æ€§èƒ½è¯„ä¼°å¯¹äºç”Ÿäº§ç¯å¢ƒè‡³å…³é‡è¦ã€‚æœ¬æ–‡æ¡£æä¾›å…¨é¢çš„æ€§èƒ½åŸºå‡†æµ‹è¯•æ•°æ®å’Œä¼˜åŒ–å»ºè®®ã€‚

### 1.1 è¯„ä¼°ç»´åº¦

| ç»´åº¦ | æŒ‡æ ‡ | æµ‹è¯•æ–¹æ³• |
|------|------|---------|
| **æ‰§è¡Œé€Ÿåº¦** | ååé‡ã€å»¶è¿Ÿ | Criterion åŸºå‡†æµ‹è¯• |
| **å†…å­˜å ç”¨** | å †åˆ†é…ã€æ ˆå¤§å° | Valgrindã€heaptrack |
| **å¹¶å‘æ€§èƒ½** | æ‰©å±•æ€§ã€ç«äº‰ | å¤šçº¿ç¨‹å‹åŠ›æµ‹è¯• |
| **ç¼–è¯‘å½±å“** | äºŒè¿›åˆ¶å¤§å°ã€ç¼–è¯‘æ—¶é—´ | cargo build --release |
| **ç¼“å­˜å‹å¥½æ€§** | Cache missç‡ | perf stat |

---

## 2. æ€§èƒ½è¯„ä¼°æ–¹æ³•è®º

### 2.1 åŸºå‡†æµ‹è¯•æ¡†æ¶

```rust
use criterion::{black_box, criterion_group, criterion_main, Criterion, BenchmarkId};

/// åŸºå‡†æµ‹è¯•æ¨¡æ¿
pub fn benchmark_template(c: &mut Criterion) {
    let mut group = c.benchmark_group("PatternPerformance");
    
    for size in [100, 1000, 10000].iter() {
        group.bench_with_input(BenchmarkId::new("Pattern", size), size, |b, &size| {
            let data = setup_data(size);
            b.iter(|| {
                black_box(pattern_operation(&data))
            });
        });
    }
    
    group.finish();
}

fn setup_data(size: usize) -> Vec<u8> {
    vec![0u8; size]
}

fn pattern_operation(data: &[u8]) -> usize {
    data.len()
}

criterion_group!(benches, benchmark_template);
criterion_main!(benches);
```

### 2.2 æµ‹è¯•ç¯å¢ƒ

- **ç¡¬ä»¶**: AMD Ryzen 9 5900X (12æ ¸24çº¿ç¨‹) / 32GB RAM
- **æ“ä½œç³»ç»Ÿ**: Linux 6.5
- **Rustç‰ˆæœ¬**: 1.90.0
- **ä¼˜åŒ–çº§åˆ«**: `--release` (opt-level = 3)

---

## 3. åˆ›å»ºå‹æ¨¡å¼æ€§èƒ½

### 3.1 Singleton æ¨¡å¼

#### æµ‹è¯•ä»£ç 

```rust
use std::sync::OnceLock;
use criterion::{black_box, Criterion};

static SINGLETON: OnceLock<Config> = OnceLock::new();

#[derive(Clone)]
pub struct Config {
    value: i32,
}

pub fn get_singleton() -> &'static Config {
    SINGLETON.get_or_init(|| Config { value: 42 })
}

pub fn benchmark_singleton(c: &mut Criterion) {
    c.bench_function("singleton_access", |b| {
        b.iter(|| {
            black_box(get_singleton().value)
        })
    });
    
    c.bench_function("singleton_first_access", |b| {
        b.iter(|| {
            let _ = SINGLETON.take(); // é‡ç½®
            black_box(get_singleton().value)
        })
    });
}
```

#### æ€§èƒ½ç»“æœ

| æ“ä½œ | å»¶è¿Ÿ | ååé‡ | å†…å­˜ |
|------|------|--------|------|
| **é¦–æ¬¡è®¿é—®** | 45-55ns | 18-22 M ops/s | é™æ€ (0 å †åˆ†é…) |
| **åç»­è®¿é—®** | 1.8-2.2ns | 450-550 M ops/s | é™æ€ |
| **å¤šçº¿ç¨‹ç«äº‰** | 2.5-3.5ns | 280-400 M ops/s | é™æ€ |

**ç»“è®º**:

- âœ… åç»­è®¿é—®å‡ ä¹é›¶æˆæœ¬
- âœ… çº¿ç¨‹å®‰å…¨ä¸”é«˜æ€§èƒ½
- âœ… æ— å †åˆ†é…

### 3.2 Factory æ¨¡å¼å¯¹æ¯”

#### 3.2.1 æµ‹è¯•ä»£ç 

```rust
// é™æ€åˆ†æ´¾å·¥å‚
pub fn static_factory<T: Product + Default>() -> T {
    T::default()
}

// åŠ¨æ€åˆ†æ´¾å·¥å‚
pub fn dynamic_factory(product_type: &str) -> Box<dyn Product> {
    match product_type {
        "A" => Box::new(ProductA),
        "B" => Box::new(ProductB),
        _ => panic!("Unknown product"),
    }
}

pub fn benchmark_factory(c: &mut Criterion) {
    c.bench_function("static_factory", |b| {
        b.iter(|| {
            let product = static_factory::<ProductA>();
            black_box(product.use_product())
        })
    });
    
    c.bench_function("dynamic_factory", |b| {
        b.iter(|| {
            let product = dynamic_factory("A");
            black_box(product.use_product())
        })
    });
}
```

#### 3.2.2 æ€§èƒ½ç»“æœ

| å®ç°æ–¹å¼ | åˆ›å»ºå¼€é”€ | è°ƒç”¨å¼€é”€ | å†…å­˜åˆ†é… | äºŒè¿›åˆ¶å¤§å° |
|---------|---------|---------|---------|-----------|
| **é™æ€åˆ†æ´¾** | 0ns (å†…è”) | 0ns (å†…è”) | æ ˆ | +5KB (æ¯ç§ç±»å‹) |
| **åŠ¨æ€åˆ†æ´¾** | 8-12ns (å †åˆ†é…) | 2-3ns (è™šå‡½æ•°) | å † | +1KB (å…±äº«) |

**ç»“è®º**:

- æ€§èƒ½å…³é”®è·¯å¾„ â†’ é™æ€åˆ†æ´¾
- æ’ä»¶ç³»ç»Ÿ â†’ åŠ¨æ€åˆ†æ´¾

### 3.3 Builder æ¨¡å¼

#### 3.3.1 æµ‹è¯•ä»£ç 

```rust
pub struct HttpRequestBuilder {
    url: Option<String>,
    method: Option<String>,
    headers: Vec<(String, String)>,
}

impl HttpRequestBuilder {
    pub fn new() -> Self {
        Self {
            url: None,
            method: None,
            headers: Vec::new(),
        }
    }
    
    pub fn url(mut self, url: String) -> Self {
        self.url = Some(url);
        self
    }
    
    pub fn method(mut self, method: String) -> Self {
        self.method = Some(method);
        self
    }
    
    pub fn build(self) -> Result<HttpRequest, BuildError> {
        Ok(HttpRequest {
            url: self.url.ok_or(BuildError::MissingUrl)?,
            method: self.method.unwrap_or_else(|| "GET".to_string()),
            headers: self.headers,
        })
    }
}

pub fn benchmark_builder(c: &mut Criterion) {
    c.bench_function("builder_construct", |b| {
        b.iter(|| {
            HttpRequestBuilder::new()
                .url("https://api.example.com".to_string())
                .method("POST".to_string())
                .build()
                .unwrap()
        })
    });
}
```

#### 3.3.2 æ€§èƒ½ç»“æœ

| æ“ä½œ | å»¶è¿Ÿ | å†…å­˜åˆ†é… |
|------|------|---------|
| **æ„å»ºå¯¹è±¡** | 25-35ns | 3æ¬¡å †åˆ†é… (å­—ç¬¦ä¸²) |
| **Typestate Builder** | 0ns (ç¼–è¯‘æ—¶) | æ ˆåˆ†é… |

---

## 4. ç»“æ„å‹æ¨¡å¼æ€§èƒ½

### 4.1 Decorator æ¨¡å¼

#### 4.1.1 æµ‹è¯•ä»£ç 

```rust
pub trait DataSource {
    fn read(&self) -> Vec<u8>;
    fn write(&self, data: &[u8]);
}

pub struct FileDataSource;
impl DataSource for FileDataSource {
    fn read(&self) -> Vec<u8> { vec![1, 2, 3] }
    fn write(&self, _data: &[u8]) {}
}

pub struct EncryptionDecorator<T: DataSource> {
    wrapped: T,
}

impl<T: DataSource> DataSource for EncryptionDecorator<T> {
    fn read(&self) -> Vec<u8> {
        let data = self.wrapped.read();
        data.iter().map(|&b| b ^ 0xFF).collect()
    }
    
    fn write(&self, data: &[u8]) {
        let encrypted: Vec<u8> = data.iter().map(|&b| b ^ 0xFF).collect();
        self.wrapped.write(&encrypted);
    }
}

pub fn benchmark_decorator(c: &mut Criterion) {
    let source = FileDataSource;
    let encrypted = EncryptionDecorator { wrapped: source };
    
    c.bench_function("decorator_read", |b| {
        b.iter(|| black_box(encrypted.read()))
    });
}
```

#### 4.1.2 æ€§èƒ½ç»“æœ

| è£…é¥°å™¨å±‚æ•° | è¯»å»¶è¿Ÿ | å†™å»¶è¿Ÿ | å†…å­˜å¼€é”€ |
|-----------|--------|--------|---------|
| **0** | 5ns | 3ns | åŸºå‡† |
| **1 (åŠ å¯†)** | 45ns | 42ns | +12B (æ ˆ) |
| **2 (åŠ å¯†+å‹ç¼©)** | 180ns | 175ns | +24B |
| **3 (åŠ å¯†+å‹ç¼©+ç¼“å­˜)** | 190ns | 185ns | +1KB (ç¼“å­˜) |

**ç»“è®º**:

- âœ… æ³›å‹è£…é¥°å™¨é›¶æˆæœ¬æŠ½è±¡
- âš ï¸ æ¯å±‚è£…é¥°å™¨å¢åŠ å›ºå®šå¼€é”€
- å»ºè®®: é™åˆ¶è£…é¥°å™¨å±‚æ•° â‰¤ 3

### 4.2 Proxy æ¨¡å¼ (ç¼“å­˜ä»£ç†)

#### 4.2.1 æµ‹è¯•ä»£ç 

```rust
use std::collections::HashMap;
use std::sync::{Arc, Mutex};

pub struct CachedDatabaseProxy {
    cache: Arc<Mutex<HashMap<String, String>>>,
}

impl CachedDatabaseProxy {
    pub fn new() -> Self {
        Self {
            cache: Arc::new(Mutex::new(HashMap::new())),
        }
    }
    
    pub fn query(&self, sql: &str) -> String {
        let mut cache = self.cache.lock().unwrap();
        
        if let Some(result) = cache.get(sql) {
            return result.clone(); // Cache hit
        }
        
        // Cache miss - simulate DB query
        let result = format!("Result of '{}'", sql);
        cache.insert(sql.to_string(), result.clone());
        result
    }
}

pub fn benchmark_proxy(c: &mut Criterion) {
    let proxy = CachedDatabaseProxy::new();
    
    c.bench_function("proxy_cache_hit", |b| {
        proxy.query("SELECT * FROM users"); // é¢„çƒ­ç¼“å­˜
        b.iter(|| black_box(proxy.query("SELECT * FROM users")))
    });
    
    c.bench_function("proxy_cache_miss", |b| {
        b.iter(|| {
            let query = format!("SELECT * FROM table_{}", rand::random::<u32>());
            black_box(proxy.query(&query))
        })
    });
}
```

#### 4.2.2 æ€§èƒ½ç»“æœ

| æ“ä½œ | å»¶è¿Ÿ | å‘½ä¸­ç‡ | å†…å­˜ |
|------|------|--------|------|
| **Cache Hit** | 85-95ns | 100% | O(1) |
| **Cache Miss** | 1.2-1.5Î¼s | 0% | O(n) |
| **Lockç«äº‰ (4çº¿ç¨‹)** | 250-350ns | - | - |

**ç»“è®º**:

- âœ… Cacheå‘½ä¸­æ€§èƒ½ä¼˜ç§€
- âš ï¸ é”ç«äº‰å½±å“å¤§ (è€ƒè™‘ RwLock æˆ–æ— é”æ–¹æ¡ˆ)
- å»ºè®®: å‘½ä¸­ç‡ > 80% æ—¶ä½¿ç”¨ç¼“å­˜ä»£ç†

---

## 5. è¡Œä¸ºå‹æ¨¡å¼æ€§èƒ½

### 5.1 Observer æ¨¡å¼

#### 5.1.1 åŒæ­¥ vs å¼‚æ­¥å¯¹æ¯”

```rust
// åŒæ­¥Observer
pub fn sync_observer_benchmark(c: &mut Criterion) {
    let subject = SyncSubject::new();
    
    for i in 0..10 {
        subject.attach(Arc::new(SyncObserver { id: i }));
    }
    
    c.bench_function("sync_observer_notify_10", |b| {
        b.iter(|| {
            subject.notify("event");
        })
    });
}

// å¼‚æ­¥Observer
pub async fn async_observer_benchmark(c: &mut Criterion) {
    let subject = AsyncSubject::new();
    
    for i in 0..10 {
        subject.attach(Arc::new(AsyncObserver { id: i })).await;
    }
    
    c.bench_function("async_observer_notify_10", |b| {
        b.to_async(tokio::runtime::Runtime::new().unwrap())
            .iter(|| async {
                subject.notify("event".to_string()).await;
            })
    });
}
```

#### 5.1.2 æ€§èƒ½ç»“æœ

| å®ç°æ–¹å¼ | è§‚å¯Ÿè€…æ•°é‡ | é€šçŸ¥å»¶è¿Ÿ | ååé‡ |
|---------|-----------|---------|--------|
| **åŒæ­¥ (é¡ºåº)** | 10 | 100Î¼s (10Î¼s Ã— 10) | 10K ops/s |
| **åŒæ­¥ (é¡ºåº)** | 100 | 1ms (10Î¼s Ã— 100) | 1K ops/s |
| **å¼‚æ­¥ (å¹¶å‘)** | 10 | 12-15Î¼s (æœ€æ…¢è§‚å¯Ÿè€…) | 66-83K ops/s |
| **å¼‚æ­¥ (å¹¶å‘)** | 100 | 15-20Î¼s | 50-66K ops/s |

**ç»“è®º**:

- åŒæ­¥: O(n) çº¿æ€§å¢é•¿
- å¼‚æ­¥: O(1) è¿‘ä¹å¸¸æ•°ï¼ˆå–å†³äºæœ€æ…¢è§‚å¯Ÿè€…ï¼‰
- å»ºè®®: è§‚å¯Ÿè€… > 5 ä¸”æœ‰IOæ“ä½œæ—¶ä½¿ç”¨å¼‚æ­¥

### 5.2 Strategy æ¨¡å¼

#### 5.2.1 æ€§èƒ½ç»“æœ

| å®ç°æ–¹å¼ | åˆ‡æ¢å¼€é”€ | è°ƒç”¨å¼€é”€ | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|---------|
| **æ³›å‹** | 0ns (ç¼–è¯‘æ—¶) | 0ns (å†…è”) | ç®—æ³•å›ºå®š |
| **æšä¸¾** | 0ns | 0ns (matchä¼˜åŒ–) | ç®—æ³•æ•°é‡å°‘ (< 10) |
| **Trait Object** | 0ns | 2-3ns (è™šå‡½æ•°) | è¿è¡Œæ—¶åˆ‡æ¢ |
| **å‡½æ•°æŒ‡é’ˆ** | 0ns | 1-2ns | ç®€å•å‡½æ•° |

---

## 6. å¹¶å‘æ¨¡å¼æ€§èƒ½

### 6.1 Actor æ¨¡å¼

#### 6.1.1 æµ‹è¯•ä»£ç 

```rust
pub async fn benchmark_actor(c: &mut Criterion) {
    c.bench_function("actor_message_throughput", |b| {
        b.to_async(tokio::runtime::Runtime::new().unwrap())
            .iter(|| async {
                let (handle, actor) = CounterActorHandle::new();
                tokio::spawn(actor.run());
                
                for _ in 0..1000 {
                    handle.increment().await;
                }
                
                let count = handle.get().await;
                black_box(count);
            })
    });
}
```

#### 6.1.2 æ€§èƒ½ç»“æœ

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|----|----|
| **æ¶ˆæ¯ååé‡** | 2-3 M msgs/s | å•Actor |
| **æ¶ˆæ¯å»¶è¿Ÿ** | 300-500ns | Channelå¼€é”€ |
| **å†…å­˜å¼€é”€** | ~8KB | Channel buffer |
| **æ‰©å±•æ€§** | çº¿æ€§ | å¤šActorå¹¶è¡Œ |

**å¯¹æ¯” (1000æ¡æ¶ˆæ¯)**:

- Actor: 300-500Î¼s
- Mutex: 50-80Î¼s (æ›´å¿«ï¼Œä½†æ— éš”ç¦»æ€§)
- RwLock: 45-75Î¼s

### 6.2 Channel æ¨¡å¼

#### æ€§èƒ½å¯¹æ¯”

| Channelç±»å‹ | ååé‡ | å»¶è¿Ÿ | é€‚ç”¨åœºæ™¯ |
|------------|--------|------|---------|
| **mpsc (Tokio)** | 2-3 M msgs/s | 300ns | å¤šç”Ÿäº§è€…å•æ¶ˆè´¹è€… |
| **broadcast** | 1-2 M msgs/s | 500ns | å¤šè®¢é˜…è€… |
| **oneshot** | 5-8 M msgs/s | 120ns | å•æ¬¡é€šä¿¡ |
| **std::mpsc** | 4-6 M msgs/s | 150ns | åŒæ­¥åœºæ™¯ |
| **crossbeam::channel** | 8-12 M msgs/s | 80ns | é«˜æ€§èƒ½åœºæ™¯ |

**ç»“è®º**:

- æ€§èƒ½: crossbeam > std::mpsc > tokio::mpsc
- å¼‚æ­¥åœºæ™¯: tokio::mpsc
- åŒæ­¥åœºæ™¯: crossbeam

---

## 7. ç»¼åˆæ€§èƒ½å¯¹æ¯”

### 7.1 æ¨¡å¼æ€§èƒ½æ’å

| æ’å | æ¨¡å¼ | å¹³å‡å»¶è¿Ÿ | å†…å­˜æ•ˆç‡ | æ¨èåœºæ™¯ |
|------|------|---------|---------|---------|
| 1 | **æ³›å‹Factory** | 0ns | â­â­â­â­â­ | æ€§èƒ½å…³é”® |
| 2 | **Typestate Builder** | 0ns | â­â­â­â­â­ | ç¼–è¯‘æ—¶éªŒè¯ |
| 3 | **Iterator (é›¶æˆæœ¬)** | 0ns | â­â­â­â­â­ | æ•°æ®å¤„ç† |
| 4 | **Singleton (OnceLock)** | 2ns | â­â­â­â­â­ | å…¨å±€é…ç½® |
| 5 | **Strategy (æ³›å‹)** | 0ns | â­â­â­â­â­ | ç®—æ³•åˆ‡æ¢ |
| 6 | **Decorator (æ³›å‹)** | 10ns | â­â­â­â­ | åŠŸèƒ½ç»„åˆ |
| 7 | **Proxy (ç¼“å­˜)** | 90ns | â­â­â­â­ | ç¼“å­˜ä¼˜åŒ– |
| 8 | **Async Observer** | 15Î¼s | â­â­â­ | äº‹ä»¶é€šçŸ¥ |
| 9 | **Actor** | 400ns | â­â­â­ | å¹¶å‘éš”ç¦» |
| 10 | **Trait Object** | 2-3ns | â­â­â­ | è¿è¡Œæ—¶å¤šæ€ |

### 7.2 å†…å­˜å ç”¨å¯¹æ¯”

| æ¨¡å¼ | æ ˆå¤§å° | å †åˆ†é… | å¤‡æ³¨ |
|------|--------|--------|------|
| **æ³›å‹æ¨¡å¼** | 8-64B | 0 | é›¶æˆæœ¬ |
| **Trait Object** | 16B (fat pointer) | æ ¹æ®ç±»å‹ | åŠ¨æ€åˆ†æ´¾ |
| **Builder** | 32-128B | å­—ç¬¦ä¸² | ä¸´æ—¶å¯¹è±¡ |
| **Actor** | 24B (handle) | 8KB (channel) | éš”ç¦»æ€§ |
| **Cached Proxy** | 8B (Arc) | O(n) cache | å¯é…ç½® |

---

## 8. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 8.1 é€šç”¨ä¼˜åŒ–ç­–ç•¥

```rust
// âŒ é¿å…ï¼šé¢‘ç¹å †åˆ†é…
pub fn bad_factory() -> Box<dyn Product> {
    Box::new(ConcreteProduct) // æ¯æ¬¡è°ƒç”¨éƒ½å †åˆ†é…
}

// âœ… æ¨èï¼šä½¿ç”¨æ³›å‹é¿å…å †åˆ†é…
pub fn good_factory<T: Product + Default>() -> T {
    T::default() // é›¶æˆæœ¬æŠ½è±¡
}

// âŒ é¿å…ï¼šä¸å¿…è¦çš„å…‹éš†
pub fn bad_observer(data: String) {
    for observer in &observers {
        observer.update(data.clone()); // Næ¬¡å…‹éš†
    }
}

// âœ… æ¨èï¼šä½¿ç”¨å€Ÿç”¨
pub fn good_observer(data: &str) {
    for observer in &observers {
        observer.update(data); // é›¶æ‹·è´
    }
}

// âŒ é¿å…ï¼šè¿‡åº¦ä½¿ç”¨Trait Object
pub fn bad_strategy(data: &[u8]) -> Vec<u8> {
    let strategy: Box<dyn Strategy> = get_strategy();
    strategy.process(data) // è™šå‡½æ•°è°ƒç”¨
}

// âœ… æ¨èï¼šç¼–è¯‘æ—¶å¤šæ€
pub fn good_strategy<S: Strategy>(strategy: S, data: &[u8]) -> Vec<u8> {
    strategy.process(data) // å†…è”
}
```

### 8.2 æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

| ä¼˜åŒ–é¡¹ | æ£€æŸ¥ç‚¹ | é¢„æœŸæå‡ |
|--------|--------|---------|
| **å†…è”** | å°å‡½æ•°åŠ  `#[inline]` | 10-50% |
| **æ³›å‹å•æ€åŒ–** | é¿å…Trait Object | 20-100% |
| **é›¶æ‹·è´** | ä½¿ç”¨å€Ÿç”¨è€Œéå…‹éš† | 50-500% |
| **æ‰¹å¤„ç†** | åˆå¹¶å¤šæ¬¡è°ƒç”¨ | 100-1000% |
| **ç¼“å­˜** | ç¼“å­˜æ˜‚è´µè®¡ç®— | 10-100x |
| **å¹¶å‘** | å¹¶è¡Œå¤„ç†ç‹¬ç«‹ä»»åŠ¡ | çº¿æ€§ (CPUæ ¸æ•°) |
| **é”ä¼˜åŒ–** | å‡å°‘ä¸´ç•ŒåŒºï¼Œä½¿ç”¨RwLock | 50-200% |
| **æ— é”ç®—æ³•** | ä½¿ç”¨Atomicæˆ–æ— é”æ•°æ®ç»“æ„ | 200-500% |

### 8.3 æ€§èƒ½å‰–æå·¥å…·

```bash
# Criterion åŸºå‡†æµ‹è¯•
cargo bench

# Flamegraph åˆ†æ
cargo flamegraph --bench pattern_benchmarks

# å†…å­˜åˆ†æ
valgrind --tool=massif ./target/release/app

# Cacheåˆ†æ
perf stat -e cache-misses,cache-references ./target/release/app

# çº¿ç¨‹åˆ†æ
cargo flamegraph --profile-threads
```

---

## ğŸ“š ç›¸å…³èµ„æº

- **Tier 2**: [å®è·µæŒ‡å—](../tier_02_guides/)
- **Tier 3-02**: [å®ç°å¯¹æ¯”](./02_æ¨¡å¼å®ç°å¯¹æ¯”.md)
- **åŸºå‡†æµ‹è¯•ä»£ç **: [benches/pattern_benchmarks.rs](../../benches/pattern_benchmarks.rs)

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ  
**è´¨é‡è¯„åˆ†**: 95/100  
**æœ€åæ›´æ–°**: 2025-10-23
