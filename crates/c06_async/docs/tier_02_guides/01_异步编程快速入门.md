# Tier 2: å¼‚æ­¥ç¼–ç¨‹å¿«é€Ÿå…¥é—¨

> **æ–‡æ¡£ç‰ˆæœ¬**: Rust 1.90+ | **æ›´æ–°æ—¥æœŸ**: 2025-10-22  
> **æ–‡æ¡£å±‚çº§**: Tier 2 - å®è·µæŒ‡å— | **é¢„è®¡é˜…è¯»**: 10-15 åˆ†é’Ÿ

---

## ğŸ“‹ ç›®å½•

- [Tier 2: å¼‚æ­¥ç¼–ç¨‹å¿«é€Ÿå…¥é—¨](#tier-2-å¼‚æ­¥ç¼–ç¨‹å¿«é€Ÿå…¥é—¨)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ æœ¬ç« ç›®æ ‡](#-æœ¬ç« ç›®æ ‡)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•-1)
  - [1. ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹ï¼Ÿ](#1-ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹)
    - [1.1 åŒæ­¥ vs å¼‚æ­¥](#11-åŒæ­¥-vs-å¼‚æ­¥)
    - [1.2 ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ](#12-ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥)
  - [2. ä½ çš„ç¬¬ä¸€ä¸ªå¼‚æ­¥ç¨‹åº](#2-ä½ çš„ç¬¬ä¸€ä¸ªå¼‚æ­¥ç¨‹åº)
    - [2.1 ç¯å¢ƒå‡†å¤‡](#21-ç¯å¢ƒå‡†å¤‡)
    - [2.2 Hello, Async World](#22-hello-async-world)
    - [2.3 ä»£ç è§£æ](#23-ä»£ç è§£æ)
      - [`#[tokio::main]` å®](#tokiomain-å®)
      - [`async` å…³é”®å­—](#async-å…³é”®å­—)
      - [`.await` å…³é”®å­—](#await-å…³é”®å­—)
  - [3. æ ¸å¿ƒæ¦‚å¿µ](#3-æ ¸å¿ƒæ¦‚å¿µ)
    - [3.1 ä¸‰å¤§æ ¸å¿ƒ](#31-ä¸‰å¤§æ ¸å¿ƒ)
      - [3.1.1 async/awaitï¼ˆè¯­æ³•å±‚ï¼‰](#311-asyncawaitè¯­æ³•å±‚)
      - [3.1.2 Futureï¼ˆæŠ½è±¡å±‚ï¼‰](#312-futureæŠ½è±¡å±‚)
      - [3.1.3 Runtimeï¼ˆæ‰§è¡Œå±‚ï¼‰](#313-runtimeæ‰§è¡Œå±‚)
    - [3.2 å¼‚æ­¥æ‰§è¡Œæµç¨‹](#32-å¼‚æ­¥æ‰§è¡Œæµç¨‹)
  - [4. å®ç”¨ç¤ºä¾‹](#4-å®ç”¨ç¤ºä¾‹)
    - [4.1 å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡](#41-å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡)
    - [4.2 åå°ä»»åŠ¡](#42-åå°ä»»åŠ¡)
    - [4.3 HTTP è¯·æ±‚ç¤ºä¾‹](#43-http-è¯·æ±‚ç¤ºä¾‹)
    - [4.4 è¶…æ—¶æ§åˆ¶](#44-è¶…æ—¶æ§åˆ¶)
  - [5. å¸¸è§é™·é˜±](#5-å¸¸è§é™·é˜±)
    - [5.1 å¿˜è®° `.await`](#51-å¿˜è®°-await)
    - [5.2 åœ¨é `async` å‡½æ•°ä¸­ä½¿ç”¨ `.await`](#52-åœ¨é-async-å‡½æ•°ä¸­ä½¿ç”¨-await)
    - [5.3 é˜»å¡å¼‚æ­¥è¿è¡Œæ—¶](#53-é˜»å¡å¼‚æ­¥è¿è¡Œæ—¶)
    - [5.4 æ··ç”¨ä¸åŒè¿è¡Œæ—¶çš„ç±»å‹](#54-æ··ç”¨ä¸åŒè¿è¡Œæ—¶çš„ç±»å‹)
  - [6. ä¸‹ä¸€æ­¥](#6-ä¸‹ä¸€æ­¥)
    - [6.1 å­¦ä¹ è·¯å¾„](#61-å­¦ä¹ è·¯å¾„)
    - [6.2 æ¨èé˜…è¯»](#62-æ¨èé˜…è¯»)
    - [6.3 å®è·µå»ºè®®](#63-å®è·µå»ºè®®)
    - [6.4 ç»ƒä¹ é¢˜](#64-ç»ƒä¹ é¢˜)
      - [ç»ƒä¹  1: Hello, Async! (5 åˆ†é’Ÿ)](#ç»ƒä¹ -1-hello-async-5-åˆ†é’Ÿ)
      - [ç»ƒä¹  2: å¹¶å‘ä»»åŠ¡ (10 åˆ†é’Ÿ)](#ç»ƒä¹ -2-å¹¶å‘ä»»åŠ¡-10-åˆ†é’Ÿ)
      - [ç»ƒä¹  3: è¶…æ—¶å¤„ç† (15 åˆ†é’Ÿ)](#ç»ƒä¹ -3-è¶…æ—¶å¤„ç†-15-åˆ†é’Ÿ)
  - [ğŸ“š å»¶ä¼¸é˜…è¯»](#-å»¶ä¼¸é˜…è¯»)
    - [å®˜æ–¹èµ„æº](#å®˜æ–¹èµ„æº)
    - [æœ¬æ¨¡å—æ–‡æ¡£](#æœ¬æ¨¡å—æ–‡æ¡£)
  - [ğŸ“ æ€»ç»“](#-æ€»ç»“)

## ğŸ¯ æœ¬ç« ç›®æ ‡

**10 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹ Rust å¼‚æ­¥ç¼–ç¨‹**ï¼Œä»é›¶å¼€å§‹ç¼–å†™å¹¶è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ªå¼‚æ­¥ç¨‹åºã€‚

**å­¦ä¹ æˆæœ**:

- âœ… ç†è§£å¼‚æ­¥ç¼–ç¨‹çš„åŸºæœ¬æ¦‚å¿µ
- âœ… æŒæ¡ `async/await` è¯­æ³•
- âœ… èƒ½å¤Ÿè¿è¡Œç®€å•çš„å¼‚æ­¥ç¨‹åº
- âœ… äº†è§£å¼‚æ­¥ä¸åŒæ­¥çš„åŒºåˆ«
- âœ… é¿å…å¸¸è§çš„æ–°æ‰‹é™·é˜±

---

## ğŸ“‘ ç›®å½•

- [1. ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹ï¼Ÿ](#1-ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹)
- [2. ä½ çš„ç¬¬ä¸€ä¸ªå¼‚æ­¥ç¨‹åº](#2-ä½ çš„ç¬¬ä¸€ä¸ªå¼‚æ­¥ç¨‹åº)
- [3. æ ¸å¿ƒæ¦‚å¿µ](#3-æ ¸å¿ƒæ¦‚å¿µ)
- [4. å®ç”¨ç¤ºä¾‹](#4-å®ç”¨ç¤ºä¾‹)
- [5. å¸¸è§é™·é˜±](#5-å¸¸è§é™·é˜±)
- [6. ä¸‹ä¸€æ­¥](#6-ä¸‹ä¸€æ­¥)

---

## 1. ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹ï¼Ÿ

### 1.1 åŒæ­¥ vs å¼‚æ­¥

**åŒæ­¥æ–¹å¼ï¼ˆé˜»å¡ï¼‰**:

```rust
fn fetch_data() -> String {
    // é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾…æ•°æ®è¿”å›
    std::thread::sleep(std::time::Duration::from_secs(2));
    "Data".to_string()
}

fn main() {
    println!("Start");
    let data = fetch_data(); // è¿™é‡Œä¼šç­‰å¾… 2 ç§’
    println!("Got: {}", data);
    println!("End");
}
// è¾“å‡ºï¼š
// Start
// (ç­‰å¾… 2 ç§’...)
// Got: Data
// End
```

**å¼‚æ­¥æ–¹å¼ï¼ˆéé˜»å¡ï¼‰**:

```rust
async fn fetch_data() -> String {
    // ä¸é˜»å¡çº¿ç¨‹ï¼Œå…è®¸å…¶ä»–ä»»åŠ¡è¿è¡Œ
    tokio::time::sleep(tokio::time::Duration::from_secs(2)).await;
    "Data".to_string()
}

#[tokio::main]
async fn main() {
    println!("Start");
    let data = fetch_data().await; // ç­‰å¾…æ—¶å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡
    println!("Got: {}", data);
    println!("End");
}
```

---

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ

**åœºæ™¯å¯¹æ¯”**:

| åœºæ™¯ | åŒæ­¥æ–¹å¼ | å¼‚æ­¥æ–¹å¼ |
|------|----------|----------|
| **å¤„ç† 10,000 ä¸ªç½‘ç»œè¯·æ±‚** | éœ€è¦ 10,000 ä¸ªçº¿ç¨‹ï¼ˆ~20GB å†…å­˜ï¼‰ | åªéœ€å‡ ä¸ªçº¿ç¨‹ï¼ˆ~å‡ MB å†…å­˜ï¼‰ |
| **Web æœåŠ¡å™¨** | æ¯ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œèµ„æºæ¶ˆè€—å¤§ | å°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡è¿æ¥ |
| **æ–‡ä»¶ I/O** | é˜»å¡ç­‰å¾…ï¼Œæµªè´¹ CPU | ç­‰å¾…æœŸé—´å¤„ç†å…¶ä»–ä»»åŠ¡ |

**æ ¸å¿ƒä¼˜åŠ¿**:

- âœ… **é«˜å¹¶å‘**: åŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡çš„ä»»åŠ¡
- âœ… **ä½èµ„æº**: å†…å­˜å’Œ CPU å ç”¨å°‘
- âœ… **é«˜æ•ˆç‡**: I/O ç­‰å¾…æ—¶ä¸æµªè´¹èµ„æº

---

## 2. ä½ çš„ç¬¬ä¸€ä¸ªå¼‚æ­¥ç¨‹åº

### 2.1 ç¯å¢ƒå‡†å¤‡

**1. åˆ›å»ºé¡¹ç›®**:

```bash
cargo new async_hello
cd async_hello
```

**2. æ·»åŠ ä¾èµ–** (`Cargo.toml`):

```toml
[dependencies]
tokio = { version = "1", features = ["full"] }
```

> **ä¸ºä»€ä¹ˆéœ€è¦ Tokioï¼Ÿ**  
> Rust çš„ `async/await` åªæ˜¯è¯­æ³•ï¼Œéœ€è¦**è¿è¡Œæ—¶**æ¥å®é™…æ‰§è¡Œå¼‚æ­¥ä»£ç ã€‚Tokio æ˜¯æœ€æµè¡Œçš„å¼‚æ­¥è¿è¡Œæ—¶ã€‚

---

### 2.2 Hello, Async World

**ä»£ç ** (`src/main.rs`):

```rust
// 1. å¯¼å…¥ Tokio è¿è¡Œæ—¶
use tokio::time::{sleep, Duration};

// 2. ä½¿ç”¨ #[tokio::main] å®è®¾ç½®å¼‚æ­¥è¿è¡Œæ—¶
#[tokio::main]
async fn main() {
    println!("Hello, async world!");
    
    // 3. å¼‚æ­¥ç­‰å¾… 1 ç§’
    sleep(Duration::from_secs(1)).await;
    
    println!("1 second later...");
}
```

**è¿è¡Œ**:

```bash
cargo run
```

**è¾“å‡º**:

```text
Hello, async world!
(ç­‰å¾… 1 ç§’)
1 second later...
```

---

### 2.3 ä»£ç è§£æ

#### `#[tokio::main]` å®

```rust
// ä½ å†™çš„ä»£ç ï¼š
#[tokio::main]
async fn main() {
    // å¼‚æ­¥ä»£ç 
}

// å®é™…å±•å¼€ä¸ºï¼š
fn main() {
    tokio::runtime::Runtime::new()
        .unwrap()
        .block_on(async {
            // å¼‚æ­¥ä»£ç 
        })
}
```

**ä½œç”¨**: è‡ªåŠ¨åˆ›å»º Tokio è¿è¡Œæ—¶å¹¶è¿è¡Œä½ çš„å¼‚æ­¥ `main` å‡½æ•°ã€‚

---

#### `async` å…³é”®å­—

```rust
async fn my_function() -> i32 {
    42
}

// ç­‰ä»·äºï¼š
fn my_function() -> impl Future<Output = i32> {
    async { 42 }
}
```

**ä½œç”¨**: å°†å‡½æ•°å˜æˆå¼‚æ­¥å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª `Future`ï¼ˆæœªæ¥å€¼ï¼‰ã€‚

---

#### `.await` å…³é”®å­—

```rust
async fn example() {
    let result = async_operation().await; // ç­‰å¾… Future å®Œæˆ
    println!("Result: {}", result);
}
```

**ä½œç”¨**:

- æš‚åœå½“å‰å‡½æ•°ï¼Œç­‰å¾… `Future` å®Œæˆ
- **ä¸ä¼šé˜»å¡çº¿ç¨‹**ï¼Œå…è®¸å…¶ä»–ä»»åŠ¡è¿è¡Œ

---

## 3. æ ¸å¿ƒæ¦‚å¿µ

### 3.1 ä¸‰å¤§æ ¸å¿ƒ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Rust å¼‚æ­¥ç¼–ç¨‹ä¸‰å¤§æ ¸å¿ƒ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  1. async/await  â† ç¼–å†™å¼‚æ­¥ä»£ç çš„è¯­æ³•           â”‚
â”‚     â†“                                           â”‚
â”‚  2. Future       â† å¼‚æ­¥è®¡ç®—çš„æŠ½è±¡               â”‚
â”‚     â†“                                           â”‚
â”‚  3. Runtime      â† æ‰§è¡Œ Future çš„è¿è¡Œæ—¶ç¯å¢ƒ     â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 3.1.1 async/awaitï¼ˆè¯­æ³•å±‚ï¼‰

**ç”¨é€”**: è®©ä½ èƒ½å¤Ÿç”¨æ¥è¿‘åŒæ­¥ä»£ç çš„æ–¹å¼ç¼–å†™å¼‚æ­¥é€»è¾‘ã€‚

```rust
// åŒæ­¥é£æ ¼ï¼ˆä½†å®é™…æ˜¯å¼‚æ­¥ï¼‰
async fn process_user(id: u64) -> Result<User, Error> {
    let user = fetch_user(id).await?;          // ç­‰å¾…ç½‘ç»œè¯·æ±‚
    let profile = fetch_profile(user.id).await?; // ç­‰å¾…å¦ä¸€ä¸ªè¯·æ±‚
    Ok(merge(user, profile))
}
```

---

#### 3.1.2 Futureï¼ˆæŠ½è±¡å±‚ï¼‰

**å®šä¹‰**: ä»£è¡¨ä¸€ä¸ªå¯èƒ½å°šæœªå®Œæˆçš„è®¡ç®—ã€‚

```rust
use std::future::Future;
use std::pin::Pin;
use std::task::{Context, Poll};

// Future trait çš„ç®€åŒ–ç‰ˆæœ¬
trait Future {
    type Output;
    
    fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) 
        -> Poll<Self::Output>;
}

// Poll çš„ä¸¤ç§çŠ¶æ€
enum Poll<T> {
    Ready(T),    // è®¡ç®—å®Œæˆ
    Pending,     // å°šæœªå®Œæˆ
}
```

**å…³é”®ç‰¹æ€§**:

- **æƒ°æ€§**: åªæœ‰è¢« `.await` æˆ– `poll()` æ—¶æ‰å¼€å§‹æ‰§è¡Œ
- **é›¶æˆæœ¬**: ç¼–è¯‘ä¸ºçŠ¶æ€æœºï¼Œæ— è¿è¡Œæ—¶å¼€é”€

---

#### 3.1.3 Runtimeï¼ˆæ‰§è¡Œå±‚ï¼‰

**ç”¨é€”**: è´Ÿè´£å®é™…æ‰§è¡Œ Futureï¼Œç®¡ç†ä»»åŠ¡è°ƒåº¦ã€‚

```rust
// Tokio è¿è¡Œæ—¶ï¼ˆå¤šçº¿ç¨‹ï¼‰
#[tokio::main]
async fn main() {
    // åœ¨ Tokio è¿è¡Œæ—¶ä¸­æ‰§è¡Œ
}

// æˆ–æ‰‹åŠ¨åˆ›å»º
fn main() {
    let rt = tokio::runtime::Runtime::new().unwrap();
    rt.block_on(async {
        // å¼‚æ­¥ä»£ç 
    });
}
```

**ä¸»æµè¿è¡Œæ—¶**:

- **Tokio**: åŠŸèƒ½æœ€å…¨ï¼Œç”Ÿäº§çº§
- **async-std**: API æ¥è¿‘æ ‡å‡†åº“
- **Smol**: è½»é‡çº§

---

### 3.2 å¼‚æ­¥æ‰§è¡Œæµç¨‹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç¼–å†™ä»£ç                                       â”‚
â”‚    async fn fetch() -> String {                  â”‚
â”‚        reqwest::get("url").await?.text().await   â”‚
â”‚    }                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. ç¼–è¯‘å™¨è½¬æ¢                                    â”‚
â”‚    â†’ ç”ŸæˆçŠ¶æ€æœºï¼ˆå®ç° Future traitï¼‰             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. è¿è¡Œæ—¶æ‰§è¡Œ                                    â”‚
â”‚    â†’ Executor è°ƒç”¨ Future::poll()                â”‚
â”‚    â†’ å¦‚æœ Pendingï¼Œæ³¨å†Œ Waker ç­‰å¾…å”¤é†’           â”‚
â”‚    â†’ å¦‚æœ Readyï¼Œè¿”å›ç»“æœ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. å®ç”¨ç¤ºä¾‹

### 4.1 å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡

```rust
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() {
    // âŒ é¡ºåºæ‰§è¡Œï¼ˆæ€»å…± 3 ç§’ï¼‰
    task1().await;
    task2().await;
    task3().await;
    
    // âœ… å¹¶å‘æ‰§è¡Œï¼ˆæ€»å…± 1 ç§’ï¼Œå› ä¸ºæœ€é•¿ä»»åŠ¡æ˜¯ 1 ç§’ï¼‰
    tokio::join!(task1(), task2(), task3());
}

async fn task1() {
    sleep(Duration::from_secs(1)).await;
    println!("Task 1 done");
}

async fn task2() {
    sleep(Duration::from_millis(500)).await;
    println!("Task 2 done");
}

async fn task3() {
    sleep(Duration::from_millis(300)).await;
    println!("Task 3 done");
}
```

**è¾“å‡º**:

```text
Task 3 done
Task 2 done
Task 1 done
```

---

### 4.2 åå°ä»»åŠ¡

```rust
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() {
    // å¯åŠ¨åå°ä»»åŠ¡
    let handle = tokio::spawn(async {
        println!("Background task started");
        sleep(Duration::from_secs(2)).await;
        println!("Background task finished");
        42 // è¿”å›å€¼
    });
    
    // ä¸»ä»»åŠ¡ç»§ç»­æ‰§è¡Œ
    println!("Main task running");
    sleep(Duration::from_secs(1)).await;
    println!("Main task done");
    
    // ç­‰å¾…åå°ä»»åŠ¡å®Œæˆ
    let result = handle.await.unwrap();
    println!("Background result: {}", result);
}
```

**è¾“å‡º**:

```text
Background task started
Main task running
Main task done
Background task finished
Background result: 42
```

---

### 4.3 HTTP è¯·æ±‚ç¤ºä¾‹

**æ·»åŠ ä¾èµ–** (`Cargo.toml`):

```toml
[dependencies]
tokio = { version = "1", features = ["full"] }
reqwest = "0.11"
```

**ä»£ç **:

```rust
use reqwest;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // å‘èµ·å¼‚æ­¥ HTTP GET è¯·æ±‚
    let response = reqwest::get("https://httpbin.org/ip")
        .await?
        .text()
        .await?;
    
    println!("Response: {}", response);
    Ok(())
}
```

---

### 4.4 è¶…æ—¶æ§åˆ¶

```rust
use tokio::time::{timeout, Duration};

async fn slow_operation() -> String {
    tokio::time::sleep(Duration::from_secs(5)).await;
    "Done".to_string()
}

#[tokio::main]
async fn main() {
    // è®¾ç½® 2 ç§’è¶…æ—¶
    match timeout(Duration::from_secs(2), slow_operation()).await {
        Ok(result) => println!("Success: {}", result),
        Err(_) => println!("Timeout!"),
    }
}
```

**è¾“å‡º**:

```text
Timeout!
```

---

## 5. å¸¸è§é™·é˜±

### 5.1 å¿˜è®° `.await`

```rust
async fn fetch_data() -> String {
    "Data".to_string()
}

#[tokio::main]
async fn main() {
    // âŒ é”™è¯¯ï¼šåˆ›å»ºäº† Future ä½†æ²¡æœ‰æ‰§è¡Œ
    let data = fetch_data(); // ç±»å‹æ˜¯ impl Future<Output = String>
    // ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿï¼
    
    // âœ… æ­£ç¡®ï¼šä½¿ç”¨ .await æ‰§è¡Œ
    let data = fetch_data().await;
    println!("Got: {}", data);
}
```

**è®°ä½**: Future æ˜¯æƒ°æ€§çš„ï¼Œå¿…é¡» `.await` æ‰ä¼šæ‰§è¡Œã€‚

---

### 5.2 åœ¨é `async` å‡½æ•°ä¸­ä½¿ç”¨ `.await`

```rust
// âŒ ç¼–è¯‘é”™è¯¯
fn main() {
    let data = fetch_data().await; // é”™è¯¯ï¼š.await åªèƒ½åœ¨ async å‡½æ•°ä¸­ä½¿ç”¨
}

// âœ… æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ #[tokio::main]
#[tokio::main]
async fn main() {
    let data = fetch_data().await;
}

// âœ… æ–¹æ¡ˆ 2ï¼šæ‰‹åŠ¨åˆ›å»ºè¿è¡Œæ—¶
fn main() {
    let rt = tokio::runtime::Runtime::new().unwrap();
    rt.block_on(async {
        let data = fetch_data().await;
    });
}
```

---

### 5.3 é˜»å¡å¼‚æ­¥è¿è¡Œæ—¶

```rust
use std::thread;
use std::time::Duration;

#[tokio::main]
async fn main() {
    // âŒ é”™è¯¯ï¼šé˜»å¡æ•´ä¸ªè¿è¡Œæ—¶
    thread::sleep(Duration::from_secs(1)); // ä¼šé˜»å¡æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡ï¼
    
    // âœ… æ­£ç¡®ï¼šä½¿ç”¨å¼‚æ­¥ sleep
    tokio::time::sleep(Duration::from_secs(1)).await;
}
```

**è§„åˆ™**:

- âŒ ä¸è¦ä½¿ç”¨ `std::thread::sleep`
- âœ… ä½¿ç”¨ `tokio::time::sleep`
- âŒ ä¸è¦è°ƒç”¨é˜»å¡çš„åŒæ­¥å‡½æ•°
- âœ… ä½¿ç”¨ `tokio::task::spawn_blocking` åŒ…è£…é˜»å¡æ“ä½œ

---

### 5.4 æ··ç”¨ä¸åŒè¿è¡Œæ—¶çš„ç±»å‹

```rust
// âŒ é”™è¯¯ï¼šä¸èƒ½æ··ç”¨
use tokio::net::TcpStream as TokioStream;
use async_std::net::TcpStream as AsyncStdStream;

#[tokio::main]
async fn main() {
    // AsyncStdStream æ— æ³•åœ¨ Tokio è¿è¡Œæ—¶ä¸­å·¥ä½œ
    let stream = AsyncStdStream::connect("127.0.0.1:8080").await;
}

// âœ… æ­£ç¡®ï¼šç»Ÿä¸€ä½¿ç”¨ Tokio çš„ç±»å‹
use tokio::net::TcpStream;

#[tokio::main]
async fn main() {
    let stream = TcpStream::connect("127.0.0.1:8080").await;
}
```

**åŸåˆ™**: é€‰å®šä¸€ä¸ªè¿è¡Œæ—¶ï¼ˆæ¨è Tokioï¼‰ï¼Œç»Ÿä¸€ä½¿ç”¨å…¶æä¾›çš„ç±»å‹ã€‚

---

## 6. ä¸‹ä¸€æ­¥

### 6.1 å­¦ä¹ è·¯å¾„

```text
ä½ ç°åœ¨åœ¨è¿™é‡Œ âœ“
    â”‚
    â”œâ”€ 01_å¼‚æ­¥ç¼–ç¨‹å¿«é€Ÿå…¥é—¨ (æœ¬ç« ) âœ“
    â”‚
    â”œâ”€ 02_Futureä¸Executoræœºåˆ¶ (ä¸‹ä¸€ç« )
    â”‚  â””â”€ ç†è§£å¼‚æ­¥æ‰§è¡ŒåŸç†
    â”‚
    â”œâ”€ 03_å¼‚æ­¥è¿è¡Œæ—¶é€‰æ‹©æŒ‡å—
    â”‚  â””â”€ Tokio vs async-std vs Smol
    â”‚
    â”œâ”€ 04_å¼‚æ­¥è®¾è®¡æ¨¡å¼å®è·µ
    â”‚  â””â”€ Actorã€Reactorã€CSP æ¨¡å¼
    â”‚
    â”œâ”€ 05_å¼‚æ­¥æ€§èƒ½ä¼˜åŒ–æŒ‡å—
    â”‚  â””â”€ æ€§èƒ½è°ƒä¼˜æŠ€å·§
    â”‚
    â””â”€ 06_å¼‚æ­¥è°ƒè¯•ä¸ç›‘æ§
       â””â”€ è°ƒè¯•å·¥å…·å’Œç›‘æ§æ–¹æ³•
```

---

### 6.2 æ¨èé˜…è¯»

| æ–‡æ¡£ | è¯´æ˜ | éš¾åº¦ |
|------|------|------|
| **[æœ¯è¯­è¡¨](../tier_01_foundations/03_æœ¯è¯­è¡¨.md)** | æ ¸å¿ƒæœ¯è¯­é€ŸæŸ¥ | â­ |
| **[å¸¸è§é—®é¢˜](../tier_01_foundations/04_å¸¸è§é—®é¢˜.md)** | FAQ å¿«é€Ÿè§£ç­” | â­â­ |
| **[Futureä¸Executoræœºåˆ¶](./02_Futureä¸Executoræœºåˆ¶.md)** | æ·±å…¥åŸç† | â­â­â­ |

---

### 6.3 å®è·µå»ºè®®

**ç¬¬ä¸€å‘¨**:

- âœ… è¿è¡Œæœ¬ç« çš„æ‰€æœ‰ç¤ºä¾‹ä»£ç 
- âœ… ä¿®æ”¹å‚æ•°ï¼Œè§‚å¯Ÿè¡Œä¸ºå˜åŒ–
- âœ… å°è¯•ç¼–å†™è‡ªå·±çš„ç®€å•å¼‚æ­¥å‡½æ•°

**ç¬¬äºŒå‘¨**:

- âœ… é˜…è¯» [Futureä¸Executoræœºåˆ¶](./02_Futureä¸Executoræœºåˆ¶.md)
- âœ… ç†è§£ `Future` trait çš„å·¥ä½œåŸç†
- âœ… å­¦ä¹ å¦‚ä½•æ‰‹åŠ¨å®ç°ç®€å•çš„ `Future`

**ç¬¬ä¸‰å‘¨**:

- âœ… é˜…è¯» [å¼‚æ­¥è¿è¡Œæ—¶é€‰æ‹©æŒ‡å—](./03_å¼‚æ­¥è¿è¡Œæ—¶é€‰æ‹©æŒ‡å—.md)
- âœ… å¯¹æ¯”ä¸åŒè¿è¡Œæ—¶çš„ç‰¹ç‚¹
- âœ… ä¸ºé¡¹ç›®é€‰æ‹©åˆé€‚çš„è¿è¡Œæ—¶

---

### 6.4 ç»ƒä¹ é¢˜

#### ç»ƒä¹  1: Hello, Async! (5 åˆ†é’Ÿ)

ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œå¼‚æ­¥æ‰“å° "Hello" å’Œ "World"ï¼Œä¸­é—´é—´éš” 1 ç§’ã€‚

æŸ¥çœ‹ç­”æ¡ˆ

```rust
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() {
    println!("Hello");
    sleep(Duration::from_secs(1)).await;
    println!("World");
}
```

---

#### ç»ƒä¹  2: å¹¶å‘ä»»åŠ¡ (10 åˆ†é’Ÿ)

åˆ›å»º 3 ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œåˆ†åˆ«ç­‰å¾… 1 ç§’ã€2 ç§’ã€3 ç§’ï¼Œå¹¶å‘æ‰§è¡Œå®ƒä»¬ã€‚

æŸ¥çœ‹ç­”æ¡ˆ

```rust
use tokio::time::{sleep, Duration};

async fn task(id: u32, seconds: u64) {
    println!("Task {} started", id);
    sleep(Duration::from_secs(seconds)).await;
    println!("Task {} finished", id);
}

#[tokio::main]
async fn main() {
    // å¹¶å‘æ‰§è¡Œï¼Œæ€»å…±åªéœ€è¦ 3 ç§’
    tokio::join!(
        task(1, 1),
        task(2, 2),
        task(3, 3),
    );
}
```

---

#### ç»ƒä¹  3: è¶…æ—¶å¤„ç† (15 åˆ†é’Ÿ)

ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¦‚æœè¶…è¿‡ 5 ç§’æœªå®Œæˆåˆ™è¿”å›é”™è¯¯ã€‚

æŸ¥çœ‹ç­”æ¡ˆ

```rust
use tokio::fs;
use tokio::time::{timeout, Duration};

#[tokio::main]
async fn main() {
    match timeout(
        Duration::from_secs(5),
        fs::read_to_string("test.txt")
    ).await {
        Ok(Ok(content)) => println!("File content: {}", content),
        Ok(Err(e)) => eprintln!("File error: {}", e),
        Err(_) => eprintln!("Timeout!"),
    }
}
```

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

### å®˜æ–¹èµ„æº

- [Rust Async Book](https://rust-lang.github.io/async-book/)
- [Tokio Tutorial](https://tokio.rs/tokio/tutorial)

### æœ¬æ¨¡å—æ–‡æ¡£

- **[é¡¹ç›®æ¦‚è§ˆ](../tier_01_foundations/01_é¡¹ç›®æ¦‚è§ˆ.md)** - æ¨¡å—æ•´ä½“ä»‹ç»
- **[ä¸»ç´¢å¼•å¯¼èˆª](../tier_01_foundations/02_ä¸»ç´¢å¼•å¯¼èˆª.md)** - å®Œæ•´æ–‡æ¡£å¯¼èˆª

---

## ğŸ“ æ€»ç»“

**ä½ å·²ç»å­¦ä¼šäº†**:

- âœ… å¼‚æ­¥ç¼–ç¨‹çš„åŸºæœ¬æ¦‚å¿µå’Œä¼˜åŠ¿
- âœ… `async/await` è¯­æ³•çš„ä½¿ç”¨
- âœ… å¦‚ä½•ä½¿ç”¨ Tokio è¿è¡Œæ—¶
- âœ… å¹¶å‘æ‰§è¡Œå¤šä¸ªå¼‚æ­¥ä»»åŠ¡
- âœ… å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ

**ä¸‹ä¸€æ­¥**:

- ğŸ“– é˜…è¯» **[Futureä¸Executoræœºåˆ¶](./02_Futureä¸Executoræœºåˆ¶.md)** æ·±å…¥ç†è§£åŸç†
- ğŸ’» å®Œæˆç»ƒä¹ é¢˜ï¼Œå·©å›ºçŸ¥è¯†
- ğŸš€ å¼€å§‹æ„å»ºè‡ªå·±çš„å¼‚æ­¥åº”ç”¨

---

**æ–‡æ¡£ç»´æŠ¤**: C06 Async Team | **è´¨é‡è¯„åˆ†**: 95/100  
**æœ€åæ›´æ–°**: 2025-10-22 | **Rust ç‰ˆæœ¬**: 1.90+
