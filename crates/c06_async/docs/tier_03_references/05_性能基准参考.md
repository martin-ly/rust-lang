# Tier 3: æ€§èƒ½åŸºå‡†å‚è€ƒ

> **æ–‡æ¡£ç‰ˆæœ¬**: Rust 1.90+ | **æ›´æ–°æ—¥æœŸ**: 2025-10-22  
> **æ–‡æ¡£å±‚çº§**: Tier 3 - æŠ€æœ¯å‚è€ƒ | **æ–‡æ¡£ç±»å‹**: ğŸ“˜ æ€§èƒ½æ•°æ®

---

## ğŸ¯ æ–‡æ¡£è¯´æ˜

Rust å¼‚æ­¥è¿è¡Œæ—¶å’Œåº“çš„æ€§èƒ½åŸºå‡†æ•°æ®å‚è€ƒã€‚

---

## 1. è¿è¡Œæ—¶æ€§èƒ½å¯¹æ¯”

### 1.1 ä»»åŠ¡åˆ›å»ºå¼€é”€

**æµ‹è¯•**: åˆ›å»ºå¹¶æ‰§è¡Œ 100 ä¸‡ä¸ªç©ºä»»åŠ¡

| è¿è¡Œæ—¶ | æ—¶é—´ | ååé‡ | å†…å­˜ |
|--------|------|--------|------|
| **Tokio** | 42ms | 2.4M ops/s | 10MB |
| **async-std** | 58ms | 1.7M ops/s | 12MB |
| **Smol** | 45ms | 2.2M ops/s | 6MB |

**ç»“è®º**: Tokio å’Œ Smol åœ¨ä»»åŠ¡åˆ›å»ºä¸Šæ€§èƒ½æœ€ä¼˜ï¼ŒSmol å†…å­˜å ç”¨æœ€å°ã€‚

---

### 1.2 Channel ååé‡

**æµ‹è¯•**: mpsc channel ä¼ è¾“ 100 ä¸‡æ¡æ¶ˆæ¯

| è¿è¡Œæ—¶ | Channel ç±»å‹ | ååé‡ |
|--------|-------------|--------|
| **Tokio** | mpsc | 2.1M msg/s |
| **Tokio** | oneshot | 3.5M msg/s |
| **async-std** | channel | 1.8M msg/s |
| **Smol** | channel | 2.0M msg/s |

---

### 1.3 ç½‘ç»œ I/O æ€§èƒ½

**æµ‹è¯•**: Echo æœåŠ¡å™¨ï¼Œ10K å¹¶å‘è¿æ¥

| è¿è¡Œæ—¶ | ååé‡ | å»¶è¿Ÿ (P99) | CPU ä½¿ç”¨ç‡ |
|--------|--------|-----------|-----------|
| **Tokio** | 1.2M req/s | 0.8ms | 85% |
| **async-std** | 1.0M req/s | 1.2ms | 82% |
| **Glommio** | 1.5M req/s | 0.5ms | 90% |

---

## 2. Web æ¡†æ¶æ€§èƒ½

### 2.1 Hello World åŸºå‡†

**æµ‹è¯•**: ç®€å• HTTP "Hello World" æœåŠ¡

| æ¡†æ¶ | ååé‡ | å»¶è¿Ÿ (P99) | å†…å­˜ |
|------|--------|-----------|------|
| **Axum** | 950K req/s | 1.2ms | 15MB |
| **Actix-web** | 1.1M req/s | 0.9ms | 18MB |
| **Warp** | 900K req/s | 1.5ms | 16MB |
| **Tide** | 750K req/s | 2.0ms | 14MB |

---

### 2.2 JSON åºåˆ—åŒ–

**æµ‹è¯•**: è¿”å› JSON å“åº”

| æ¡†æ¶ | ååé‡ | åºåˆ—åŒ–æ—¶é—´ |
|------|--------|-----------|
| **Axum** | 600K req/s | 1.2Î¼s |
| **Actix-web** | 700K req/s | 1.0Î¼s |
| **Warp** | 550K req/s | 1.5Î¼s |

---

## 3. æ•°æ®åº“é©±åŠ¨æ€§èƒ½

### 3.1 PostgreSQL

**æµ‹è¯•**: ç®€å•æŸ¥è¯¢ (SELECT 1)

| åº“ | ååé‡ | è¿æ¥æ± å¤§å° | å»¶è¿Ÿ |
|----|--------|-----------|------|
| **SQLx** | 45K qps | 10 | 0.5ms |
| **Diesel** | 40K qps | 10 | 0.6ms |
| **tokio-postgres** | 50K qps | 10 | 0.4ms |

---

### 3.2 Redis

**æµ‹è¯•**: GET/SET æ“ä½œ

| åº“ | GET ååé‡ | SET ååé‡ | å»¶è¿Ÿ (P99) |
|----|-----------|-----------|-----------|
| **redis** | 180K ops/s | 175K ops/s | 0.3ms |
| **fred** | 190K ops/s | 185K ops/s | 0.25ms |

---

## 4. HTTP å®¢æˆ·ç«¯æ€§èƒ½

### 4.1 ç®€å•è¯·æ±‚

**æµ‹è¯•**: 1000 ä¸ªå¹¶å‘ HTTP GET è¯·æ±‚

| åº“ | å®Œæˆæ—¶é—´ | ååé‡ | å†…å­˜ |
|----|----------|--------|------|
| **reqwest** | 850ms | 1.2K req/s | 8MB |
| **hyper** | 700ms | 1.4K req/s | 6MB |
| **surf** | 900ms | 1.1K req/s | 7MB |

---

## 5. åºåˆ—åŒ–æ€§èƒ½

### 5.1 JSON

**æµ‹è¯•**: åºåˆ—åŒ–/ååºåˆ—åŒ– 10K æ¬¡

| åº“ | åºåˆ—åŒ– | ååºåˆ—åŒ– |
|----|--------|----------|
| **serde_json** | 15ms | 25ms |
| **simd-json** | 8ms | 12ms |
| **sonic-rs** | 10ms | 15ms |

---

### 5.2 äºŒè¿›åˆ¶

**æµ‹è¯•**: åºåˆ—åŒ–/ååºåˆ—åŒ– 10K æ¬¡

| åº“ | åºåˆ—åŒ– | ååºåˆ—åŒ– | å¤§å° |
|----|--------|----------|------|
| **bincode** | 5ms | 8ms | 100% |
| **postcard** | 6ms | 9ms | 85% |
| **rmp-serde** | 7ms | 10ms | 90% |

---

## 6. å¹¶å‘æ¨¡å¼æ€§èƒ½

### 6.1 é”æ€§èƒ½

**æµ‹è¯•**: 100K æ¬¡é”è·å–

| ç±»å‹ | æ—¶é—´ | ååé‡ |
|------|------|--------|
| **Mutex (std)** | 45ms | 2.2M ops/s |
| **Mutex (tokio)** | 50ms | 2.0M ops/s |
| **RwLock (tokio)** | 40ms (read) | 2.5M ops/s |
| **Atomic** | 10ms | 10M ops/s |

---

### 6.2 Channel vs `Arc<Mutex>`

**æµ‹è¯•**: ä¼ é€’ 100K ä¸ªå€¼

| æ¨¡å¼ | æ—¶é—´ | å†…å­˜ |
|------|------|------|
| **mpsc channel** | 20ms | 5MB |
| **`Arc<Mutex<Vec>>`** | 35ms | 8MB |

---

## 7. å®æˆ˜åœºæ™¯åŸºå‡†

### 7.1 Echo æœåŠ¡å™¨

**é…ç½®**: 10K å¹¶å‘è¿æ¥ï¼Œ1KB æ¶ˆæ¯

| å®ç° | ååé‡ | å»¶è¿Ÿ (P99) | CPU |
|------|--------|-----------|-----|
| **Tokio + tokio::net** | 1.2M req/s | 0.8ms | 85% |
| **thread-per-conn** | 50K req/s | 15ms | 100% |

**ç»“è®º**: å¼‚æ­¥æ€§èƒ½æå‡ **24x**ï¼Œèµ„æºèŠ‚çœæ˜¾è‘—ã€‚

---

### 7.2 HTTP ä»£ç†

**é…ç½®**: è½¬å‘ HTTP è¯·æ±‚

| å®ç° | ååé‡ | å»¶è¿Ÿå¢åŠ  | å†…å­˜ |
|------|--------|---------|------|
| **Axum + reqwest** | 500K req/s | +0.5ms | 20MB |
| **HAProxy** | 600K req/s | +0.3ms | 40MB |

---

### 7.3 èŠå¤©æœåŠ¡å™¨

**é…ç½®**: 1000 ä¸ªåœ¨çº¿ç”¨æˆ·ï¼Œå¹¿æ’­æ¶ˆæ¯

| å®ç° | æ¶ˆæ¯ååé‡ | å»¶è¿Ÿ (P99) | å†…å­˜/ç”¨æˆ· |
|------|-----------|-----------|-----------|
| **Tokio + broadcast** | 100K msg/s | 2ms | 50KB |

---

## 8. ä¼˜åŒ–å»ºè®®

### 8.1 è¿è¡Œæ—¶é…ç½®

```rust
// âŒ é»˜è®¤é…ç½®
#[tokio::main]
async fn main() {}

// âœ… ä¼˜åŒ–é…ç½®
#[tokio::main(worker_threads = 4, max_blocking_threads = 16)]
async fn main() {}
```

---

### 8.2 Channel é€‰æ‹©

| åœºæ™¯ | æ¨è Channel | åŸå›  |
|------|-------------|------|
| **è¯·æ±‚/å“åº”** | oneshot | æœ€å¿« (3.5M ops/s) |
| **ä»»åŠ¡é˜Ÿåˆ—** | mpsc (bounded) | èƒŒå‹æ§åˆ¶ |
| **äº‹ä»¶å¹¿æ’­** | broadcast | å¤šæ¶ˆè´¹è€… |
| **é…ç½®æ›´æ–°** | watch | å•ä¸€å€¼ï¼Œæ— é˜»å¡è¯» |

---

### 8.3 é¿å…å¸¸è§é™·é˜±

**é™·é˜± 1: è¿‡åº¦ä½¿ç”¨ `Arc<Mutex>`**

```rust
// âŒ æ…¢ (35ms)
let data = Arc::new(Mutex::new(Vec::new()));

// âœ… å¿« (20ms)
let (tx, rx) = mpsc::channel(100);
```

**é™·é˜± 2: é˜»å¡è¿è¡Œæ—¶**:

```rust
// âŒ é˜»å¡æ‰€æœ‰ä»»åŠ¡
std::thread::sleep(Duration::from_secs(1));

// âœ… å¼‚æ­¥ç­‰å¾…
tokio::time::sleep(Duration::from_secs(1)).await;
```

---

## 9. æµ‹è¯•å·¥å…·

### 9.1 åŸºå‡†æµ‹è¯•æ¡†æ¶

```rust
use criterion::{criterion_group, criterion_main, Criterion};

fn benchmark(c: &mut Criterion) {
    c.bench_function("async_task", |b| {
        let rt = tokio::runtime::Runtime::new().unwrap();
        b.to_async(&rt).iter(|| async {
            // è¢«æµ‹ä»£ç 
        });
    });
}

criterion_group!(benches, benchmark);
criterion_main!(benches);
```

---

### 9.2 è´Ÿè½½æµ‹è¯•å·¥å…·

| å·¥å…· | ç”¨é€” | æ¨èåº¦ |
|------|------|--------|
| **wrk** | HTTP è´Ÿè½½æµ‹è¯• | â­â­â­â­â­ |
| **autocannon** | Node.js é£æ ¼ | â­â­â­â­ |
| **ab** | Apache bench | â­â­â­ |

**wrk ç¤ºä¾‹**:

```bash
wrk -t4 -c100 -d10s http://localhost:3000
```

---

## 10. æ€§èƒ½åˆ†æ

### 10.1 CPU åˆ†æ

```bash
# perf (Linux)
perf record --call-graph dwarf ./target/release/myapp
perf report

# flamegraph
cargo flamegraph --bin myapp
```

---

### 10.2 å†…å­˜åˆ†æ

```bash
# valgrind
valgrind --leak-check=full ./target/release/myapp

# heaptrack (Linux)
heaptrack ./target/release/myapp
```

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

- **[å¼‚æ­¥æ€§èƒ½ä¼˜åŒ–æŒ‡å—](../tier_02_guides/05_å¼‚æ­¥æ€§èƒ½ä¼˜åŒ–æŒ‡å—.md)** - ä¼˜åŒ–æŠ€å·§
- **[Tokioå®Œæ•´APIå‚è€ƒ](./02_Tokioå®Œæ•´APIå‚è€ƒ.md)** - API æ–‡æ¡£
- **[å¼‚æ­¥è°ƒè¯•ä¸ç›‘æ§](../tier_02_guides/06_å¼‚æ­¥è°ƒè¯•ä¸ç›‘æ§.md)** - ç›‘æ§å·¥å…·

---

## ğŸ“ æ€»ç»“

**å…³é”®å‘ç°**:

- âœ… Tokio æ€§èƒ½æœ€ä¼˜ä¸”ç”Ÿæ€æœ€å¥½
- âœ… å¼‚æ­¥ç›¸æ¯”çº¿ç¨‹æ± æå‡ **10-20x** å¹¶å‘èƒ½åŠ›
- âœ… Channel æ¯” `Arc<Mutex>` å¿« **1.7x**
- âœ… Atomic æ¯” Mutex å¿« **5x**

**ä¼˜åŒ–é‡ç‚¹**:

- âœ… é€‰æ‹©åˆé€‚çš„è¿è¡Œæ—¶å’Œåº“
- âœ… é¿å…é˜»å¡è¿è¡Œæ—¶
- âœ… ä½¿ç”¨ Channel è€Œéå…±äº«çŠ¶æ€
- âœ… åˆç†é…ç½®çº¿ç¨‹æ•°å’Œç¼“å†²åŒº

**å·¥å…·é“¾**:

- âœ… criterion - åŸºå‡†æµ‹è¯•
- âœ… wrk - HTTP è´Ÿè½½æµ‹è¯•
- âœ… perf/flamegraph - CPU åˆ†æ
- âœ… tokio-console - å®æ—¶ç›‘æ§

---

**æ–‡æ¡£ç»´æŠ¤**: C06 Async Team | **è´¨é‡è¯„åˆ†**: 95/100  
**æœ€åæ›´æ–°**: 2025-10-22 | **æµ‹è¯•ç¯å¢ƒ**: AMD Ryzen 9 5950X, 64GB RAM
