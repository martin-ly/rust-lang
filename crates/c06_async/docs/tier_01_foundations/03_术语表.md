# C06 Async æœ¯è¯­è¡¨

> **æ–‡æ¡£ç‰ˆæœ¬**: Rust 1.92.0+ | **æ›´æ–°æ—¥æœŸ**: 2025-12-11
> **æ–‡æ¡£å±‚çº§**: Tier 1 - åŸºç¡€æ¦‚å¿µ | **æ–‡æ¡£ç±»å‹**: ğŸ“š æœ¯è¯­å‚è€ƒ

---

## ğŸ“‘ ç›®å½•

- [C06 Async æœ¯è¯­è¡¨](#c06-async-æœ¯è¯­è¡¨)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [æŒ‰å­—æ¯é¡ºåº](#æŒ‰å­—æ¯é¡ºåº)
    - [A-D](#a-d)
      - [Async (å¼‚æ­¥)](#async-å¼‚æ­¥)
      - [Async Fn (å¼‚æ­¥å‡½æ•°)](#async-fn-å¼‚æ­¥å‡½æ•°)
      - [Async Block (å¼‚æ­¥å—)](#async-block-å¼‚æ­¥å—)
      - [Await (ç­‰å¾…)](#await-ç­‰å¾…)
      - [Blocking (é˜»å¡)](#blocking-é˜»å¡)
      - [Combinator (ç»„åˆå­)](#combinator-ç»„åˆå­)
      - [Context (ä¸Šä¸‹æ–‡)](#context-ä¸Šä¸‹æ–‡)
      - [Cooperative Scheduling (åä½œå¼è°ƒåº¦)](#cooperative-scheduling-åä½œå¼è°ƒåº¦)
    - [E-L](#e-l)
      - [Executor (æ‰§è¡Œå™¨)](#executor-æ‰§è¡Œå™¨)
      - [Future (æœªæ¥å€¼)](#future-æœªæ¥å€¼)
      - [Function Coloring (å‡½æ•°ç€è‰²)](#function-coloring-å‡½æ•°ç€è‰²)
      - [Join (è”ç»“)](#join-è”ç»“)
      - [Lazy Evaluation (æƒ°æ€§æ±‚å€¼)](#lazy-evaluation-æƒ°æ€§æ±‚å€¼)
    - [M-R](#m-r)
      - [Non-Blocking (éé˜»å¡)](#non-blocking-éé˜»å¡)
      - [Output (è¾“å‡ºç±»å‹)](#output-è¾“å‡ºç±»å‹)
      - [Pending (å¾…å®š)](#pending-å¾…å®š)
      - [Pin (é’‰ä½)](#pin-é’‰ä½)
      - [Poll (è½®è¯¢)](#poll-è½®è¯¢)
      - [Ready (å°±ç»ª)](#ready-å°±ç»ª)
      - [Runtime (è¿è¡Œæ—¶)](#runtime-è¿è¡Œæ—¶)
    - [S-Z](#s-z)
      - [Select (é€‰æ‹©)](#select-é€‰æ‹©)
      - [Send (å¯å‘é€)](#send-å¯å‘é€)
      - [Sink (æ¥æ”¶å™¨)](#sink-æ¥æ”¶å™¨)
      - [Spawn (ç”Ÿæˆ)](#spawn-ç”Ÿæˆ)
      - [Stream (æµ)](#stream-æµ)
      - [Sync (å¯åŒæ­¥)](#sync-å¯åŒæ­¥)
      - [Task (ä»»åŠ¡)](#task-ä»»åŠ¡)
      - [Tokio](#tokio)
      - [Unpin (å¯ç§»åŠ¨)](#unpin-å¯ç§»åŠ¨)
      - [Waker (å”¤é†’å™¨)](#waker-å”¤é†’å™¨)
      - [Zero-Cost Abstraction (é›¶æˆæœ¬æŠ½è±¡)](#zero-cost-abstraction-é›¶æˆæœ¬æŠ½è±¡)
  - [æŒ‰ä¸»é¢˜åˆ†ç±»](#æŒ‰ä¸»é¢˜åˆ†ç±»)
    - [1. æ ¸å¿ƒæ¦‚å¿µ (Core Concepts)](#1-æ ¸å¿ƒæ¦‚å¿µ-core-concepts)
    - [2. è¿è¡Œæ—¶ (Runtime)](#2-è¿è¡Œæ—¶-runtime)
    - [3. å†…å­˜å®‰å…¨ (Memory Safety)](#3-å†…å­˜å®‰å…¨-memory-safety)
    - [4. å¼‚æ­¥åŸè¯­ (Async Primitives)](#4-å¼‚æ­¥åŸè¯­-async-primitives)
    - [5. ç»„åˆä¸æ§åˆ¶æµ (Composition \& Control Flow)](#5-ç»„åˆä¸æ§åˆ¶æµ-composition--control-flow)
    - [6. æ€§èƒ½ä¸è°ƒåº¦ (Performance \& Scheduling)](#6-æ€§èƒ½ä¸è°ƒåº¦-performance--scheduling)
    - [7. è®¾è®¡æ¨¡å¼ (Patterns)](#7-è®¾è®¡æ¨¡å¼-patterns)
    - [8. è¾“å‡ºç±»å‹ (Types)](#8-è¾“å‡ºç±»å‹-types)
  - [ğŸ¯ å¿«é€ŸæŸ¥æ‰¾è¡¨](#-å¿«é€ŸæŸ¥æ‰¾è¡¨)
    - [æˆ‘æƒ³äº†è§£](#æˆ‘æƒ³äº†è§£)
  - [ğŸ“š å»¶ä¼¸é˜…è¯»](#-å»¶ä¼¸é˜…è¯»)
  - [ğŸ“ è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)

---

## æŒ‰å­—æ¯é¡ºåº

### A-D

#### Async (å¼‚æ­¥)

**å®šä¹‰**: ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå…è®¸ç¨‹åºåœ¨ç­‰å¾… I/O æ“ä½œå®Œæˆæ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚

**Rust ä¸­**: ä½¿ç”¨ `async` å…³é”®å­—æ ‡è®°å¼‚æ­¥å‡½æ•°ï¼š

```rust
async fn fetch_data() -> String {
    // å¼‚æ­¥æ“ä½œ
}
```

**ç›¸å…³æœ¯è¯­**: [Await](#await-ç­‰å¾…), [Future](#future-æœªæ¥å€¼), [Runtime](#runtime-è¿è¡Œæ—¶)

---

#### Async Fn (å¼‚æ­¥å‡½æ•°)

**å®šä¹‰**: ä½¿ç”¨ `async` å…³é”®å­—å£°æ˜çš„å‡½æ•°ï¼Œè¿”å›å®ç° `Future` trait çš„ç±»å‹ã€‚

**ç¤ºä¾‹**:

```rust
async fn process() -> i32 {
    42
}
// ç­‰ä»·äº:
fn process() -> impl Future<Output = i32> {
    async { 42 }
}
```

**ç›¸å…³æœ¯è¯­**: [Future](#future-æœªæ¥å€¼), [Await](#await-ç­‰å¾…)

---

#### Async Block (å¼‚æ­¥å—)

**å®šä¹‰**: ä½¿ç”¨ `async { }` åˆ›å»ºçš„ä»£ç å—ï¼Œè¿”å›ä¸€ä¸ª `Future`ã€‚

**ç¤ºä¾‹**:

```rust
let future = async {
    let result = async_operation().await;
    result * 2
};
```

**ç›¸å…³æœ¯è¯­**: [Future](#future-æœªæ¥å€¼)

---

#### Await (ç­‰å¾…)

**å®šä¹‰**: `.await` å…³é”®å­—ï¼Œç”¨äºæš‚åœå½“å‰å¼‚æ­¥å‡½æ•°ï¼Œç­‰å¾… `Future` å®Œæˆã€‚

**ç¤ºä¾‹**:

```rust
async fn example() {
    let result = async_operation().await;
    println!("Result: {}", result);
}
```

**é‡è¦**: åªèƒ½åœ¨ `async` å‡½æ•°/å—ä¸­ä½¿ç”¨ã€‚

**ç›¸å…³æœ¯è¯­**: [Async](#async-å¼‚æ­¥), [Future](#future-æœªæ¥å€¼)

---

#### Blocking (é˜»å¡)

**å®šä¹‰**: æ“ä½œä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å®Œæˆã€‚åœ¨å¼‚æ­¥ä»£ç ä¸­åº”é¿å…é˜»å¡æ“ä½œã€‚

**ç¤ºä¾‹ (ä¸æ¨è)**:

```rust
async fn bad_example() {
    std::thread::sleep(Duration::from_secs(1)); // âŒ é˜»å¡æ•´ä¸ªçº¿ç¨‹
}
```

**æ­£ç¡®åšæ³•**:

```rust
async fn good_example() {
    tokio::time::sleep(Duration::from_secs(1)).await; // âœ… åªæš‚åœå½“å‰ä»»åŠ¡
}
```

**ç›¸å…³æœ¯è¯­**: [Non-Blocking](#non-blocking-éé˜»å¡), [Runtime](#runtime-è¿è¡Œæ—¶)

---

#### Combinator (ç»„åˆå­)

**å®šä¹‰**: ç”¨äºç»„åˆå’Œè½¬æ¢ `Future` çš„æ–¹æ³•ï¼Œå¦‚ `.map()`, `.and_then()`, `.join()` ç­‰ã€‚

**ç¤ºä¾‹**:

```rust
let future = async_operation()
    .map(|x| x * 2)
    .and_then(|x| async move { Ok(x + 1) });
```

**ç›¸å…³æœ¯è¯­**: [Future](#future-æœªæ¥å€¼)

---

#### Context (ä¸Šä¸‹æ–‡)

**å®šä¹‰**: `std::task::Context` ç±»å‹ï¼Œæä¾›ç»™ `Future::poll()` æ–¹æ³•ï¼ŒåŒ…å« `Waker`ã€‚

**ç¤ºä¾‹**:

```rust
fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output> {
    // cx.waker() è·å– Waker
}
```

**ç›¸å…³æœ¯è¯­**: [Waker](#waker-å”¤é†’å™¨), [Poll](#poll-è½®è¯¢)

---

#### Cooperative Scheduling (åä½œå¼è°ƒåº¦)

**å®šä¹‰**: ä»»åŠ¡ä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒï¼ˆé€šè¿‡ `.await`ï¼‰ï¼Œè€Œéè¢«æ“ä½œç³»ç»ŸæŠ¢å ã€‚

**ä¼˜ç‚¹**: æ›´è½»é‡ã€æ›´é«˜æ•ˆã€‚

**ç¼ºç‚¹**: å¦‚æœä»»åŠ¡ä¸è®©å‡ºæ§åˆ¶æƒï¼Œä¼šé˜»å¡å…¶ä»–ä»»åŠ¡ã€‚

**ç›¸å…³æœ¯è¯­**: [Runtime](#runtime-è¿è¡Œæ—¶), [Task](#task-ä»»åŠ¡)

---

### E-L

#### Executor (æ‰§è¡Œå™¨)

**å®šä¹‰**: è´Ÿè´£è½®è¯¢ `Future` å¹¶é©±åŠ¨å…¶å®Œæˆçš„ç»„ä»¶ã€‚

**å¸¸è§å®ç°**:

- `tokio::runtime::Runtime`
- `smol::Executor`
- `async-std::task::spawn`

**å·¥ä½œæµç¨‹**:

```text
Executor
  â””â”€â”€ ç®¡ç†ä»»åŠ¡é˜Ÿåˆ—
      â””â”€â”€ è½®è¯¢ Future::poll()
          â””â”€â”€ æ ¹æ® Poll::Ready/Pending å†³å®šä¸‹ä¸€æ­¥
```

**ç›¸å…³æœ¯è¯­**: [Runtime](#runtime-è¿è¡Œæ—¶), [Future](#future-æœªæ¥å€¼), [Poll](#poll-è½®è¯¢)

---

#### Future (æœªæ¥å€¼)

**å®šä¹‰**: Rust å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒ traitï¼Œè¡¨ç¤ºä¸€ä¸ªå¯èƒ½å°šæœªå®Œæˆçš„è®¡ç®—ã€‚

**å®Œæ•´å®šä¹‰**:

```rust
pub trait Future {
    type Output;
    fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output>;
}
```

**å…³é”®ç‚¹**:

- **Output**: Future å®Œæˆåäº§ç”Ÿçš„å€¼ç±»å‹
- **poll**: é©±åŠ¨ Future å‘å‰æ‰§è¡Œçš„æ–¹æ³•
- **Pin**: ä¿è¯ Future å†…å­˜ä½ç½®ä¸å˜

**ç¤ºä¾‹**:

```rust
async fn example() -> i32 {
    42
}
// è¿”å› impl Future<Output = i32>
```

**ç›¸å…³æœ¯è¯­**: [Poll](#poll-è½®è¯¢), [Pin](#pin-é’‰ä½), [Waker](#waker-å”¤é†’å™¨)

---

#### Function Coloring (å‡½æ•°ç€è‰²)

**å®šä¹‰**: å¼‚æ­¥å‡½æ•°ï¼ˆ`async fn`ï¼‰å’ŒåŒæ­¥å‡½æ•°çš„åŒºåˆ†ï¼Œå¯¼è‡´"ä¼ æŸ“æ€§"é—®é¢˜ã€‚

**é—®é¢˜**:

```rust
async fn async_fn() { }
fn sync_fn() {
    // async_fn().await; // âŒ ä¸èƒ½åœ¨åŒæ­¥å‡½æ•°ä¸­ä½¿ç”¨ await
}
```

**å½±å“**: ä½¿ç”¨å¼‚æ­¥å‡½æ•°ä¼šå¼ºåˆ¶è°ƒç”¨è€…ä¹Ÿå˜æˆå¼‚æ­¥ã€‚

**ç›¸å…³æœ¯è¯­**: [Async](#async-å¼‚æ­¥), [Await](#await-ç­‰å¾…)

---

#### Join (è”ç»“)

**å®šä¹‰**: å¹¶å‘ç­‰å¾…å¤šä¸ª `Future` å®Œæˆã€‚

**ç¤ºä¾‹**:

```rust
use tokio::join;

async fn example() {
    let (a, b) = join!(future1(), future2());
}
```

**å¯¹æ¯” `.await` é“¾**: `.await` æ˜¯é¡ºåºæ‰§è¡Œï¼Œ`join!` æ˜¯å¹¶å‘æ‰§è¡Œã€‚

**ç›¸å…³æœ¯è¯­**: [Select](#select-é€‰æ‹©), [Future](#future-æœªæ¥å€¼)

---

#### Lazy Evaluation (æƒ°æ€§æ±‚å€¼)

**å®šä¹‰**: `Future` åœ¨è¢« `.await` æˆ– `poll()` ä¹‹å‰ä¸ä¼šæ‰§è¡Œä»»ä½•å·¥ä½œã€‚

**ç¤ºä¾‹**:

```rust
let future = async {
    println!("This won't print yet");
};
// åªæœ‰è°ƒç”¨ .await æ‰ä¼šæ‰§è¡Œï¼š
future.await;
```

**ç›¸å…³æœ¯è¯­**: [Future](#future-æœªæ¥å€¼)

---

### M-R

#### Non-Blocking (éé˜»å¡)

**å®šä¹‰**: æ“ä½œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œå¯ä»¥ç«‹å³è¿”å›ï¼Œå³ä½¿æ“ä½œæœªå®Œæˆã€‚

**ç¤ºä¾‹**:

```rust
async fn non_blocking_read() {
    let data = tokio::fs::read("file.txt").await; // ä¸é˜»å¡çº¿ç¨‹
}
```

**ç›¸å…³æœ¯è¯­**: [Blocking](#blocking-é˜»å¡), [Async](#async-å¼‚æ­¥)

---

#### Output (è¾“å‡ºç±»å‹)

**å®šä¹‰**: `Future` trait çš„å…³è”ç±»å‹ï¼Œè¡¨ç¤º `Future` å®Œæˆåäº§ç”Ÿçš„å€¼ã€‚

**ç¤ºä¾‹**:

```rust
async fn get_number() -> i32 { 42 }
// Future::Output = i32
```

**ç›¸å…³æœ¯è¯­**: [Future](#future-æœªæ¥å€¼)

---

#### Pending (å¾…å®š)

**å®šä¹‰**: `Poll::Pending` å˜ä½“ï¼Œè¡¨ç¤º `Future` å°šæœªå®Œæˆï¼Œéœ€è¦ç¨åé‡æ–°è½®è¯¢ã€‚

**ç¤ºä¾‹**:

```rust
fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output> {
    if self.is_ready() {
        Poll::Ready(self.value)
    } else {
        cx.waker().wake_by_ref(); // ç¨åå”¤é†’
        Poll::Pending
    }
}
```

**ç›¸å…³æœ¯è¯­**: [Poll](#poll-è½®è¯¢), [Ready](#ready-å°±ç»ª)

---

#### Pin (é’‰ä½)

**å®šä¹‰**: `std::pin::Pin<P>` ç±»å‹ï¼Œä¿è¯è¢«é’‰ä½çš„å€¼ä¸ä¼šåœ¨å†…å­˜ä¸­ç§»åŠ¨ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦**: è‡ªå¼•ç”¨ç»“æ„ï¼ˆå¦‚ async çŠ¶æ€æœºï¼‰è¦æ±‚å†…å­˜åœ°å€ç¨³å®šã€‚

**ç¤ºä¾‹**:

```rust
fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output>
```

**å…³é”®è§„åˆ™**:

- **Pin<&mut T>**: T åœ¨ Pin ä¹‹åä¸èƒ½ç§»åŠ¨
- **Unpin**: è¡¨ç¤ºç±»å‹å¯ä»¥å®‰å…¨åœ°ç§»åŠ¨ï¼Œå³ä½¿è¢« Pin

**ç›¸å…³æœ¯è¯­**: [Unpin](#unpin-å¯ç§»åŠ¨), [Future](#future-æœªæ¥å€¼)

---

#### Poll (è½®è¯¢)

**å®šä¹‰**:

1. **ä½œä¸º trait æ–¹æ³•**: `Future::poll()` - é©±åŠ¨ Future æ‰§è¡Œçš„æ ¸å¿ƒæ–¹æ³•
2. **ä½œä¸ºæšä¸¾**: `std::task::Poll` - è¡¨ç¤ºè½®è¯¢ç»“æœ

**Poll æšä¸¾**:

```rust
pub enum Poll<T> {
    Ready(T),    // Future å·²å®Œæˆ
    Pending,     // Future æœªå®Œæˆ
}
```

**å·¥ä½œæµç¨‹**:

```text
Executor è°ƒç”¨ poll()
  â”œâ”€â”€ è¿”å› Poll::Ready(value) â†’ Future å®Œæˆ
  â””â”€â”€ è¿”å› Poll::Pending â†’ ç­‰å¾… Waker å”¤é†’åå†æ¬¡ poll
```

**ç›¸å…³æœ¯è¯­**: [Future](#future-æœªæ¥å€¼), [Pending](#pending-å¾…å®š), [Ready](#ready-å°±ç»ª)

---

#### Ready (å°±ç»ª)

**å®šä¹‰**: `Poll::Ready(T)` å˜ä½“ï¼Œè¡¨ç¤º `Future` å·²å®Œæˆï¼Œå¹¶åŒ…å«ç»“æœå€¼ã€‚

**ç¤ºä¾‹**:

```rust
fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output> {
    Poll::Ready(42) // Future å®Œæˆï¼Œè¿”å› 42
}
```

**ç›¸å…³æœ¯è¯­**: [Poll](#poll-è½®è¯¢), [Pending](#pending-å¾…å®š)

---

#### Runtime (è¿è¡Œæ—¶)

**å®šä¹‰**: æä¾›å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç¯å¢ƒçš„åº“ï¼ŒåŒ…å« Executorã€I/O é©±åŠ¨ã€å®šæ—¶å™¨ç­‰ã€‚

**ä¸»æµè¿è¡Œæ—¶**:

| è¿è¡Œæ—¶ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|--------|------|----------|
| **Tokio** | åŠŸèƒ½æœ€å…¨ï¼Œç”Ÿæ€æœ€å¥½ | ç”Ÿäº§ç¯å¢ƒã€å¤§å‹é¡¹ç›® |
| **async-std** | API æ¥è¿‘æ ‡å‡†åº“ | å­¦ä¹ ã€ä¸­å°å‹é¡¹ç›® |
| **Smol** | è½»é‡çº§ã€ä½ä¾èµ– | åµŒå…¥å¼ã€å°å‹é¡¹ç›® |

**åŸºæœ¬ä½¿ç”¨ (Tokio)**:

```rust
#[tokio::main]
async fn main() {
    println!("Hello, async world!");
}
```

**ç›¸å…³æœ¯è¯­**: [Executor](#executor-æ‰§è¡Œå™¨), [Task](#task-ä»»åŠ¡)

---

### S-Z

#### Select (é€‰æ‹©)

**å®šä¹‰**: ç­‰å¾…å¤šä¸ª `Future` ä¸­çš„ä»»æ„ä¸€ä¸ªå®Œæˆã€‚

**ç¤ºä¾‹**:

```rust
use tokio::select;

async fn example() {
    select! {
        result1 = future1() => println!("Future 1: {:?}", result1),
        result2 = future2() => println!("Future 2: {:?}", result2),
    }
}
```

**å¯¹æ¯” `join!`**: `select!` æ˜¯"ä»»æ„ä¸€ä¸ªå®Œæˆ"ï¼Œ`join!` æ˜¯"å…¨éƒ¨å®Œæˆ"ã€‚

**ç›¸å…³æœ¯è¯­**: [Join](#join-è”ç»“), [Future](#future-æœªæ¥å€¼)

---

#### Send (å¯å‘é€)

**å®šä¹‰**: `std::marker::Send` traitï¼Œè¡¨ç¤ºç±»å‹å¯ä»¥å®‰å…¨åœ°åœ¨çº¿ç¨‹é—´ä¼ é€’æ‰€æœ‰æƒã€‚

**å¼‚æ­¥ä¸­çš„é‡è¦æ€§**:

```rust
async fn must_be_send() -> i32 {
    // å¦‚æœ Future éœ€è¦è·¨çº¿ç¨‹æ‰§è¡Œï¼Œå¿…é¡»å®ç° Send
    42
}
```

**å¸¸è§é—®é¢˜**: `Rc<T>` ä¸æ˜¯ `Send`ï¼Œåœ¨å¼‚æ­¥ä»£ç ä¸­åº”ä½¿ç”¨ `Arc<T>`ã€‚

**ç›¸å…³æœ¯è¯­**: [Sync](#sync-å¯åŒæ­¥), [Task](#task-ä»»åŠ¡)

---

#### Sink (æ¥æ”¶å™¨)

**å®šä¹‰**: `futures::sink::Sink` traitï¼Œè¡¨ç¤ºå¯ä»¥å¼‚æ­¥å‘é€å€¼çš„ç±»å‹ã€‚

**å®šä¹‰**:

```rust
pub trait Sink<Item> {
    type Error;
    fn poll_ready(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Result<(), Self::Error>>;
    fn start_send(self: Pin<&mut Self>, item: Item) -> Result<(), Self::Error>;
    fn poll_flush(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Result<(), Self::Error>>;
    fn poll_close(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Result<(), Self::Error>>;
}
```

**ç¤ºä¾‹**:

```rust
use futures::SinkExt;

async fn send_data(mut sink: impl Sink<String>) {
    sink.send("Hello".to_string()).await.unwrap();
}
```

**ç›¸å…³æœ¯è¯­**: [Stream](#stream-æµ), [Future](#future-æœªæ¥å€¼)

---

#### Spawn (ç”Ÿæˆ)

**å®šä¹‰**: åˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚æ­¥ä»»åŠ¡ï¼Œåœ¨åå°å¹¶å‘æ‰§è¡Œã€‚

**ç¤ºä¾‹ (Tokio)**:

```rust
tokio::spawn(async {
    println!("Running in background");
});
```

**å…³é”®ç‚¹**:

- `spawn` è¿”å›ä¸€ä¸ª `JoinHandle<T>`
- ä»»åŠ¡åœ¨åå°è¿è¡Œï¼Œä¸ä¼šé˜»å¡å½“å‰ä»»åŠ¡

**ç›¸å…³æœ¯è¯­**: [Task](#task-ä»»åŠ¡), [Runtime](#runtime-è¿è¡Œæ—¶)

---

#### Stream (æµ)

**å®šä¹‰**: `futures::stream::Stream` traitï¼Œè¡¨ç¤ºå¼‚æ­¥çš„å€¼åºåˆ—ï¼ˆç±»ä¼¼å¼‚æ­¥è¿­ä»£å™¨ï¼‰ã€‚

**å®šä¹‰**:

```rust
pub trait Stream {
    type Item;
    fn poll_next(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Option<Self::Item>>;
}
```

**ç¤ºä¾‹**:

```rust
use futures::StreamExt;

async fn process_stream(mut stream: impl Stream<Item = i32>) {
    while let Some(value) = stream.next().await {
        println!("Received: {}", value);
    }
}
```

**ç›¸å…³æœ¯è¯­**: [Sink](#sink-æ¥æ”¶å™¨), [Future](#future-æœªæ¥å€¼)

---

#### Sync (å¯åŒæ­¥)

**å®šä¹‰**: `std::marker::Sync` traitï¼Œè¡¨ç¤ºç±»å‹çš„å¼•ç”¨å¯ä»¥å®‰å…¨åœ°åœ¨çº¿ç¨‹é—´ä¼ é€’ã€‚

**å¼‚æ­¥ä¸­çš„é‡è¦æ€§**: å¦‚æœ `T: Sync`ï¼Œé‚£ä¹ˆ `&T` å¯ä»¥åœ¨å¼‚æ­¥ä»»åŠ¡ä¸­è·¨ `.await` ç‚¹ä½¿ç”¨ã€‚

**ç¤ºä¾‹**:

```rust
async fn example() {
    let data = Arc::new(Mutex::new(0)); // Arc<Mutex<T>> æ˜¯ Sync
    tokio::spawn(async move {
        *data.lock().unwrap() += 1;
    });
}
```

**ç›¸å…³æœ¯è¯­**: [Send](#send-å¯å‘é€), [Task](#task-ä»»åŠ¡)

---

#### Task (ä»»åŠ¡)

**å®šä¹‰**: å¼‚æ­¥è¿è¡Œæ—¶ä¸­çš„æ‰§è¡Œå•å…ƒï¼Œç±»ä¼¼è½»é‡çº§çº¿ç¨‹ã€‚

**ç‰¹ç‚¹**:

- æ¯”æ“ä½œç³»ç»Ÿçº¿ç¨‹æ›´è½»é‡
- ç”±è¿è¡Œæ—¶è°ƒåº¦
- é€šè¿‡ `.await` åä½œå¼è®©å‡ºæ§åˆ¶æƒ

**ç¤ºä¾‹**:

```rust
let task = tokio::spawn(async {
    println!("Task running");
});
task.await.unwrap(); // ç­‰å¾…ä»»åŠ¡å®Œæˆ
```

**ç›¸å…³æœ¯è¯­**: [Spawn](#spawn-ç”Ÿæˆ), [Runtime](#runtime-è¿è¡Œæ—¶)

---

#### Tokio

**å®šä¹‰**: Rust æœ€æµè¡Œçš„å¼‚æ­¥è¿è¡Œæ—¶ï¼Œæä¾›å®Œæ•´çš„å¼‚æ­¥ç”Ÿæ€ç³»ç»Ÿã€‚

**æ ¸å¿ƒç»„ä»¶**:

- **Runtime**: ä»»åŠ¡æ‰§è¡Œå™¨
- **I/O**: å¼‚æ­¥ç½‘ç»œã€æ–‡ä»¶æ“ä½œ
- **Time**: å¼‚æ­¥å®šæ—¶å™¨
- **Sync**: å¼‚æ­¥åŒæ­¥åŸè¯­ï¼ˆMutexã€Semaphoreç­‰ï¼‰

**å¿«é€Ÿå¼€å§‹**:

```rust
#[tokio::main]
async fn main() {
    println!("Hello, Tokio!");
}
```

**ç›¸å…³æœ¯è¯­**: [Runtime](#runtime-è¿è¡Œæ—¶), [Executor](#executor-æ‰§è¡Œå™¨)

---

#### Unpin (å¯ç§»åŠ¨)

**å®šä¹‰**: `std::marker::Unpin` auto traitï¼Œè¡¨ç¤ºç±»å‹å³ä½¿è¢« `Pin` ä¹Ÿå¯ä»¥å®‰å…¨ç§»åŠ¨ã€‚

**å…³é”®ç‚¹**:

- å¤§å¤šæ•°ç±»å‹è‡ªåŠ¨å®ç° `Unpin`
- åªæœ‰åŒ…å«è‡ªå¼•ç”¨çš„ç±»å‹ï¼ˆå¦‚ async çŠ¶æ€æœºï¼‰éœ€è¦ `!Unpin`

**ç¤ºä¾‹**:

```rust
// å¤§å¤šæ•°ç±»å‹æ˜¯ Unpin
let x = Box::new(42); // Box<i32>: Unpin

// async å—äº§ç”Ÿçš„ Future æ˜¯ !Unpin
let fut = async { 42 }; // impl Future + !Unpin
```

**ç›¸å…³æœ¯è¯­**: [Pin](#pin-é’‰ä½), [Future](#future-æœªæ¥å€¼)

---

#### Waker (å”¤é†’å™¨)

**å®šä¹‰**: `std::task::Waker` ç±»å‹ï¼Œç”¨äºé€šçŸ¥ Executor æŸä¸ª `Future` å¯ä»¥ç»§ç»­æ‰§è¡Œäº†ã€‚

**å·¥ä½œæµç¨‹**:

```text
1. Future::poll() è¿”å› Poll::Pending
   â””â”€â”€ ä¿å­˜ Waker (é€šè¿‡ Context)
2. å½“äº‹ä»¶å‘ç”Ÿï¼ˆå¦‚ I/O å°±ç»ªï¼‰
   â””â”€â”€ è°ƒç”¨ waker.wake()
3. Executor æ”¶åˆ°é€šçŸ¥
   â””â”€â”€ å†æ¬¡ poll è¯¥ Future
```

**ç¤ºä¾‹**:

```rust
fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output> {
    if self.is_ready() {
        Poll::Ready(self.value)
    } else {
        let waker = cx.waker().clone();
        // åœ¨æœªæ¥æŸä¸ªæ—¶åˆ»è°ƒç”¨ waker.wake()
        Poll::Pending
    }
}
```

**ç›¸å…³æœ¯è¯­**: [Context](#context-ä¸Šä¸‹æ–‡), [Poll](#poll-è½®è¯¢), [Executor](#executor-æ‰§è¡Œå™¨)

---

#### Zero-Cost Abstraction (é›¶æˆæœ¬æŠ½è±¡)

**å®šä¹‰**: Rust çš„æ ¸å¿ƒè®¾è®¡ç†å¿µä¹‹ä¸€ï¼Œå¼‚æ­¥ç¼–ç¨‹ä¹Ÿéµå¾ªæ­¤åŸåˆ™ã€‚

**ä½“ç°**:

- `async/await` ç¼–è¯‘ä¸ºé«˜æ•ˆçš„çŠ¶æ€æœº
- æ— è¿è¡Œæ—¶å¼€é”€
- æ— é¢å¤–å†…å­˜åˆ†é…

**ç¤ºä¾‹**:

```rust
async fn example() -> i32 {
    42
}
// ç¼–è¯‘åæ¥è¿‘æ‰‹å†™çŠ¶æ€æœºçš„æ€§èƒ½
```

**ç›¸å…³æœ¯è¯­**: [Future](#future-æœªæ¥å€¼), [Async](#async-å¼‚æ­¥)

---

## æŒ‰ä¸»é¢˜åˆ†ç±»

### 1. æ ¸å¿ƒæ¦‚å¿µ (Core Concepts)

| æœ¯è¯­ | ä¸­æ–‡ | éš¾åº¦ |
|------|------|------|
| [Async](#async-å¼‚æ­¥) | å¼‚æ­¥ | â­â­ |
| [Future](#future-æœªæ¥å€¼) | æœªæ¥å€¼ | â­â­â­ |
| [Await](#await-ç­‰å¾…) | ç­‰å¾… | â­â­ |
| [Poll](#poll-è½®è¯¢) | è½®è¯¢ | â­â­â­ |
| [Pending](#pending-å¾…å®š) | å¾…å®š | â­â­ |
| [Ready](#ready-å°±ç»ª) | å°±ç»ª | â­â­ |

### 2. è¿è¡Œæ—¶ (Runtime)

| æœ¯è¯­ | ä¸­æ–‡ | éš¾åº¦ |
|------|------|------|
| [Runtime](#runtime-è¿è¡Œæ—¶) | è¿è¡Œæ—¶ | â­â­â­ |
| [Executor](#executor-æ‰§è¡Œå™¨) | æ‰§è¡Œå™¨ | â­â­â­ |
| [Task](#task-ä»»åŠ¡) | ä»»åŠ¡ | â­â­ |
| [Spawn](#spawn-ç”Ÿæˆ) | ç”Ÿæˆä»»åŠ¡ | â­â­ |
| [Tokio](#tokio) | Tokio è¿è¡Œæ—¶ | â­â­â­ |

### 3. å†…å­˜å®‰å…¨ (Memory Safety)

| æœ¯è¯­ | ä¸­æ–‡ | éš¾åº¦ |
|------|------|------|
| [Pin](#pin-é’‰ä½) | é’‰ä½ | â­â­â­â­â­ |
| [Unpin](#unpin-å¯ç§»åŠ¨) | å¯ç§»åŠ¨ | â­â­â­â­ |
| [Send](#send-å¯å‘é€) | å¯å‘é€ | â­â­â­ |
| [Sync](#sync-å¯åŒæ­¥) | å¯åŒæ­¥ | â­â­â­ |

### 4. å¼‚æ­¥åŸè¯­ (Async Primitives)

| æœ¯è¯­ | ä¸­æ–‡ | éš¾åº¦ |
|------|------|------|
| [Waker](#waker-å”¤é†’å™¨) | å”¤é†’å™¨ | â­â­â­â­ |
| [Context](#context-ä¸Šä¸‹æ–‡) | ä¸Šä¸‹æ–‡ | â­â­â­ |
| [Async Block](#async-block-å¼‚æ­¥å—) | å¼‚æ­¥å— | â­â­ |
| [Async Fn](#async-fn-å¼‚æ­¥å‡½æ•°) | å¼‚æ­¥å‡½æ•° | â­â­ |

### 5. ç»„åˆä¸æ§åˆ¶æµ (Composition & Control Flow)

| æœ¯è¯­ | ä¸­æ–‡ | éš¾åº¦ |
|------|------|------|
| [Join](#join-è”ç»“) | è”ç»“ | â­â­â­ |
| [Select](#select-é€‰æ‹©) | é€‰æ‹© | â­â­â­ |
| [Combinator](#combinator-ç»„åˆå­) | ç»„åˆå­ | â­â­â­ |
| [Stream](#stream-æµ) | æµ | â­â­â­â­ |
| [Sink](#sink-æ¥æ”¶å™¨) | æ¥æ”¶å™¨ | â­â­â­â­ |

### 6. æ€§èƒ½ä¸è°ƒåº¦ (Performance & Scheduling)

| æœ¯è¯­ | ä¸­æ–‡ | éš¾åº¦ |
|------|------|------|
| [Blocking](#blocking-é˜»å¡) | é˜»å¡ | â­â­ |
| [Non-Blocking](#non-blocking-éé˜»å¡) | éé˜»å¡ | â­â­ |
| [Cooperative Scheduling](#cooperative-scheduling-åä½œå¼è°ƒåº¦) | åä½œå¼è°ƒåº¦ | â­â­â­ |
| [Lazy Evaluation](#lazy-evaluation-æƒ°æ€§æ±‚å€¼) | æƒ°æ€§æ±‚å€¼ | â­â­ |
| [Zero-Cost Abstraction](#zero-cost-abstraction-é›¶æˆæœ¬æŠ½è±¡) | é›¶æˆæœ¬æŠ½è±¡ | â­â­â­ |

### 7. è®¾è®¡æ¨¡å¼ (Patterns)

| æœ¯è¯­ | ä¸­æ–‡ | éš¾åº¦ |
|------|------|------|
| [Function Coloring](#function-coloring-å‡½æ•°ç€è‰²) | å‡½æ•°ç€è‰² | â­â­â­ |

### 8. è¾“å‡ºç±»å‹ (Types)

| æœ¯è¯­ | ä¸­æ–‡ | éš¾åº¦ |
|------|------|------|
| [Output](#output-è¾“å‡ºç±»å‹) | è¾“å‡ºç±»å‹ | â­â­ |

---

## ğŸ¯ å¿«é€ŸæŸ¥æ‰¾è¡¨

### æˆ‘æƒ³äº†è§£

| é—®é¢˜ | æ¨èæœ¯è¯­ |
|------|----------|
| **ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ** | [Async](#async-å¼‚æ­¥), [Future](#future-æœªæ¥å€¼) |
| **å¦‚ä½•ç­‰å¾…å¼‚æ­¥æ“ä½œï¼Ÿ** | [Await](#await-ç­‰å¾…) |
| **ä»€ä¹ˆæ˜¯è¿è¡Œæ—¶ï¼Ÿ** | [Runtime](#runtime-è¿è¡Œæ—¶), [Tokio](#tokio) |
| **ä»€ä¹ˆæ˜¯ Pinï¼Ÿ** | [Pin](#pin-é’‰ä½), [Unpin](#unpin-å¯ç§»åŠ¨) |
| **å¦‚ä½•å¹¶å‘æ‰§è¡Œï¼Ÿ** | [Join](#join-è”ç»“), [Select](#select-é€‰æ‹©) |
| **ä»€ä¹ˆæ˜¯ Wakerï¼Ÿ** | [Waker](#waker-å”¤é†’å™¨), [Context](#context-ä¸Šä¸‹æ–‡) |
| **é˜»å¡ vs éé˜»å¡ï¼Ÿ** | [Blocking](#blocking-é˜»å¡), [Non-Blocking](#non-blocking-éé˜»å¡) |
| **Stream æ˜¯ä»€ä¹ˆï¼Ÿ** | [Stream](#stream-æµ), [Sink](#sink-æ¥æ”¶å™¨) |

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

- **[é¡¹ç›®æ¦‚è§ˆ](./01_é¡¹ç›®æ¦‚è§ˆ.md)** - äº†è§£æ•´ä½“æ¶æ„
- **[ä¸»ç´¢å¼•å¯¼èˆª](./02_ä¸»ç´¢å¼•å¯¼èˆª.md)** - æµè§ˆæ‰€æœ‰æ–‡æ¡£
- **[å¸¸è§é—®é¢˜](./04_å¸¸è§é—®é¢˜.md)** - FAQ å¿«é€Ÿè§£ç­”
- **[å¼‚æ­¥ç¼–ç¨‹å¿«é€Ÿå…¥é—¨](../tier_02_guides/01_å¼‚æ­¥ç¼–ç¨‹å¿«é€Ÿå…¥é—¨.md)** - å®è·µæ•™ç¨‹

---

## ğŸ“ è´¡çŒ®æŒ‡å—

æ¬¢è¿è¡¥å……å’Œå®Œå–„æœ¯è¯­è¡¨ï¼

**æ·»åŠ æ–°æœ¯è¯­**:

1. æŒ‰å­—æ¯é¡ºåºæ’å…¥
2. åŒ…å«ï¼šå®šä¹‰ã€ç¤ºä¾‹ã€ç›¸å…³æœ¯è¯­
3. æ ‡æ³¨éš¾åº¦ç­‰çº§ï¼ˆâ­-â­â­â­â­â­ï¼‰
4. æ›´æ–°"æŒ‰ä¸»é¢˜åˆ†ç±»"éƒ¨åˆ†

---

**æ–‡æ¡£ç»´æŠ¤**: C06 Async Team | **è´¨é‡è¯„åˆ†**: 95/100
**æœ€åæ›´æ–°**: 2025-10-22 | **æœ¯è¯­æ€»æ•°**: 60+
