# è¿è¡Œæ—¶æŒ‡å— (Runtimes)

æœ¬ç›®å½•åŒ…å«Rustä¸»æµå¼‚æ­¥è¿è¡Œæ—¶çš„å¯¹æ¯”åˆ†æã€æœ€ä½³å®è·µå’Œä½¿ç”¨æŒ‡å—ã€‚

## ğŸ“š æ–‡æ¡£åˆ—è¡¨

### [01_comparison_2025.md](./01_comparison_2025.md) - è¿è¡Œæ—¶å¯¹æ¯” â­â­â­â­â­

**å¿…è¯»æ–‡æ¡£**:

2025å¹´æœ€æ–°è¿è¡Œæ—¶å…¨é¢å¯¹æ¯”ï¼š

- Tokio vs async-std vs Smol
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- åŠŸèƒ½ç‰¹æ€§å¯¹æ¯”
- ç”Ÿæ€ç³»ç»Ÿæˆç†Ÿåº¦
- é€‰æ‹©å†³ç­–æ ‘

**é€‚åˆ**: é€‰æ‹©è¿è¡Œæ—¶å‰å¿…è¯»

---

### [02_tokio_best_practices.md](./02_tokio_best_practices.md) - Tokioæœ€ä½³å®è·µ â­â­â­â­

**ç”Ÿäº§ç¯å¢ƒæ¨è**:

Tokioè¿è¡Œæ—¶æœ€ä½³å®è·µï¼š

- è¿è¡Œæ—¶é…ç½®ä¼˜åŒ–
- ä»»åŠ¡ç®¡ç†ç­–ç•¥
- èµ„æºæ§åˆ¶
- ç›‘æ§å’Œè°ƒè¯•
- å¸¸è§é™·é˜±

**é€‚åˆ**: ä½¿ç”¨Tokioçš„ç”Ÿäº§é¡¹ç›®

---

### [03_smol_best_practices.md](./03_smol_best_practices.md) - Smolæœ€ä½³å®è·µ â­â­â­

**è½»é‡çº§æ–¹æ¡ˆ**:

Smolè¿è¡Œæ—¶æœ€ä½³å®è·µï¼š

- æç®€é…ç½®
- åµŒå…¥å¼åº”ç”¨
- ä½èµ„æºæ¶ˆè€—ä¼˜åŒ–
- ä¸å…¶ä»–è¿è¡Œæ—¶å¯¹æ¯”

**é€‚åˆ**: åµŒå…¥å¼æˆ–è½»é‡çº§åº”ç”¨

---

### [04_cookbook.md](./04_cookbook.md) - å®æˆ˜æ‰‹å†Œ â­â­â­â­

**å®ç”¨å‚è€ƒ**:

Tokioå’ŒSmolå®æˆ˜ä»£ç ç¤ºä¾‹ï¼š

- å¸¸è§ä½¿ç”¨åœºæ™¯
- ä»£ç æ¨¡æ¿
- æœ€ä½³å®è·µä»£ç 
- æ€§èƒ½ä¼˜åŒ–æŠ€å·§

**é€‚åˆ**: æ—¥å¸¸å¼€å‘å‚è€ƒ

---

## ğŸ¯ è¿è¡Œæ—¶é€‰æ‹©æŒ‡å—

### å¿«é€Ÿå†³ç­–æ ‘

```text
éœ€è¦é€‰æ‹©è¿è¡Œæ—¶ï¼Ÿ
â”‚
â”œâ”€ ç”Ÿäº§ç¯å¢ƒWebæœåŠ¡ï¼Ÿ
â”‚  â””â”€ âœ… Tokio (æˆç†Ÿã€é«˜æ€§èƒ½ã€ç”Ÿæ€ä¸°å¯Œ)
â”‚
â”œâ”€ å­¦ä¹ å¼‚æ­¥ç¼–ç¨‹ï¼Ÿ
â”‚  â””â”€ âœ… async-std (APIç±»ä¼¼æ ‡å‡†åº“ï¼Œæ˜“å­¦)
â”‚
â”œâ”€ åµŒå…¥å¼æˆ–èµ„æºå—é™ï¼Ÿ
â”‚  â””â”€ âœ… Smol (æè½»é‡ï¼Œ~1500è¡Œä»£ç )
â”‚
â””â”€ éœ€è¦è‡ªå®šä¹‰è¿è¡Œæ—¶ï¼Ÿ
   â””â”€ âœ… å‚è€ƒ [../core/02_runtime_and_execution_model.md](../core/02_runtime_and_execution_model.md)
```

---

## ğŸ“Š è¿è¡Œæ—¶å¯¹æ¯”é€Ÿè§ˆ

| ç‰¹æ€§ | Tokio | async-std | Smol |
|------|-------|-----------|------|
| **æˆç†Ÿåº¦** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| **æ€§èƒ½** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| **ç”Ÿæ€** | â­â­â­â­â­ | â­â­â­ | â­â­ |
| **æ˜“ç”¨æ€§** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­ |
| **ä½“ç§¯** | å¤§ | ä¸­ | å° |
| **å­¦ä¹ æ›²çº¿** | ä¸­ç­‰ | å¹³ç¼“ | é™¡å³­ |

è¯¦ç»†å¯¹æ¯”è§ [01_comparison_2025.md](./01_comparison_2025.md)

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### Tokio - ç”Ÿäº§é¦–é€‰

**ä¼˜åŠ¿**:

- æ€§èƒ½æœ€ä¼˜
- ç”Ÿæ€æœ€ä¸°å¯Œï¼ˆAxum, Tonic, etc.ï¼‰
- ä¼ä¸šçº§æ”¯æŒ
- ç›‘æ§å·¥å…·å®Œå–„ï¼ˆtokio-consoleï¼‰

**é€‚ç”¨åœºæ™¯**:

- WebæœåŠ¡å™¨
- gRPCæœåŠ¡
- WebSocketæœåŠ¡
- é«˜æ€§èƒ½ä»£ç†

**ç¤ºä¾‹**:

```rust
#[tokio::main]
async fn main() {
    // Tokioä»£ç 
}
```

---

### async-std - å­¦ä¹ å‹å¥½

**ä¼˜åŠ¿**:

- APIè®¾è®¡ç±»ä¼¼æ ‡å‡†åº“
- å­¦ä¹ æ›²çº¿å¹³ç¼“
- æ–‡æ¡£ä¼˜ç§€
- é€‚åˆæ•™å­¦

**é€‚ç”¨åœºæ™¯**:

- å­¦ä¹ é¡¹ç›®
- åŸå‹å¼€å‘
- ä¸éœ€è¦æè‡´æ€§èƒ½çš„åº”ç”¨

**ç¤ºä¾‹**:

```rust
use async_std::task;

fn main() {
    task::block_on(async {
        // async-stdä»£ç 
    });
}
```

---

### Smol - è½»é‡ä¹‹é€‰

**ä¼˜åŠ¿**:

- ä»£ç é‡æå°ï¼ˆ~1500è¡Œï¼‰
- èµ„æºæ¶ˆè€—ä½
- é€‚åˆåµŒå…¥å¼
- æ˜“äºç†è§£å®ç°

**é€‚ç”¨åœºæ™¯**:

- åµŒå…¥å¼ç³»ç»Ÿ
- CLIå·¥å…·
- å­¦ä¹ è¿è¡Œæ—¶åŸç†
- éœ€è¦è‡ªå®šä¹‰è¿è¡Œæ—¶

**ç¤ºä¾‹**:

```rust
use smol;

fn main() {
    smol::block_on(async {
        // Smolä»£ç 
    });
}
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Tokio

```toml
[dependencies]
tokio = { version = "1.35", features = ["full"] }
```

```rust
#[tokio::main]
async fn main() {
    println!("Hello from Tokio!");
}
```

### async-std

```toml
[dependencies]
async-std = { version = "1.12", features = ["attributes"] }
```

```rust
#[async_std::main]
async fn main() {
    println!("Hello from async-std!");
}
```

### Smol

```toml
[dependencies]
smol = "2.0"
```

```rust
fn main() {
    smol::block_on(async {
        println!("Hello from Smol!");
    });
}
```

---

## ğŸ“– ç›¸å…³èµ„æº

### æœ¬æ¨¡å—èµ„æº

- [../guides/](../guides/) - åŸºç¡€å­¦ä¹ æŒ‡å—
- [../core/02_runtime_and_execution_model.md](../core/02_runtime_and_execution_model.md) - è¿è¡Œæ—¶åŸç†
- [../performance/](../performance/) - æ€§èƒ½ä¼˜åŒ–æŒ‡å—

### å¤–éƒ¨èµ„æº

- [Tokioå®˜æ–¹æ–‡æ¡£](https://tokio.rs/)
- [async-stdå®˜æ–¹æ–‡æ¡£](https://async.rs/)
- [Smolå®˜æ–¹æ–‡æ¡£](https://docs.rs/smol/)

### ç¤ºä¾‹ä»£ç 

```bash
cd ../../examples/runtimes/
cargo run --example tokio_basic
cargo run --example async_std_basic
cargo run --example smol_basic
```

---

## âš ï¸ å¸¸è§é™·é˜±

### 1. è¿è¡Œæ—¶ä¸å…¼å®¹

```rust
// âŒ é”™è¯¯ï¼šæ··ç”¨ä¸åŒè¿è¡Œæ—¶
#[tokio::main]
async fn main() {
    async_std::task::sleep(...).await; // ä¸å…¼å®¹ï¼
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨åŒä¸€è¿è¡Œæ—¶çš„API
#[tokio::main]
async fn main() {
    tokio::time::sleep(...).await;
}
```

### 2. é˜»å¡è¿è¡Œæ—¶

```rust
// âŒ é”™è¯¯ï¼šåœ¨å¼‚æ­¥ä¸Šä¸‹æ–‡é˜»å¡
async fn bad() {
    std::thread::sleep(...); // ä¼šé˜»å¡æ•´ä¸ªçº¿ç¨‹ï¼
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨spawn_blocking
async fn good() {
    tokio::task::spawn_blocking(|| {
        std::thread::sleep(...);
    }).await;
}
```

### 3. è¿‡åº¦ä½¿ç”¨spawn

```rust
// âŒ ä½æ•ˆï¼šè¿‡åº¦spawn
for i in 0..1000 {
    tokio::spawn(async move {
        do_work(i).await;
    });
}

// âœ… æ›´å¥½ï¼šæ‰¹é‡å¤„ç†
use futures::future::join_all;
let tasks: Vec<_> = (0..1000)
    .map(|i| do_work(i))
    .collect();
join_all(tasks).await;
```

---

## ğŸ“ æœ€ä½³å®è·µæ€»ç»“

### é…ç½®

- âœ… æ ¹æ®è´Ÿè½½è°ƒæ•´workerçº¿ç¨‹æ•°
- âœ… é…ç½®åˆç†çš„å †æ ˆå¤§å°
- âœ… å¯ç”¨æ‰€éœ€çš„featureå³å¯

### ä»»åŠ¡ç®¡ç†

- âœ… åˆç†ä½¿ç”¨spawnå’Œjoin
- âœ… é¿å…åˆ›å»ºè¿‡å¤šä»»åŠ¡
- âœ… åŠæ—¶å–æ¶ˆä¸éœ€è¦çš„ä»»åŠ¡

### èµ„æºæ§åˆ¶

- âœ… ä½¿ç”¨è¿æ¥æ± 
- âœ… é™åˆ¶å¹¶å‘æ•°ï¼ˆSemaphoreï¼‰
- âœ… è®¾ç½®è¶…æ—¶

### ç›‘æ§è°ƒè¯•

- âœ… ä½¿ç”¨tokio-consoleç›‘æ§
- âœ… æ·»åŠ åˆé€‚çš„æ—¥å¿—
- âœ… æ€§èƒ½åˆ†æå·¥å…·

---

## ğŸ”„ è¿è¡Œæ—¶è¿ç§»

ä»ä¸€ä¸ªè¿è¡Œæ—¶è¿ç§»åˆ°å¦ä¸€ä¸ªï¼Ÿ

### Tokio â†’ async-std

ä¸»è¦APIå·®å¼‚ï¼š

- `tokio::main` â†’ `async_std::main`
- `tokio::spawn` â†’ `async_std::task::spawn`
- `tokio::time::sleep` â†’ `async_std::task::sleep`

### async-std â†’ Tokio

åå‘è¿ç§»é€šå¸¸æ˜¯ä¸ºäº†æ€§èƒ½æˆ–ç”Ÿæ€ç³»ç»Ÿã€‚

### é€šç”¨æŠ½è±¡

è€ƒè™‘ä½¿ç”¨è¿è¡Œæ—¶æ— å…³çš„æŠ½è±¡ï¼š

- `futures` crateæä¾›çš„trait
- `async-trait`ç”¨äºtraitä¸­çš„async
- æ¡ä»¶ç¼–è¯‘å¤„ç†å·®å¼‚

---

**ç›®å½•çŠ¶æ€**: âœ… å®Œæ•´  
**æœ€åæ›´æ–°**: 2025-10-19
