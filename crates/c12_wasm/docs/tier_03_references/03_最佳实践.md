# C12 WASM - æœ€ä½³å®è·µ

> **æ–‡æ¡£ç±»å‹**: Tier 3 - å‚è€ƒå±‚
> **æ–‡æ¡£å®šä½**: WASM å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ
> **é¡¹ç›®çŠ¶æ€**: âœ… å®Œæ•´å®Œæˆ
> **ç›¸å…³æ–‡æ¡£**: [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](../tier_02_guides/04_æ€§èƒ½ä¼˜åŒ–æŒ‡å—.md) | [API å‚è€ƒ](./01_api_å‚è€ƒ.md)

**æœ€åæ›´æ–°**: 2025-10-30
**é€‚ç”¨ç‰ˆæœ¬**: Rust 1.90+ / Edition 2024, WASM 2.0 + WASI 0.2

---

## ğŸ“‹ ç›®å½•

- [C12 WASM - æœ€ä½³å®è·µ](#c12-wasm---æœ€ä½³å®è·µ)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ’» ä»£ç å®è·µ](#-ä»£ç å®è·µ)
  - [âš¡ æ€§èƒ½ä¼˜åŒ–](#-æ€§èƒ½ä¼˜åŒ–)
  - [ğŸ” å®‰å…¨å®è·µ](#-å®‰å…¨å®è·µ)
  - [ğŸ“¦ é¡¹ç›®ç®¡ç†](#-é¡¹ç›®ç®¡ç†)
  - [ğŸ“š ç›¸å…³èµ„æº](#-ç›¸å…³èµ„æº)

---

## ğŸ¯ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾› WASM å¼€å‘çš„æœ€ä½³å®è·µå’Œè§„èŒƒã€‚

---

## ğŸ’» ä»£ç å®è·µ

### 1. ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹

```rust
// âœ… å¥½ï¼šä½¿ç”¨åŸå§‹ç±»å‹
#[wasm_bindgen]
pub fn add(a: i32, b: i32) -> i32 {
    a + b
}

// âŒ é¿å…ï¼šè¿‡åº¦ä½¿ç”¨ String
#[wasm_bindgen]
pub fn add_bad(a: String, b: String) -> String {
    format!("{}", a.parse::<i32>().unwrap() + b.parse::<i32>().unwrap())
}
```

### 2. å‡å°‘å†…å­˜åˆ†é…

```rust
// âœ… å¥½ï¼šé‡ç”¨ç¼“å†²åŒº
thread_local! {
    static BUFFER: RefCell<Vec<u8>> = RefCell::new(Vec::new());
}

// âŒ é¿å…ï¼šé¢‘ç¹åˆ†é…
pub fn process(data: &[u8]) -> Vec<u8> {
    // æ¯æ¬¡éƒ½åˆ†é…æ–° Vec
    data.to_vec()
}
```

### 3. é”™è¯¯å¤„ç†

```rust
// âœ… å¥½ï¼šä½¿ç”¨ Result
#[wasm_bindgen]
pub fn divide(a: f64, b: f64) -> Result<f64, String> {
    if b == 0.0 {
        Err("Division by zero".to_string())
    } else {
        Ok(a / b)
    }
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. ç¼–è¯‘ä¼˜åŒ–

```toml
[profile.release]
opt-level = "z"      # ä¼˜åŒ–å¤§å°
lto = true           # é“¾æ¥æ—¶ä¼˜åŒ–
codegen-units = 1    # å•ä¸€ä»£ç ç”Ÿæˆå•å…ƒ
```

### 2. ä½¿ç”¨ wasm-opt

```bash
wasm-opt -Oz -o output.wasm input.wasm
```

### 3. å‡å°‘ä¾èµ–

```toml
[dependencies]
some-crate = { version = "1.0", default-features = false }
```

---

## ğŸ” å®‰å…¨å®è·µ

### 1. è¾“å…¥éªŒè¯

```rust
#[wasm_bindgen]
pub fn process_input(input: &str) -> Result<String, String> {
    if input.len() > 1000 {
        return Err("Input too long".to_string());
    }
    // å¤„ç†è¾“å…¥
    Ok(input.to_uppercase())
}
```

### 2. é¿å…å†…å­˜æ³„æ¼

```rust
// âœ… å¥½ï¼šåŠæ—¶é‡Šæ”¾èµ„æº
{
    let data = expensive_operation();
    // ä½¿ç”¨ data
} // data åœ¨è¿™é‡Œè‡ªåŠ¨é‡Šæ”¾
```

---

## ğŸ“¦ é¡¹ç›®ç®¡ç†

### 1. é¡¹ç›®ç»“æ„

```text
project/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚   â””â”€â”€ lib.rs
â”œâ”€â”€ pkg/          # wasm-pack è¾“å‡º
â”œâ”€â”€ www/          # Web å‰ç«¯
â””â”€â”€ tests/        # æµ‹è¯•
```

### 2. ç‰ˆæœ¬ç®¡ç†

```toml
[package]
version = "0.1.0"
```

### 3. æµ‹è¯•

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_add() {
        assert_eq!(add(2, 3), 5);
    }
}
```

---

## ğŸ“š ç›¸å…³èµ„æº

- [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](../tier_02_guides/04_æ€§èƒ½ä¼˜åŒ–æŒ‡å—.md) - æ·±å…¥å­¦ä¹ ä¼˜åŒ–
- [API å‚è€ƒ](./01_api_å‚è€ƒ.md) - API æ–‡æ¡£
- [å¸¸è§é—®é¢˜](../tier_01_foundations/04_å¸¸è§é—®é¢˜.md) - FAQ

---

**æ–‡æ¡£ç»´æŠ¤**: Documentation Team
**åˆ›å»ºæ—¥æœŸ**: 2025-10-30
**é€‚ç”¨ç‰ˆæœ¬**: Rust 1.90+ / Edition 2024, WASM 2.0 + WASI 0.2
