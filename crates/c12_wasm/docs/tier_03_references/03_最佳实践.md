# C12 WASM - æœ€ä½³å®è·µ

> **æ–‡æ¡£ç±»å‹**: Tier 3 - å‚è€ƒå±‚
> **æ–‡æ¡£å®šä½**: WASM å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ
> **é¡¹ç›®çŠ¶æ€**: âœ… å®Œæ•´å®Œæˆ
> **ç›¸å…³æ–‡æ¡£**: [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](../tier_02_guides/04_æ€§èƒ½ä¼˜åŒ–æŒ‡å—.md) | [API å‚è€ƒ](./01_api_å‚è€ƒ.md)

**æœ€åæ›´æ–°**: 2025-12-11
**é€‚ç”¨ç‰ˆæœ¬**: Rust 1.92.0+ / Edition 2024, WASM 2.0 + WASI 0.2

---

## ğŸ“‹ ç›®å½•

- [C12 WASM - æœ€ä½³å®è·µ](#c12-wasm---æœ€ä½³å®è·µ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ“ çŸ¥è¯†ç»“æ„](#-çŸ¥è¯†ç»“æ„)
    - [æ¦‚å¿µå®šä¹‰](#æ¦‚å¿µå®šä¹‰)
    - [å±æ€§ç‰¹å¾](#å±æ€§ç‰¹å¾)
    - [å…³ç³»è¿æ¥](#å…³ç³»è¿æ¥)
    - [æ€ç»´å¯¼å›¾](#æ€ç»´å¯¼å›¾)
  - [ğŸ¯ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ’» ä»£ç å®è·µ](#-ä»£ç å®è·µ)
    - [1. ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹](#1-ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹)
    - [2. å‡å°‘å†…å­˜åˆ†é…](#2-å‡å°‘å†…å­˜åˆ†é…)
    - [3. é”™è¯¯å¤„ç†](#3-é”™è¯¯å¤„ç†)
  - [âš¡ æ€§èƒ½ä¼˜åŒ–](#-æ€§èƒ½ä¼˜åŒ–)
    - [1. ç¼–è¯‘ä¼˜åŒ–](#1-ç¼–è¯‘ä¼˜åŒ–)
    - [2. ä½¿ç”¨ wasm-opt](#2-ä½¿ç”¨-wasm-opt)
    - [3. å‡å°‘ä¾èµ–](#3-å‡å°‘ä¾èµ–)
  - [ğŸ” å®‰å…¨å®è·µ](#-å®‰å…¨å®è·µ)
    - [1. è¾“å…¥éªŒè¯](#1-è¾“å…¥éªŒè¯)
    - [2. é¿å…å†…å­˜æ³„æ¼](#2-é¿å…å†…å­˜æ³„æ¼)
  - [ğŸ“¦ é¡¹ç›®ç®¡ç†](#-é¡¹ç›®ç®¡ç†)
    - [1. é¡¹ç›®ç»“æ„](#1-é¡¹ç›®ç»“æ„)
    - [2. ç‰ˆæœ¬ç®¡ç†](#2-ç‰ˆæœ¬ç®¡ç†)
    - [3. æµ‹è¯•](#3-æµ‹è¯•)
  - [ğŸ“š ç›¸å…³èµ„æº](#-ç›¸å…³èµ„æº)

---

## ğŸ“ çŸ¥è¯†ç»“æ„

### æ¦‚å¿µå®šä¹‰

**WASM æœ€ä½³å®è·µ (WASM Best Practices)**:

- **å®šä¹‰**: WASM å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µæŒ‡å—
- **ç±»å‹**: æœ€ä½³å®è·µæ–‡æ¡£
- **èŒƒç•´**: WebAssemblyã€å¼€å‘è§„èŒƒ
- **ç‰ˆæœ¬**: Rust 1.92.0+, WASM 2.0, WASI 0.2
- **ç›¸å…³æ¦‚å¿µ**: æœ€ä½³å®è·µã€ä»£ç å®è·µã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨å®è·µ

### å±æ€§ç‰¹å¾

**æ ¸å¿ƒå±æ€§**:

- **ä»£ç å®è·µ**: ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹ã€å‡å°‘å†…å­˜åˆ†é…ã€é”™è¯¯å¤„ç†
- **æ€§èƒ½ä¼˜åŒ–**: ç¼–è¯‘ä¼˜åŒ–ã€ä½¿ç”¨ wasm-optã€å‡å°‘ä¾èµ–
- **å®‰å…¨å®è·µ**: è¾“å…¥éªŒè¯ã€é¿å…å†…å­˜æ³„æ¼
- **é¡¹ç›®ç®¡ç†**: é¡¹ç›®ç»“æ„ã€ç‰ˆæœ¬ç®¡ç†ã€æµ‹è¯•

**æ€§èƒ½ç‰¹å¾**:

- **ä»£ç è´¨é‡**: æé«˜ä»£ç å¯ç»´æŠ¤æ€§
- **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ– WASM æ€§èƒ½
- **é€‚ç”¨åœºæ™¯**: WASM å¼€å‘ã€ç”Ÿäº§éƒ¨ç½²ã€æ€§èƒ½ä¼˜åŒ–

### å…³ç³»è¿æ¥

**ç»„åˆå…³ç³»**:

- WASM æœ€ä½³å®è·µ --[covers]--> å¤šç§æœ€ä½³å®è·µ
- WASM åº”ç”¨å¼€å‘ --[uses]--> WASM æœ€ä½³å®è·µ

**ä¾èµ–å…³ç³»**:

- WASM æœ€ä½³å®è·µ --[depends-on]--> WASM çŸ¥è¯†
- WASM å¼€å‘è´¨é‡ --[depends-on]--> WASM æœ€ä½³å®è·µ

### æ€ç»´å¯¼å›¾

```text
WASM æœ€ä½³å®è·µ
â”‚
â”œâ”€â”€ ä»£ç å®è·µ
â”‚   â”œâ”€â”€ æ•°æ®ç±»å‹
â”‚   â””â”€â”€ å†…å­˜åˆ†é…
â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–
â”‚   â”œâ”€â”€ ç¼–è¯‘ä¼˜åŒ–
â”‚   â””â”€â”€ wasm-opt
â”œâ”€â”€ å®‰å…¨å®è·µ
â”‚   â””â”€â”€ è¾“å…¥éªŒè¯
â””â”€â”€ é¡¹ç›®ç®¡ç†
    â””â”€â”€ é¡¹ç›®ç»“æ„
```

---

## ğŸ¯ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾› WASM å¼€å‘çš„æœ€ä½³å®è·µå’Œè§„èŒƒã€‚

---

## ğŸ’» ä»£ç å®è·µ

### 1. ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹

```rust
// âœ… å¥½ï¼šä½¿ç”¨åŸå§‹ç±»å‹
#[wasm_bindgen]
pub fn add(a: i32, b: i32) -> i32 {
    a + b
}

// âŒ é¿å…ï¼šè¿‡åº¦ä½¿ç”¨ String
#[wasm_bindgen]
pub fn add_bad(a: String, b: String) -> String {
    format!("{}", a.parse::<i32>().unwrap() + b.parse::<i32>().unwrap())
}
```

### 2. å‡å°‘å†…å­˜åˆ†é…

```rust
// âœ… å¥½ï¼šé‡ç”¨ç¼“å†²åŒº
thread_local! {
    static BUFFER: RefCell<Vec<u8>> = RefCell::new(Vec::new());
}

// âŒ é¿å…ï¼šé¢‘ç¹åˆ†é…
pub fn process(data: &[u8]) -> Vec<u8> {
    // æ¯æ¬¡éƒ½åˆ†é…æ–° Vec
    data.to_vec()
}
```

### 3. é”™è¯¯å¤„ç†

```rust
// âœ… å¥½ï¼šä½¿ç”¨ Result
#[wasm_bindgen]
pub fn divide(a: f64, b: f64) -> Result<f64, String> {
    if b == 0.0 {
        Err("Division by zero".to_string())
    } else {
        Ok(a / b)
    }
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. ç¼–è¯‘ä¼˜åŒ–

```toml
[profile.release]
opt-level = "z"      # ä¼˜åŒ–å¤§å°
lto = true           # é“¾æ¥æ—¶ä¼˜åŒ–
codegen-units = 1    # å•ä¸€ä»£ç ç”Ÿæˆå•å…ƒ
```

### 2. ä½¿ç”¨ wasm-opt

```bash
wasm-opt -Oz -o output.wasm input.wasm
```

### 3. å‡å°‘ä¾èµ–

```toml
[dependencies]
some-crate = { version = "1.0", default-features = false }
```

---

## ğŸ” å®‰å…¨å®è·µ

### 1. è¾“å…¥éªŒè¯

```rust
#[wasm_bindgen]
pub fn process_input(input: &str) -> Result<String, String> {
    if input.len() > 1000 {
        return Err("Input too long".to_string());
    }
    // å¤„ç†è¾“å…¥
    Ok(input.to_uppercase())
}
```

### 2. é¿å…å†…å­˜æ³„æ¼

```rust
// âœ… å¥½ï¼šåŠæ—¶é‡Šæ”¾èµ„æº
{
    let data = expensive_operation();
    // ä½¿ç”¨ data
} // data åœ¨è¿™é‡Œè‡ªåŠ¨é‡Šæ”¾
```

---

## ğŸ“¦ é¡¹ç›®ç®¡ç†

### 1. é¡¹ç›®ç»“æ„

```text
project/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚   â””â”€â”€ lib.rs
â”œâ”€â”€ pkg/          # wasm-pack è¾“å‡º
â”œâ”€â”€ www/          # Web å‰ç«¯
â””â”€â”€ tests/        # æµ‹è¯•
```

### 2. ç‰ˆæœ¬ç®¡ç†

```toml
[package]
version = "0.1.0"
```

### 3. æµ‹è¯•

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_add() {
        assert_eq!(add(2, 3), 5);
    }
}
```

---

## ğŸ“š ç›¸å…³èµ„æº

- [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](../tier_02_guides/04_æ€§èƒ½ä¼˜åŒ–æŒ‡å—.md) - æ·±å…¥å­¦ä¹ ä¼˜åŒ–
- [API å‚è€ƒ](./01_api_å‚è€ƒ.md) - API æ–‡æ¡£
- [å¸¸è§é—®é¢˜](../tier_01_foundations/04_å¸¸è§é—®é¢˜.md) - FAQ

---

**æ–‡æ¡£ç»´æŠ¤**: Documentation Team
**åˆ›å»ºæ—¥æœŸ**: 2025-10-30
**é€‚ç”¨ç‰ˆæœ¬**: Rust 1.92.0+ / Edition 2024, WASM 2.0 + WASI 0.2
