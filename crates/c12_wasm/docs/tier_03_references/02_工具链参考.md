# C12 WASM - 工具链参考

> **文档类型**: Tier 3 - 参考层
> **文档定位**: WASM 工具链使用手册
> **项目状态**: ✅ 完整完成
> **相关文档**: [Rust 编译 WASM](../tier_02_guides/02_rust_编译_wasm.md) | [最佳实践](./03_最佳实践.md)

**最后更新**: 2025-10-30
**适用版本**: Rust 1.90+ / Edition 2024, WASM 2.0 + WASI 0.2

---

## 📋 目录

- [C12 WASM - 工具链参考](#c12-wasm---工具链参考)
  - [📋 目录](#-目录)
  - [🎯 概述](#-概述)
  - [🛠️ rustc](#️-rustc)
    - [基本用法](#基本用法)
  - [📦 wasm-pack](#-wasm-pack)
    - [安装](#安装)
    - [基本命令](#基本命令)
    - [目标选项](#目标选项)
  - [🔧 wasm-bindgen](#-wasm-bindgen)
    - [wasm-bindgen 安装](#wasm-bindgen-安装)
    - [wasm-bindgen 基本用法](#wasm-bindgen-基本用法)
  - [⚡ wasm-opt](#-wasm-opt)
    - [wasm-opt 安装](#wasm-opt-安装)
    - [wasm-opt 基本用法](#wasm-opt-基本用法)
  - [🚀 WasmEdge](#-wasmedge)
    - [WasmEdge 简介](#wasmedge-简介)
    - [WasmEdge 安装](#wasmedge-安装)
    - [WasmEdge 基本用法](#wasmedge-基本用法)
    - [Rust 编译到 WASI](#rust-编译到-wasi)
    - [WasmEdge 高级特性](#wasmedge-高级特性)
  - [🖥️ 其他本地运行时](#️-其他本地运行时)
    - [wasmtime](#wasmtime)
    - [wasmer](#wasmer)
  - [📚 相关资源](#-相关资源)

---

## 🎯 概述

本文档提供 WASM 工具链的完整使用手册。

---

## 🛠️ rustc

### 基本用法

```bash
# 编译到 WASM
cargo build --target wasm32-unknown-unknown --release

# 指定优化级别
cargo build --target wasm32-unknown-unknown --release -- -C opt-level=z
```

---

## 📦 wasm-pack

### 安装

```bash
curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh
```

### 基本命令

```bash
# 创建新项目
wasm-pack new hello-wasm

# 构建 WASM 模块
wasm-pack build --target web

# 测试
wasm-pack test --headless --firefox

# 发布
wasm-pack publish
```

### 目标选项

- `--target web`: Web 浏览器环境
- `--target nodejs`: Node.js 环境
- `--target bundler`: Webpack/Rollup 等打包工具
- `--target no-modules`: 不使用 ES 模块

---

## 🔧 wasm-bindgen

### wasm-bindgen 安装

```bash
cargo install wasm-bindgen-cli
```

### wasm-bindgen 基本用法

```bash
# 生成绑定代码
wasm-bindgen target/wasm32-unknown-unknown/release/module.wasm \
  --out-dir pkg \
  --target web
```

---

## ⚡ wasm-opt

### wasm-opt 安装

```bash
npm install -g wasm-opt
```

### wasm-opt 基本用法

```bash
# 优化大小
wasm-opt -Oz -o output.wasm input.wasm

# 优化性能
wasm-opt -O3 -o output.wasm input.wasm
```

---

## 🚀 WasmEdge

### WasmEdge 简介

WasmEdge 是一个轻量级、高性能的 WebAssembly 运行时，专门为云原生、边缘计算和去中心化应用设计。它可以在本地操作系统（Linux、macOS、Windows）上运行 WASM 应用程序。

**特点**:

- ✅ 高性能执行（接近原生速度）
- ✅ 支持 WASI 标准
- ✅ 支持多线程
- ✅ 支持 TensorFlow、OpenVINO 等 AI 框架
- ✅ 支持 JavaScript 运行时（QuickJS）

### WasmEdge 安装

**Linux/macOS**:

```bash
curl -sSf https://raw.githubusercontent.com/WasmEdge/WasmEdge/master/utils/install.sh | bash
```

**Windows**:

```powershell
# 使用 Chocolatey
choco install wasmedge

# 或使用 GitHub Releases
# 下载 https://github.com/WasmEdge/WasmEdge/releases
```

**验证安装**:

```bash
wasmedge --version
wasmedgec --version
```

### WasmEdge 基本用法

**运行 WASM 应用程序**:

```bash
# 直接运行 WASM 文件
wasmedge your_app.wasm

# 运行并传递参数
wasmedge your_app.wasm arg1 arg2

# 运行并设置环境变量
wasmedge --env "KEY=VALUE" your_app.wasm
```

**编译优化**:

```bash
# 使用 wasmedgec 编译为优化版本
wasmedgec your_app.wasm your_app.so

# 运行优化版本（更快）
wasmedge your_app.so
```

**目录挂载**:

```bash
# 挂载本地目录到 WASM 文件系统
wasmedge --dir .:/app your_app.wasm
```

**网络访问**:

```bash
# 允许网络访问
wasmedge --allow-net your_app.wasm
```

### Rust 编译到 WASI

要使用 WasmEdge 运行 Rust 程序，需要编译到 `wasm32-wasi` 目标：

```bash
# 添加 WASI 目标
rustup target add wasm32-wasi

# 编译到 WASI
cargo build --target wasm32-wasi --release

# 使用 WasmEdge 运行
wasmedge target/wasm32-wasi/release/your_app.wasm
```

### WasmEdge 高级特性

**1. 多线程支持**:

```bash
# 启用多线程
wasmedge --enable-threads your_app.wasm
```

**2. 扩展插件**:

```bash
# 使用 WASI-NN（神经网络）插件
wasmedge --enable-wasi-nn your_app.wasm
```

**3. 性能监控**:

```bash
# 启用性能分析
wasmedge --perf your_app.wasm
```

---

## 🖥️ 其他本地运行时

### wasmtime

wasmtime 是另一个流行的 WASM 运行时：

```bash
# 安装
curl https://wasmtime.dev/install.sh -sSf | bash

# 运行
wasmtime your_app.wasm

# 运行并传递参数
wasmtime run your_app.wasm -- arg1 arg2
```

### wasmer

wasmer 是一个高性能的 WASM 运行时：

```bash
# 安装
curl https://get.wasmer.io -sSfL | sh

# 运行
wasmer run your_app.wasm

# 编译为原生二进制
wasmer compile your_app.wasm -o your_app
```

---

## 📚 相关资源

- [wasm-pack Book](https://rustwasm.github.io/docs/wasm-pack/)
- [wasm-bindgen Book](https://rustwasm.github.io/docs/wasm-bindgen/)
- [wasm-opt 文档](https://github.com/WebAssembly/binaryen)
- [WasmEdge 官方文档](https://wasmedge.org/docs/)
- [wasmtime 文档](https://docs.wasmtime.dev/)
- [wasmer 文档](https://docs.wasmer.io/)

---

**文档维护**: Documentation Team
**创建日期**: 2025-10-30
**适用版本**: Rust 1.90+ / Edition 2024, WASM 2.0 + WASI 0.2
