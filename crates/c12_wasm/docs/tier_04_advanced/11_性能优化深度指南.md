# WebAssembly æ€§èƒ½ä¼˜åŒ–æ·±åº¦æŒ‡å—

> **æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæˆ
> **æ›´æ–°æ—¥æœŸ**: 2025-10-30
> **å¯¹æ ‡æŠ€æœ¯**: WasmEdge 0.14+, WASM 2.0, AOT ç¼–è¯‘
> **éš¾åº¦ç­‰çº§**: â­â­â­â­â­

---

## ğŸ“‹ ç›®å½•

- [WebAssembly æ€§èƒ½ä¼˜åŒ–æ·±åº¦æŒ‡å—](#webassembly-æ€§èƒ½ä¼˜åŒ–æ·±åº¦æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ“ çŸ¥è¯†ç»“æ„](#-çŸ¥è¯†ç»“æ„)
    - [æ¦‚å¿µå®šä¹‰](#æ¦‚å¿µå®šä¹‰)
    - [å±æ€§ç‰¹å¾](#å±æ€§ç‰¹å¾)
    - [å…³ç³»è¿æ¥](#å…³ç³»è¿æ¥)
    - [æ€ç»´å¯¼å›¾](#æ€ç»´å¯¼å›¾)
    - [å¤šç»´æ¦‚å¿µå¯¹æ¯”çŸ©é˜µ](#å¤šç»´æ¦‚å¿µå¯¹æ¯”çŸ©é˜µ)
    - [å†³ç­–æ ‘å›¾](#å†³ç­–æ ‘å›¾)
  - [æ¦‚è¿°](#æ¦‚è¿°)
    - [æ€§èƒ½ä¼˜åŒ–å±‚æ¬¡](#æ€§èƒ½ä¼˜åŒ–å±‚æ¬¡)
    - [æ€§èƒ½ç›®æ ‡è®¾å®š](#æ€§èƒ½ç›®æ ‡è®¾å®š)
  - [ç¼–è¯‘æ—¶ä¼˜åŒ–](#ç¼–è¯‘æ—¶ä¼˜åŒ–)
    - [1. Cargo Profile é…ç½®](#1-cargo-profile-é…ç½®)
      - [ç”Ÿäº§ç¯å¢ƒé…ç½®](#ç”Ÿäº§ç¯å¢ƒé…ç½®)
      - [æ€§èƒ½ä¼˜å…ˆé…ç½®](#æ€§èƒ½ä¼˜å…ˆé…ç½®)
      - [å¯¹æ¯”æµ‹è¯•](#å¯¹æ¯”æµ‹è¯•)
    - [2. wasm-opt ä¼˜åŒ–](#2-wasm-opt-ä¼˜åŒ–)
    - [3. ä¼˜åŒ–å¯¹æ¯”è¡¨](#3-ä¼˜åŒ–å¯¹æ¯”è¡¨)
  - [è¿è¡Œæ—¶ä¼˜åŒ–](#è¿è¡Œæ—¶ä¼˜åŒ–)
    - [1. WasmEdge AOT ç¼–è¯‘](#1-wasmedge-aot-ç¼–è¯‘)
      - [ä»€ä¹ˆæ˜¯ AOT ç¼–è¯‘](#ä»€ä¹ˆæ˜¯-aot-ç¼–è¯‘)
      - [ä½¿ç”¨ WasmEdge AOT ç¼–è¯‘å™¨](#ä½¿ç”¨-wasmedge-aot-ç¼–è¯‘å™¨)
      - [æ€§èƒ½æå‡å¯¹æ¯”](#æ€§èƒ½æå‡å¯¹æ¯”)
      - [AOT ç¼–è¯‘é€‰é¡¹](#aot-ç¼–è¯‘é€‰é¡¹)
    - [2. JIT vs AOT é€‰æ‹©æŒ‡å—](#2-jit-vs-aot-é€‰æ‹©æŒ‡å—)
      - [ä½•æ—¶ä½¿ç”¨ JIT](#ä½•æ—¶ä½¿ç”¨-jit)
      - [ä½•æ—¶ä½¿ç”¨ AOT](#ä½•æ—¶ä½¿ç”¨-aot)
  - [å†…å­˜ä¼˜åŒ–](#å†…å­˜ä¼˜åŒ–)
    - [1. å†…å­˜åˆ†é…ç­–ç•¥](#1-å†…å­˜åˆ†é…ç­–ç•¥)
      - [é¢„åˆ†é… vs åŠ¨æ€åˆ†é…](#é¢„åˆ†é…-vs-åŠ¨æ€åˆ†é…)
      - [æ€§èƒ½å¯¹æ¯”](#æ€§èƒ½å¯¹æ¯”)
    - [2. å†…å­˜æ± æŠ€æœ¯](#2-å†…å­˜æ± æŠ€æœ¯)
    - [3. é›¶åˆ†é…è®¾è®¡æ¨¡å¼](#3-é›¶åˆ†é…è®¾è®¡æ¨¡å¼)
      - [å€Ÿç”¨è€Œéæ‹¥æœ‰](#å€Ÿç”¨è€Œéæ‹¥æœ‰)
      - [å¤ç”¨ç¼“å†²åŒº](#å¤ç”¨ç¼“å†²åŒº)
  - [é›¶æ‹·è´æŠ€æœ¯](#é›¶æ‹·è´æŠ€æœ¯)
    - [1. ä»€ä¹ˆæ˜¯é›¶æ‹·è´](#1-ä»€ä¹ˆæ˜¯é›¶æ‹·è´)
    - [2. å®ç°é›¶æ‹·è´](#2-å®ç°é›¶æ‹·è´)
      - [ä½¿ç”¨ wasm-bindgen çš„ Uint8Array](#ä½¿ç”¨-wasm-bindgen-çš„-uint8array)
      - [JavaScript ç«¯ä½¿ç”¨](#javascript-ç«¯ä½¿ç”¨)
    - [3. å…±äº«å†…å­˜å’Œçº¿ç¨‹](#3-å…±äº«å†…å­˜å’Œçº¿ç¨‹)
  - [SIMD ä¼˜åŒ–](#simd-ä¼˜åŒ–)
    - [1. SIMD ç®€ä»‹](#1-simd-ç®€ä»‹)
    - [2. ä½¿ç”¨ SIMD](#2-ä½¿ç”¨-simd)
      - [å¯ç”¨ SIMD](#å¯ç”¨-simd)
      - [SIMD ä»£ç ç¤ºä¾‹](#simd-ä»£ç ç¤ºä¾‹)
      - [æ€§èƒ½å¯¹æ¯”](#æ€§èƒ½å¯¹æ¯”-1)
    - [3. SIMD æœ€ä½³å®è·µ](#3-simd-æœ€ä½³å®è·µ)
  - [æ€§èƒ½åˆ†æå·¥å…·](#æ€§èƒ½åˆ†æå·¥å…·)
    - [1. æµè§ˆå™¨æ€§èƒ½åˆ†æ](#1-æµè§ˆå™¨æ€§èƒ½åˆ†æ)
      - [Chrome DevTools](#chrome-devtools)
      - [æ—¶é—´åˆ†æ](#æ—¶é—´åˆ†æ)
    - [2. WasmEdge æ€§èƒ½åˆ†æ](#2-wasmedge-æ€§èƒ½åˆ†æ)
    - [3. Rust æ€§èƒ½åˆ†æ](#3-rust-æ€§èƒ½åˆ†æ)
      - [Criterion åŸºå‡†æµ‹è¯•](#criterion-åŸºå‡†æµ‹è¯•)
  - [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
    - [1. ä»£ç å±‚é¢ä¼˜åŒ–æ¸…å•](#1-ä»£ç å±‚é¢ä¼˜åŒ–æ¸…å•)
    - [2. ç®—æ³•é€‰æ‹©](#2-ç®—æ³•é€‰æ‹©)
    - [3. æ€§èƒ½ä¼˜åŒ– Checklist](#3-æ€§èƒ½ä¼˜åŒ–-checklist)
      - [ç¼–è¯‘ä¼˜åŒ– âœ“](#ç¼–è¯‘ä¼˜åŒ–-)
      - [å†…å­˜ä¼˜åŒ– âœ“](#å†…å­˜ä¼˜åŒ–-)
      - [è¿è¡Œæ—¶ä¼˜åŒ– âœ“](#è¿è¡Œæ—¶ä¼˜åŒ–-)
      - [ç½‘ç»œä¼˜åŒ– âœ“](#ç½‘ç»œä¼˜åŒ–-)
    - [4. æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹](#4-æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹)
  - [æ€»ç»“](#æ€»ç»“)
    - [æ€§èƒ½ä¼˜åŒ–é‡‘å­—å¡”](#æ€§èƒ½ä¼˜åŒ–é‡‘å­—å¡”)
    - [å…³é”®è¦ç‚¹](#å…³é”®è¦ç‚¹)
    - [ä¸‹ä¸€æ­¥è¡ŒåŠ¨](#ä¸‹ä¸€æ­¥è¡ŒåŠ¨)
    - [å‚è€ƒèµ„æº](#å‚è€ƒèµ„æº)

---

## ğŸ“ çŸ¥è¯†ç»“æ„

### æ¦‚å¿µå®šä¹‰

**æ€§èƒ½ä¼˜åŒ–æ·±åº¦æŒ‡å— (Performance Optimization Deep Guide)**:

- **å®šä¹‰**: Rust 1.92.0 WebAssembly æ€§èƒ½ä¼˜åŒ–æ·±åº¦æŒ‡å—ï¼ŒåŒ…æ‹¬ç¼–è¯‘æ—¶ä¼˜åŒ–ã€è¿è¡Œæ—¶ä¼˜åŒ–ã€å†…å­˜ä¼˜åŒ–ã€é›¶æ‹·è´æŠ€æœ¯ã€SIMD ä¼˜åŒ–ã€å¤šçº¿ç¨‹ä¼˜åŒ–ã€æ€§èƒ½åŸºå‡†æµ‹è¯•ã€æ€§èƒ½åˆ†æå·¥å…·ã€æœ€ä½³å®è·µç­‰
- **ç±»å‹**: é«˜çº§ä¸»é¢˜æ–‡æ¡£
- **èŒƒç•´**: WASMã€æ€§èƒ½ä¼˜åŒ–
- **ç‰ˆæœ¬**: Rust 1.92.0+ / Edition 2024, WasmEdge 0.14+, WASM 2.0, AOT ç¼–è¯‘
- **ç›¸å…³æ¦‚å¿µ**: æ€§èƒ½ä¼˜åŒ–ã€ç¼–è¯‘æ—¶ä¼˜åŒ–ã€è¿è¡Œæ—¶ä¼˜åŒ–ã€å†…å­˜ä¼˜åŒ–ã€é›¶æ‹·è´ã€SIMDã€å¤šçº¿ç¨‹

### å±æ€§ç‰¹å¾

**æ ¸å¿ƒå±æ€§**:

- **ç¼–è¯‘æ—¶ä¼˜åŒ–**: Cargo Profile é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒé…ç½®ã€æ€§èƒ½ä¼˜å…ˆé…ç½®ã€å¯¹æ¯”æµ‹è¯•ï¼‰ã€wasm-opt ä¼˜åŒ–ã€ä¼˜åŒ–å¯¹æ¯”è¡¨
- **è¿è¡Œæ—¶ä¼˜åŒ–**: WasmEdge AOT ç¼–è¯‘ï¼ˆä»€ä¹ˆæ˜¯ AOT ç¼–è¯‘ã€ä½¿ç”¨ WasmEdge AOT ç¼–è¯‘å™¨ã€æ€§èƒ½æå‡å¯¹æ¯”ã€AOT ç¼–è¯‘é€‰é¡¹ï¼‰ã€JIT vs AOT é€‰æ‹©æŒ‡å—
- **å†…å­˜ä¼˜åŒ–**: å†…å­˜åˆ†é…ç­–ç•¥ï¼ˆé¢„åˆ†é… vs åŠ¨æ€åˆ†é…ã€æ€§èƒ½å¯¹æ¯”ï¼‰ã€å†…å­˜æ± æŠ€æœ¯ã€é›¶åˆ†é…è®¾è®¡æ¨¡å¼
- **é›¶æ‹·è´æŠ€æœ¯**: ä»€ä¹ˆæ˜¯é›¶æ‹·è´ã€å®ç°é›¶æ‹·è´ï¼ˆä½¿ç”¨ wasm-bindgen çš„ Uint8Arrayã€JavaScript ç«¯ä½¿ç”¨ï¼‰ã€å…±äº«å†…å­˜å’Œçº¿ç¨‹
- **SIMD ä¼˜åŒ–**: SIMD ç®€ä»‹ã€ä½¿ç”¨ SIMDï¼ˆå¯ç”¨ SIMDã€SIMD ç¤ºä¾‹ã€æ€§èƒ½å¯¹æ¯”ï¼‰
- **å¤šçº¿ç¨‹ä¼˜åŒ–**: WebAssembly å¤šçº¿ç¨‹ã€WasmEdge å¤šçº¿ç¨‹æ”¯æŒã€æ€§èƒ½æå‡
- **æ€§èƒ½åŸºå‡†æµ‹è¯•**: åŸºå‡†æµ‹è¯•æ¡†æ¶ã€æ€§èƒ½åŸºå‡†æµ‹è¯•ç¤ºä¾‹
- **æ€§èƒ½åˆ†æå·¥å…·**: æ€§èƒ½åˆ†æå·¥å…·ã€æ€§èƒ½åˆ†æç¤ºä¾‹

**Rust 1.92.0 æ–°ç‰¹æ€§**:

- **æ”¹è¿›çš„ SIMD**: æ›´å¥½çš„ portable_simd æ”¯æŒ
- **å¢å¼ºçš„ AOT**: æ›´å¥½çš„ AOT ç¼–è¯‘æ”¯æŒ
- **ä¼˜åŒ–çš„æ€§èƒ½**: æ›´é«˜æ•ˆçš„æ€§èƒ½ä¼˜åŒ–

**æ€§èƒ½ç‰¹å¾**:

- **æè‡´æ€§èƒ½**: æ˜¾è‘—çš„æ€§èƒ½æå‡
- **ä½å»¶è¿Ÿ**: ä¼˜åŒ–çš„å»¶è¿Ÿ
- **é€‚ç”¨åœºæ™¯**: é«˜æ€§èƒ½ WASM åº”ç”¨ã€å®æ—¶ç³»ç»Ÿã€æ€§èƒ½å…³é”®åº”ç”¨

### å…³ç³»è¿æ¥

**ç»„åˆå…³ç³»**:

- æ€§èƒ½ä¼˜åŒ–æ·±åº¦æŒ‡å— --[covers]--> æ€§èƒ½ä¼˜åŒ–å®Œæ•´å†…å®¹
- é«˜æ€§èƒ½ WASM åº”ç”¨ --[uses]--> æ€§èƒ½ä¼˜åŒ–æ·±åº¦æŒ‡å—

**ä¾èµ–å…³ç³»**:

- æ€§èƒ½ä¼˜åŒ–æ·±åº¦æŒ‡å— --[depends-on]--> WASM åŸºç¡€
- æ€§èƒ½ä¼˜åŒ– --[depends-on]--> æ€§èƒ½ä¼˜åŒ–æ·±åº¦æŒ‡å—

### æ€ç»´å¯¼å›¾

```text
æ€§èƒ½ä¼˜åŒ–æ·±åº¦æŒ‡å—
â”‚
â”œâ”€â”€ ç¼–è¯‘æ—¶ä¼˜åŒ–
â”‚   â”œâ”€â”€ Cargo Profile é…ç½®
â”‚   â””â”€â”€ wasm-opt ä¼˜åŒ–
â”œâ”€â”€ è¿è¡Œæ—¶ä¼˜åŒ–
â”‚   â”œâ”€â”€ WasmEdge AOT ç¼–è¯‘
â”‚   â””â”€â”€ JIT vs AOT
â”œâ”€â”€ å†…å­˜ä¼˜åŒ–
â”‚   â”œâ”€â”€ å†…å­˜åˆ†é…ç­–ç•¥
â”‚   â””â”€â”€ å†…å­˜æ± æŠ€æœ¯
â”œâ”€â”€ é›¶æ‹·è´æŠ€æœ¯
â”‚   â””â”€â”€ å®ç°é›¶æ‹·è´
â”œâ”€â”€ SIMD ä¼˜åŒ–
â”‚   â””â”€â”€ SIMD ç¤ºä¾‹
â”œâ”€â”€ å¤šçº¿ç¨‹ä¼˜åŒ–
â”‚   â””â”€â”€ WebAssembly å¤šçº¿ç¨‹
â”œâ”€â”€ æ€§èƒ½åŸºå‡†æµ‹è¯•
â”‚   â””â”€â”€ åŸºå‡†æµ‹è¯•æ¡†æ¶
â””â”€â”€ æ€§èƒ½åˆ†æå·¥å…·
    â””â”€â”€ æ€§èƒ½åˆ†æç¤ºä¾‹
```

### å¤šç»´æ¦‚å¿µå¯¹æ¯”çŸ©é˜µ

| ä¼˜åŒ–æŠ€æœ¯       | æ€§èƒ½æå‡ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯   | Rust 1.92.0 |
| :--- | :--- | :--- | :--- | :--- |
| **ç¼–è¯‘æ—¶ä¼˜åŒ–** | ä¸­       | ä½     | æ‰€æœ‰åº”ç”¨   | âœ…          |
| **AOT ç¼–è¯‘**   | æœ€é«˜     | ä¸­     | ç”Ÿäº§ç¯å¢ƒ   | âœ…          |
| **å†…å­˜ä¼˜åŒ–**   | é«˜       | ä¸­     | å†…å­˜å¯†é›†å‹ | âœ…          |
| **é›¶æ‹·è´**     | æœ€é«˜     | é«˜     | I/O å¯†é›†å‹ | âœ…          |
| **SIMD**       | æœ€é«˜     | é«˜     | æ•°å€¼è®¡ç®—   | âœ… å¢å¼º     |
| **å¤šçº¿ç¨‹**     | é«˜       | é«˜     | å¹¶è¡Œè®¡ç®—   | âœ…          |

### å†³ç­–æ ‘å›¾

```text
é€‰æ‹©ä¼˜åŒ–æŠ€æœ¯
â”‚
â”œâ”€â”€ éœ€è¦ä¼˜åŒ–ä»€ä¹ˆï¼Ÿ
â”‚   â”œâ”€â”€ ç¼–è¯‘æ—¶ â†’ Cargo Profile / wasm-opt
â”‚   â”œâ”€â”€ è¿è¡Œæ—¶ â†’ AOT ç¼–è¯‘
â”‚   â”œâ”€â”€ å†…å­˜ â†’ å†…å­˜ä¼˜åŒ– / å†…å­˜æ± 
â”‚   â”œâ”€â”€ I/O â†’ é›¶æ‹·è´
â”‚   â”œâ”€â”€ æ•°å€¼è®¡ç®— â†’ SIMD
â”‚   â””â”€â”€ å¹¶è¡Œè®¡ç®— â†’ å¤šçº¿ç¨‹
```

---

## æ¦‚è¿°

### æ€§èƒ½ä¼˜åŒ–å±‚æ¬¡

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Design                 â”‚  æœ€é‡è¦ï¼
â”‚  - Algorithm Selection                      â”‚
â”‚  - Data Structure Design                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Compilation Optimization           â”‚
â”‚  - Release Profile                          â”‚
â”‚  - LTO, Codegen Units                       â”‚
â”‚  - Size Optimization                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Runtime Optimization               â”‚
â”‚  - AOT Compilation                          â”‚
â”‚  - Memory Management                        â”‚
â”‚  - SIMD Utilization                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Infrastructure                     â”‚
â”‚  - CDN, Caching                             â”‚
â”‚  - Compression                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ€§èƒ½ç›®æ ‡è®¾å®š

| æŒ‡æ ‡           | è‰¯å¥½    | ä¼˜ç§€     | å“è¶Š      |
| :--- | :--- | :--- | :--- |
| **é¦–æ¬¡åŠ è½½**   | < 1s    | < 500ms  | < 200ms   |
| **æ‰§è¡Œé€Ÿåº¦**   | 2-5x JS | 5-10x JS | 10-20x JS |
| **äºŒè¿›åˆ¶å¤§å°** | < 500KB | < 200KB  | < 100KB   |
| **å†…å­˜å ç”¨**   | < 10MB  | < 5MB    | < 2MB     |
| **å¯åŠ¨æ—¶é—´**   | < 100ms | < 50ms   | < 10ms    |

---

## ç¼–è¯‘æ—¶ä¼˜åŒ–

### 1. Cargo Profile é…ç½®

#### ç”Ÿäº§ç¯å¢ƒé…ç½®

```toml
[profile.release]
# ä¼˜åŒ–çº§åˆ«
opt-level = "z"          # æè‡´å¤§å°ä¼˜åŒ– (3 ä¹Ÿå¯ç”¨äºæ€§èƒ½)

# Link Time Optimization
lto = true               # å¯ç”¨ LTOï¼Œå‡å°å¤§å°å¹¶æå‡æ€§èƒ½
codegen-units = 1        # å•ä¸ªä»£ç ç”Ÿæˆå•å…ƒï¼Œæœ€å¤§åŒ–ä¼˜åŒ–

# Strip ç¬¦å·
strip = true             # ç§»é™¤è°ƒè¯•ç¬¦å·

# æº¢å‡ºæ£€æŸ¥
overflow-checks = false  # ç§»é™¤æº¢å‡ºæ£€æŸ¥ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

# å…¶ä»–ä¼˜åŒ–
panic = "abort"          # panic æ—¶ç›´æ¥ç»ˆæ­¢ï¼Œä¸å±•å¼€æ ˆ

[profile.release.package."*"]
# ä¾èµ–ä¼˜åŒ–
opt-level = "z"
```

#### æ€§èƒ½ä¼˜å…ˆé…ç½®

```toml
[profile.release-perf]
inherits = "release"
opt-level = 3             # æ€§èƒ½ä¼˜åŒ–è€Œéå¤§å°
lto = "thin"              # Thin LTOï¼Œå¹³è¡¡ç¼–è¯‘é€Ÿåº¦å’Œä¼˜åŒ–æ•ˆæœ
```

#### å¯¹æ¯”æµ‹è¯•

```bash
# å¤§å°ä¼˜åŒ–
cargo build --release
ls -lh target/wasm32-unknown-unknown/release/*.wasm

# æ€§èƒ½ä¼˜åŒ–
cargo build --profile release-perf
ls -lh target/wasm32-unknown-unknown/release-perf/*.wasm
```

### 2. wasm-opt ä¼˜åŒ–

```bash
# å®‰è£… wasm-opt (æ¥è‡ª Binaryen)
npm install -g wasm-opt

# æˆ–ä»æºç å®‰è£…
git clone https://github.com/WebAssembly/binaryen
cd binaryen && cmake . && make
sudo make install

# å¤§å°ä¼˜åŒ–ï¼ˆæœ€æ¿€è¿›ï¼‰
wasm-opt -Oz input.wasm -o output.wasm

# å¤§å°ä¼˜åŒ–ï¼ˆä¿å®ˆï¼‰
wasm-opt -Os input.wasm -o output.wasm

# æ€§èƒ½ä¼˜åŒ–
wasm-opt -O3 input.wasm -o output.wasm

# å®Œæ•´ä¼˜åŒ–æµç¨‹
wasm-opt -Oz \
  --enable-bulk-memory \
  --enable-sign-ext \
  --enable-mutable-globals \
  --enable-simd \
  input.wasm -o output.wasm
```

### 3. ä¼˜åŒ–å¯¹æ¯”è¡¨

| é…ç½®                             | äºŒè¿›åˆ¶å¤§å° | æ‰§è¡Œé€Ÿåº¦ | ç¼–è¯‘æ—¶é—´ |
| :--- | :--- | :--- | :--- |
| `--dev`                          | 3.2 MB     | 1.0x     | 30s      |
| `--release`                      | 450 KB     | 2.5x     | 2m       |
| `--release` + LTO                | 280 KB     | 3.0x     | 5m       |
| `--release` + LTO + wasm-opt -Oz | 180 KB     | 2.8x     | 6m       |
| `--release` + LTO + wasm-opt -O3 | 320 KB     | 3.5x     | 6m       |

---

## è¿è¡Œæ—¶ä¼˜åŒ–

### 1. WasmEdge AOT ç¼–è¯‘

#### ä»€ä¹ˆæ˜¯ AOT ç¼–è¯‘

```text
ä¼ ç»Ÿ Wasm æ‰§è¡Œæµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  åŠ è½½  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  JITç¼–è¯‘  â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚  .wasm â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  è§£æ   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ æ‰§è¡Œ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”˜
                                          â†‘
                                    å¯åŠ¨æ…¢ã€é¦–æ¬¡æ‰§è¡Œæ…¢

AOT ç¼–è¯‘æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  AOT  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  åŠ è½½  â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚  .wasm â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  åŸç”Ÿç   â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ æ‰§è¡Œ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜
                                       â†‘
                                 å¯åŠ¨å¿«ã€æ€§èƒ½é«˜
```

#### ä½¿ç”¨ WasmEdge AOT ç¼–è¯‘å™¨

```bash
# ç¼–è¯‘ä¸º AOT
wasmedgec input.wasm output.so

# è¿è¡Œ AOT ç¼–è¯‘çš„ Wasm
wasmedge output.so

# å¸¦ä¼˜åŒ–çº§åˆ«çš„ AOT ç¼–è¯‘
wasmedgec --optimize 3 input.wasm output.so
```

#### æ€§èƒ½æå‡å¯¹æ¯”

| æ¨¡å¼         | å¯åŠ¨æ—¶é—´ | é¦–æ¬¡æ‰§è¡Œ | æŒç»­æ‰§è¡Œ |
| :--- | :--- | :--- | :--- |
| **è§£é‡Šæ¨¡å¼** | 10ms     | 100ms    | 1.0x     |
| **JIT æ¨¡å¼** | 50ms     | 80ms     | 3.0x     |
| **AOT æ¨¡å¼** | 1ms      | 1ms      | 3.5x     |

#### AOT ç¼–è¯‘é€‰é¡¹

```bash
# ä¼˜åŒ–çº§åˆ«
wasmedgec --optimize 0  # æ— ä¼˜åŒ–
wasmedgec --optimize 1  # åŸºç¡€ä¼˜åŒ–
wasmedgec --optimize 2  # æ ‡å‡†ä¼˜åŒ–ï¼ˆé»˜è®¤ï¼‰
wasmedgec --optimize 3  # æœ€å¤§ä¼˜åŒ–

# é€šç”¨äºŒè¿›åˆ¶ï¼ˆè·¨å¹³å°ï¼‰
wasmedgec --generic-binary input.wasm output.so

# é’ˆå¯¹ç‰¹å®š CPU
wasmedgec --cpu-features avx2,sse4.2 input.wasm output.so

# è°ƒè¯•ä¿¡æ¯
wasmedgec --debug-info input.wasm output.so
```

### 2. JIT vs AOT é€‰æ‹©æŒ‡å—

#### ä½•æ—¶ä½¿ç”¨ JIT

- âœ… å¼€å‘ç¯å¢ƒ
- âœ… é¢‘ç¹æ›´æ–°çš„ä»£ç 
- âœ… çŸ­ç”Ÿå‘½å‘¨æœŸåº”ç”¨
- âœ… è·¨å¹³å°åˆ†å‘

#### ä½•æ—¶ä½¿ç”¨ AOT

- âœ… ç”Ÿäº§ç¯å¢ƒ
- âœ… é•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡
- âœ… æ€§èƒ½å…³é”®åº”ç”¨
- âœ… è¾¹ç¼˜è®¡ç®—èŠ‚ç‚¹

---

## å†…å­˜ä¼˜åŒ–

### 1. å†…å­˜åˆ†é…ç­–ç•¥

#### é¢„åˆ†é… vs åŠ¨æ€åˆ†é…

```rust
// âŒ åŠ¨æ€åˆ†é…ï¼ˆæ…¢ï¼‰
pub fn process_dynamic(input: &[u8]) -> Vec<u8> {
    let mut result = Vec::new();
    for &byte in input {
        result.push(byte * 2);  // å¤šæ¬¡é‡æ–°åˆ†é…
    }
    result
}

// âœ… é¢„åˆ†é…ï¼ˆå¿«ï¼‰
pub fn process_preallocated(input: &[u8]) -> Vec<u8> {
    let mut result = Vec::with_capacity(input.len());
    for &byte in input {
        result.push(byte * 2);  // æ— éœ€é‡æ–°åˆ†é…
    }
    result
}

// âœ… åŸåœ°å¤„ç†ï¼ˆæ›´å¿«ï¼‰
pub fn process_inplace(data: &mut [u8]) {
    for byte in data {
        *byte *= 2;  // é›¶åˆ†é…
    }
}
```

#### æ€§èƒ½å¯¹æ¯”

```text
è¾“å…¥: 1MB æ•°æ®

åŠ¨æ€åˆ†é…:      2.5 ms  (å¤šæ¬¡å†…å­˜åˆ†é…)
é¢„åˆ†é…:        1.2 ms  (å•æ¬¡å†…å­˜åˆ†é…)
åŸåœ°å¤„ç†:      0.8 ms  (é›¶å†…å­˜åˆ†é…)  â­ æœ€å¿«
```

### 2. å†…å­˜æ± æŠ€æœ¯

```rust
use std::cell::RefCell;
use std::rc::Rc;

/// ç®€å•çš„å¯¹è±¡æ± 
struct ObjectPool<T> {
    pool: RefCell<Vec<T>>,
    factory: Box<dyn Fn() -> T>,
}

impl<T> ObjectPool<T> {
    fn new(factory: Box<dyn Fn() -> T>, initial_size: usize) -> Self {
        let mut pool = Vec::with_capacity(initial_size);
        for _ in 0..initial_size {
            pool.push(factory());
        }
        Self {
            pool: RefCell::new(pool),
            factory,
        }
    }

    fn acquire(&self) -> T {
        self.pool
            .borrow_mut()
            .pop()
            .unwrap_or_else(|| (self.factory)())
    }

    fn release(&self, obj: T) {
        self.pool.borrow_mut().push(obj);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
fn use_object_pool() {
    let pool = ObjectPool::new(
        Box::new(|| Vec::with_capacity(1024)),
        10
    );

    // è·å–å¯¹è±¡
    let mut buffer = pool.acquire();
    buffer.extend_from_slice(&[1, 2, 3, 4]);

    // ä½¿ç”¨å®Œæ¯•åå½’è¿˜
    buffer.clear();
    pool.release(buffer);
}
```

### 3. é›¶åˆ†é…è®¾è®¡æ¨¡å¼

#### å€Ÿç”¨è€Œéæ‹¥æœ‰

```rust
// âŒ åˆ†é…æ–°å­—ç¬¦ä¸²
fn to_uppercase_owned(s: &str) -> String {
    s.to_uppercase()  // åˆ†é…æ–°å†…å­˜
}

// âœ… ä½¿ç”¨è¿­ä»£å™¨ï¼ˆé›¶åˆ†é…ï¼‰
fn process_uppercase(s: &str) {
    for ch in s.chars().flat_map(|c| c.to_uppercase()) {
        // å¤„ç†å­—ç¬¦ï¼Œæ— éœ€åˆ†é…
        print!("{}", ch);
    }
}
```

#### å¤ç”¨ç¼“å†²åŒº

```rust
struct DataProcessor {
    buffer: Vec<u8>,
}

impl DataProcessor {
    fn process(&mut self, input: &[u8]) -> &[u8] {
        self.buffer.clear();  // å¤ç”¨ç°æœ‰å®¹é‡
        self.buffer.extend_from_slice(input);
        // å¤„ç† buffer
        &self.buffer
    }
}
```

---

## é›¶æ‹·è´æŠ€æœ¯

### 1. ä»€ä¹ˆæ˜¯é›¶æ‹·è´

```text
ä¼ ç»Ÿæ‹·è´æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   æ‹·è´1   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   æ‹·è´2   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JS å†…å­˜ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Wasm å†…å­˜â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ å¤„ç†å™¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†‘
                    æµªè´¹æ—¶é—´å’Œå†…å­˜

é›¶æ‹·è´æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     å¼•ç”¨     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…±äº«å†…å­˜       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ å¤„ç†å™¨  â”‚
â”‚ (JS + Wasm)     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å®ç°é›¶æ‹·è´

#### ä½¿ç”¨ wasm-bindgen çš„ Uint8Array

```rust
use wasm_bindgen::prelude::*;

// âŒ æ‹·è´æ•°æ®
#[wasm_bindgen]
pub fn process_copy(data: Vec<u8>) -> Vec<u8> {
    // data è¢«æ‹·è´åˆ° Wasm å†…å­˜
    data.into_iter().map(|b| b * 2).collect()
    // ç»“æœè¢«æ‹·è´å› JS
}

// âœ… é›¶æ‹·è´ï¼ˆä½¿ç”¨è§†å›¾ï¼‰
#[wasm_bindgen]
pub fn process_view(data: &[u8]) -> Box<[u8]> {
    // ç›´æ¥è®¿é—® JS çš„ ArrayBuffer
    let result: Vec<u8> = data.iter().map(|b| b * 2).collect();
    result.into_boxed_slice()
}

// âœ… åŸåœ°ä¿®æ”¹ï¼ˆçœŸæ­£çš„é›¶æ‹·è´ï¼‰
#[wasm_bindgen]
pub fn process_inplace(data: &mut [u8]) {
    for byte in data {
        *byte *= 2;
    }
}
```

#### JavaScript ç«¯ä½¿ç”¨

```javascript
// ä¼ ç»Ÿæ–¹å¼ï¼ˆæ‹·è´ï¼‰
const data = new Uint8Array([1, 2, 3, 4])
const result = wasm.process_copy(data)

// é›¶æ‹·è´æ–¹å¼
const data = new Uint8Array([1, 2, 3, 4])
wasm.process_inplace(data) // ç›´æ¥ä¿®æ”¹åŸæ•°ç»„

// æ€§èƒ½å¯¹æ¯”ï¼ˆ1MB æ•°æ®ï¼‰
// process_copy:    15 ms
// process_inplace:  3 ms  â­
```

### 3. å…±äº«å†…å­˜å’Œçº¿ç¨‹

```rust
use wasm_bindgen::prelude::*;
use web_sys::SharedArrayBuffer;

#[wasm_bindgen]
pub fn process_shared(buffer: SharedArrayBuffer) {
    // å¤šä¸ª Worker å¯ä»¥åŒæ—¶è®¿é—®æ­¤ç¼“å†²åŒº
    // æ— éœ€æ‹·è´ï¼Œå®ç°çœŸæ­£çš„é›¶æ‹·è´
}
```

---

## SIMD ä¼˜åŒ–

### 1. SIMD ç®€ä»‹

```text
æ ‡é‡å¤„ç†:
â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”
â”‚ 1 â”‚  â”‚ 2 â”‚  â”‚ 3 â”‚  â”‚ 4 â”‚  é€ä¸ªå¤„ç†
â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜

SIMD å¤„ç†:
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚  å¹¶è¡Œå¤„ç†
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
     â†“
ä¸€æ¡æŒ‡ä»¤å¤„ç† 4 ä¸ªæ•°æ® â†’ 4x æ€§èƒ½æå‡
```

### 2. ä½¿ç”¨ SIMD

#### å¯ç”¨ SIMD

```toml
# Cargo.toml
[dependencies]
packed_simd = "0.3"

[profile.release]
rustflags = ["-C", "target-feature=+simd128"]
```

#### SIMD ä»£ç ç¤ºä¾‹

```rust
#[cfg(target_arch = "wasm32")]
use std::arch::wasm32::*;

// æ ‡é‡ç‰ˆæœ¬
fn add_scalar(a: &[f32], b: &[f32], result: &mut [f32]) {
    for i in 0..a.len() {
        result[i] = a[i] + b[i];
    }
}

// SIMD ç‰ˆæœ¬ï¼ˆ4x å¹¶è¡Œï¼‰
#[cfg(target_arch = "wasm32")]
unsafe fn add_simd(a: &[f32], b: &[f32], result: &mut [f32]) {
    let len = a.len();
    let mut i = 0;

    // æ¯æ¬¡å¤„ç† 4 ä¸ªå…ƒç´ 
    while i + 4 <= len {
        let va = v128_load(a.as_ptr().add(i) as *const v128);
        let vb = v128_load(b.as_ptr().add(i) as *const v128);
        let vr = f32x4_add(va, vb);
        v128_store(result.as_mut_ptr().add(i) as *mut v128, vr);
        i += 4;
    }

    // å¤„ç†å‰©ä½™å…ƒç´ 
    while i < len {
        result[i] = a[i] + b[i];
        i += 1;
    }
}
```

#### æ€§èƒ½å¯¹æ¯”

```text
æ•°ç»„å¤§å°: 1M å…ƒç´ 

æ ‡é‡ç‰ˆæœ¬:  8.5 ms
SIMD ç‰ˆæœ¬: 2.1 ms  â­ 4x åŠ é€Ÿ
```

### 3. SIMD æœ€ä½³å®è·µ

```rust
use std::arch::wasm32::*;

/// å›¾åƒå¤„ç†ï¼šåº”ç”¨äº®åº¦è°ƒæ•´ï¼ˆSIMD ä¼˜åŒ–ï¼‰
#[cfg(target_arch = "wasm32")]
pub unsafe fn adjust_brightness_simd(pixels: &mut [u8], factor: f32) {
    let factor_vec = f32x4_splat(factor);
    let mut i = 0;
    let len = pixels.len();

    // SIMDï¼šæ¯æ¬¡å¤„ç† 16 å­—èŠ‚ï¼ˆRGBA * 4 åƒç´ ï¼‰
    while i + 16 <= len {
        // åŠ è½½ 16 ä¸ªå­—èŠ‚
        let data = v128_load(pixels.as_ptr().add(i) as *const v128);

        // è½¬æ¢ä¸ºæµ®ç‚¹
        let r = u32x4_extend_low_u16x8(u16x8_extend_low_u8x16(data));
        let floats = f32x4_convert_i32x4(r);

        // åº”ç”¨å› å­
        let adjusted = f32x4_mul(floats, factor_vec);

        // è½¬å›æ•´æ•°å¹¶å­˜å‚¨
        let ints = i32x4_trunc_sat_f32x4(adjusted);
        let bytes = u8x16_narrow_i16x8(i16x8_narrow_i32x4(ints, ints), i16x8_splat(0));
        v128_store(pixels.as_mut_ptr().add(i) as *mut v128, bytes);

        i += 16;
    }

    // æ ‡é‡å¤„ç†å‰©ä½™åƒç´ 
    while i < len {
        pixels[i] = (pixels[i] as f32 * factor).min(255.0) as u8;
        i += 1;
    }
}
```

---

## æ€§èƒ½åˆ†æå·¥å…·

### 1. æµè§ˆå™¨æ€§èƒ½åˆ†æ

#### Chrome DevTools

```javascript
// ä½¿ç”¨ Performance API
performance.mark("wasm-start")
wasm.expensive_function()
performance.mark("wasm-end")
performance.measure("wasm-execution", "wasm-start", "wasm-end")

// è·å–æµ‹é‡ç»“æœ
const measures = performance.getEntriesByName("wasm-execution")
console.log(`Execution time: ${measures[0].duration} ms`)
```

#### æ—¶é—´åˆ†æ

```javascript
console.time("wasm-init")
const wasm = await init()
console.timeEnd("wasm-init")

console.time("computation")
const result = wasm.compute(largeData)
console.timeEnd("computation")
```

### 2. WasmEdge æ€§èƒ½åˆ†æ

```bash
# ç»Ÿè®¡æ‰§è¡Œæ—¶é—´
wasmedge --enable-statistics app.wasm

# è¾“å‡ºç¤ºä¾‹:
# [StatisticsWASM] Execution time: 1.234 ms
# [StatisticsWASM] Instructions: 1000000
# [StatisticsWASM] Gas: 5000000

# è¯¦ç»†åˆ†æ
wasmedge --enable-statistics --statistics-detail app.wasm
```

### 3. Rust æ€§èƒ½åˆ†æ

#### Criterion åŸºå‡†æµ‹è¯•

```rust
use criterion::{black_box, criterion_group, criterion_main, Criterion};

fn benchmark_function(c: &mut Criterion) {
    c.bench_function("my_function", |b| {
        b.iter(|| {
            my_function(black_box(1000))
        });
    });
}

criterion_group!(benches, benchmark_function);
criterion_main!(benches);
```

```bash
# è¿è¡ŒåŸºå‡†æµ‹è¯•
cargo bench --target wasm32-wasi

# ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
# æŸ¥çœ‹ target/criterion/report/index.html
```

---

## æœ€ä½³å®è·µ

### 1. ä»£ç å±‚é¢ä¼˜åŒ–æ¸…å•

```rust
// âœ… DO: ä½¿ç”¨è¿­ä»£å™¨è€Œéå¾ªç¯
data.iter().filter(|x| x.is_positive()).sum()

// âŒ DON'T: æ‰‹åŠ¨å¾ªç¯
let mut sum = 0;
for x in &data {
    if x.is_positive() {
        sum += x;
    }
}

// âœ… DO: ä½¿ç”¨ &str è€Œé String
fn process(s: &str) { }

// âŒ DON'T: ä¸å¿…è¦çš„ String
fn process(s: String) { }  // éœ€è¦å…‹éš†

// âœ… DO: å»¶è¿Ÿè®¡ç®—
let expensive = |
| compute_expensive_value();
if condition {
    expensive();  // åªåœ¨éœ€è¦æ—¶è®¡ç®—
}

// âŒ DON'T: æå‰è®¡ç®—
let expensive = compute_expensive_value();  // æ€»æ˜¯è®¡ç®—
if condition {
    // ä½¿ç”¨ expensive
}
```

### 2. ç®—æ³•é€‰æ‹©

| æ“ä½œ       | æ•°æ®é‡å° (< 1K) | æ•°æ®é‡ä¸­ (1K-100K) | æ•°æ®é‡å¤§ (> 100K) |
| :--- | :--- | :--- | :--- |
| **æ’åº**   | æ’å…¥æ’åº        | å¿«é€Ÿæ’åº           | å½’å¹¶æ’åº + å¤šçº¿ç¨‹ |
| **æŸ¥æ‰¾**   | çº¿æ€§æŸ¥æ‰¾        | äºŒåˆ†æŸ¥æ‰¾           | HashMap           |
| **å­—ç¬¦ä¸²** | æ™®é€š String     | Cow<str>           | é›¶æ‹·è´åˆ‡ç‰‡        |

### 3. æ€§èƒ½ä¼˜åŒ– Checklist

#### ç¼–è¯‘ä¼˜åŒ– âœ“

- [ ] å¯ç”¨ `opt-level = "z"` æˆ– `3`
- [ ] å¯ç”¨ LTO
- [ ] è®¾ç½® `codegen-units = 1`
- [ ] å¯ç”¨ `strip = true`
- [ ] ä½¿ç”¨ `wasm-opt` åå¤„ç†

#### å†…å­˜ä¼˜åŒ– âœ“

- [ ] é¢„åˆ†é… Vec å®¹é‡
- [ ] å¤ç”¨ç¼“å†²åŒº
- [ ] é¿å…ä¸å¿…è¦çš„å…‹éš†
- [ ] ä½¿ç”¨å¼•ç”¨è€Œéæ‰€æœ‰æƒ
- [ ] å®ç°å¯¹è±¡æ± ï¼ˆå¦‚éœ€è¦ï¼‰

#### è¿è¡Œæ—¶ä¼˜åŒ– âœ“

- [ ] ä½¿ç”¨ AOT ç¼–è¯‘ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] å¯ç”¨ SIMDï¼ˆé€‚ç”¨åœºæ™¯ï¼‰
- [ ] å®ç°é›¶æ‹·è´ä¼ è¾“
- [ ] è€ƒè™‘å¤šçº¿ç¨‹å¹¶è¡Œ

#### ç½‘ç»œä¼˜åŒ– âœ“

- [ ] å¯ç”¨ gzip/brotli å‹ç¼©
- [ ] ä½¿ç”¨ CDN åˆ†å‘
- [ ] å®ç°æ‡’åŠ è½½
- [ ] æ‹†åˆ†ä»£ç ï¼ˆå¦‚éœ€è¦ï¼‰

### 4. æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹

```rust
// åœºæ™¯ï¼šå¤„ç† 1MB å›¾åƒæ•°æ®

// æ–¹æ¡ˆ 1: æœ´ç´ å®ç°
pub fn process_v1(data: Vec<u8>) -> Vec<u8> {
    data.into_iter().map(|b| b.wrapping_mul(2)).collect()
}
// æ€§èƒ½: 15 ms

// æ–¹æ¡ˆ 2: é¢„åˆ†é… + è¿­ä»£å™¨
pub fn process_v2(data: &[u8]) -> Vec<u8> {
    let mut result = Vec::with_capacity(data.len());
    result.extend(data.iter().map(|b| b.wrapping_mul(2)));
    result
}
// æ€§èƒ½: 8 ms  (1.9x åŠ é€Ÿ)

// æ–¹æ¡ˆ 3: åŸåœ°ä¿®æ”¹
pub fn process_v3(data: &mut [u8]) {
    data.iter_mut().for_each(|b| *b = b.wrapping_mul(2));
}
// æ€§èƒ½: 4 ms  (3.8x åŠ é€Ÿ)

// æ–¹æ¡ˆ 4: SIMD
#[cfg(target_arch = "wasm32")]
pub unsafe fn process_v4(data: &mut [u8]) {
    // SIMD å®ç°...
}
// æ€§èƒ½: 1 ms  (15x åŠ é€Ÿ) â­
```

---

## æ€»ç»“

### æ€§èƒ½ä¼˜åŒ–é‡‘å­—å¡”

```text
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ ç®—æ³•ä¼˜åŒ–     â”‚  å½±å“æœ€å¤§
           â”‚  O(nÂ²) â†’ O(nâ”‚  log n)
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚ æ•°æ®ç»“æ„     â”‚  æ¬¡é‡è¦
           â”‚ Vec vs       â”‚  HashMap
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚ ç¼–è¯‘ä¼˜åŒ–     â”‚  ä¸­ç­‰å½±å“
           â”‚ LTO, opt     â”‚  -level
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚ SIMD/AOT    â”‚  é”¦ä¸Šæ·»èŠ±
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®è¦ç‚¹

1. **å…ˆä¼˜åŒ–ç®—æ³•**ï¼šO(nÂ²) ä¼˜åŒ–åˆ° O(n log n) æ¯”ä»»ä½•å…¶ä»–ä¼˜åŒ–éƒ½é‡è¦
2. **æµ‹é‡å†ä¼˜åŒ–**ï¼šä¸è¦ç›²ç›®ä¼˜åŒ–ï¼Œå…ˆç”¨å·¥å…·æµ‹é‡ç“¶é¢ˆ
3. **å¾ªåºæ¸è¿›**ï¼šä»é«˜å±‚ä¼˜åŒ–å¼€å§‹ï¼Œé€æ­¥æ·±å…¥ç»†èŠ‚
4. **æƒè¡¡å–èˆ**ï¼šæ€§èƒ½ã€å¤§å°ã€å¼€å‘æ•ˆç‡ä¹‹é—´éœ€è¦å¹³è¡¡

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

- [ ] è®¾ç½®æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] ä½¿ç”¨ wasm-opt ä¼˜åŒ–ç°æœ‰é¡¹ç›®
- [ ] å°è¯• AOT ç¼–è¯‘
- [ ] æ¢ç´¢ SIMD åœ¨ä½ çš„åœºæ™¯ä¸­çš„åº”ç”¨
- [ ] å®ç°é›¶æ‹·è´æ•°æ®ä¼ è¾“

### å‚è€ƒèµ„æº

- [Rust Performance Book](https://nnethercote.github.io/perf-book/)
- [WasmEdge Performance](https://wasmedge.org/docs/develop/rust/performance/)
- [WebAssembly SIMD](https://github.com/WebAssembly/simd)
- [wasm-opt Documentation](https://github.com/WebAssembly/binaryen#tools)

---

**æ–‡æ¡£ç»´æŠ¤**: Documentation Team
**æœ€åæ›´æ–°**: 2025-12-11
**ä¸‹ä¸€æ¬¡æ›´æ–°**: æ ¹æ®å·¥å…·é“¾å’Œæœ€ä½³å®è·µæ¼”è¿›

---

_æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ã€‚å§‹ç»ˆè®°ä½ï¼šé¦–å…ˆä½¿ä»£ç æ­£ç¡®ï¼Œç„¶åä½¿å…¶å¿«é€Ÿã€‚_ ğŸš€
