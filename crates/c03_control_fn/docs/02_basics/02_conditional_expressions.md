# 02. æ¡ä»¶è¡¨è¾¾å¼ (Conditional Expressions)

> **æ–‡æ¡£ç±»å‹**ï¼šåŸºç¡€  
> **éš¾åº¦ç­‰çº§**ï¼šâ­â­  
> **é¢„è®¡é˜…è¯»æ—¶é—´**ï¼š1.5å°æ—¶  
> **å‰ç½®çŸ¥è¯†**ï¼šRust åŸºæœ¬è¯­æ³•ã€å¸ƒå°”ç±»å‹ã€æ¨¡å¼åŒ¹é…åŸºç¡€

## ğŸ“– å†…å®¹æ¦‚è¿°

æ¡ä»¶è¡¨è¾¾å¼æ˜¯ Rust æ§åˆ¶æµçš„åŸºçŸ³ï¼Œå…è®¸ç¨‹åºæ ¹æ®ä¸åŒæ¡ä»¶æ‰§è¡Œä¸åŒçš„ä»£ç è·¯å¾„ã€‚æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç» ifã€if let å’Œ match è¡¨è¾¾å¼ï¼Œä»¥åŠå®ƒä»¬ä¸æ‰€æœ‰æƒç³»ç»Ÿçš„äº¤äº’ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬æ–‡æ¡£å­¦ä¹ åï¼Œä½ å°†èƒ½å¤Ÿï¼š

- [ ] ç†è§£ if è¡¨è¾¾å¼çš„è¡¨è¾¾å¼ç‰¹æ€§å’Œç±»å‹çº¦æŸ
- [ ] ä½¿ç”¨ if let ç®€åŒ–ç®€å•çš„æ¨¡å¼åŒ¹é…
- [ ] æŒæ¡ match è¡¨è¾¾å¼çš„å¼ºå¤§åŠŸèƒ½å’Œç©·å°½æ€§æ£€æŸ¥
- [ ] ç†è§£æ¡ä»¶è¡¨è¾¾å¼ä¸­çš„æ‰€æœ‰æƒå’Œå€Ÿç”¨è§„åˆ™
- [ ] åº”ç”¨å®ˆå«æ¡ä»¶å®ç°å¤æ‚çš„åŒ¹é…é€»è¾‘

## ğŸ“š ç›®å½•

- [02. æ¡ä»¶è¡¨è¾¾å¼ (Conditional Expressions)](#02-æ¡ä»¶è¡¨è¾¾å¼-conditional-expressions)
  - [ğŸ“– å†…å®¹æ¦‚è¿°](#-å†…å®¹æ¦‚è¿°)
  - [ğŸ¯ å­¦ä¹ ç›®æ ‡](#-å­¦ä¹ ç›®æ ‡)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [2.1. `if` ä¸ `if let`](#21-if-ä¸-if-let)
    - [2.1.1. `if` è¡¨è¾¾å¼](#211-if-è¡¨è¾¾å¼)
    - [2.1.2. `if let` è¡¨è¾¾å¼ï¼šä¾¿æ·çš„æ¨¡å¼åŒ¹é…](#212-if-let-è¡¨è¾¾å¼ä¾¿æ·çš„æ¨¡å¼åŒ¹é…)
  - [2.2. `match` è¡¨è¾¾å¼ï¼šå¼ºå¤§çš„æ¨¡å¼åŒ¹é…](#22-match-è¡¨è¾¾å¼å¼ºå¤§çš„æ¨¡å¼åŒ¹é…)

---

## 2.1. `if` ä¸ `if let`

### 2.1.1. `if` è¡¨è¾¾å¼

`if` è¡¨è¾¾å¼åŸºäºä¸€ä¸ªå¸ƒå°”æ¡ä»¶æ¥é€‰æ‹©æ‰§è¡Œä¸¤ä¸ªä»£ç å—ä¹‹ä¸€ã€‚

**å½¢å¼åŒ–å®šä¹‰**:
ä¸€ä¸ª `if` è¡¨è¾¾å¼ \(E_{if}\) æ¥å—ä¸€ä¸ªæ¡ä»¶ \(c\) (å¿…é¡»ä¸º `bool` ç±»å‹) å’Œä¸¤ä¸ªä»£ç å—ï¼Œä¸€ä¸ªç”¨äº `true` æƒ…å†µ (\(b_t\))ï¼Œä¸€ä¸ªç”¨äº `false` æƒ…å†µ (\(b_f\))ã€‚
\[ E_{if}(c, b_t, b_f) = \begin{cases} eval(b_t) & \text{if } c = \text{true} \\ eval(b_f) & \text{if } c = \text{false} \end{cases} \]

**ç±»å‹ç³»ç»Ÿçº¦æŸ**:
ä¸ºäº†ä¿è¯ç±»å‹å®‰å…¨ï¼Œ`if` è¡¨è¾¾å¼çš„æ‰€æœ‰åˆ†æ”¯å¿…é¡»è¿”å›**ç›¸åŒç±»å‹**çš„å€¼ã€‚å¦‚æœåˆ†æ”¯ä¸æ˜¾å¼è¿”å›å€¼ï¼Œåˆ™å®ƒä»¬éšå¼è¿”å›å•å…ƒç±»å‹ `()`ã€‚

**æ‰€æœ‰æƒä¸å€Ÿç”¨**:
å€Ÿç”¨æ£€æŸ¥å™¨ä¼šç‹¬ç«‹ä½†ååŒåœ°åˆ†ææ‰€æœ‰åˆ†æ”¯ï¼š

1. **ç§»åŠ¨ (Move)**: å¦‚æœä¸€ä¸ªå€¼çš„æ‰€æœ‰æƒåœ¨**æŸä¸ª**åˆ†æ”¯ä¸­è¢«ç§»å‡ºï¼Œé‚£ä¹ˆåœ¨ `if` è¡¨è¾¾å¼ä¹‹åï¼Œè¯¥å€¼é€šå¸¸è¢«è§†ä¸ºä¸å¯ç”¨ï¼Œé™¤é**æ‰€æœ‰**åˆ†æ”¯éƒ½å°†æ‰€æœ‰æƒç§»å‡ºåˆ°åŒä¸€ä¸ªå˜é‡ä¸­ã€‚ç¼–è¯‘å™¨éœ€è¦ç¡®ä¿åœ¨æ‰€æœ‰è·¯å¾„ç»“æŸåï¼Œå˜é‡çš„åˆå§‹åŒ–çŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚
2. **å€Ÿç”¨ (Borrow)**: åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸­åˆ›å»ºçš„å€Ÿç”¨ï¼Œå…¶æœ‰æ•ˆæ€§ä¸èƒ½ä¸å¦ä¸€åˆ†æ”¯ä¸­çš„å€Ÿç”¨ç›¸å†²çªã€‚ä¾‹å¦‚ï¼Œä¸èƒ½åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸­å¯¹å˜é‡ `x` è¿›è¡Œå¯å˜å€Ÿç”¨ï¼Œè€Œåœ¨å¦ä¸€åˆ†æ”¯ä¸­è¿›è¡Œä¸å¯å˜å€Ÿç”¨ï¼Œå¦‚æœè¿™ä¸¤ä¸ªå€Ÿç”¨åœ¨ `if` å—ä¹‹å¤–ä»ç„¶å¯èƒ½è¢«ä½¿ç”¨ã€‚

**ä»£ç ç¤ºä¾‹**:

```rust
fn get_level(score: i32) -> &'static str {
    // è¡¨è¾¾å¼è¿”å›å€¼ï¼Œæ‰€æœ‰åˆ†æ”¯ç±»å‹å¿…é¡»ä¸º &'static str
    let level = if score > 90 {
        "Expert"
    } else if score > 60 {
        "Advanced"
    } else {
        "Beginner"
    };
    level
}

fn move_semantics_example(condition: bool) {
    let s = String::from("hello");
    if condition {
        // s çš„æ‰€æœ‰æƒè¢«ç§»åŠ¨
        drop(s);
    }
    // ç¼–è¯‘é”™è¯¯: `s` åœ¨æ­¤å¯èƒ½æœªè¢«åˆå§‹åŒ–ï¼Œå› ä¸º `if` åˆ†æ”¯æ¶ˆè€—äº†å®ƒ
    // println!("{}", s);
}
```

### 2.1.2. `if let` è¡¨è¾¾å¼ï¼šä¾¿æ·çš„æ¨¡å¼åŒ¹é…

`if let` æ˜¯ `match` è¡¨è¾¾å¼çš„è¯­æ³•ç³–ï¼Œç”¨äºå¤„ç†åªå…³å¿ƒä¸€ç§æˆ–å°‘æ•°å‡ ç§æ¨¡å¼åŒ¹é…æˆåŠŸçš„æƒ…å†µï¼Œé¿å…äº†ç¼–å†™ `match` æ—¶éœ€è¦å¤„ç†æ‰€æœ‰å¯èƒ½æƒ…å†µçš„å†—é•¿ä»£ç ã€‚

**å½¢å¼åŒ–å®šä¹‰**:
`if let pattern = expression { block_true } else { block_false }`
è¿™åœ¨è¯­ä¹‰ä¸Šç­‰ä»·äºï¼š

```rust
match expression {
    pattern => { block_true },
    _ => { block_false },
}
```

`else` åˆ†æ”¯æ˜¯å¯é€‰çš„ã€‚

**ç”¨ä¾‹**:
`if let` æœ€å¸¸ç”¨äºè§£æ„ `Option` å’Œ `Result`ã€‚

```rust
let maybe_value: Option<i32> = Some(10);

if let Some(value) = maybe_value {
    // ä»…åœ¨ maybe_value æ˜¯ Some(...) æ—¶æ‰§è¡Œ
    println!("Got value: {}", value);
}
// `value` å˜é‡çš„ä½œç”¨åŸŸä»…é™äº if let å—å†…éƒ¨
```

## 2.2. `match` è¡¨è¾¾å¼ï¼šå¼ºå¤§çš„æ¨¡å¼åŒ¹é…

`match` æ˜¯ Rust ä¸­æœ€å¼ºå¤§ã€æœ€é€šç”¨çš„æ§åˆ¶æµç»“æ„ä¹‹ä¸€ã€‚å®ƒå…è®¸å°†ä¸€ä¸ªå€¼ä¸ä¸€ç³»åˆ—æ¨¡å¼è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶æ ¹æ®ç¬¬ä¸€ä¸ªæˆåŠŸåŒ¹é…çš„æ¨¡å¼æ‰§è¡Œç›¸åº”çš„ä»£ç å—ã€‚

**å½¢å¼åŒ–å®šä¹‰**:
ä¸€ä¸ª `match` è¡¨è¾¾å¼ \(E_{m}\) æ¥å—ä¸€ä¸ªå€¼ \(v\) å’Œä¸€ä¸ªæ¨¡å¼-è¡¨è¾¾å¼å¯¹çš„åˆ—è¡¨ \([(p_i, e_i), ...]\)ã€‚å®ƒä¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸçš„æ¨¡å¼ \(p_k\) å¯¹åº”çš„è¡¨è¾¾å¼ \(e_k\) çš„æ±‚å€¼ç»“æœã€‚
\[ E_{match}(v, [(p_i, e_i)]) = eval(e_k) \text{ where } p_k \text{ is the first pattern matching } v \]

**æ ¸å¿ƒç‰¹æ€§**:

1. **ç©·å°½æ€§ (Exhaustiveness)**
    - **å®šä¹‰**: `match` è¡¨è¾¾å¼å¿…é¡»æ˜¯**ç©·å°½çš„**ï¼Œå³å®ƒçš„æ¨¡å¼å¿…é¡»è¦†ç›–æ‰€æœ‰å¯èƒ½è¾“å…¥çš„å€¼ã€‚
    - **ä¿è¯**: ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶é™æ€åœ°å¼ºåˆ¶æ‰§è¡Œæ­¤è§„åˆ™ã€‚å¦‚æœä¸€ä¸ª `match` éç©·å°½ï¼Œä»£ç å°†æ— æ³•ç¼–è¯‘ã€‚è¿™ä»æ ¹æœ¬ä¸Šæ¶ˆé™¤äº†å› å¿˜è®°å¤„ç†æŸäº›æƒ…å†µè€Œå¯¼è‡´çš„ bugï¼ˆä¾‹å¦‚ C/C++ `switch` è¯­å¥å¿˜è®° `default`ï¼‰ã€‚
    - **å®ç°**: å¯¹äº `enum`ï¼Œéœ€è¦è¦†ç›–æ‰€æœ‰å˜ä½“ã€‚å¯¹äºæ•´æ•°ã€å­—ç¬¦ä¸²ç­‰å¼€æ”¾ç±»å‹ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨é€šé…ç¬¦ `_` æ¥å¤„ç†æ‰€æœ‰å…¶ä»–æƒ…å†µã€‚

2. **æ¨¡å¼ (Patterns)**
    Rust çš„æ¨¡å¼éå¸¸å¼ºå¤§ï¼ŒåŒ…æ‹¬ï¼š
    - å­—é¢å€¼: `1`, `"hello"`
    - å˜é‡ç»‘å®š: `Some(x)` ä¼šå°† `Option` å†…éƒ¨çš„å€¼ç»‘å®šåˆ°å˜é‡ `x`
    - è§£æ„: `Point { x, y }` å¯ä»¥è§£æ„ç»“æ„ä½“
    - é€šé…ç¬¦: `_` åŒ¹é…ä»»ä½•å€¼ä½†ä¸ç»‘å®š
    - èŒƒå›´: `1..=5` (ä»…é™æ•°å­—å’Œå­—ç¬¦)
    - å®ˆå« (Guards): `Some(n) if n > 0`ï¼Œæä¾›é¢å¤–çš„æ¡ä»¶åˆ¤æ–­

**æ‰€æœ‰æƒä¸å€Ÿç”¨**:
`match` åˆ†æ”¯ä¸­çš„æ‰€æœ‰æƒè§„åˆ™ä¸ `if` ç±»ä¼¼ã€‚

- **ç»‘å®šæ¨¡å¼**: å½“ä¸€ä¸ªæ¨¡å¼ç»‘å®šä¸€ä¸ªå˜é‡æ—¶ï¼Œæ‰€æœ‰æƒä¼šæ ¹æ®è¢«åŒ¹é…å€¼çš„ç±»å‹å’Œç»‘å®šçš„æ–¹å¼è¿›è¡Œç§»åŠ¨æˆ–å€Ÿç”¨ã€‚
  - å¯¹äºé `Copy` ç±»å‹ï¼Œå¦‚ `String`ï¼Œ`case Message::Write(text)` ä¼šå°†å€¼ç§»å…¥ `text`ã€‚
  - è‹¥è¦é¿å…ç§»åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ `ref` å…³é”®å­— (`ref text`) æˆ–å¯¹å¼•ç”¨è¿›è¡ŒåŒ¹é… (`&Message::Write(ref text)`)ã€‚
- **åˆ†æ”¯å…¼å®¹æ€§**: æ‰€æœ‰åˆ†æ”¯å¿…é¡»åœ¨æ‰€æœ‰æƒä¸Šå…¼å®¹ï¼Œç¡®ä¿ `match` ç»“æŸåæ‰€æœ‰å˜é‡çš„çŠ¶æ€æ˜¯ç¡®å®šçš„ã€‚

**ä»£ç ç¤ºä¾‹**:

```rust
enum State {
    Idle,
    Processing(u32),
    Finished,
    Error(String),
}

fn process_state(state: State) -> &'static str {
    match state {
        State::Idle => "Waiting to start.",
        State::Processing(id) if id > 100 => { // å¸¦å®ˆå«çš„æ¨¡å¼
            "Processing a high-priority item."
        },
        State::Processing(_) => "Processing.",
        State::Finished => "Done.",
        // `Error(s)` ä¼šç§»åŠ¨ Stringï¼Œä½†ç”±äºæˆ‘ä»¬åªè¿”å› &'static str
        // ä¸”ä¸å†ä½¿ç”¨ `s`ï¼Œè¿™æ˜¯å…è®¸çš„ã€‚
        State::Error(_) => "An error occurred.",
    } // ç¼–è¯‘å™¨ç¡®ä¿æ‰€æœ‰ State å˜ä½“éƒ½è¢«å¤„ç†
}
```

---

**ç« èŠ‚å¯¼èˆª:**

- **ä¸Šä¸€ç«  ->** `01_foundations_of_control_flow.md`
- **ä¸‹ä¸€ç«  ->** `03_iterative_constructs.md`: æ¢è®¨ `loop`, `for`, `while` ç­‰å¾ªç¯ç»“æ„ã€‚
- **è¿”å›ç›®å½• ->** `_index.md`
