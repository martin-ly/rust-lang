# 03. match 人体工学与绑定技巧 (Match Ergonomics - Rust 1.90)

> **文档类型**：高级  
> **难度等级**：⭐⭐⭐  
> **预计阅读时间**：1小时  
> **前置知识**：基础模式匹配、引用与借用

## 📊 目录

- [03. match 人体工学与绑定技巧 (Match Ergonomics - Rust 1.90)](#03-match-人体工学与绑定技巧-match-ergonomics---rust-190)
  - [📊 目录](#-目录)
  - [📖 内容概述](#-内容概述)
  - [🎯 学习目标](#-学习目标)
  - [📚 目录](#-目录-1)
  - [3.1. 穷尽性与兜底](#31-穷尽性与兜底)
  - [绑定与再利用（`@`）](#绑定与再利用)
  - [引用与可变引用匹配](#引用与可变引用匹配)
  - [人体工学：最小捕获与字段捕获](#人体工学最小捕获与字段捕获)

## 📖 内容概述

本文档聚焦 match 的可读性与工程实践，深入讲解穷尽性检查、@ 绑定、守卫条件、引用匹配、最小捕获的人体工学，以及枚举未来兼容性设计。

## 🎯 学习目标

完成本文档学习后，你将能够：

- [ ] 理解穷尽性检查的工程价值
- [ ] 使用 @ 绑定提升代码可读性
- [ ] 掌握引用和可变引用匹配技巧
- [ ] 设计面向未来的枚举 API
- [ ] 应用人体工学特性简化代码

## 📚 目录

- [03. match 人体工学与绑定技巧 (Match Ergonomics - Rust 1.90)](#03-match-人体工学与绑定技巧-match-ergonomics---rust-190)
  - [📊 目录](#-目录)
  - [📖 内容概述](#-内容概述)
  - [🎯 学习目标](#-学习目标)
  - [📚 目录](#-目录-1)
  - [3.1. 穷尽性与兜底](#31-穷尽性与兜底)
  - [绑定与再利用（`@`）](#绑定与再利用)
  - [引用与可变引用匹配](#引用与可变引用匹配)
  - [人体工学：最小捕获与字段捕获](#人体工学最小捕获与字段捕获)

---

## 3.1. 穷尽性与兜底

- 让编译器帮助你覆盖所有分支；
- 对外 API 建议保留兜底 `_`，避免未来枚举新增破坏下游。

```rust
enum Msg { Ping, Pong, Data(i32) }

fn handle(m: Msg) -> &'static str {
    match m {
        Msg::Ping => "ping",
        Msg::Pong => "pong",
        Msg::Data(x) if x > 0 => "pos",
        Msg::Data(_) => "nonpos",
    }
}
```

## 绑定与再利用（`@`）

```rust
fn describe(bytes: &[u8]) -> String {
    match bytes {
        head @ [0x7F, b'E', b'L', b'F', ..] => format!("ELF: {} bytes", head.len()),
        other => format!("raw: {} bytes", other.len()),
    }
}
```

## 引用与可变引用匹配

```rust
fn touch_first(v: &mut Vec<i32>) {
    match v.as_mut_slice() {
        [x, ..] => *x += 1,
        [] => {}
    }
}
```

## 人体工学：最小捕获与字段捕获

- 现代 Rust 会按需最小捕获，仅捕获闭包/匹配用到的部分字段；
- 利用结构体/枚举解构让“读必要字段”的意图更加明确。

```rust
struct Config { host: String, port: u16, tls: bool }

fn port_enabled(c: &Config) -> bool {
    match c {
        Config { port, .. } if *port != 0 => true,
        _ => false,
    }
}
```

---

工程建议：

- 在复杂布尔表达式前优先考虑“解构 + 守卫”；
- 同时需要整体值与部分字段时使用 `@`；
- 公共枚举匹配保留兜底，私有内部枚举不必过度兜底以获得更强的穷尽性检查。
