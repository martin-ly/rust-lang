# 控制流模式对比矩阵

> **文档类型**: 📊 对比矩阵 | 🔍 决策指南  
> **创建日期**: 2025-10-19  
> **Rust 版本**: 1.90+

---

## 目录

- [控制流模式对比矩阵](#控制流模式对比矩阵)
  - [目录](#目录)
  - [📋 文档概述](#-文档概述)
  - [1️⃣ 条件控制流对比矩阵](#1️⃣-条件控制流对比矩阵)
    - [基础对比](#基础对比)
    - [性能对比矩阵](#性能对比矩阵)
    - [适用场景矩阵](#适用场景矩阵)
    - [代码风格对比](#代码风格对比)
  - [2️⃣ 循环控制流对比矩阵](#2️⃣-循环控制流对比矩阵)
    - [基础对比1](#基础对比1)
    - [性能对比矩阵1](#性能对比矩阵1)
    - [适用场景决策矩阵](#适用场景决策矩阵)
    - [Rust 1.90增强](#rust-190增强)
  - [3️⃣ 模式匹配深度对比](#3️⃣-模式匹配深度对比)
    - [模式类型矩阵](#模式类型矩阵)
    - [模式特性对比](#模式特性对比)
  - [4️⃣ 跨语言对比矩阵](#4️⃣-跨语言对比矩阵)
    - [与其他语言的控制流对比](#与其他语言的控制流对比)
    - [模式匹配对比](#模式匹配对比)
  - [5️⃣ 决策流程图](#5️⃣-决策流程图)
    - [条件控制流选择流程](#条件控制流选择流程)
  - [🔗 参考文档](#-参考文档)

## 📋 文档概述

本文档提供控制流模式的**多维度对比矩阵**，支持快速决策和模式选择。

---

## 1️⃣ 条件控制流对比矩阵

### 基础对比

| 特性 | if/else | match | if let | let-else (1.90) | if-let链 (1.90) |
|------|---------|-------|--------|----------------|----------------|
| **表达式** | ✅ | ✅ | ✅ | ❌ (语句) | ✅ |
| **返回值** | ✅ | ✅ | ✅ | N/A | ✅ |
| **模式匹配** | ❌ | ✅ | ✅ | ✅ | ✅ |
| **穷尽性检查** | ❌ | ✅ | ❌ | 部分 | ❌ |
| **守卫条件** | N/A | ✅ | ✅ | ❌ | ✅ |
| **多模式** | N/A | ✅ | ❌ | ❌ | ✅ (链式) |
| **学习难度** | ⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐⭐ | ⭐⭐⭐ |
| **代码行数** | 3-5 | 5-15 | 2-3 | 1-2 | 3-8 |

### 性能对比矩阵

| 构造 | 编译时开销 | 运行时开销 | 内联可能性 | 分支预测 | 优化等级 |
|------|-----------|-----------|-----------|---------|---------|
| **if/else(2分支)** | 极低 | O(1) | 极高 | 好 | ⭐⭐⭐⭐⭐ |
| **if/else(多层)** | 低 | O(log n) | 高 | 中 | ⭐⭐⭐⭐ |
| **match(≤3分支)** | 低 | O(1) | 高 | 好 | ⭐⭐⭐⭐⭐ |
| **match(4-10分支)** | 中 | O(1) | 中 | 跳转表 | ⭐⭐⭐⭐⭐ |
| **match(>10分支)** | 中-高 | O(1) | 低 | 跳转表 | ⭐⭐⭐⭐⭐ |
| **if let** | 低 | O(1) | 高 | 好 | ⭐⭐⭐⭐⭐ |
| **let-else** | 低 | O(1) | 高 | 好 | ⭐⭐⭐⭐⭐ |

### 适用场景矩阵

| 场景 | 推荐方案 | 优先级 | 原因 | Rust 1.90增强 |
|------|---------|-------|------|--------------|
| **简单布尔条件** | if/else | ⭐⭐⭐⭐⭐ | 最直观 | 类型推断改进 |
| **枚举完全匹配** | match | ⭐⭐⭐⭐⭐ | 穷尽性保证 | 更好的错误消息 |
| **Option/Result单分支** | if let | ⭐⭐⭐⭐⭐ | 简洁 | let链支持 |
| **早期返回模式** | let-else | ⭐⭐⭐⭐⭐ | 最简洁 | 稳定化 |
| **多条件组合** | if-let链 | ⭐⭐⭐⭐ | 避免嵌套 | 新特性 |
| **范围匹配** | match | ⭐⭐⭐⭐⭐ | 范围模式 | - |
| **守卫条件** | match | ⭐⭐⭐⭐⭐ | if支持 | - |

### 代码风格对比

```rust
// 场景: 处理Optional值并早期返回

// ⭐⭐⭐ 传统match (5行)
let value = match get_config() {
    Some(v) => v,
    None => return Err("no config"),
};

// ⭐⭐⭐⭐ if-let (3行)
let value = if let Some(v) = get_config() {
    v
} else {
    return Err("no config");
};

// ⭐⭐⭐⭐⭐ let-else (1行, Rust 1.90)
let Some(value) = get_config() else { return Err("no config"); };
```

---

## 2️⃣ 循环控制流对比矩阵

### 基础对比1

| 特性 | loop | while | while let | for | 迭代器 |
|------|------|-------|-----------|-----|-------|
| **无限循环** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **条件终止** | 手动 | ✅ | ✅ | 自动 | 自动 |
| **break值** | ✅ | ❌ | ❌ | ❌ | N/A |
| **标签支持** | ✅ | ✅ | ✅ | ✅ | ❌ |
| **所有权模式** | 手动 | 手动 | 手动 | 自动 | 明确 |
| **迭代器消费** | N/A | N/A | ✅ | ✅ | ✅ |
| **学习难度** | ⭐ | ⭐ | ⭐⭐ | ⭐ | ⭐⭐⭐ |

### 性能对比矩阵1

| 循环类型 | 编译优化 | 循环展开 | 向量化 | SIMD | 零成本抽象 |
|---------|---------|---------|-------|------|----------|
| **loop** | ⭐⭐⭐⭐⭐ | ✅ | ✅ | ✅ | ✅ |
| **while** | ⭐⭐⭐⭐⭐ | ✅ | ✅ | ✅ | ✅ |
| **while let** | ⭐⭐⭐⭐ | 部分 | 部分 | ❌ | ✅ |
| **for** | ⭐⭐⭐⭐⭐ | ✅ | ✅ | ✅ | ✅ |
| **迭代器** | ⭐⭐⭐⭐⭐ | ✅ | ✅ | ✅ | ✅ |

### 适用场景决策矩阵

| 场景 | 推荐方案 | 优先级 | 原因 | 示例 |
|------|---------|-------|------|------|
| **已知集合遍历** | for | ⭐⭐⭐⭐⭐ | 最安全简洁 | `for item in &vec` |
| **状态机** | loop + match | ⭐⭐⭐⭐⭐ | 灵活 + break值 | FSM实现 |
| **条件循环** | while | ⭐⭐⭐⭐⭐ | 意图明确 | `while !done()` |
| **迭代直到None** | while let | ⭐⭐⭐⭐⭐ | 模式匹配 | `while let Some(x) = iter.next()` |
| **函数式处理** | 迭代器链 | ⭐⭐⭐⭐ | 声明式 | `.map().filter()` |
| **需要索引** | for + enumerate | ⭐⭐⭐⭐⭐ | 安全索引 | `for (i, item) in iter.enumerate()` |
| **需要返回值** | loop + break | ⭐⭐⭐⭐⭐ | break值 | `loop { break result; }` |

### Rust 1.90增强

| 特性 | 传统方式 | Rust 1.90 | 改进点 |
|------|---------|-----------|--------|
| **while-let链** | 嵌套if-let | `while let Some(x) = a && let Ok(y) = b` | 避免嵌套 |
| **标签块** | 有限支持 | 完整支持 | 更灵活 |
| **迭代器优化** | 好 | 更好 | +5%性能 |

---

## 3️⃣ 模式匹配深度对比

### 模式类型矩阵

| 模式类型 | 语法 | 可反驳性 | 绑定 | 嵌套 | 守卫 | 性能 |
|---------|------|---------|------|------|------|------|
| **字面量** | `42`, `"str"` | 可反驳 | ❌ | ❌ | ❌ | O(1) |
| **变量** | `x`, `mut y` | 不可反驳 | ✅ | ❌ | ❌ | O(1) |
| **通配符** | `_` | 不可反驳 | ❌ | ❌ | ❌ | O(1) |
| **元组** | `(a, b, c)` | 取决于子模式 | ✅ | ✅ | ✅ | O(1) |
| **结构体** | `Point{x, y}` | 取决于字段 | ✅ | ✅ | ✅ | O(1) |
| **枚举** | `Some(x)` | 可反驳 | ✅ | ✅ | ✅ | O(1) |
| **引用** | `&x`, `ref x` | 取决于内部 | ✅ | ✅ | ✅ | O(1) |
| **范围** | `1..=10` | 可反驳 | ❌ | ❌ | ❌ | O(1) |
| **切片** | `[a, b, ..]` | 可反驳 | ✅ | ✅ | ✅ | O(1) |

### 模式特性对比

| 特性 | match | if let | while let | let解构 | let-else |
|------|-------|--------|-----------|---------|---------|
| **字面量模式** | ✅ | ✅ | ✅ | ❌ | ✅ |
| **变量绑定** | ✅ | ✅ | ✅ | ✅ | ✅ |
| **通配符** | ✅ | ✅ | ✅ | ✅ | ❌ |
| **嵌套模式** | ✅ | ✅ | ✅ | ✅ | ✅ |
| **守卫条件** | ✅ | ✅ | ✅ | ❌ | ❌ |
| **@绑定** | ✅ | ✅ | ✅ | ✅ | ✅ |
| **OR模式** | ✅ | ✅ | ✅ | ❌ | ✅ |
| **穷尽性要求** | ✅ | ❌ | ❌ | 不可反驳 | 部分 |

---

## 4️⃣ 跨语言对比矩阵

### 与其他语言的控制流对比

| 特性 | Rust | C/C++ | Java | Python | Go |
|------|------|-------|------|--------|-----|
| **表达式if** | ✅ | 三元 | ❌ | ✅ | ❌ |
| **模式匹配** | ⭐⭐⭐⭐⭐ | C++17+ | Java 17+ | ⭐⭐⭐ | ⭐⭐ |
| **穷尽性检查** | 编译时 | ❌ | 编译时 | 运行时 | ❌ |
| **break with value** | ✅ | ❌ | ❌ | ❌ | ❌ |
| **标签块** | ✅ | goto | ❌ | ❌ | ✅ |
| **迭代器性能** | 零成本 | 零成本 | 开销 | 开销 | 开销 |
| **错误处理** | Result | 异常 | 异常 | 异常 | error值 |

### 模式匹配对比

| 语言 | 穷尽性 | 守卫 | 解构 | 性能 | 成熟度 |
|------|-------|------|------|------|-------|
| **Rust** | ⭐⭐⭐⭐⭐ | ✅ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Scala** | ⭐⭐⭐⭐ | ✅ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Haskell** | ⭐⭐⭐⭐⭐ | ✅ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Python 3.10+** | ⭐⭐ | ✅ | ⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ |
| **Java 17+** | ⭐⭐⭐ | 部分 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |

---

## 5️⃣ 决策流程图

### 条件控制流选择流程

```text
需要条件分支?
├─ 是 → 布尔条件?
│       ├─ 是 → if/else
│       └─ 否 → 需要模式匹配?
│               ├─ 是 → 穷尽性重要?
│               │       ├─ 是 → match
│               │       └─ 否 → 单模式?
│               │               ├─ 是 → if let
│               │               └─ 否 → match
│               └─ 否 → if/else
└─ 否 → 循环?
        ├─ 是 → 已知集合?
        │       ├─ 是 → for
        │       └─ 否 → 条件已知?
        │               ├─ 是 → while/while-let
        │               └─ 否 → loop
        └─ 否 → 其他控制流
```

---

## 🔗 参考文档

- [概念本体](./01_concept_ontology.md)
- [函数闭包矩阵](./11_function_closure_matrix.md)
- [错误处理矩阵](./12_error_handling_matrix.md)

---

**文档维护**: Rust 学习社区  
**文档版本**: v1.0
