# ç¬¬2å±‚ï¼šç³»ç»Ÿç¼–ç¨‹å±‚ (System Programming Layer)

> **å®šä½**: ç³»ç»Ÿçº§ç¼–ç¨‹æ‰€éœ€çš„å¹¶å‘ã€å†…å­˜ã€I/O ç­‰æ ¸å¿ƒèƒ½åŠ›  
> **ç‰¹ç‚¹**: é«˜æ€§èƒ½ã€é›¶æˆæœ¬æŠ½è±¡ã€å®‰å…¨å¹¶å‘  
> **ç‰ˆæœ¬**: Rust 1.90 (2025)

---

## ğŸ“‹ ç›®å½•

- [ç¬¬2å±‚ï¼šç³»ç»Ÿç¼–ç¨‹å±‚ (System Programming Layer)](#ç¬¬2å±‚ç³»ç»Ÿç¼–ç¨‹å±‚-system-programming-layer)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [å±‚çº§æ¦‚è¿°](#å±‚çº§æ¦‚è¿°)
    - [æ ¸å¿ƒèƒ½åŠ›](#æ ¸å¿ƒèƒ½åŠ›)
    - [æŠ€æœ¯æ ˆé€‰æ‹©](#æŠ€æœ¯æ ˆé€‰æ‹©)
  - [æ ¸å¿ƒç±»åˆ«](#æ ¸å¿ƒç±»åˆ«)
    - [1. å¼‚æ­¥è¿è¡Œæ—¶ (`async_runtime/`)](#1-å¼‚æ­¥è¿è¡Œæ—¶-async_runtime)
    - [2. å¹¶å‘åŸè¯­ (`concurrency/`)](#2-å¹¶å‘åŸè¯­-concurrency)
    - [3. å†…å­˜ç®¡ç† (`memory/`)](#3-å†…å­˜ç®¡ç†-memory)
    - [4. ç½‘ç»œç¼–ç¨‹ (`networking/`)](#4-ç½‘ç»œç¼–ç¨‹-networking)
    - [5. æ–‡ä»¶ I/O (`io/`)](#5-æ–‡ä»¶-io-io)
    - [6. é€šé“ (`channels/`)](#6-é€šé“-channels)
    - [7. Unsafe Rust (`unsafe/`)](#7-unsafe-rust-unsafe)
    - [8. è¿›ç¨‹ä¸ç³»ç»Ÿ (`process_system/`)](#8-è¿›ç¨‹ä¸ç³»ç»Ÿ-process_system)
  - [æŠ€æœ¯é€‰å‹æŒ‡å—](#æŠ€æœ¯é€‰å‹æŒ‡å—)
    - [å¼‚æ­¥ vs åŒæ­¥](#å¼‚æ­¥-vs-åŒæ­¥)
    - [å¹¶å‘æ¨¡å‹é€‰æ‹©](#å¹¶å‘æ¨¡å‹é€‰æ‹©)
    - [å†…å­˜ç®¡ç†ç­–ç•¥](#å†…å­˜ç®¡ç†ç­–ç•¥)
  - [å­¦ä¹ è·¯å¾„](#å­¦ä¹ è·¯å¾„)
    - [åˆçº§ï¼ˆ1-2å‘¨ï¼‰](#åˆçº§1-2å‘¨)
    - [ä¸­çº§ï¼ˆ3-4å‘¨ï¼‰](#ä¸­çº§3-4å‘¨)
    - [é«˜çº§ï¼ˆ5-8å‘¨ï¼‰](#é«˜çº§5-8å‘¨)
  - [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
    - [1. å¼‚æ­¥ + åŒæ­¥æ··åˆ](#1-å¼‚æ­¥--åŒæ­¥æ··åˆ)
    - [2. åˆç†ä½¿ç”¨é€šé“](#2-åˆç†ä½¿ç”¨é€šé“)
    - [3. å†…å­˜æ± å¤ç”¨](#3-å†…å­˜æ± å¤ç”¨)
    - [4. é›¶æ‹·è´ä¼˜åŒ–](#4-é›¶æ‹·è´ä¼˜åŒ–)
    - [5. ä¼˜é›…å…³é—­](#5-ä¼˜é›…å…³é—­)
  - [å‚è€ƒèµ„æº](#å‚è€ƒèµ„æº)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [æ·±åº¦æ–‡ç« ](#æ·±åº¦æ–‡ç« )
    - [å®æˆ˜é¡¹ç›®](#å®æˆ˜é¡¹ç›®)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## å±‚çº§æ¦‚è¿°

### æ ¸å¿ƒèƒ½åŠ›

**ç³»ç»Ÿç¼–ç¨‹å±‚** æ˜¯ Rust ç”Ÿæ€çš„æ ¸å¿ƒåŠ›é‡æ‰€åœ¨ï¼Œæä¾›æ„å»ºé«˜æ€§èƒ½ç³»ç»Ÿçº§åº”ç”¨çš„åŸºç¡€è®¾æ–½ã€‚

**å…³é”®ç‰¹æ€§**:

1. **é›¶æˆæœ¬æŠ½è±¡**: æ— è¿è¡Œæ—¶å¼€é”€çš„é«˜å±‚æŠ½è±¡
2. **å†…å­˜å®‰å…¨**: ç¼–è¯‘æœŸä¿è¯ï¼Œæ— éœ€ GC
3. **å¹¶å‘å®‰å…¨**: ç±»å‹ç³»ç»Ÿä¿è¯çº¿ç¨‹å®‰å…¨
4. **å¯é¢„æµ‹æ€§èƒ½**: æ—  GC æš‚åœï¼Œç¡®å®šæ€§å»¶è¿Ÿ

**å…¸å‹åº”ç”¨åœºæ™¯**:

- ğŸš€ é«˜æ€§èƒ½æœåŠ¡å™¨ï¼ˆWebã€æ•°æ®åº“ã€ç¼“å­˜ï¼‰
- ğŸ”§ ç³»ç»Ÿå·¥å…·ï¼ˆCLIã€å®ˆæŠ¤è¿›ç¨‹ã€ç½‘ç»œå·¥å…·ï¼‰
- ğŸ“¡ ç½‘ç»œæœåŠ¡ï¼ˆä»£ç†ã€è´Ÿè½½å‡è¡¡ã€ç½‘å…³ï¼‰
- ğŸ® å®æ—¶ç³»ç»Ÿï¼ˆæ¸¸æˆæœåŠ¡å™¨ã€æµåª’ä½“ï¼‰
- ğŸ” å®‰å…¨å…³é”®ç³»ç»Ÿï¼ˆåŠ å¯†ã€è®¤è¯ã€å®¡è®¡ï¼‰

### æŠ€æœ¯æ ˆé€‰æ‹©

**æŒ‰å¹¶å‘æ¨¡å‹åˆ†ç±»**:

| æ¨¡å‹ | é€‚ç”¨åœºæ™¯ | æ ¸å¿ƒåº“ | æ€§èƒ½ç‰¹ç‚¹ |
|------|---------|--------|----------|
| **å¼‚æ­¥ I/O** | ç½‘ç»œå¯†é›†å‹ | tokio, async-std | é«˜å¹¶å‘ã€ä½å»¶è¿Ÿ |
| **æ•°æ®å¹¶è¡Œ** | è®¡ç®—å¯†é›†å‹ | rayon | å……åˆ†åˆ©ç”¨å¤šæ ¸ |
| **æ··åˆæ¨¡å‹** | å¤æ‚ç³»ç»Ÿ | tokio + rayon | çµæ´»ç»„åˆ |

**æŒ‰æ€§èƒ½éœ€æ±‚åˆ†ç±»**:

| éœ€æ±‚ | æŠ€æœ¯æ ˆ | æƒè¡¡ |
|------|--------|------|
| **æè‡´æ€§èƒ½** | tokio + parking_lot + bytes | å¤æ‚åº¦é«˜ |
| **å¿«é€Ÿå¼€å‘** | async-std + crossbeam | æ˜“ç”¨æ€§ä¼˜å…ˆ |
| **è½»é‡çº§** | smol + flume | ä¾èµ–å°‘ã€ä½“ç§¯å° |

---

## æ ¸å¿ƒç±»åˆ«

### 1. å¼‚æ­¥è¿è¡Œæ—¶ ([`async_runtime/`](./async_runtime/))

**å¯¹æ¯”çŸ©é˜µ**:

| åº“å | ç‰¹ç‚¹ | ç”Ÿæ€è§„æ¨¡ | å­¦ä¹ æ›²çº¿ | æ¨èåº¦ |
|------|------|---------|---------|--------|
| **tokio** | åŠŸèƒ½æœ€å…¨ã€ç”Ÿæ€æœ€å¤§ã€å·¥ä¸šæ ‡å‡† | â­â­â­â­â­ | ä¸­ | â­â­â­â­â­ |
| **async-std** | ç±»ä¼¼æ ‡å‡†åº“ APIã€æ˜“ä¸Šæ‰‹ | â­â­â­â­ | ä½ | â­â­â­â­ |
| **smol** | è½»é‡çº§ã€é«˜æ€§èƒ½ã€æ¨¡å—åŒ– | â­â­â­ | ä¸­ | â­â­â­â­ |

**å¿«é€Ÿç¤ºä¾‹** (tokio):

```rust
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() {
    // å¹¶å‘ä»»åŠ¡
    let task1 = tokio::spawn(async {
        sleep(Duration::from_secs(1)).await;
        println!("Task 1 å®Œæˆ");
        1
    });
    
    let task2 = tokio::spawn(async {
        sleep(Duration::from_secs(2)).await;
        println!("Task 2 å®Œæˆ");
        2
    });
    
    // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡
    let (r1, r2) = tokio::join!(task1, task2);
    println!("ç»“æœ: {} + {} = {}", r1.unwrap(), r2.unwrap(), r1.unwrap() + r2.unwrap());
}
```

**æ€§èƒ½æ•°æ®**:

- **ååé‡**: 1M+ req/s (å•æ ¸ï¼Œecho server)
- **å»¶è¿Ÿ**: P99 < 1ms (ç©ºè½½)
- **å†…å­˜**: ~5MB (æœ€å°é…ç½®)

**é€‰æ‹©å»ºè®®**:

- **é€‰ tokio**: ç”Ÿäº§ç¯å¢ƒã€éœ€è¦å®Œæ•´ç”Ÿæ€ï¼ˆå¦‚ hyper, tonicï¼‰
- **é€‰ async-std**: å­¦ä¹ å¼‚æ­¥ç¼–ç¨‹ã€API ç®€å•åœºæ™¯
- **é€‰ smol**: åµŒå…¥å¼ã€WASMã€æœ€å°åŒ–ä¾èµ–

**è¯¦ç»†æ–‡æ¡£**: [`async_runtime/README.md`](./async_runtime/)

---

### 2. å¹¶å‘åŸè¯­ ([`concurrency/`](./concurrency/))

**å¯¹æ¯”çŸ©é˜µ**:

| åº“å | ç”¨é€” | ç‰¹ç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| **rayon** | æ•°æ®å¹¶è¡Œ | è‡ªåŠ¨è´Ÿè½½å‡è¡¡ã€work-stealing | â­â­â­â­â­ |
| **crossbeam** | å¹¶å‘æ•°æ®ç»“æ„ | æ— é”ç®—æ³•ã€channel | â­â­â­â­â­ |
| **parking_lot** | é«˜æ€§èƒ½é” | æ¯”æ ‡å‡†åº“å¿« 2-3x | â­â­â­â­â­ |

**å¿«é€Ÿç¤ºä¾‹** (rayon):

```rust
use rayon::prelude::*;

// å¹¶è¡Œè®¡ç®—
let sum: i32 = (1..=1_000_000)
    .into_par_iter()
    .map(|x| x * x)
    .sum();

println!("å¹³æ–¹å’Œ: {}", sum);

// å¹¶è¡Œæ’åº
let mut data = vec![3, 1, 4, 1, 5, 9, 2, 6];
data.par_sort_unstable();
```

**æ€§èƒ½å¯¹æ¯”**:

| æ“ä½œ | ä¸²è¡Œ | rayon | åŠ é€Ÿæ¯” (8æ ¸) |
|------|------|-------|-------------|
| æ±‚å’Œ (1M) | 2.5ms | 0.4ms | 6.25x |
| æ’åº (1M) | 120ms | 20ms | 6.0x |
| map-reduce | 50ms | 8ms | 6.25x |

**è¯¦ç»†æ–‡æ¡£**: [`concurrency/README.md`](./concurrency/)

---

### 3. å†…å­˜ç®¡ç† ([`memory/`](./memory/))

**å¯¹æ¯”çŸ©é˜µ**:

| åº“å | ç”¨é€” | ç‰¹ç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| **bytes** | å­—èŠ‚ç¼“å†²åŒº | é›¶æ‹·è´ã€å¼•ç”¨è®¡æ•° | â­â­â­â­â­ |
| **bumpalo** | ç«æŠ€åœºåˆ†é…å™¨ | å¿«é€Ÿåˆ†é…ã€æ‰¹é‡é‡Šæ”¾ | â­â­â­â­ |
| **slab** | å¯¹è±¡æ±  | å›ºå®šå¤§å°ã€O(1) åˆ†é… | â­â­â­â­ |

**å¿«é€Ÿç¤ºä¾‹** (bytes):

```rust
use bytes::{Bytes, BytesMut, Buf, BufMut};

// é›¶æ‹·è´åˆ‡ç‰‡
let data = Bytes::from("Hello, world!");
let slice1 = data.slice(0..5);  // "Hello"
let slice2 = data.slice(7..12); // "world"

// å¯å˜ç¼“å†²åŒº
let mut buf = BytesMut::with_capacity(1024);
buf.put_slice(b"Hello");
buf.put_u32(42);
```

**è¯¦ç»†æ–‡æ¡£**: [`memory/README.md`](./memory/)

---

### 4. ç½‘ç»œç¼–ç¨‹ ([`networking/`](./networking/))

**å¯¹æ¯”çŸ©é˜µ**:

| åº“å | å±‚æ¬¡ | ç‰¹ç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| **mio** | åº•å±‚äº‹ä»¶é©±åŠ¨ | epoll/kqueue å°è£… | â­â­â­â­ |
| **socket2** | Socket API | è·¨å¹³å°ã€åŠŸèƒ½å…¨ | â­â­â­â­ |
| **quinn** | QUIC åè®® | HTTP/3ã€UDP | â­â­â­â­ |

**æŠ€æœ¯æ ˆå»ºè®®**:

- **é«˜å±‚åº”ç”¨**: tokio + hyper/tonicï¼ˆä¸ç›´æ¥ç”¨ mioï¼‰
- **è‡ªå®šä¹‰åè®®**: tokio + mio
- **UDP åº”ç”¨**: socket2 + tokio
- **HTTP/3**: quinn + h3

**è¯¦ç»†æ–‡æ¡£**: [`networking/README.md`](./networking/)

---

### 5. æ–‡ä»¶ I/O ([`io/`](./io/))

**å¯¹æ¯”çŸ©é˜µ**:

| åº“å | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|------|---------|--------|
| **tokio::fs** | å¼‚æ­¥æ–‡ä»¶ I/O | é«˜å¹¶å‘ã€éé˜»å¡ | â­â­â­â­â­ |
| **std::fs** | åŒæ­¥æ–‡ä»¶ I/O | ç®€å•åœºæ™¯ã€è„šæœ¬ | â­â­â­â­â­ |
| **memmap2** | å†…å­˜æ˜ å°„ | å¤§æ–‡ä»¶ã€éšæœºè®¿é—® | â­â­â­â­ |
| **walkdir** | ç›®å½•éå† | é€’å½’æœç´¢ | â­â­â­â­ |

**æ€§èƒ½å¯¹æ¯”** (è¯»å– 1GB æ–‡ä»¶):

| æ–¹æ³• | è€—æ—¶ | å†…å­˜ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| `std::fs::read` | 3.2s | 1GB | å°æ–‡ä»¶ |
| `BufReader` | 1.5s | 8KB | é¡ºåºè¯»å– |
| `memmap2` | 0.1s | ~100MB | éšæœºè®¿é—® |
| `tokio::fs` | 1.6s | 8KB | å¼‚æ­¥åœºæ™¯ |

**è¯¦ç»†æ–‡æ¡£**: [`io/README.md`](./io/)

---

### 6. é€šé“ ([`channels/`](./channels/))

**å¯¹æ¯”çŸ©é˜µ**:

| åº“å | ç±»å‹ | æ€§èƒ½ | ç‰¹ç‚¹ | æ¨èåº¦ |
|------|------|------|------|--------|
| **crossbeam-channel** | MPMC | âš¡âš¡âš¡âš¡âš¡ | æ— é”ã€select | â­â­â­â­â­ |
| **flume** | MPMC | âš¡âš¡âš¡âš¡âš¡ | å¼‚æ­¥å…¼å®¹ | â­â­â­â­ |
| **tokio::sync::mpsc** | å¼‚æ­¥ MPSC | âš¡âš¡âš¡âš¡ | Tokio ç”Ÿæ€ | â­â­â­â­â­ |
| **std::sync::mpsc** | MPSC | âš¡âš¡âš¡ | æ ‡å‡†åº“ | â­â­â­ |

**é€‰æ‹©å»ºè®®**:

- **åŒæ­¥åœºæ™¯**: crossbeam-channelï¼ˆæœ€å¿«ï¼‰
- **å¼‚æ­¥åœºæ™¯**: tokio::sync::mpsc
- **æ··åˆåœºæ™¯**: flumeï¼ˆåŒæ­¥/å¼‚æ­¥å…¼å®¹ï¼‰
- **ç®€å•åœºæ™¯**: std::sync::mpsc

**è¯¦ç»†æ–‡æ¡£**: [`channels/README.md`](./channels/)

---

### 7. Unsafe Rust ([`unsafe/`](./unsafe/))

**æ ¸å¿ƒæ¦‚å¿µ**:

- è£¸æŒ‡é’ˆæ“ä½œ
- FFIï¼ˆForeign Function Interfaceï¼‰
- å†…è”æ±‡ç¼–
- ä¸å®‰å…¨ trait

**ä½¿ç”¨åœºæ™¯**:

- ğŸ”§ ä¸ C/C++ äº’æ“ä½œ
- âš¡ æ€§èƒ½å…³é”®è·¯å¾„ä¼˜åŒ–
- ğŸ¯ å®ç°æ— é”æ•°æ®ç»“æ„
- ğŸ”Œ ç¡¬ä»¶åº•å±‚æ“ä½œ

**å®‰å…¨å‡†åˆ™**:

1. **æœ€å°åŒ–ä½¿ç”¨**: å°½å¯èƒ½ç”¨å®‰å…¨æŠ½è±¡
2. **éš”ç¦»å°è£…**: æä¾›å®‰å…¨ API æ¥å£
3. **è¯¦ç»†æ–‡æ¡£**: è¯´æ˜ä¸å˜é‡å’Œå‰ç½®æ¡ä»¶
4. **å……åˆ†æµ‹è¯•**: åŒ…æ‹¬è¾¹ç•Œæ¡ä»¶å’Œå¹¶å‘åœºæ™¯

**è¯¦ç»†æ–‡æ¡£**: [`unsafe/README.md`](./unsafe/)

---

### 8. è¿›ç¨‹ä¸ç³»ç»Ÿ ([`process_system/`](./process_system/))

**æ ¸å¿ƒåº“**:

| åº“å | ç”¨é€” | æ¨èåº¦ |
|------|------|--------|
| **nix** | Unix ç³»ç»Ÿè°ƒç”¨ | â­â­â­â­â­ |
| **sysinfo** | ç³»ç»Ÿä¿¡æ¯ | â­â­â­â­â­ |
| **signal-hook** | ä¿¡å·å¤„ç† | â­â­â­â­â­ |
| **daemonize** | å®ˆæŠ¤è¿›ç¨‹ | â­â­â­â­ |

**åŠŸèƒ½è¦†ç›–**:

- è¿›ç¨‹ç®¡ç†ï¼ˆfork, exec, waitï¼‰
- ä¿¡å·å¤„ç†ï¼ˆSIGTERM, SIGINT, è‡ªå®šä¹‰ï¼‰
- ç³»ç»Ÿç›‘æ§ï¼ˆCPU, å†…å­˜, ç£ç›˜, ç½‘ç»œï¼‰
- è¿›ç¨‹é—´é€šä¿¡ï¼ˆç®¡é“, å…±äº«å†…å­˜ï¼‰
- å®ˆæŠ¤è¿›ç¨‹åŒ–

**è¯¦ç»†æ–‡æ¡£**: [`process_system/README.md`](./process_system/)

---

## æŠ€æœ¯é€‰å‹æŒ‡å—

### å¼‚æ­¥ vs åŒæ­¥

**é€‰æ‹©å¼‚æ­¥** (tokio/async-std):

- âœ… I/O å¯†é›†å‹ï¼ˆç½‘ç»œæœåŠ¡ã€æ•°æ®åº“ï¼‰
- âœ… é«˜å¹¶å‘ï¼ˆ>1000 è¿æ¥ï¼‰
- âœ… ä½å»¶è¿Ÿè¦æ±‚
- âœ… éœ€è¦å¼‚æ­¥ç”Ÿæ€ï¼ˆhyper, tonicï¼‰

**é€‰æ‹©åŒæ­¥** (rayon/crossbeam):

- âœ… è®¡ç®—å¯†é›†å‹ï¼ˆæ•°æ®å¤„ç†ã€å›¾åƒå¤„ç†ï¼‰
- âœ… ç®€å•åœºæ™¯ï¼ˆCLI å·¥å…·ã€è„šæœ¬ï¼‰
- âœ… ä½å¹¶å‘ï¼ˆ<100 è¿æ¥ï¼‰
- âœ… ä¸éœ€è¦å¼‚æ­¥ç”Ÿæ€

**æ··åˆæ¨¡å‹**:

```rust
#[tokio::main]
async fn main() {
    // å¼‚æ­¥å¤„ç†ç½‘ç»œè¯·æ±‚
    let data = fetch_data().await;
    
    // åŒæ­¥å¤„ç†è®¡ç®—å¯†é›†ä»»åŠ¡ï¼ˆä½¿ç”¨ spawn_blockingï¼‰
    let result = tokio::task::spawn_blocking(move || {
        // åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œ
        rayon::par_iter(&data)
            .map(|x| expensive_computation(x))
            .collect()
    }).await?;
}
```

### å¹¶å‘æ¨¡å‹é€‰æ‹©

**å†³ç­–æ ‘**:

```text
I/O å¯†é›†å‹ï¼Ÿ
â”œâ”€ æ˜¯ â†’ å¼‚æ­¥ I/O (tokio)
â”‚  â””â”€ éœ€è¦è®¡ç®—ï¼Ÿ
â”‚     â”œâ”€ æ˜¯ â†’ tokio + rayon (spawn_blocking)
â”‚     â””â”€ å¦ â†’ tokio
â”‚
â””â”€ å¦ â†’ è®¡ç®—å¯†é›†å‹
   â”œâ”€ æ•°æ®å¹¶è¡Œï¼Ÿ
   â”‚  â””â”€ æ˜¯ â†’ rayon
   â”‚
   â””â”€ ä»»åŠ¡å¹¶è¡Œï¼Ÿ
      â””â”€ æ˜¯ â†’ crossbeam + çº¿ç¨‹æ± 
```

### å†…å­˜ç®¡ç†ç­–ç•¥

**æ ‡å‡†ç­–ç•¥** (å¤§å¤šæ•°åœºæ™¯):

- ä½¿ç”¨æ ‡å‡†åº“æ™ºèƒ½æŒ‡é’ˆï¼ˆ`Box`, `Rc`, `Arc`ï¼‰
- å¿…è¦æ—¶ä½¿ç”¨ `bytes` å‡å°‘æ‹·è´
- é¿å…æ‰‹åŠ¨å†…å­˜ç®¡ç†

**é«˜æ€§èƒ½ç­–ç•¥** (æ€§èƒ½å…³é”®åœºæ™¯):

- ä½¿ç”¨ `bumpalo` ç«æŠ€åœºåˆ†é…å™¨ï¼ˆæ‰¹é‡åˆ†é…/é‡Šæ”¾ï¼‰
- ä½¿ç”¨ `slab` å¯¹è±¡æ± ï¼ˆå›ºå®šå¤§å°å¯¹è±¡ï¼‰
- ä½¿ç”¨ `bytes` é›¶æ‹·è´ï¼ˆç½‘ç»œ/I/Oï¼‰
- ä½¿ç”¨ `parking_lot` é«˜æ€§èƒ½é”

**æƒè¡¡**:

| ç­–ç•¥ | æ€§èƒ½ | å¤æ‚åº¦ | å†…å­˜ä½¿ç”¨ |
|------|------|--------|----------|
| æ ‡å‡†åº“ | â­â­â­ | ä½ | ä¸­ |
| bytes | â­â­â­â­ | ä¸­ | ä½ |
| bumpalo | â­â­â­â­â­ | é«˜ | é«˜ï¼ˆçŸ­æœŸï¼‰ |
| slab | â­â­â­â­â­ | ä¸­ | ä¸­ |

---

## å­¦ä¹ è·¯å¾„

### åˆçº§ï¼ˆ1-2å‘¨ï¼‰

**ç›®æ ‡**: æŒæ¡åŸºç¡€å¼‚æ­¥ç¼–ç¨‹å’Œå¹¶å‘åŸè¯­

1. **å¼‚æ­¥åŸºç¡€** (tokio)
   - `async/await` è¯­æ³•
   - `tokio::spawn` ä»»åŠ¡
   - `tokio::join!` å¹¶å‘
   - ç®€å• TCP echo server

2. **æ•°æ®å¹¶è¡Œ** (rayon)
   - `par_iter()` å¹¶è¡Œè¿­ä»£
   - `par_sort()` å¹¶è¡Œæ’åº
   - å›¾åƒå¤„ç†ç¤ºä¾‹

**å®æˆ˜é¡¹ç›®**: å¤šçº¿ç¨‹æ–‡ä»¶å¤„ç†å·¥å…·

### ä¸­çº§ï¼ˆ3-4å‘¨ï¼‰

**ç›®æ ‡**: æ·±å…¥å¼‚æ­¥ç¼–ç¨‹å’Œé«˜çº§å¹¶å‘

1. **å¼‚æ­¥è¿›é˜¶** (tokio)
   - `tokio::select!` å¤šè·¯å¤ç”¨
   - `tokio::time` å®šæ—¶å™¨
   - `tokio::sync` åŒæ­¥åŸè¯­
   - HTTP æœåŠ¡å™¨

2. **å¹¶å‘æ•°æ®ç»“æ„** (crossbeam)
   - `crossbeam-channel` é€šé“
   - `crossbeam-epoch` æ— é”ç®—æ³•
   - ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼

3. **å†…å­˜ä¼˜åŒ–** (bytes)
   - é›¶æ‹·è´æŠ€æœ¯
   - ç¼“å†²åŒºç®¡ç†
   - ç½‘ç»œåè®®è§£æ

**å®æˆ˜é¡¹ç›®**: Web ä»£ç†æœåŠ¡å™¨

### é«˜çº§ï¼ˆ5-8å‘¨ï¼‰

**ç›®æ ‡**: ç³»ç»Ÿçº§ç¼–ç¨‹å’Œæ€§èƒ½ä¼˜åŒ–

1. **ç³»ç»Ÿç¼–ç¨‹** (nix, sysinfo)
   - è¿›ç¨‹ç®¡ç†
   - ä¿¡å·å¤„ç†
   - ç³»ç»Ÿç›‘æ§

2. **Unsafe Rust**
   - FFI äº’æ“ä½œ
   - æ— é”æ•°æ®ç»“æ„
   - æ€§èƒ½ä¼˜åŒ–

3. **ç»¼åˆé¡¹ç›®**
   - åˆ†å¸ƒå¼ç³»ç»Ÿ
   - é«˜æ€§èƒ½æœåŠ¡å™¨
   - å®æ—¶æ•°æ®å¤„ç†

**å®æˆ˜é¡¹ç›®**: åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿï¼ˆç±» Redisï¼‰

---

## æœ€ä½³å®è·µ

### 1. å¼‚æ­¥ + åŒæ­¥æ··åˆ

**æè¿°**: åœ¨å¼‚æ­¥è¿è¡Œæ—¶ä¸­æ‰§è¡ŒåŒæ­¥ä»»åŠ¡ã€‚

```rust
#[tokio::main]
async fn main() {
    // CPU å¯†é›†ä»»åŠ¡æ”¾åˆ° spawn_blocking
    let result = tokio::task::spawn_blocking(|| {
        // è¿™é‡Œä¼šåœ¨ä¸“é—¨çš„çº¿ç¨‹æ± æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡å¼‚æ­¥è¿è¡Œæ—¶
        expensive_computation()
    }).await.unwrap();
}
```

### 2. åˆç†ä½¿ç”¨é€šé“

**æè¿°**: æ ¹æ®åœºæ™¯é€‰æ‹©é€šé“ç±»å‹ã€‚

```rust
use tokio::sync::mpsc;

// å¼‚æ­¥åœºæ™¯ï¼štokio::sync::mpsc
let (tx, mut rx) = mpsc::channel(100);

tokio::spawn(async move {
    while let Some(msg) = rx.recv().await {
        process(msg).await;
    }
});
```

### 3. å†…å­˜æ± å¤ç”¨

**æè¿°**: é«˜é¢‘åˆ†é…åœºæ™¯ä½¿ç”¨å¯¹è±¡æ± ã€‚

```rust
use slab::Slab;

// å¯¹è±¡æ± ï¼Œå¤ç”¨å†…å­˜
let mut pool = Slab::new();
let key = pool.insert(data);
// ... ä½¿ç”¨
pool.remove(key);  // å½’è¿˜æ± ä¸­
```

### 4. é›¶æ‹·è´ä¼˜åŒ–

**æè¿°**: ç½‘ç»œ/I/O å¯†é›†åœºæ™¯ä½¿ç”¨ `bytes`ã€‚

```rust
use bytes::Bytes;

// é›¶æ‹·è´åˆ‡ç‰‡
let data = Bytes::from(vec![1, 2, 3, 4]);
let slice1 = data.slice(0..2);  // ä¸æ‹·è´
let slice2 = data.slice(2..4);  // ä¸æ‹·è´
```

### 5. ä¼˜é›…å…³é—­

**æè¿°**: æ­£ç¡®å¤„ç†ä¿¡å·å’Œèµ„æºæ¸…ç†ã€‚

```rust
use tokio::signal;

#[tokio::main]
async fn main() {
    tokio::select! {
        _ = signal::ctrl_c() => {
            println!("æ”¶åˆ° Ctrl+Cï¼Œä¼˜é›…å…³é—­...");
            cleanup().await;
        }
        _ = run_server() => {}
    }
}
```

---

## å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- ğŸ“š [Tokio å®˜æ–¹æ•™ç¨‹](https://tokio.rs/tokio/tutorial)
- ğŸ“š [Async Book](https://rust-lang.github.io/async-book/)
- ğŸ“š [Rayon æ–‡æ¡£](https://docs.rs/rayon/)

### æ·±åº¦æ–‡ç« 

- ğŸ“– [Async Rust: Blocking Inside Async Code](https://ryhl.io/blog/async-what-is-blocking/)
- ğŸ“– [Rust Concurrency Patterns](https://rust-unofficial.github.io/patterns/patterns/index.html)
- ğŸ“– [Zero-Cost Async I/O](https://boats.gitlab.io/blog/post/zero-cost-async-io/)

### å®æˆ˜é¡¹ç›®

- ğŸ’» [mini-redis](https://github.com/tokio-rs/mini-redis) - Tokio å®˜æ–¹ç¤ºä¾‹
- ğŸ’» [hyper](https://github.com/hyperium/hyper) - HTTP åº“
- ğŸ’» [mio](https://github.com/tokio-rs/mio) - åº•å±‚ I/O åº“

### ç›¸å…³æ–‡æ¡£

- ğŸ”— [åº”ç”¨å¼€å‘å±‚](../03_application_dev/README.md)
- ğŸ”— [åŸºç¡€è®¾æ–½å±‚](../01_infrastructure/README.md)
- ğŸ”— [å¼‚æ­¥è¿è¡Œæ—¶è¯¦è§£](./async_runtime/README.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0.0  
**æœ€åæ›´æ–°**: 2025-10-20  
**ç»´æŠ¤è€…**: Rust å­¦ä¹ ç¤¾åŒº
