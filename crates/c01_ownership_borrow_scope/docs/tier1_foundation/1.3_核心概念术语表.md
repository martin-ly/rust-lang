# 1.3 æ ¸å¿ƒæ¦‚å¿µæœ¯è¯­è¡¨

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**é€‚ç”¨ Rust ç‰ˆæœ¬**: 1.90+  
**æœ€åæ›´æ–°**: 2025-10-22  
**æ–‡æ¡£ç±»å‹**: ğŸ“š å‚è€ƒèµ„æ–™

## ğŸ“‹ ç›®å½•

- [1.3 æ ¸å¿ƒæ¦‚å¿µæœ¯è¯­è¡¨](#13-æ ¸å¿ƒæ¦‚å¿µæœ¯è¯­è¡¨)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ“‹ ä½¿ç”¨è¯´æ˜](#-ä½¿ç”¨è¯´æ˜)
  - [ğŸ—‚ï¸ æœ¯è¯­ç´¢å¼•](#ï¸-æœ¯è¯­ç´¢å¼•)
  - [A åŒº](#a-åŒº)
    - [Arc (Atomic Reference Counted)](#arc-atomic-reference-counted)
  - [B åŒº](#b-åŒº)
    - [Borrow (å€Ÿç”¨)](#borrow-å€Ÿç”¨)
    - [Borrow Checker (å€Ÿç”¨æ£€æŸ¥å™¨)](#borrow-checker-å€Ÿç”¨æ£€æŸ¥å™¨)
    - [Box\<T\>](#boxt)
  - [C åŒº](#c-åŒº)
    - [Clone (å…‹éš†)](#clone-å…‹éš†)
    - [Copy](#copy)
  - [D åŒº](#d-åŒº)
    - [Dangling Pointer (æ‚¬å‚æŒ‡é’ˆ)](#dangling-pointer-æ‚¬å‚æŒ‡é’ˆ)
    - [Deref](#deref)
    - [Drop](#drop)
  - [L åŒº](#l-åŒº)
    - [Lifetime (ç”Ÿå‘½å‘¨æœŸ)](#lifetime-ç”Ÿå‘½å‘¨æœŸ)
  - [M åŒº](#m-åŒº)
    - [Move (ç§»åŠ¨)](#move-ç§»åŠ¨)
    - [Mutex\<T\>](#mutext)
  - [N åŒº](#n-åŒº)
    - [NLL (Non-Lexical Lifetimes)](#nll-non-lexical-lifetimes)
  - [O åŒº](#o-åŒº)
    - [Ownership (æ‰€æœ‰æƒ)](#ownership-æ‰€æœ‰æƒ)
  - [R åŒº](#r-åŒº)
    - [RAII](#raii)
    - [Rc (Reference Counted)](#rc-reference-counted)
    - [RefCell\<T\>](#refcellt)
    - [Reference (å¼•ç”¨)](#reference-å¼•ç”¨)
  - [S åŒº](#s-åŒº)
    - [Scope (ä½œç”¨åŸŸ)](#scope-ä½œç”¨åŸŸ)
    - [Smart Pointer (æ™ºèƒ½æŒ‡é’ˆ)](#smart-pointer-æ™ºèƒ½æŒ‡é’ˆ)
  - [å…¶ä»–](#å…¶ä»–)
    - [å†…éƒ¨å¯å˜æ€§ (Interior Mutability)](#å†…éƒ¨å¯å˜æ€§-interior-mutability)
    - [é›¶æˆæœ¬æŠ½è±¡ (Zero-Cost Abstraction)](#é›¶æˆæœ¬æŠ½è±¡-zero-cost-abstraction)
  - [ğŸ“š å¦‚ä½•ä½¿ç”¨æœ¬æœ¯è¯­è¡¨](#-å¦‚ä½•ä½¿ç”¨æœ¬æœ¯è¯­è¡¨)
    - [å­¦ä¹ å»ºè®®](#å­¦ä¹ å»ºè®®)
    - [ç›¸å…³èµ„æº](#ç›¸å…³èµ„æº)
    - [æ·±å…¥å­¦ä¹ ](#æ·±å…¥å­¦ä¹ )

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

æœ¬æœ¯è¯­è¡¨æä¾›äº† Rust æ‰€æœ‰æƒç³»ç»Ÿä¸­æœ€æ ¸å¿ƒæ¦‚å¿µçš„å¿«é€Ÿå‚è€ƒã€‚æ¯ä¸ªæœ¯è¯­éƒ½åŒ…å«ï¼š

- **å®šä¹‰**ï¼šç®€æ˜æ‰¼è¦çš„è§£é‡Š
- **ç¤ºä¾‹**ï¼šå®é™…ä»£ç æ¼”ç¤º
- **å…³é”®ç‚¹**ï¼šéœ€è¦ç‰¹åˆ«æ³¨æ„çš„å†…å®¹
- **ç›¸å…³é“¾æ¥**ï¼šæ·±å…¥å­¦ä¹ çš„èµ„æº

**å»ºè®®ç”¨æ³•**ï¼š

- ğŸ”– ä½œä¸ºå¿«é€ŸæŸ¥é˜…æ‰‹å†Œ
- ğŸ“– é‡åˆ°ä¸æ‡‚çš„æ¦‚å¿µæ—¶æŸ¥é˜…
- ğŸ“ å­¦ä¹ æ–°å†…å®¹å‰é¢„ä¹ ç›¸å…³æœ¯è¯­
- âœ… å¤ä¹ æ—¶æ£€æŸ¥ç†è§£ç¨‹åº¦

## ğŸ—‚ï¸ æœ¯è¯­ç´¢å¼•

ç‚¹å‡»å­—æ¯å¿«é€Ÿè·³è½¬ï¼š

**[A](#a-åŒº) | [B](#b-åŒº) | [C](#c-åŒº) | [D](#d-åŒº) | [L](#l-åŒº) | [M](#m-åŒº) | [N](#n-åŒº) | [O](#o-åŒº) | [R](#r-åŒº) | [S](#s-åŒº) | [å…¶ä»–](#å…¶ä»–)**

---

## A åŒº

### Arc (Atomic Reference Counted)

**ä¸­æ–‡**: åŸå­å¼•ç”¨è®¡æ•°

**å®šä¹‰**: å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆï¼Œå…è®¸å¤šä¸ªæ‰€æœ‰è€…å…±äº«æ•°æ®ã€‚

**ç¤ºä¾‹**:

```rust
use std::sync::Arc;
use std::thread;

let data = Arc::new(vec![1, 2, 3]);
let data_clone = Arc::clone(&data);

thread::spawn(move || {
    println!("{:?}", data_clone);
}).join().unwrap();

println!("{:?}", data);  // data ä»ç„¶æœ‰æ•ˆ
```

**å…³é”®ç‚¹**:

- âœ… çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨åŸå­æ“ä½œï¼‰
- âœ… åªè¯»å…±äº«ï¼ˆéœ€è¦å†…éƒ¨å¯å˜æ€§æ¥ä¿®æ”¹ï¼‰
- âœ… ç›¸æ¯” `Rc` æœ‰æ€§èƒ½å¼€é”€

**å¯¹æ¯”**: å•çº¿ç¨‹ç”¨ `Rc`ï¼Œå¤šçº¿ç¨‹ç”¨ `Arc`

**æ·±å…¥å­¦ä¹ **: [æ™ºèƒ½æŒ‡é’ˆç³»ç»Ÿ](../03_advanced/04_smart_pointers.md)

---

## B åŒº

### Borrow (å€Ÿç”¨)

**å®šä¹‰**: è·å–å€¼çš„å¼•ç”¨è€Œä¸è·å–æ‰€æœ‰æƒçš„æœºåˆ¶ã€‚

**ä¸¤ç§ç±»å‹**:

- **ä¸å¯å˜å€Ÿç”¨** `&T`: åªè¯»è®¿é—®
- **å¯å˜å€Ÿç”¨** `&mut T`: è¯»å†™è®¿é—®

**ç¤ºä¾‹**:

```rust
let s = String::from("hello");

// ä¸å¯å˜å€Ÿç”¨
let r1 = &s;
let r2 = &s;
println!("{} {}", r1, r2);  // âœ… å¤šä¸ªä¸å¯å˜å€Ÿç”¨

// å¯å˜å€Ÿç”¨
let mut s = String::from("hello");
let r = &mut s;
r.push_str(" world");
// åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨
```

**å€Ÿç”¨è§„åˆ™**:

```text
âœ… ä»»æ„æ•°é‡çš„ä¸å¯å˜å€Ÿç”¨ (&T)
   OR
âœ… æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨ (&mut T)

âŒ ä¸å¯å˜å’Œå¯å˜å€Ÿç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨
```

**å…³é”®ç‚¹**:

- âœ… ä¸è½¬ç§»æ‰€æœ‰æƒ
- âœ… å¿…é¡»éµå®ˆå€Ÿç”¨è§„åˆ™
- âœ… ç¼–è¯‘æ—¶æ£€æŸ¥

**æ·±å…¥å­¦ä¹ **: [å€Ÿç”¨ç³»ç»Ÿ](../tier2_core_concepts/2.2_å€Ÿç”¨æ£€æŸ¥å™¨.md)

### Borrow Checker (å€Ÿç”¨æ£€æŸ¥å™¨)

**å®šä¹‰**: Rust ç¼–è¯‘å™¨çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£åœ¨ç¼–è¯‘æ—¶éªŒè¯å€Ÿç”¨è§„åˆ™ã€‚

**æ£€æŸ¥å†…å®¹**:

1. æ‰€æœ‰æƒè§„åˆ™
2. å€Ÿç”¨è§„åˆ™
3. ç”Ÿå‘½å‘¨æœŸæœ‰æ•ˆæ€§

**ç¤ºä¾‹ï¼ˆç¼–è¯‘é”™è¯¯ï¼‰**:

```rust
let mut s = String::from("hello");

let r1 = &s;
let r2 = &mut s;  // âŒ é”™è¯¯ï¼šä¸å¯å˜å€Ÿç”¨å­˜åœ¨æ—¶ä¸èƒ½å¯å˜å€Ÿç”¨

println!("{}", r1);
```

**Rust 1.31+ çš„ NLL æ”¹è¿›**:

```rust
let mut s = String::from("hello");

let r1 = &s;
let r2 = &s;
println!("{} {}", r1, r2);
// r1 å’Œ r2 çš„ä½œç”¨åŸŸåœ¨æ­¤ç»“æŸ

let r3 = &mut s;  // âœ… OKï¼šr1 å’Œ r2 ä¸å†ä½¿ç”¨
println!("{}", r3);
```

**å…³é”®ç‚¹**:

- âœ… ç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œé›¶è¿è¡Œæ—¶å¼€é”€
- âœ… NLL ä½¿è§„åˆ™æ›´çµæ´»
- âœ… é”™è¯¯ä¿¡æ¯éå¸¸è¯¦ç»†

**æ·±å…¥å­¦ä¹ **: [å€Ÿç”¨æ£€æŸ¥å™¨](../tier2_core_concepts/2.2_å€Ÿç”¨æ£€æŸ¥å™¨.md)

### Box\<T\>

**å®šä¹‰**: æœ€ç®€å•çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå°†æ•°æ®åˆ†é…åœ¨å †ä¸Šã€‚

**ç”¨é€”**:

1. ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„ç±»å‹
2. å¤§é‡æ•°æ®çš„æ‰€æœ‰æƒè½¬ç§»ï¼ˆé¿å…æ ˆæ‹·è´ï¼‰
3. trait å¯¹è±¡

**ç¤ºä¾‹**:

```rust
// å †åˆ†é…
let b = Box::new(5);
println!("{}", b);

// é€’å½’ç±»å‹
enum List {
    Cons(i32, Box<List>),
    Nil,
}

// Trait å¯¹è±¡
let obj: Box<dyn ToString> = Box::new(42);
```

**å…³é”®ç‚¹**:

- âœ… ç‹¬å æ‰€æœ‰æƒ
- âœ… å®ç° `Deref` å’Œ `Drop`
- âœ… é›¶æˆæœ¬æŠ½è±¡ï¼ˆæŒ‡é’ˆå¤§å°ï¼‰

**æ·±å…¥å­¦ä¹ **: [æ™ºèƒ½æŒ‡é’ˆç³»ç»Ÿ](../03_advanced/04_smart_pointers.md)

---

## C åŒº

### Clone (å…‹éš†)

**å®šä¹‰**: æ˜¾å¼åœ°æ·±åº¦å¤åˆ¶å€¼çš„ traitã€‚

**ä¸ Copy çš„åŒºåˆ«**:

| ç‰¹æ€§ | Copy | Clone |
|------|------|-------|
| è°ƒç”¨æ–¹å¼ | éšå¼ | æ˜¾å¼ (`clone()`) |
| å¼€é”€ | æ€»æ˜¯å»‰ä»· | å¯èƒ½æ˜‚è´µ |
| å®ç°è¦æ±‚ | å¿…é¡»æ˜¯ç®€å•ä½å¤åˆ¶ | å¯ä»¥æœ‰å †åˆ†é… |

**ç¤ºä¾‹**:

```rust
// Clone trait
let s1 = String::from("hello");
let s2 = s1.clone();  // æ˜¾å¼å…‹éš†
println!("{} {}", s1, s2);  // âœ… éƒ½æœ‰æ•ˆ

// è‡ªå®šä¹‰å®ç°
#[derive(Clone)]
struct Point {
    x: i32,
    y: i32,
}
```

**å…³é”®ç‚¹**:

- âœ… éœ€è¦æ˜¾å¼è°ƒç”¨ `.clone()`
- âš ï¸ å¯èƒ½æœ‰æ€§èƒ½å¼€é”€
- âœ… é€‚ç”¨äºæ‰€æœ‰ç±»å‹

**æ·±å…¥å­¦ä¹ **: [æ‰€æœ‰æƒåŸºç¡€](../tier2_core_concepts/2.1_æ‰€æœ‰æƒç³»ç»Ÿ.md)

### Copy

**å®šä¹‰**: æ ‡è®°ç±»å‹å¯ä»¥é€šè¿‡ç®€å•çš„ä½å¤åˆ¶æ¥å¤åˆ¶çš„ traitã€‚

**Copy ç±»å‹**:

- æ‰€æœ‰æ•´æ•°ç±»å‹ (`i32`, `u64`, etc.)
- æµ®ç‚¹ç±»å‹ (`f32`, `f64`)
- å¸ƒå°”ç±»å‹ (`bool`)
- å­—ç¬¦ç±»å‹ (`char`)
- å…ƒç»„ï¼ˆå¦‚æœæ‰€æœ‰å…ƒç´ éƒ½æ˜¯ Copyï¼‰

**ç¤ºä¾‹**:

```rust
// åŸºæœ¬ç±»å‹æ˜¯ Copy
let x = 5;
let y = x;  // å¤åˆ¶ï¼Œä¸æ˜¯ç§»åŠ¨
println!("{} {}", x, y);  // âœ… éƒ½æœ‰æ•ˆ

// è‡ªå®šä¹‰ Copy ç±»å‹
#[derive(Copy, Clone)]
struct Point {
    x: i32,
    y: i32,
}

let p1 = Point { x: 1, y: 2 };
let p2 = p1;  // å¤åˆ¶
println!("{} {}", p1.x, p2.x);  // âœ… éƒ½æœ‰æ•ˆ
```

**å®ç°æ¡ä»¶**:

- âœ… æ‰€æœ‰å­—æ®µéƒ½æ˜¯ Copy
- âŒ ä¸èƒ½å®ç° `Drop`

**å…³é”®ç‚¹**:

- âœ… éšå¼å¤åˆ¶ï¼Œæ— éœ€ `.clone()`
- âœ… æ€»æ˜¯å»‰ä»·çš„ï¼ˆä½å¤åˆ¶ï¼‰
- âœ… èµ‹å€¼ååŸå€¼ä»æœ‰æ•ˆ

**æ·±å…¥å­¦ä¹ **: [æ‰€æœ‰æƒåŸºç¡€](../tier2_core_concepts/2.1_æ‰€æœ‰æƒç³»ç»Ÿ.md)

---

## D åŒº

### Dangling Pointer (æ‚¬å‚æŒ‡é’ˆ)

**å®šä¹‰**: æŒ‡å‘å·²é‡Šæ”¾å†…å­˜çš„æŒ‡é’ˆã€‚

**Rust çš„é˜²æŠ¤**:
Rust ç¼–è¯‘å™¨ä¿è¯ä¸ä¼šäº§ç”Ÿæ‚¬å‚å¼•ç”¨ï¼š

```rust
// âŒ ç¼–è¯‘é”™è¯¯
fn dangle() -> &String {
    let s = String::from("hello");
    &s  // é”™è¯¯ï¼šè¿”å›å±€éƒ¨å˜é‡çš„å¼•ç”¨
}  // s è¢«é‡Šæ”¾ï¼Œå¼•ç”¨å°†æ‚¬å‚

// âœ… æ­£ç¡®æ–¹å¼
fn no_dangle() -> String {
    let s = String::from("hello");
    s  // è½¬ç§»æ‰€æœ‰æƒ
}
```

**å…³é”®ç‚¹**:

- âœ… Rust åœ¨ç¼–è¯‘æ—¶é˜²æ­¢æ‚¬å‚æŒ‡é’ˆ
- âœ… å€Ÿç”¨æ£€æŸ¥å™¨ç¡®ä¿å¼•ç”¨æœ‰æ•ˆæ€§
- âœ… é›¶è¿è¡Œæ—¶å¼€é”€

**æ·±å…¥å­¦ä¹ **: [å†…å­˜å®‰å…¨](../04_safety/01_memory_safety.md)

### Deref

**å®šä¹‰**: è§£å¼•ç”¨è¿ç®—ç¬¦ `*` çš„è¡Œä¸ºå®šä¹‰ traitã€‚

**Deref Coercion (è§£å¼•ç”¨å¼ºåˆ¶è½¬æ¢)**:

```rust
fn hello(name: &str) {
    println!("Hello, {}!", name);
}

let m = Box::new(String::from("Rust"));
hello(&m);  // &Box<String> â†’ &String â†’ &str
// ç¼–è¯‘å™¨è‡ªåŠ¨æ’å…¥è§£å¼•ç”¨
```

**ç¤ºä¾‹**:

```rust
use std::ops::Deref;

struct MyBox<T>(T);

impl<T> Deref for MyBox<T> {
    type Target = T;
    
    fn deref(&self) -> &T {
        &self.0
    }
}

let x = MyBox(5);
assert_eq!(5, *x);  // è°ƒç”¨ deref
```

**å…³é”®ç‚¹**:

- âœ… æ™ºèƒ½æŒ‡é’ˆçš„æ ¸å¿ƒ trait
- âœ… å®ç°è‡ªåŠ¨è§£å¼•ç”¨å¼ºåˆ¶è½¬æ¢
- âœ… ä½¿æ™ºèƒ½æŒ‡é’ˆåƒæ™®é€šå¼•ç”¨ä¸€æ ·ä½¿ç”¨

**æ·±å…¥å­¦ä¹ **: [æ™ºèƒ½æŒ‡é’ˆç³»ç»Ÿ](../03_advanced/04_smart_pointers.md)

### Drop

**å®šä¹‰**: å€¼ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨è°ƒç”¨çš„æ¸…ç† traitã€‚

**Drop Trait**:

```rust
pub trait Drop {
    fn drop(&mut self);
}
```

**ç¤ºä¾‹**:

```rust
struct CustomSmartPointer {
    data: String,
}

impl Drop for CustomSmartPointer {
    fn drop(&mut self) {
        println!("Dropping: {}", self.data);
    }
}

fn main() {
    let c = CustomSmartPointer {
        data: String::from("my stuff"),
    };
    println!("Created");
}  // drop è‡ªåŠ¨è°ƒç”¨
// è¾“å‡ºï¼š
// Created
// Dropping: my stuff
```

**å…³é”®ç‚¹**:

- âœ… RAII (Resource Acquisition Is Initialization)
- âœ… è‡ªåŠ¨èµ„æºç®¡ç†
- âŒ Copy å’Œ Drop äº’æ–¥

**æå‰é‡Šæ”¾**:

```rust
drop(c);  // æ˜¾å¼è°ƒç”¨ std::mem::drop
```

**æ·±å…¥å­¦ä¹ **: [ä½œç”¨åŸŸç®¡ç†](../tier2_core_concepts/2.4_ä½œç”¨åŸŸè§„åˆ™.md)

---

## L åŒº

### Lifetime (ç”Ÿå‘½å‘¨æœŸ)

**å®šä¹‰**: å¼•ç”¨æœ‰æ•ˆçš„ä½œç”¨åŸŸï¼Œç¡®ä¿å¼•ç”¨å§‹ç»ˆæœ‰æ•ˆã€‚

**æ ‡æ³¨è¯­æ³•**:

```rust
// å‡½æ•°
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() { x } else { y }
}

// ç»“æ„ä½“
struct ImportantExcerpt<'a> {
    part: &'a str,
}

// impl å—
impl<'a> ImportantExcerpt<'a> {
    fn level(&self) -> i32 {
        3
    }
}
```

**ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™**:

ç¼–è¯‘å™¨åœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨æ¨å¯¼ï¼š

1. **è¾“å…¥ä½ç½®**: æ¯ä¸ªå¼•ç”¨å‚æ•°è·å¾—ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸ
2. **è¾“å‡ºä½ç½®**: å¦‚æœåªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œè¾“å‡ºä½¿ç”¨å®ƒ
3. **æ–¹æ³•**: å¦‚æœæœ‰ `&self` æˆ– `&mut self`ï¼Œè¾“å‡ºä½¿ç”¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸ

**ç¤ºä¾‹**:

```rust
// æ— éœ€æ ‡æ³¨ï¼ˆè§„åˆ™2ï¼‰
fn first_word(s: &str) -> &str {
    &s[..1]
}

// ç­‰ä»·äº
fn first_word<'a>(s: &'a str) -> &'a str {
    &s[..1]
}
```

**ç‰¹æ®Šç”Ÿå‘½å‘¨æœŸ**:

- `'static`: ç¨‹åºæ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚å­—ç¬¦ä¸²å­—é¢é‡ï¼‰

**å…³é”®ç‚¹**:

- âœ… ç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œé›¶è¿è¡Œæ—¶å¼€é”€
- âœ… å¤§å¤šæ•°æƒ…å†µå¯ä»¥çœç•¥
- âœ… é˜²æ­¢æ‚¬å‚å¼•ç”¨

**æ·±å…¥å­¦ä¹ **: [ç”Ÿå‘½å‘¨æœŸ](../tier2_core_concepts/2.3_ç”Ÿå‘½å‘¨æœŸ.md)

---

## M åŒº

### Move (ç§»åŠ¨)

**å®šä¹‰**: å€¼çš„æ‰€æœ‰æƒä»ä¸€ä¸ªä½ç½®è½¬ç§»åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚

**Move è¯­ä¹‰**:

```rust
let s1 = String::from("hello");
let s2 = s1;  // Move: æ‰€æœ‰æƒè½¬ç§»
// s1 ä¸å†æœ‰æ•ˆ

let v1 = vec![1, 2, 3];
let v2 = v1;  // Move
// v1 ä¸å†æœ‰æ•ˆ
```

**å‡½æ•°è°ƒç”¨ä¸­çš„ Move**:

```rust
fn take_ownership(s: String) {
    println!("{}", s);
}  // s è¢«é‡Šæ”¾

let s = String::from("hello");
take_ownership(s);  // s ç§»åŠ¨åˆ°å‡½æ•°
// s ä¸å†æœ‰æ•ˆ
```

**è¿”å›å€¼ä¸­çš„ Move**:

```rust
fn give_ownership() -> String {
    let s = String::from("hello");
    s  // æ‰€æœ‰æƒè½¬ç§»ç»™è°ƒç”¨è€…
}

let s = give_ownership();  // s è·å¾—æ‰€æœ‰æƒ
```

**å…³é”®ç‚¹**:

- âœ… é»˜è®¤è¯­ä¹‰ï¼ˆé Copy ç±»å‹ï¼‰
- âœ… é›¶è¿è¡Œæ—¶å¼€é”€
- âœ… é˜²æ­¢åŒé‡é‡Šæ”¾

**æ·±å…¥å­¦ä¹ **: [æ‰€æœ‰æƒç³»ç»Ÿ](../tier2_core_concepts/2.1_æ‰€æœ‰æƒç³»ç»Ÿ.md)

### Mutex\<T\>

**å®šä¹‰**: äº’æ–¥é”ï¼Œæä¾›è·¨çº¿ç¨‹çš„å†…éƒ¨å¯å˜æ€§ã€‚

**ç¤ºä¾‹**:

```rust
use std::sync::{Arc, Mutex};
use std::thread;

let counter = Arc::new(Mutex::new(0));
let mut handles = vec![];

for _ in 0..10 {
    let counter = Arc::clone(&counter);
    let handle = thread::spawn(move || {
        let mut num = counter.lock().unwrap();
        *num += 1;
    });
    handles.push(handle);
}

for handle in handles {
    handle.join().unwrap();
}

println!("Result: {}", *counter.lock().unwrap());
// è¾“å‡º: Result: 10
```

**å…³é”®ç‚¹**:

- âœ… ä¿è¯äº’æ–¥è®¿é—®
- âœ… çº¿ç¨‹å®‰å…¨
- âš ï¸ å¯èƒ½æ­»é”
- âš ï¸ æ€§èƒ½å¼€é”€ï¼ˆé”ç«äº‰ï¼‰

**æ›¿ä»£æ–¹æ¡ˆ**:

- è¯»å¤šå†™å°‘ï¼š`RwLock<T>`
- åŸå­æ“ä½œï¼š`AtomicXxx`

**æ·±å…¥å­¦ä¹ **: [å¹¶å‘å®‰å…¨](../04_safety/02_concurrency_safety.md)

---

## N åŒº

### NLL (Non-Lexical Lifetimes)

**å®šä¹‰**: Rust 1.31+ å¼•å…¥çš„æ›´æ™ºèƒ½çš„å€Ÿç”¨æ£€æŸ¥ï¼ŒåŸºäºå®é™…ä½¿ç”¨è€Œéè¯æ³•ä½œç”¨åŸŸã€‚

**æ”¹è¿›å‰ï¼ˆè¯æ³•ä½œç”¨åŸŸï¼‰**:

```rust
// Rust 2015
let mut s = String::from("hello");

let r1 = &s;
let r2 = &s;
println!("{} {}", r1, r2);

let r3 = &mut s;  // âŒ é”™è¯¯ï¼šr1 å’Œ r2 ä»åœ¨ä½œç”¨åŸŸå†…
```

**æ”¹è¿›åï¼ˆNLLï¼‰**:

```rust
// Rust 2018+
let mut s = String::from("hello");

let r1 = &s;
let r2 = &s;
println!("{} {}", r1, r2);
// r1 å’Œ r2 çš„"ä½¿ç”¨åŸŸ"åœ¨æ­¤ç»“æŸ

let r3 = &mut s;  // âœ… OKï¼šr1 å’Œ r2 ä¸å†ä½¿ç”¨
println!("{}", r3);
```

**å…³é”®ç‚¹**:

- âœ… æ›´çµæ´»çš„å€Ÿç”¨è§„åˆ™
- âœ… å‡å°‘ä¸å¿…è¦çš„ä½œç”¨åŸŸé™åˆ¶
- âœ… Rust 1.90 ä¸­å·²éå¸¸æˆç†Ÿ

**æ·±å…¥å­¦ä¹ **: [å€Ÿç”¨æ£€æŸ¥å™¨](../tier2_core_concepts/2.2_å€Ÿç”¨æ£€æŸ¥å™¨.md)

---

## O åŒº

### Ownership (æ‰€æœ‰æƒ)

**å®šä¹‰**: Rust å†…å­˜ç®¡ç†çš„æ ¸å¿ƒæœºåˆ¶ï¼Œæ¯ä¸ªå€¼éƒ½æœ‰å”¯ä¸€çš„æ‰€æœ‰è€…ã€‚

**ä¸‰å¤§è§„åˆ™**:

```text
è§„åˆ™ 1: æ¯ä¸ªå€¼éƒ½æœ‰å”¯ä¸€çš„æ‰€æœ‰è€…
è§„åˆ™ 2: åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
è§„åˆ™ 3: æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå€¼è¢«è‡ªåŠ¨é‡Šæ”¾
```

**ç¤ºä¾‹**:

```rust
{
    let s = String::from("hello");  // s æ‹¥æœ‰å­—ç¬¦ä¸²
    // ä½¿ç”¨ s
}  // s ç¦»å¼€ä½œç”¨åŸŸï¼Œå­—ç¬¦ä¸²è¢«é‡Šæ”¾

let s1 = String::from("hello");
let s2 = s1;  // æ‰€æœ‰æƒè½¬ç§»
// s1 ä¸å†æœ‰æ•ˆï¼Œs2 æ˜¯æ–°æ‰€æœ‰è€…
```

**ä¼˜åŠ¿**:

- âœ… æ— éœ€åƒåœ¾å›æ”¶å™¨
- âœ… å†…å­˜å®‰å…¨
- âœ… é›¶è¿è¡Œæ—¶å¼€é”€
- âœ… é˜²æ­¢æ•°æ®ç«äº‰

**æ·±å…¥å­¦ä¹ **: [æ‰€æœ‰æƒç³»ç»Ÿ](../tier2_core_concepts/2.1_æ‰€æœ‰æƒç³»ç»Ÿ.md)

---

## R åŒº

### RAII

**å…¨ç§°**: Resource Acquisition Is Initializationï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰

**å®šä¹‰**: é€šè¿‡å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ¥ç®¡ç†èµ„æºã€‚

**Rust å®ç°**: é€šè¿‡ `Drop` trait

**ç¤ºä¾‹**:

```rust
use std::fs::File;

fn process_file() -> std::io::Result<()> {
    let file = File::open("file.txt")?;
    // ä½¿ç”¨ file
    
    // å³ä½¿å‘ç”Ÿé”™è¯¯ï¼Œfile ä¹Ÿä¼šè‡ªåŠ¨å…³é—­
    Ok(())
}  // file è‡ªåŠ¨å…³é—­ï¼ˆDrop::drop è¢«è°ƒç”¨ï¼‰
```

**ä¼˜åŠ¿**:

- âœ… è‡ªåŠ¨èµ„æºç®¡ç†
- âœ… å¼‚å¸¸å®‰å…¨
- âœ… é›¶å¼€é”€

**å¸¸è§åº”ç”¨**:

- æ–‡ä»¶å¥æŸ„
- ç½‘ç»œè¿æ¥
- é”ï¼ˆMutex, RwLockï¼‰
- å†…å­˜åˆ†é…

**æ·±å…¥å­¦ä¹ **: [å†…å­˜å®‰å…¨](../04_safety/01_memory_safety.md)

### Rc (Reference Counted)

**ä¸­æ–‡**: å¼•ç”¨è®¡æ•°

**å®šä¹‰**: å•çº¿ç¨‹ç¯å¢ƒä¸‹çš„å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆï¼Œå…è®¸å¤šä¸ªæ‰€æœ‰è€…å…±äº«æ•°æ®ã€‚

**ç¤ºä¾‹**:

```rust
use std::rc::Rc;

let a = Rc::new(String::from("hello"));
let b = Rc::clone(&a);  // å¼•ç”¨è®¡æ•°å¢åŠ 
let c = Rc::clone(&a);

println!("count: {}", Rc::strong_count(&a));  // 3

drop(c);
println!("count: {}", Rc::strong_count(&a));  // 2
```

**å…³é”®ç‚¹**:

- âœ… å•çº¿ç¨‹å…±äº«æ‰€æœ‰æƒ
- âŒ ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„
- âœ… åªè¯»å…±äº«ï¼ˆéœ€è¦å†…éƒ¨å¯å˜æ€§æ¥ä¿®æ”¹ï¼‰
- âš ï¸ å¯èƒ½å¯¼è‡´å¾ªç¯å¼•ç”¨ï¼ˆä½¿ç”¨ `Weak` è§£å†³ï¼‰

**å¯¹æ¯”**:

- å•çº¿ç¨‹ï¼š`Rc`
- å¤šçº¿ç¨‹ï¼š`Arc`

**æ·±å…¥å­¦ä¹ **: [æ™ºèƒ½æŒ‡é’ˆç³»ç»Ÿ](../03_advanced/04_smart_pointers.md)

### RefCell\<T\>

**å®šä¹‰**: æä¾›å†…éƒ¨å¯å˜æ€§çš„æ™ºèƒ½æŒ‡é’ˆï¼Œè¿è¡Œæ—¶æ£€æŸ¥å€Ÿç”¨è§„åˆ™ã€‚

**ç¤ºä¾‹**:

```rust
use std::cell::RefCell;

let data = RefCell::new(5);

// å€Ÿç”¨æ£€æŸ¥åœ¨è¿è¡Œæ—¶
{
    let mut value = data.borrow_mut();
    *value += 1;
}  // å¯å˜å€Ÿç”¨é‡Šæ”¾

println!("{}", data.borrow());  // 6
```

**ä¸æ™®é€šå¼•ç”¨å¯¹æ¯”**:

| ç‰¹æ€§ | æ™®é€šå¼•ç”¨ | RefCell |
|------|----------|---------|
| å€Ÿç”¨æ£€æŸ¥ | ç¼–è¯‘æ—¶ | è¿è¡Œæ—¶ |
| æ€§èƒ½ | é›¶å¼€é”€ | è½»å¾®å¼€é”€ |
| å®‰å…¨æ€§ | ç¼–è¯‘ä¿è¯ | è¿è¡Œæ—¶ panic |

**å¸¸è§ç»„åˆ**:

```rust
use std::rc::Rc;
use std::cell::RefCell;

// å•çº¿ç¨‹å…±äº«å¯å˜æ•°æ®
let data = Rc::new(RefCell::new(5));

let data1 = Rc::clone(&data);
*data1.borrow_mut() += 1;

let data2 = Rc::clone(&data);
*data2.borrow_mut() += 1;

println!("{}", data.borrow());  // 7
```

**å…³é”®ç‚¹**:

- âœ… å†…éƒ¨å¯å˜æ€§
- âœ… ç»•è¿‡ç¼–è¯‘æ—¶å€Ÿç”¨æ£€æŸ¥
- âš ï¸ è¿åå€Ÿç”¨è§„åˆ™ä¼š panic
- âŒ ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„

**æ·±å…¥å­¦ä¹ **: [é«˜çº§æ‰€æœ‰æƒæ¨¡å¼](../03_advanced/01_advanced_ownership.md)

### Reference (å¼•ç”¨)

**å®šä¹‰**: æŒ‡å‘å€¼çš„æŒ‡é’ˆï¼Œä½†ä¸æ‹¥æœ‰è¯¥å€¼ã€‚

**ä¸¤ç§ç±»å‹**:

- **ä¸å¯å˜å¼•ç”¨** `&T`: åªè¯»è®¿é—®
- **å¯å˜å¼•ç”¨** `&mut T`: è¯»å†™è®¿é—®

**ç¤ºä¾‹**:

```rust
// ä¸å¯å˜å¼•ç”¨
let x = 5;
let r = &x;
println!("{}", *r);  // è§£å¼•ç”¨

// å¯å˜å¼•ç”¨
let mut y = 5;
let r = &mut y;
*r += 1;
println!("{}", y);  // 6
```

**å¼•ç”¨è§„åˆ™**:

```text
âœ… ä»»æ„æ•°é‡çš„ä¸å¯å˜å¼•ç”¨ (&T)
   OR
âœ… æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ (&mut T)

âœ… å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆï¼ˆä¸èƒ½æ‚¬å‚ï¼‰
```

**å…³é”®ç‚¹**:

- âœ… ä¸è·å–æ‰€æœ‰æƒ
- âœ… ç¼–è¯‘æ—¶æ£€æŸ¥
- âœ… é›¶è¿è¡Œæ—¶å¼€é”€

**æ·±å…¥å­¦ä¹ **: [å€Ÿç”¨ç³»ç»Ÿ](../tier2_core_concepts/2.2_å€Ÿç”¨æ£€æŸ¥å™¨.md)

---

## S åŒº

### Scope (ä½œç”¨åŸŸ)

**å®šä¹‰**: å˜é‡æœ‰æ•ˆçš„ä»£ç åŒºåŸŸã€‚

**è§„åˆ™**:

- å˜é‡ä»å£°æ˜ç‚¹å¼€å§‹æœ‰æ•ˆ
- å˜é‡åœ¨ç¦»å¼€ä½œç”¨åŸŸæ—¶å¤±æ•ˆ
- ç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨è°ƒç”¨ `drop`

**ç¤ºä¾‹**:

```rust
{
    let s = String::from("hello");  // s ä»è¿™é‡Œå¼€å§‹æœ‰æ•ˆ
    
    // ä½¿ç”¨ s
    println!("{}", s);
    
}  // s ç¦»å¼€ä½œç”¨åŸŸï¼Œè‡ªåŠ¨è°ƒç”¨ dropï¼Œå†…å­˜è¢«é‡Šæ”¾

// s åœ¨è¿™é‡Œä¸å¯ç”¨
```

**åµŒå¥—ä½œç”¨åŸŸ**:

```rust
let outer = String::from("outer");

{
    let inner = String::from("inner");
    println!("{} {}", outer, inner);  // âœ… éƒ½æœ‰æ•ˆ
}  // inner è¢«é‡Šæ”¾

println!("{}", outer);  // âœ… outer ä»æœ‰æ•ˆ
// println!("{}", inner);  // âŒ ç¼–è¯‘é”™è¯¯
```

**å…³é”®ç‚¹**:

- âœ… è‡ªåŠ¨å†…å­˜ç®¡ç†
- âœ… RAII æ¨¡å¼
- âœ… ç¡®å®šæ€§ææ„

**æ·±å…¥å­¦ä¹ **: [ä½œç”¨åŸŸè§„åˆ™](../tier2_core_concepts/2.4_ä½œç”¨åŸŸè§„åˆ™.md)

### Smart Pointer (æ™ºèƒ½æŒ‡é’ˆ)

**å®šä¹‰**: å®ç°äº† `Deref` å’Œ `Drop` trait çš„æ•°æ®ç»“æ„ï¼Œè¡Œä¸ºç±»ä¼¼æŒ‡é’ˆä½†æœ‰é¢å¤–åŠŸèƒ½ã€‚

**å¸¸è§ç±»å‹**:

| ç±»å‹ | ç”¨é€” | çº¿ç¨‹å®‰å…¨ |
|------|------|----------|
| `Box<T>` | å †åˆ†é… | - |
| `Rc<T>` | å•çº¿ç¨‹å…±äº« | âŒ |
| `Arc<T>` | å¤šçº¿ç¨‹å…±äº« | âœ… |
| `RefCell<T>` | å†…éƒ¨å¯å˜æ€§ | âŒ |
| `Mutex<T>` | çº¿ç¨‹å®‰å…¨å¯å˜æ€§ | âœ… |
| `RwLock<T>` | è¯»å†™é” | âœ… |

**é€‰æ‹©æŒ‡å—**:

```text
å•ä¸€æ‰€æœ‰æƒ â†’ Box<T>
å•çº¿ç¨‹å…±äº« â†’ Rc<T>
å¤šçº¿ç¨‹å…±äº« â†’ Arc<T>
å•çº¿ç¨‹å¯å˜å…±äº« â†’ Rc<RefCell<T>>
å¤šçº¿ç¨‹å¯å˜å…±äº« â†’ Arc<Mutex<T>>
è¯»å¤šå†™å°‘ â†’ Arc<RwLock<T>>
```

**ç¤ºä¾‹**:

```rust
// Box: å †åˆ†é…
let b = Box::new(5);

// Rc: å…±äº«æ‰€æœ‰æƒ
let rc = Rc::new(vec![1, 2, 3]);
let rc2 = Rc::clone(&rc);

// Arc + Mutex: è·¨çº¿ç¨‹å…±äº«å¯å˜
let data = Arc::new(Mutex::new(0));
```

**æ·±å…¥å­¦ä¹ **: [æ™ºèƒ½æŒ‡é’ˆç³»ç»Ÿ](../03_advanced/04_smart_pointers.md)

---

## å…¶ä»–

### å†…éƒ¨å¯å˜æ€§ (Interior Mutability)

**å®šä¹‰**: åœ¨æ‹¥æœ‰ä¸å¯å˜å¼•ç”¨çš„æƒ…å†µä¸‹ä¿®æ”¹æ•°æ®çš„æ¨¡å¼ã€‚

**å®ç°æ–¹å¼**:

| ç±»å‹ | åœºæ™¯ | æ£€æŸ¥æ—¶æœº |
|------|------|----------|
| `Cell<T>` | Copy ç±»å‹ï¼Œå•çº¿ç¨‹ | æ— æ£€æŸ¥ |
| `RefCell<T>` | æ‰€æœ‰ç±»å‹ï¼Œå•çº¿ç¨‹ | è¿è¡Œæ—¶ |
| `Mutex<T>` | æ‰€æœ‰ç±»å‹ï¼Œå¤šçº¿ç¨‹ | è¿è¡Œæ—¶ |
| `RwLock<T>` | æ‰€æœ‰ç±»å‹ï¼Œå¤šçº¿ç¨‹ | è¿è¡Œæ—¶ |

**ç¤ºä¾‹**:

```rust
use std::cell::RefCell;

struct Counter {
    count: RefCell<i32>,
}

impl Counter {
    fn increment(&self) {  // æ³¨æ„ï¼š&self æ˜¯ä¸å¯å˜çš„
        let mut count = self.count.borrow_mut();
        *count += 1;
    }
}

let counter = Counter { count: RefCell::new(0) };
counter.increment();  // âœ… é€šè¿‡ä¸å¯å˜å¼•ç”¨ä¿®æ”¹æ•°æ®
```

**å…³é”®ç‚¹**:

- âœ… ç»•è¿‡ç¼–è¯‘æ—¶ä¸å¯å˜æ€§é™åˆ¶
- âš ï¸ è¿è¡Œæ—¶æ£€æŸ¥å€Ÿç”¨è§„åˆ™
- âš ï¸ è¿åè§„åˆ™ä¼š panic

**æ·±å…¥å­¦ä¹ **: [é«˜çº§æ‰€æœ‰æƒæ¨¡å¼](../03_advanced/01_advanced_ownership.md)

### é›¶æˆæœ¬æŠ½è±¡ (Zero-Cost Abstraction)

**å®šä¹‰**: æŠ½è±¡ä¸ä¼šå¸¦æ¥é¢å¤–çš„è¿è¡Œæ—¶å¼€é”€ã€‚

**Rust çš„ä½“ç°**:

- æ‰€æœ‰æƒç³»ç»Ÿï¼šç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œé›¶è¿è¡Œæ—¶å¼€é”€
- æ³›å‹ï¼šå•æ€åŒ–ï¼Œæ— è™šè¡¨å¼€é”€
- è¿­ä»£å™¨ï¼šä¼˜åŒ–ä¸ºå¾ªç¯

**ç¤ºä¾‹**:

```rust
// é«˜çº§æŠ½è±¡
let sum: i32 = vec![1, 2, 3, 4, 5]
    .iter()
    .map(|x| x * 2)
    .filter(|x| x > &5)
    .sum();

// ç¼–è¯‘åç­‰ä»·äºæ‰‹å†™å¾ªç¯
let mut sum = 0;
for x in [1, 2, 3, 4, 5].iter() {
    let doubled = x * 2;
    if doubled > 5 {
        sum += doubled;
    }
}
```

**å…³é”®ç‚¹**:

- âœ… æŠ½è±¡ä¸ç‰ºç‰²æ€§èƒ½
- âœ… ç¼–è¯‘å™¨ä¼˜åŒ–
- âœ… Rust çš„æ ¸å¿ƒç†å¿µ

**æ·±å…¥å­¦ä¹ **: [æ€§èƒ½ä¼˜åŒ–](../04_safety/03_performance_optimization.md)

---

## ğŸ“š å¦‚ä½•ä½¿ç”¨æœ¬æœ¯è¯­è¡¨

### å­¦ä¹ å»ºè®®

1. **ç¬¬ä¸€æ¬¡é˜…è¯»**: æŒ‰é¡ºåºæµè§ˆï¼Œå»ºç«‹æ•´ä½“è®¤çŸ¥
2. **å­¦ä¹ æ–°æ¦‚å¿µ**: æå‰æŸ¥é˜…ç›¸å…³æœ¯è¯­
3. **é‡åˆ°å›°éš¾**: éšæ—¶å›æ¥æŸ¥é˜…
4. **å®šæœŸå¤ä¹ **: æ£€æŸ¥å¯¹æ¦‚å¿µçš„ç†è§£

### ç›¸å…³èµ„æº

- ğŸ“– [å¿«é€Ÿå¼€å§‹æŒ‡å—](./1.2_å¿«é€Ÿå¼€å§‹æŒ‡å—.md) - å®è·µè¿™äº›æ¦‚å¿µ
- â“ [å¸¸è§é—®é¢˜è§£ç­”](./1.4_å¸¸è§é—®é¢˜è§£ç­”.md) - å¸¸è§å›°æƒ‘
- ğŸ—ºï¸ [ä¸»ç´¢å¼•](../00_MASTER_INDEX.md) - å®Œæ•´æ–‡æ¡£å¯¼èˆª
- ğŸ“Š [å¯è§†åŒ–èµ„æº](../VISUALIZATION_INDEX.md) - å¯è§†åŒ–å­¦ä¹ 

### æ·±å…¥å­¦ä¹ 

å®Œæˆ Tier 1 åï¼Œç»§ç»­å­¦ä¹ ï¼š

- ğŸ“š [Tier 2: æ ¸å¿ƒæ¦‚å¿µå±‚](../tier2_core_concepts/README.md)
- ğŸ’» [ä»£ç ç¤ºä¾‹](../../examples/)
- ğŸ§ª [æµ‹è¯•ç”¨ä¾‹](../../tests/)

---

**éœ€è¦æ›´å¤šå¸®åŠ©ï¼Ÿ**

- æäº¤ Issue: [GitHub Issues]
- æŸ¥çœ‹ FAQ: [å¸¸è§é—®é¢˜è§£ç­”](./1.4_å¸¸è§é—®é¢˜è§£ç­”.md)
- ç¤¾åŒºè®¨è®º: [Rust Users Forum](https://users.rust-lang.org/)

---

**æœ€åæ›´æ–°**: 2025-10-22  
**ç»´æŠ¤çŠ¶æ€**: âœ… æ´»è·ƒç»´æŠ¤
