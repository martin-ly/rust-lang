# Tier 4: 内存布局优化

> **文档类型**: 高级主题  
> **难度**: ⭐⭐⭐⭐⭐  
> **适用版本**: Rust 1.90+

---

## 📊 目录

- [Tier 4: 内存布局优化](#tier-4-内存布局优化)
  - [📊 目录](#-目录)
  - [1. 内存对齐](#1-内存对齐)
  - [2. #\[repr(packed)\]](#2-reprpacked)
  - [3. #\[repr(align(N))\]](#3-repralignn)
  - [4. 字段重排序](#4-字段重排序)
  - [5. 零大小类型 (ZST)](#5-零大小类型-zst)

## 1. 内存对齐

```rust
use std::mem;

#[repr(C)]
struct Aligned {
    a: u8,
    _padding: [u8; 7],
    b: u64,
}

assert_eq!(mem::align_of::<Aligned>(), 8);
assert_eq!(mem::size_of::<Aligned>(), 16);
```

---

## 2. #[repr(packed)]

```rust
#[repr(packed)]
struct Packed {
    a: u8,
    b: u64,
    c: u8,
}

// size = 10 字节 (无填充)
```

---

## 3. #[repr(align(N))]

```rust
#[repr(align(64))] // 缓存行对齐
struct CacheAligned {
    data: [u8; 64],
}
```

---

## 4. 字段重排序

```rust
// 自动优化
#[repr(Rust)] // 默认
struct Optimized {
    b: u64, // 编译器会重排
    a: u8,
    c: u8,
}
```

---

## 5. 零大小类型 (ZST)

```rust
struct ZeroSized; // size = 0

let v = vec![ZeroSized; 1000]; // 无内存开销
```

---

**相关文档**:

- [Tier 4: 03_所有权性能优化](./03_所有权性能优化.md)

---

**文档维护**: Documentation Team  
**创建日期**: 2025-10-22
