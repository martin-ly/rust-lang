# Tier 4: 高级生命周期模式

> **文档类型**: 高级主题  
> **难度**: ⭐⭐⭐⭐⭐  
> **适用版本**: Rust 1.90+

---

## 1. 高阶生命周期

### Higher-Rank Trait Bounds (HRTB)

```rust
// for<'a> 语法
fn apply<F>(f: F)
where
    F: for<'a> Fn(&'a str) -> &'a str,
{
    let s = "hello";
    println!("{}", f(s));
}

// 使用
apply(|s| s);
```

---

## 2. 生命周期子类型

```rust
// 'static 是所有生命周期的子类型
fn longest<'a>(x: &'a str, y: &'static str) -> &'a str {
    if x.len() > y.len() { x } else { y }
}
```

---

## 3. 协变与逆变

### 协变 (Covariance)

```rust
// 如果 'a: 'b，则 &'a T 可以转换为 &'b T
fn covariant<'a, 'b: 'a>(x: &'a str) -> &'b str {
    x
}
```

### 逆变 (Contravariance)

```rust
// 函数参数是逆变的
trait Trait<'a> {
    fn method(&self, x: &'a str);
}
```

---

## 4. 生命周期约束

```rust
// where 子句中的生命周期约束
fn complex<'a, 'b, T>(x: &'a T, y: &'b T) -> &'a T
where
    T: 'a + 'b,
{
    x
}
```

---

## 5. GAT (Generic Associated Types)

```rust
trait StreamingIterator {
    type Item<'a>
    where
        Self: 'a;

    fn next(&mut self) -> Option<Self::Item<'_>>;
}
```

---

**相关文档**:

- [Tier 3: 03_生命周期参考](../tier_03_references/03_生命周期参考.md)

---

**文档维护**: Documentation Team  
**创建日期**: 2025-10-22
