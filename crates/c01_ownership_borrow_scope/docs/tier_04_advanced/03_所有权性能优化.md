# Tier 4: 所有权性能优化

> **文档类型**: 高级主题  
> **难度**: ⭐⭐⭐⭐⭐  
> **适用版本**: Rust 1.90+

---

## 1. 避免不必要的 Clone

```rust
// ❌ 不必要的 clone
fn process(data: &String) {
    let owned = data.clone(); // 昂贵的堆分配
    // 使用 owned
}

// ✅ 使用引用
fn process(data: &str) {
    // 直接使用引用
}
```

---

## 2. Copy on Write (Cow)

```rust
use std::borrow::Cow;

fn process<'a>(input: &'a str) -> Cow<'a, str> {
    if input.contains("special") {
        Cow::Owned(input.replace("special", "normal"))
    } else {
        Cow::Borrowed(input)
    }
}
```

---

## 3. 内存布局优化

```rust
// ❌ 内存浪费
struct Wasteful {
    a: u8,    // 1 byte
    b: u64,   // 8 bytes (需要 8 字节对齐)
    c: u8,    // 1 byte
} // 总共 24 字节（含填充）

// ✅ 优化后
struct Optimized {
    b: u64,   // 8 bytes
    a: u8,    // 1 byte
    c: u8,    // 1 byte
} // 总共 16 字节
```

---

## 4. 零拷贝优化

```rust
// 使用 &[u8] 而非 Vec<u8>
fn parse_data(data: &[u8]) -> Result<Data, Error> {
    // 零拷贝解析
    todo!()
}
```

---

## 5. 移动语义优化

```rust
// ✅ RVO (Return Value Optimization)
fn create_large() -> Vec<u8> {
    vec![0; 1024 * 1024] // 直接构造在调用者的栈上
}
```

---

**相关文档**:
- [Tier 3: 09_性能优化参考](../tier_03_references/09_性能优化参考.md)

---

**文档维护**: Documentation Team  
**创建日期**: 2025-10-22

