# Tier 4: è·¨çº¿ç¨‹æ‰€æœ‰æƒ

> **æ–‡æ¡£ç±»å‹**: é«˜çº§ä¸»é¢˜
> **éš¾åº¦**: â­â­â­â­â­
> **é€‚ç”¨ç‰ˆæœ¬**: Rust 1.92.0+

---

## ğŸ“Š ç›®å½•

- [Tier 4: è·¨çº¿ç¨‹æ‰€æœ‰æƒ](#tier-4-è·¨çº¿ç¨‹æ‰€æœ‰æƒ)
  - [ğŸ“Š ç›®å½•](#-ç›®å½•)
  - [1. Send å’Œ Sync](#1-send-å’Œ-sync)
    - [Send trait](#send-trait)
    - [Sync trait](#sync-trait)
  - [2. Arc + Mutex æ¨¡å¼](#2-arc--mutex-æ¨¡å¼)
  - [3. Scoped Threads](#3-scoped-threads)
  - [4. Atomic ç±»å‹](#4-atomic-ç±»å‹)
  - [5. æ— é”æ•°æ®ç»“æ„](#5-æ— é”æ•°æ®ç»“æ„)

## 1. Send å’Œ Sync

### Send trait

```rust
// Send: å¯ä»¥å®‰å…¨åœ°åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ
pub unsafe auto trait Send {}

// å®ç° Send çš„ç±»å‹
impl<T: Send> Send for Vec<T> {}
impl<T: Send> Send for Box<T> {}

// ä¸å®ç° Send
impl<T> !Send for Rc<T> {}
```

### Sync trait

```rust
// Sync: å¯ä»¥å®‰å…¨åœ°åœ¨çº¿ç¨‹é—´å…±äº«å¼•ç”¨
pub unsafe auto trait Sync {}

// T æ˜¯ Sync å½“ä¸”ä»…å½“ &T æ˜¯ Send
```

---

## 2. Arc + Mutex æ¨¡å¼

```rust
use std::sync::{Arc, Mutex};
use std::thread;

let data = Arc::new(Mutex::new(0));

let handles: Vec<_> = (0..10)
    .map(|_| {
        let data = Arc::clone(&data);
        thread::spawn(move |
| {
            let mut num = data.lock().unwrap();
            *num += 1;
        })
    })
    .collect();

for handle in handles {
    handle.join().unwrap();
}

println!("Result: {}", *data.lock().unwrap());
```

---

## 3. Scoped Threads

```rust
use std::thread;

let mut data = vec![1, 2, 3];

thread::scope(|s| {
    s.spawn(|| {
        data.push(4);
    });

    s.spawn(|| {
        data.push(5);
    });
}); // è‡ªåŠ¨ join

println!("{:?}", data);
```

---

## 4. Atomic ç±»å‹

```rust
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::Arc;
use std::thread;

let counter = Arc::new(AtomicUsize::new(0));

let handles: Vec<_> = (0..10)
    .map(|_| {
        let counter = Arc::clone(&counter);
        thread::spawn(move |
| {
            counter.fetch_add(1, Ordering::SeqCst);
        })
    })
    .collect();

for handle in handles {
    handle.join().unwrap();
}

println!("Result: {}", counter.load(Ordering::SeqCst));
```

---

## 5. æ— é”æ•°æ®ç»“æ„

```rust
use std::sync::Arc;
use crossbeam::queue::ArrayQueue;

let queue = Arc::new(ArrayQueue::new(100));

// æ— é”é˜Ÿåˆ— - é«˜æ€§èƒ½å¹¶å‘
```

---

**ç›¸å…³æ–‡æ¡£**:

- [C05 Threads](../../../c05_threads/)

---

**æ–‡æ¡£ç»´æŠ¤**: Documentation Team
**åˆ›å»ºæ—¥æœŸ**: 2025-10-22
