# 2.1 æ‰€æœ‰æƒç³»ç»Ÿ - å®Œæ•´æŒ‡å—

> **æ–‡æ¡£ç±»å‹**: Tier 2 - å®è·µæŒ‡å— (å®Œæ•´ç‰ˆ)
> **éš¾åº¦**: â­â­ åˆçº§
> **é¢„è®¡å­¦ä¹ æ—¶é—´**: 2-3 å°æ—¶
> **æœ€åæ›´æ–°**: 2026-02-28
> **Rust ç‰ˆæœ¬**: 1.93.1+

---

## ğŸ“‹ ç›®å½•

- [2.1 æ‰€æœ‰æƒç³»ç»Ÿ - å®Œæ•´æŒ‡å—](#21-æ‰€æœ‰æƒç³»ç»Ÿ---å®Œæ•´æŒ‡å—)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ğŸ¯ å­¦ä¹ ç›®æ ‡](#-å­¦ä¹ ç›®æ ‡)
  - [1. æ‰€æœ‰æƒä¸‰å¤§è§„åˆ™](#1-æ‰€æœ‰æƒä¸‰å¤§è§„åˆ™)
    - [1.1 è§„åˆ™è¯¦è§£](#11-è§„åˆ™è¯¦è§£)
    - [1.2 ä¸ºä»€ä¹ˆéœ€è¦æ‰€æœ‰æƒ](#12-ä¸ºä»€ä¹ˆéœ€è¦æ‰€æœ‰æƒ)
    - [1.3 æ‰€æœ‰æƒä¸å†…å­˜å®‰å…¨](#13-æ‰€æœ‰æƒä¸å†…å­˜å®‰å…¨)
  - [2. å˜é‡çš„æ‰€æœ‰æƒ](#2-å˜é‡çš„æ‰€æœ‰æƒ)
    - [2.1 åŸºæœ¬ç¤ºä¾‹](#21-åŸºæœ¬ç¤ºä¾‹)
    - [2.2 æ‰€æœ‰æƒè½¬ç§» (Move)](#22-æ‰€æœ‰æƒè½¬ç§»-move)
    - [2.3 å¤åˆ¶è¯­ä¹‰ (Copy)](#23-å¤åˆ¶è¯­ä¹‰-copy)
  - [3. å‡½æ•°ä¸æ‰€æœ‰æƒ](#3-å‡½æ•°ä¸æ‰€æœ‰æƒ)
  - [4. è¿”å›å€¼ä¸æ‰€æœ‰æƒ](#4-è¿”å›å€¼ä¸æ‰€æœ‰æƒ)
  - [5. å®æˆ˜ç»ƒä¹ ](#5-å®æˆ˜ç»ƒä¹ )
    - [ç»ƒä¹  1: ä¿®å¤æ‰€æœ‰æƒé”™è¯¯](#ç»ƒä¹ -1-ä¿®å¤æ‰€æœ‰æƒé”™è¯¯)
    - [ç»ƒä¹  2: å®ç°ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²äº¤æ¢å‡½æ•°](#ç»ƒä¹ -2-å®ç°ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²äº¤æ¢å‡½æ•°)
    - [ç»ƒä¹  3: è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦åä¸ä¸¢å¤±æ‰€æœ‰æƒ](#ç»ƒä¹ -3-è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦åä¸ä¸¢å¤±æ‰€æœ‰æƒ)
  - [6. å¸¸è§é”™è¯¯ä¸è§£å†³](#6-å¸¸è§é”™è¯¯ä¸è§£å†³)
    - [é”™è¯¯ 1: use of moved value](#é”™è¯¯-1-use-of-moved-value)
    - [é”™è¯¯ 2: value used after move](#é”™è¯¯-2-value-used-after-move)
  - [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
    - [7.1 ä½•æ—¶ä½¿ç”¨ Move](#71-ä½•æ—¶ä½¿ç”¨-move)
    - [7.2 ä½•æ—¶ä½¿ç”¨ Copy](#72-ä½•æ—¶ä½¿ç”¨-copy)
    - [7.3 ä½•æ—¶ä½¿ç”¨ Clone](#73-ä½•æ—¶ä½¿ç”¨-clone)
  - [âœ… å®Œæˆæ£€æŸ¥](#-å®Œæˆæ£€æŸ¥)

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬æ–‡æ¡£åï¼Œä½ å°†èƒ½å¤Ÿï¼š

- âœ… ç†è§£æ‰€æœ‰æƒçš„**ä¸‰å¤§è§„åˆ™**åŠå…¶å®ç°åŸç†
- âœ… åŒºåˆ† **Move** å’Œ **Copy** è¯­ä¹‰
- âœ… é¢„æµ‹ä»£ç ä¸­çš„æ‰€æœ‰æƒè½¬ç§»
- âœ… è®¾è®¡åˆç†çš„æ‰€æœ‰æƒç­–ç•¥
- âœ… è§£å†³åŸºæœ¬çš„æ‰€æœ‰æƒé”™è¯¯

---

## 1. æ‰€æœ‰æƒä¸‰å¤§è§„åˆ™

### 1.1 è§„åˆ™è¯¦è§£

**è§„åˆ™ 1: æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…**:

```rust
fn rule1() {
    let s = String::from("hello");  // s æ˜¯ "hello" çš„æ‰€æœ‰è€…
    // æ¯ä¸ªèµ„æºåœ¨ä»»æ„æ—¶åˆ»éƒ½æœ‰å”¯ä¸€çš„æ‰€æœ‰è€…
}
```

**è§„åˆ™ 2: åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…**:

```rust
fn rule2() {
    let s1 = String::from("hello");
    let s2 = s1;  // æ‰€æœ‰æƒä» s1 è½¬ç§»åˆ° s2

    // println!("{}", s1);  // âŒ é”™è¯¯ï¼s1 ä¸å†æ‹¥æœ‰è¯¥å€¼
    println!("{}", s2);     // âœ… æ­£ç¡®ï¼s2 ç°åœ¨æ˜¯æ‰€æœ‰è€…
}
```

**è§„åˆ™ 3: æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå€¼è¢«è‡ªåŠ¨é‡Šæ”¾**:

```rust
fn rule3() {
    {
        let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ
        // ä½¿ç”¨ s
    }  // s ç¦»å¼€ä½œç”¨åŸŸï¼Œå†…å­˜è‡ªåŠ¨é‡Šæ”¾ï¼ˆè°ƒç”¨ dropï¼‰

    // s åœ¨è¿™é‡Œä¸å¯ç”¨
}
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ‰€æœ‰æƒ

**å¯¹æ¯”å…¶ä»–è¯­è¨€ï¼š**

| è¯­è¨€ | å†…å­˜ç®¡ç†æ–¹å¼ | é—®é¢˜ |
|------|-------------|------|
| C/C++ | æ‰‹åŠ¨ç®¡ç† | å®¹æ˜“å¿˜è®°é‡Šæ”¾ï¼ˆå†…å­˜æ³„æ¼ï¼‰æˆ–é‡å¤é‡Šæ”¾ï¼ˆuse-after-freeï¼‰ |
| Java/Python | åƒåœ¾å›æ”¶ (GC) | è¿è¡Œæ—¶å¼€é”€ï¼Œä¸å¯é¢„æµ‹çš„æš‚åœ |
| Rust | æ‰€æœ‰æƒç³»ç»Ÿ | ç¼–è¯‘æœŸæ£€æŸ¥ï¼Œé›¶è¿è¡Œæ—¶å¼€é”€ |

**Rust çš„è§£å†³æ–¹æ¡ˆï¼š**

- åœ¨ç¼–è¯‘æœŸè·Ÿè¸ªæ‰€æœ‰æƒ
- æ— è¿è¡Œæ—¶åƒåœ¾å›æ”¶å™¨
- ä¿è¯å†…å­˜å®‰å…¨ä¸”æ— æ•°æ®ç«äº‰

### 1.3 æ‰€æœ‰æƒä¸å†…å­˜å®‰å…¨

```rust
fn memory_safety() {
    let s = String::from("hello");

    // Rust ä¿è¯ä»¥ä¸‹ä¸ä¼šå‘ç”Ÿï¼š
    // 1. use-after-freeï¼ˆä½¿ç”¨å·²é‡Šæ”¾å†…å­˜ï¼‰
    // 2. double-freeï¼ˆé‡å¤é‡Šæ”¾ï¼‰
    // 3. å†…å­˜æ³„æ¼ï¼ˆé™¤éæ•…æ„ä½¿ç”¨ Rc/Arc å¾ªç¯ï¼‰

    takes_ownership(s);  // s çš„æ‰€æœ‰æƒè½¬ç§»ç»™å‡½æ•°
    // println!("{}", s);  // âŒ ç¼–è¯‘é”™è¯¯ï¼s å·²è¢«ç§»åŠ¨
} // s ä¸ä¼šåœ¨è¿™é‡Œè¢«é‡Šæ”¾ï¼ˆå·²åœ¨ takes_ownership ä¸­é‡Šæ”¾ï¼‰

fn takes_ownership(s: String) {
    println!("{}", s);
} // s åœ¨è¿™é‡Œè¢«é‡Šæ”¾
```

---

## 2. å˜é‡çš„æ‰€æœ‰æƒ

### 2.1 åŸºæœ¬ç¤ºä¾‹

```rust
fn main() {
    // æ•´æ•°æ˜¯ Copy ç±»å‹
    let x = 5;
    let y = x;  // x è¢«å¤åˆ¶åˆ° yï¼Œx ä»ç„¶æœ‰æ•ˆ
    println!("x = {}, y = {}", x, y);  // âœ… ä¸¤è€…éƒ½å¯ç”¨

    // String ä¸æ˜¯ Copy ç±»å‹
    let s1 = String::from("hello");
    let s2 = s1;  // s1 è¢«ç§»åŠ¨åˆ° s2ï¼Œs1 ä¸å†æœ‰æ•ˆ
    // println!("{}", s1);  // âŒ ç¼–è¯‘é”™è¯¯ï¼
    println!("{}", s2);     // âœ… s2 æœ‰æ•ˆ
}
```

### 2.2 æ‰€æœ‰æƒè½¬ç§» (Move)

**ä»€ä¹ˆæƒ…å†µä¸‹å‘ç”Ÿ Moveï¼Ÿ**

```rust
fn move_examples() {
    // 1. èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡
    let s1 = String::from("hello");
    let s2 = s1;  // Moveï¼

    // 2. ä¼ é€’ç»™å‡½æ•°
    let s3 = String::from("world");
    takes_ownership(s3);  // Moveï¼
    // s3 åœ¨è¿™é‡Œä¸å¯ç”¨

    // 3. ä»å‡½æ•°è¿”å›
    let s4 = gives_ownership();  // Move è¿”å›å€¼
}

fn takes_ownership(s: String) {
    println!("{}", s);
} // s åœ¨è¿™é‡Œ drop

fn gives_ownership() -> String {
    String::from("yours")
} // è¿”å›å€¼çš„æ‰€æœ‰æƒè½¬ç§»ç»™è°ƒç”¨è€…
```

### 2.3 å¤åˆ¶è¯­ä¹‰ (Copy)

**å“ªäº›ç±»å‹å®ç°äº† Copyï¼Ÿ**

```rust
fn copy_types() {
    // æ‰€æœ‰æ ‡é‡ç±»å‹éƒ½æ˜¯ Copy
    let a: i32 = 5;
    let b = a;  // Copyï¼Œä¸æ˜¯ Move
    println!("a = {}, b = {}", a, b);  // âœ… ä¸¤è€…éƒ½å¯ç”¨

    // å¸ƒå°”ç±»å‹
    let flag = true;
    let flag2 = flag;  // Copy

    // å­—ç¬¦ç±»å‹
    let c = 'z';
    let c2 = c;  // Copy

    // å…ƒç»„ï¼ˆå¦‚æœæ‰€æœ‰å…ƒç´ éƒ½æ˜¯ Copyï¼‰
    let tup = (1, 2.0, false);
    let tup2 = tup;  // Copy

    // æ•°ç»„ï¼ˆå¦‚æœå…ƒç´ æ˜¯ Copyï¼‰
    let arr = [1, 2, 3];
    let arr2 = arr;  // Copy
}

// è‡ªå®šä¹‰ç±»å‹å¯ä»¥é€šè¿‡ derive å®ç° Copy
#[derive(Copy, Clone)]
struct Point {
    x: i32,
    y: i32,
}

fn use_point() {
    let p1 = Point { x: 1, y: 2 };
    let p2 = p1;  // Copyï¼
    println!("p1.x = {}, p2.x = {}", p1.x, p2.x);  // âœ… ä¸¤è€…éƒ½å¯ç”¨
}
```

**ä»€ä¹ˆç±»å‹ä¸èƒ½å®ç° Copyï¼Ÿ**

```rust
// âŒ String ä¸èƒ½æ˜¯ Copyï¼ˆç®¡ç†å †å†…å­˜ï¼‰
// âŒ Vec ä¸èƒ½æ˜¯ Copy
// âŒ HashMap ä¸èƒ½æ˜¯ Copy
// âŒ ä»»ä½•åŒ…å«é Copy ç±»å‹çš„ç»“æ„ä½“ä¸èƒ½æ˜¯ Copy

struct Container {
    data: String,  // String ä¸æ˜¯ Copy
}
// ä¸èƒ½ #[derive(Copy, Clone)]
```

---

## 3. å‡½æ•°ä¸æ‰€æœ‰æƒ

```rust
fn main() {
    let s = String::from("hello");

    // æƒ…å†µ 1: ä¼ å…¥å¹¶è¿”å›ï¼ˆè½¬ç§»å‡ºå»å†å›æ¥ï¼‰
    let s = takes_and_gives_back(s);

    // æƒ…å†µ 2: ä½¿ç”¨å¼•ç”¨ï¼ˆä¸è½¬ç§»æ‰€æœ‰æƒï¼‰- ä¸‹ä¸€ç« å†…å®¹
    let len = calculate_length(&s);

    println!("'{}' çš„é•¿åº¦æ˜¯ {}", s, len);  // âœ… s ä»ç„¶æœ‰æ•ˆ
}

fn takes_and_gives_back(s: String) -> String {
    println!("{}", s);
    s  // è¿”å›æ‰€æœ‰æƒ
}

fn calculate_length(s: &String) -> usize {
    s.len()
} // s åœ¨è¿™é‡Œä¸ä¼šè¢« dropï¼ˆå› ä¸ºåªæ˜¯å€Ÿç”¨ï¼‰
```

**æ‰€æœ‰æƒè½¬ç§»æ€»ç»“å›¾ï¼š**

```text
ä¼ å…¥å‡½æ•°å‚æ•°: å€¼ â”€â”€Moveâ”€â”€â†’ å‡½æ•°å‚æ•° â”€â”€å‡½æ•°ç»“æŸâ”€â”€â†’ drop (é™¤éè¿”å›)
è¿”å›å‡½æ•°å€¼: å‡½æ•°å†…éƒ¨ â”€â”€Moveâ”€â”€â†’ è¿”å›å€¼ â”€â”€Moveâ”€â”€â†’ è°ƒç”¨è€…
```

---

## 4. è¿”å›å€¼ä¸æ‰€æœ‰æƒ

```rust
fn return_ownership() {
    // å‡½æ•°å¯ä»¥è¿”å›æ‰€æœ‰æƒ
    let s1 = gives_ownership();

    let s2 = String::from("hello");
    let s3 = takes_and_gives_back(s2);

    // s2 ä¸å¯ç”¨ï¼ˆå·²ç§»åŠ¨ç»™å‡½æ•°ï¼‰
    // s1 å’Œ s3 å¯ç”¨
}

fn gives_ownership() -> String {
    String::from("yours")
}

fn takes_and_gives_back(s: String) -> String {
    s  // è¿”å›ä¼ å…¥çš„å€¼
}
```

---

## 5. å®æˆ˜ç»ƒä¹ 

### ç»ƒä¹  1: ä¿®å¤æ‰€æœ‰æƒé”™è¯¯

```rust
// è¿™æ®µä»£ç æœ‰é”™è¯¯ï¼Œè¯·ä¿®å¤
fn exercise1() {
    let s = String::from("hello");
    let s2 = s;
    println!("{}", s);  // âŒ é”™è¯¯ï¼å¦‚ä½•ä¿®å¤ï¼Ÿ
}

// ç­”æ¡ˆ 1: ä½¿ç”¨ s2 è€Œä¸æ˜¯ s
fn answer1() {
    let s = String::from("hello");
    let s2 = s;
    println!("{}", s2);  // âœ…
}

// ç­”æ¡ˆ 2: å…‹éš†æ•°æ®
fn answer2() {
    let s = String::from("hello");
    let s2 = s.clone();  // æ·±æ‹·è´
    println!("{} {}", s, s2);  // âœ… ä¸¤è€…éƒ½å¯ç”¨
}
```

### ç»ƒä¹  2: å®ç°ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²äº¤æ¢å‡½æ•°

```rust
fn swap_strings() {
    let mut s1 = String::from("hello");
    let mut s2 = String::from("world");

    // å¦‚ä½•äº¤æ¢ s1 å’Œ s2 çš„å€¼ï¼Ÿ
    std::mem::swap(&mut s1, &mut s2);

    println!("s1 = {}, s2 = {}", s1, s2);  // s1 = world, s2 = hello
}
```

### ç»ƒä¹  3: è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦åä¸ä¸¢å¤±æ‰€æœ‰æƒ

```rust
fn exercise3() {
    let s = String::from("hello");

    // æ–¹æ³• 1: ä½¿ç”¨å¼•ç”¨ï¼ˆæ¨èï¼‰
    let len = get_length(&s);
    println!("{} çš„é•¿åº¦æ˜¯ {}", s, len);  // âœ… s ä»ç„¶æœ‰æ•ˆ

    // æ–¹æ³• 2: ä¼ å…¥å¹¶è¿”å›ï¼ˆç¹çï¼‰
    let (s, len) = get_length_return(s);
    println!("{} çš„é•¿åº¦æ˜¯ {}", s, len);  // âœ… s ä»ç„¶æœ‰æ•ˆ
}

fn get_length(s: &String) -> usize {
    s.len()
}

fn get_length_return(s: String) -> (String, usize) {
    let len = s.len();
    (s, len)
}
```

---

## 6. å¸¸è§é”™è¯¯ä¸è§£å†³

### é”™è¯¯ 1: use of moved value

```rust
fn error1() {
    let s = String::from("hello");
    let s2 = s;
    println!("{}", s);  // âŒ error[E0382]: borrow of moved value: `s`
}

// è§£å†³ï¼šä½¿ç”¨å¼•ç”¨æˆ– clone
fn fix1() {
    let s = String::from("hello");
    let s2 = s.clone();
    println!("{}", s);  // âœ…
}
```

### é”™è¯¯ 2: value used after move

```rust
fn error2() {
    let s = String::from("hello");
    takes_ownership(s);
    println!("{}", s);  // âŒ error[E0382]: borrow of moved value
}

fn takes_ownership(s: String) {
    println!("{}", s);
}

// è§£å†³ï¼šä½¿ç”¨å¼•ç”¨
fn fix2() {
    let s = String::from("hello");
    borrow_value(&s);
    println!("{}", s);  // âœ…
}

fn borrow_value(s: &String) {
    println!("{}", s);
}
```

---

## 7. æœ€ä½³å®è·µ

### 7.1 ä½•æ—¶ä½¿ç”¨ Move

```rust
// âœ… å½“è°ƒç”¨è€…ä¸å†éœ€è¦è¯¥å€¼æ—¶
fn consume_data(data: Vec<u8>) {
    // å¤„ç†å¹¶æ¶ˆè€—æ•°æ®
}

// âœ… å½“éœ€è¦è½¬ç§»æ‰€æœ‰æƒåˆ°æ–°çš„ä½œç”¨åŸŸ
fn transfer_to_thread(data: String) {
    std::thread::spawn(move || {
        println!("{}", data);
    });
}
```

### 7.2 ä½•æ—¶ä½¿ç”¨ Copy

```rust
// âœ… å°å‹ã€å›ºå®šçš„å€¼
#[derive(Copy, Clone)]
struct Config {
    max_size: usize,
    timeout: u64,
}

// âŒ ä¸è¦ä¸ºå¤§å‹ç»“æ„ä½“å®ç° Copy
#[derive(Clone)]  // åªå®ç° Cloneï¼Œä¸å®ç° Copy
struct LargeData {
    buffer: [u8; 1024],
}
```

### 7.3 ä½•æ—¶ä½¿ç”¨ Clone

```rust
// å½“ç¡®å®éœ€è¦ä¸¤ä¸ªç‹¬ç«‹çš„å‰¯æœ¬æ—¶
fn duplicate_data() {
    let original = String::from("important");
    let backup = original.clone();

    // ç°åœ¨å¯ä»¥ç‹¬ç«‹ä¿®æ”¹ä¸¤è€…
    process(&mut original.clone());
    store(&backup);
}
```

---

## âœ… å®Œæˆæ£€æŸ¥

ä½ èƒ½å›ç­”ä»¥ä¸‹é—®é¢˜å—ï¼Ÿ

- [ ] ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒçš„ä¸‰å¤§è§„åˆ™ï¼Ÿ
- [ ] Move å’Œ Copy æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
- [ ] ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿæ‰€æœ‰æƒè½¬ç§»ï¼Ÿ
- [ ] ä¸ºä»€ä¹ˆ String ä¸æ˜¯ Copy ç±»å‹ï¼Ÿ
- [ ] å¦‚ä½•åœ¨å‡½æ•°è°ƒç”¨åä¿ç•™æ‰€æœ‰æƒï¼Ÿ

å¦‚æœéƒ½èƒ½å›ç­”ï¼Œä½ å·²ç»æŒæ¡äº†æ‰€æœ‰æƒçš„åŸºç¡€ï¼ä¸‹ä¸€æ­¥å­¦ä¹ **å€Ÿç”¨ï¼ˆBorrowingï¼‰**ã€‚

---

**æ–‡æ¡£ç»´æŠ¤**: Rust å­¦ä¹ é¡¹ç›®å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2026-02-28
**ç‰ˆæœ¬**: v2.0 (å®Œæ•´ç‰ˆ)
