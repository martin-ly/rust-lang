# 2.2 借用检查器

**文档版本**: 1.0
**适用 Rust 版本**: 1.92.0+
**最后更新**: 2025-12-11
**预计学习时间**: 4-6 小时

> 本文档是借用检查器的核心导航文档。完整的实现细节请参考：[借用系统](./02_借用实践指南.md)

## 📋 目录

- [2.2 借用检查器](#22-借用检查器)
  - [📋 目录](#-目录)
  - [📖 学习目标](#-学习目标)
  - [📐 知识结构](#-知识结构)
    - [概念定义](#概念定义)
    - [属性特征](#属性特征)
    - [关系连接](#关系连接)
    - [思维导图](#思维导图)
  - [🎯 核心内容导航](#-核心内容导航)
    - [1. 借用规则](#1-借用规则)
    - [2. 借用检查器机制](#2-借用检查器机制)
    - [3. 不可变借用与可变借用](#3-不可变借用与可变借用)
  - [📚 完整内容](#-完整内容)
  - [💡 快速参考](#-快速参考)
    - [借用规则速查](#借用规则速查)
  - [🔗 相关主题](#-相关主题)
  - [🚀 下一步](#-下一步)

## 📖 学习目标

完成本文档后，你将能够：

- ✅ 深入理解借用规则的设计原理（能力转移与受限授权）
- ✅ 掌握不可变借用和可变借用的使用场景（访问许可证）
- ✅ 理解借用检查器的工作机制（编译期逻辑证明系统）
- ✅ 熟练使用 NLL (Non-Lexical Lifetimes)（逻辑证明的有效范围计算）
- ✅ 能够解决各种借用相关的编译错误（逻辑证明的失败）

---

## 📐 知识结构

### 概念定义

**借用实践指南 (Borrowing Practice Guide)**:

- **定义**: 深入理解借用规则和借用检查器的实践指南
- **类型**: 实践指南文档
- **范畴**: 所有权系统、内存安全
- **版本**: Rust 1.0+ (基础), Rust 1.31+ (NLL)
- **相关概念**: 借用、借用检查器、不可变借用、可变借用、NLL

**借用 (Borrowing)**:

- **定义**: 通过引用访问值而不获取所有权的机制
- **类型**: 内存安全机制
- **属性**: 不可变借用、可变借用、借用规则
- **关系**: 与所有权、生命周期相关

### 属性特征

**核心属性**:

- **借用规则**: 任意数量的不可变借用 OR 一个可变借用
- **借用检查器**: 编译期逻辑证明系统
- **NLL**: Non-Lexical Lifetimes，逻辑证明的有效范围计算
- **借用场景**: 不可变借用、可变借用的使用场景

**性能特征**:

- **零成本**: 借用本身零运行时开销
- **编译时检查**: 编译期逻辑证明
- **适用场景**: 共享访问、独占访问、内存安全

### 关系连接

**继承关系**:

- 不可变借用 --[is-a]--> 借用
- 可变借用 --[is-a]--> 借用

**组合关系**:

- 借用实践指南 --[covers]--> 借用规则和检查器
- 内存安全程序 --[uses]--> 借用

**依赖关系**:

- 借用 --[depends-on]--> 所有权系统
- 内存安全 --[depends-on]--> 借用

### 思维导图

```text
借用实践指南
│
├── 借用规则
│   ├── 不可变借用
│   └── 可变借用
├── 借用检查器
│   └── 编译期逻辑证明
├── NLL
│   └── 有效范围计算
└── 使用场景
    └── 共享访问
```

---

## 🎯 核心内容导航

### 1. 借用规则

**核心规则**（引用一致性视角）:

```text
✅ 任意数量的不可变借用 (&T) - 只读访问许可证
   OR
✅ 有且仅有一个可变借用 (&mut T) - 独占写入能力的证明

✅ 借用必须总是有效（不能悬垂） - 编译期逻辑证明
```

**详细学习**: [借用系统完整文档](./02_借用实践指南.md)

### 2. 借用检查器机制

**关键概念**（引用一致性视角）:

- 编译期逻辑证明系统（约束求解，非内存状态检查）
- 借用作用域检查（逻辑证明的有效范围）
- NLL (Non-Lexical Lifetimes) 改进（逻辑证明更精确地计算引用的有效范围）

**详细学习**: [借用系统完整文档](./02_借用实践指南.md)

### 3. 不可变借用与可变借用

**对比**:

| 特性 | 不可变借用 `&T` | 可变借用 `&mut T` |
| ---- | --------------- | ----------------- |
| 数量 | 无限制          | 唯一              |
| 并发 | 允许            | 互斥              |
| 修改 | 不可            | 可以              |

**详细学习**: [借用系统完整文档](./02_借用实践指南.md)

## 📚 完整内容

本主题的完整详细内容，包括大量示例和深入解析，请参考：

**[📖 借用系统完整文档](./02_借用实践指南.md)**

该文档包含：

- ✅ 借用基础概念
- ✅ 不可变借用详解
- ✅ 可变借用详解
- ✅ 借用规则和限制
- ✅ 借用检查器原理
- ✅ NLL特性详解
- ✅ 常见问题和解决方案

## 💡 快速参考

### 借用规则速查

```rust
let s = String::from("hello");

// ✅ 多个不可变借用
let r1 = &s;
let r2 = &s;

// ✅ 一个可变借用（不可变借用已结束）
let mut s = String::from("hello");
let r = &mut s;

// ❌ 错误：同时有不可变和可变借用
let r1 = &s;
let r2 = &mut s;  // 编译错误
```

## 🔗 相关主题

- 📖 [2.1 所有权系统](./2.1_所有权系统.md)
- 📖 [2.3 生命周期](./2.3_生命周期.md)
- 📖 [2.4 作用域规则](./2.4_作用域规则.md)

## 🚀 下一步

**继续学习**: [2.3 生命周期](./2.3_生命周期.md)

---

**最后更新**: 2025-12-11
**维护状态**: ✅ 活跃维护
