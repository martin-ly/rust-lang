# ğŸ’» C01: æ‰€æœ‰æƒä¸å€Ÿç”¨ - ä»£ç ç¤ºä¾‹é›†åˆ

> **åˆ›å»ºæ—¥æœŸ**: 2025-10-25
> **éš¾åº¦**: â­ åŸºç¡€ â†’ â­â­â­ è¿›é˜¶
> **ç›®æ ‡**: é€šè¿‡ä¸°å¯Œçš„ä»£ç ç¤ºä¾‹æ·±å…¥ç†è§£æ‰€æœ‰æƒå’Œå€Ÿç”¨

---

## ç›®å½•

- [ğŸ’» C01: æ‰€æœ‰æƒä¸å€Ÿç”¨ - ä»£ç ç¤ºä¾‹é›†åˆ](#-c01-æ‰€æœ‰æƒä¸å€Ÿç”¨---ä»£ç ç¤ºä¾‹é›†åˆ)
  - [ç›®å½•](#ç›®å½•)
  - [ğŸ“‹ ç¤ºä¾‹å¯¼èˆª](#-ç¤ºä¾‹å¯¼èˆª)
  - [ğŸŒŸ Tier 1: åŸºç¡€æ¦‚å¿µç¤ºä¾‹](#-tier-1-åŸºç¡€æ¦‚å¿µç¤ºä¾‹)
    - [ç¤ºä¾‹1.1: åŸºç¡€æ‰€æœ‰æƒè½¬ç§»](#ç¤ºä¾‹11-åŸºç¡€æ‰€æœ‰æƒè½¬ç§»)
    - [ç¤ºä¾‹1.2: Copy vs. Move å¯¹æ¯”](#ç¤ºä¾‹12-copy-vs-move-å¯¹æ¯”)
    - [ç¤ºä¾‹1.3: ä¸å¯å˜å€Ÿç”¨](#ç¤ºä¾‹13-ä¸å¯å˜å€Ÿç”¨)
    - [ç¤ºä¾‹1.4: å¯å˜å€Ÿç”¨](#ç¤ºä¾‹14-å¯å˜å€Ÿç”¨)
    - [ç¤ºä¾‹1.5: å€Ÿç”¨è§„åˆ™ä¸å¸¸è§é”™è¯¯](#ç¤ºä¾‹15-å€Ÿç”¨è§„åˆ™ä¸å¸¸è§é”™è¯¯)
  - [ğŸš€ Tier 2: å®è·µåº”ç”¨ç¤ºä¾‹](#-tier-2-å®è·µåº”ç”¨ç¤ºä¾‹)
    - [ç¤ºä¾‹2.1: å‡½æ•°å‚æ•°ç”Ÿå‘½å‘¨æœŸ](#ç¤ºä¾‹21-å‡½æ•°å‚æ•°ç”Ÿå‘½å‘¨æœŸ)
    - [ç¤ºä¾‹2.2: ç»“æ„ä½“ç”Ÿå‘½å‘¨æœŸ](#ç¤ºä¾‹22-ç»“æ„ä½“ç”Ÿå‘½å‘¨æœŸ)
    - [ç¤ºä¾‹2.3: ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™](#ç¤ºä¾‹23-ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™)
    - [ç¤ºä¾‹2.4: åˆ‡ç‰‡æ“ä½œå®è·µ](#ç¤ºä¾‹24-åˆ‡ç‰‡æ“ä½œå®è·µ)
    - [ç¤ºä¾‹2.5: String vs \&str æ·±å…¥ç†è§£](#ç¤ºä¾‹25-string-vs-str-æ·±å…¥ç†è§£)
  - [ğŸ“ Tier 3: æ·±å…¥ç†è§£ç¤ºä¾‹](#-tier-3-æ·±å…¥ç†è§£ç¤ºä¾‹)
    - [ç¤ºä¾‹3.1: å¤æ‚ç”Ÿå‘½å‘¨æœŸåœºæ™¯](#ç¤ºä¾‹31-å¤æ‚ç”Ÿå‘½å‘¨æœŸåœºæ™¯)
    - [ç¤ºä¾‹3.2: 'static ç”Ÿå‘½å‘¨æœŸè¯¦è§£](#ç¤ºä¾‹32-static-ç”Ÿå‘½å‘¨æœŸè¯¦è§£)
    - [ç¤ºä¾‹3.3: RefCell å†…éƒ¨å¯å˜æ€§](#ç¤ºä¾‹33-refcell-å†…éƒ¨å¯å˜æ€§)
    - [ç¤ºä¾‹3.4: Cell ç®€å•å†…éƒ¨å¯å˜æ€§](#ç¤ºä¾‹34-cell-ç®€å•å†…éƒ¨å¯å˜æ€§)
  - [ğŸ“ æ€»ç»“](#-æ€»ç»“)
    - [å­¦ä¹ è·¯å¾„å»ºè®®](#å­¦ä¹ è·¯å¾„å»ºè®®)
    - [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
    - [ä¸‹ä¸€æ­¥](#ä¸‹ä¸€æ­¥)

## ğŸ“‹ ç¤ºä¾‹å¯¼èˆª

| ç¼–å·                                  | ä¸»é¢˜             | éš¾åº¦   | é‡ç‚¹æ¦‚å¿µ     |
| :--- | :--- | :--- | :--- || [1.1](#ç¤ºä¾‹11-åŸºç¡€æ‰€æœ‰æƒè½¬ç§»)         | åŸºç¡€æ‰€æœ‰æƒè½¬ç§»   | â­     | ç§»åŠ¨è¯­ä¹‰     |
| [1.2](#ç¤ºä¾‹12-copy-vs-move-å¯¹æ¯”)      | Copy vs. Move    | â­     | Copy trait   |
| [1.3](#ç¤ºä¾‹13-ä¸å¯å˜å€Ÿç”¨)             | ä¸å¯å˜å€Ÿç”¨       | â­     | & å¼•ç”¨       |
| [1.4](#ç¤ºä¾‹14-å¯å˜å€Ÿç”¨)               | ä¸å¯å˜å€Ÿç”¨       | â­     | &mut å¼•ç”¨    |
| [1.5](#ç¤ºä¾‹15-å€Ÿç”¨è§„åˆ™ä¸å¸¸è§é”™è¯¯)     | å€Ÿç”¨è§„åˆ™         | â­â­   | å€Ÿç”¨æ£€æŸ¥å™¨   |
| [2.1](#ç¤ºä¾‹21-å‡½æ•°å‚æ•°ç”Ÿå‘½å‘¨æœŸ)       | å‡½æ•°ç”Ÿå‘½å‘¨æœŸ     | â­â­   | ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ |
| [2.2](#ç¤ºä¾‹22-ç»“æ„ä½“ç”Ÿå‘½å‘¨æœŸ)         | ç»“æ„ä½“ç”Ÿå‘½å‘¨æœŸ   | â­â­   | 'a æ ‡æ³¨      |
| [2.3](#ç¤ºä¾‹23-ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™)       | ç”Ÿå‘½å‘¨æœŸçœç•¥     | â­â­   | çœç•¥è§„åˆ™     |
| [2.4](#ç¤ºä¾‹24-åˆ‡ç‰‡æ“ä½œå®è·µ)           | åˆ‡ç‰‡æ“ä½œ         | â­â­   | &[T] å’Œ &str |
| [2.5](#ç¤ºä¾‹25-string-vs-str-æ·±å…¥ç†è§£) | String vs &str   | â­â­   | å­—ç¬¦ä¸²ç±»å‹   |
| [3.1](#ç¤ºä¾‹31-å¤æ‚ç”Ÿå‘½å‘¨æœŸåœºæ™¯)       | å¤æ‚ç”Ÿå‘½å‘¨æœŸ     | â­â­â­ | å¤šä¸ªç”Ÿå‘½å‘¨æœŸ |
| [3.2](#ç¤ºä¾‹32-static-ç”Ÿå‘½å‘¨æœŸè¯¦è§£)    | 'static ç”Ÿå‘½å‘¨æœŸ | â­â­â­ | é™æ€ç”Ÿå‘½å‘¨æœŸ |
| [3.3](#ç¤ºä¾‹33-refcell-å†…éƒ¨å¯å˜æ€§)     | RefCell ä½¿ç”¨     | â­â­â­ | å†…éƒ¨å¯å˜æ€§   |
| [3.4](#ç¤ºä¾‹34-cell-ç®€å•å†…éƒ¨å¯å˜æ€§)    | Cell ä½¿ç”¨        | â­â­â­ | å†…éƒ¨å¯å˜æ€§   |

---

## ğŸŒŸ Tier 1: åŸºç¡€æ¦‚å¿µç¤ºä¾‹

### ç¤ºä¾‹1.1: åŸºç¡€æ‰€æœ‰æƒè½¬ç§»

**ç›®æ ‡**: ç†è§£æ‰€æœ‰æƒçš„ç§»åŠ¨è¯­ä¹‰

**éš¾åº¦**: â­

**ä»£ç **:

```rust
fn main() {
    // åˆ›å»ºä¸€ä¸ª String (å †åˆ†é…æ•°æ®)
    let s1 = String::from("hello");
    println!("s1: {}", s1);

    // æ‰€æœ‰æƒè½¬ç§»: s1 çš„æ‰€æœ‰æƒç§»åŠ¨åˆ° s2
    let s2 = s1;

    // âŒ é”™è¯¯! s1 å·²ç»ä¸å†æœ‰æ•ˆ
    // println!("s1: {}", s1);
    // ç¼–è¯‘é”™è¯¯: borrow of moved value: `s1`

    // âœ… æ­£ç¡®: s2 ç°åœ¨æ‹¥æœ‰æ•°æ®
    println!("s2: {}", s2);

    // æ‰€æœ‰æƒå†æ¬¡è½¬ç§»ç»™å‡½æ•°
    take_ownership(s2);

    // âŒ é”™è¯¯! s2 çš„æ‰€æœ‰æƒå·²ç»è½¬ç§»
    // println!("s2: {}", s2);
}

fn take_ownership(s: String) {
    println!("å‡½æ•°æ‹¥æœ‰: {}", s);
    // å‡½æ•°ç»“æŸæ—¶,s è¢« drop
}
```

**è¯´æ˜**:

- **ç§»åŠ¨è¯­ä¹‰**: å½“ `let s2 = s1` æ—¶,æ‰€æœ‰æƒä» `s1` è½¬ç§»åˆ° `s2`
- **å¤±æ•ˆ**: `s1` åœ¨ç§»åŠ¨åä¸å†æœ‰æ•ˆ,è®¿é—®ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯
- **Drop**: å‡½æ•°ç»“æŸæ—¶,å‚æ•° `s` è¢«è‡ªåŠ¨é‡Šæ”¾

**è¾“å‡º**:

```text
s1: hello
s2: hello
å‡½æ•°æ‹¥æœ‰: hello
```

**å…³é”®ç‚¹**:

- ğŸ¯ Rust é€šè¿‡ç§»åŠ¨è¯­ä¹‰é˜²æ­¢åŒé‡é‡Šæ”¾ (double free)
- ğŸ¯ ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±èƒ½æ•è·è¿™ç±»é”™è¯¯
- ğŸ¯ ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜,å®‰å…¨ä¸”é«˜æ•ˆ

---

### ç¤ºä¾‹1.2: Copy vs. Move å¯¹æ¯”

**ç›®æ ‡**: åŒºåˆ† Copy ç±»å‹å’Œ Move ç±»å‹

**éš¾åº¦**: â­

**ä»£ç **:

```rust
fn main() {
    // ===== Copy ç±»å‹ (æ ˆä¸Šæ•°æ®) =====

    // åŸºæœ¬ç±»å‹å®ç°äº† Copy trait
    let x = 5;
    let y = x;  // è¿™æ˜¯æ‹·è´,ä¸æ˜¯ç§»åŠ¨

    println!("x = {}, y = {}", x, y);  // âœ… x ä»ç„¶æœ‰æ•ˆ!

    // å…ƒç»„ä¸­æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ Copy,åˆ™å…ƒç»„ä¹Ÿæ˜¯ Copy
    let point1 = (1, 2);
    let point2 = point1;  // æ‹·è´

    println!("point1: {:?}, point2: {:?}", point1, point2);  // âœ… éƒ½æœ‰æ•ˆ

    // ===== Move ç±»å‹ (å †ä¸Šæ•°æ®) =====

    // String æ²¡æœ‰å®ç° Copy trait
    let s1 = String::from("hello");
    let s2 = s1;  // è¿™æ˜¯ç§»åŠ¨,ä¸æ˜¯æ‹·è´

    // println!("{}", s1);  // âŒ é”™è¯¯! s1 å·²å¤±æ•ˆ
    println!("s2: {}", s2);  // âœ… åªæœ‰ s2 æœ‰æ•ˆ

    // Vec ä¹Ÿæ²¡æœ‰å®ç° Copy
    let v1 = vec![1, 2, 3];
    let v2 = v1;  // ç§»åŠ¨

    // println!("{:?}", v1);  // âŒ é”™è¯¯!
    println!("v2: {:?}", v2);  // âœ…

    // ===== å®ç°äº† Copy çš„ç±»å‹ =====
    println!("\nå®ç°äº† Copy çš„ç±»å‹:");

    let int: i32 = 42;
    let float: f64 = 3.14;
    let boolean: bool = true;
    let character: char = 'R';

    let int2 = int;  // æ‰€æœ‰åŸºæœ¬ç±»å‹éƒ½æ˜¯ Copy
    println!("int: {}, int2: {}", int, int2);  // éƒ½æœ‰æ•ˆ

    // ===== å¦‚æœéœ€è¦æ‹·è´ Move ç±»å‹ =====
    let s3 = String::from("world");
    let s4 = s3.clone();  // æ˜¾å¼å…‹éš†

    println!("s3: {}, s4: {}", s3, s4);  // âœ… éƒ½æœ‰æ•ˆ
}
```

**è¯´æ˜**:

- **Copy ç±»å‹**: æ ˆä¸Šæ•°æ®,æ‹·è´å»‰ä»·,è‡ªåŠ¨ copy
- **Move ç±»å‹**: å †ä¸Šæ•°æ®,ç§»åŠ¨æ‰€æœ‰æƒ,é˜²æ­¢åŒé‡é‡Šæ”¾
- **Clone**: éœ€è¦æ‹·è´ Move ç±»å‹æ—¶,ä½¿ç”¨ `.clone()`

**è¾“å‡º**:

```text
x = 5, y = 5
point1: (1, 2), point2: (1, 2)
s2: hello
v2: [1, 2, 3]

å®ç°äº† Copy çš„ç±»å‹:
int: 42, int2: 42
s3: world, s4: world
```

**ç±»å‹å¯¹ç…§è¡¨**:

| ç±»å‹                         | Copy?  | åŸå›               |
| :--- | :--- | :--- || `i32`, `f64`, `bool`, `char` | âœ… Yes | å›ºå®šå¤§å°,æ ˆä¸Š     |
| `(i32, i32)`                 | âœ… Yes | æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ Copy |
| `&T`                         | âœ… Yes | å¼•ç”¨æœ¬èº«å¯ä»¥ Copy |
| `String`                     | âŒ No  | å †åˆ†é…,éœ€è¦ç§»åŠ¨   |
| `Vec<T>`                     | âŒ No  | å †åˆ†é…,éœ€è¦ç§»åŠ¨   |
| `Box<T>`                     | âŒ No  | å †åˆ†é…,éœ€è¦ç§»åŠ¨   |

---

### ç¤ºä¾‹1.3: ä¸å¯å˜å€Ÿç”¨

**ç›®æ ‡**: æŒæ¡ä¸å¯å˜å¼•ç”¨çš„ä½¿ç”¨

**éš¾åº¦**: â­

**ä»£ç **:

```rust
fn main() {
    let s = String::from("hello world");

    // åˆ›å»ºä¸å¯å˜å€Ÿç”¨
    let len = calculate_length(&s);

    println!("'{}' çš„é•¿åº¦æ˜¯ {}", s, len);  // âœ… s ä»ç„¶æœ‰æ•ˆ

    // å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªä¸å¯å˜å€Ÿç”¨
    let r1 = &s;
    let r2 = &s;
    let r3 = &s;

    println!("r1: {}, r2: {}, r3: {}", r1, r2, r3);  // âœ… éƒ½å¯ä»¥è¯»å–

    // ä¸å¯å˜å€Ÿç”¨ä¸èƒ½ä¿®æ”¹æ•°æ®
    // r1.push_str(" rust");  // âŒ ç¼–è¯‘é”™è¯¯!

    // å€Ÿç”¨ç»“æŸå,æ‰€æœ‰æƒä»ç„¶å±äº s
    println!("åŸå§‹å­—ç¬¦ä¸²: {}", s);
}

fn calculate_length(s: &String) -> usize {
    // s æ˜¯å¯¹ String çš„å¼•ç”¨,ä¸æ‹¥æœ‰å®ƒ
    s.len()
    // s åœ¨è¿™é‡Œç¦»å¼€ä½œç”¨åŸŸ,ä½†å› ä¸ºå®ƒä¸æ‹¥æœ‰æ•°æ®,æ‰€ä»¥ä¸ä¼šé‡Šæ”¾
}
```

**è¯´æ˜**:

- **ä¸å¯å˜å€Ÿç”¨**: ä½¿ç”¨ `&` åˆ›å»ºå¼•ç”¨,å¯ä»¥è¯»å–ä½†ä¸èƒ½ä¿®æ”¹
- **å¤šä¸ªå€Ÿç”¨**: å¯ä»¥åŒæ—¶å­˜åœ¨ä»»æ„å¤šä¸ªä¸å¯å˜å€Ÿç”¨
- **æ‰€æœ‰æƒä¸å˜**: å€Ÿç”¨ä¸ä¼šè½¬ç§»æ‰€æœ‰æƒ

**è¾“å‡º**:

```text
'hello world' çš„é•¿åº¦æ˜¯ 11
r1: hello world, r2: hello world, r3: hello world
åŸå§‹å­—ç¬¦ä¸²: hello world
```

**å€Ÿç”¨è§„åˆ™**:

- âœ… å¯ä»¥æœ‰ä»»æ„å¤šä¸ªä¸å¯å˜å€Ÿç”¨ `&T`
- âœ… å€Ÿç”¨æœŸé—´åŸå§‹å€¼åªè¯»
- âŒ ä¸èƒ½ä¿®æ”¹å€Ÿç”¨çš„æ•°æ®

---

### ç¤ºä¾‹1.4: å¯å˜å€Ÿç”¨

**ç›®æ ‡**: æŒæ¡å¯å˜å¼•ç”¨çš„ä½¿ç”¨å’Œé™åˆ¶

**éš¾åº¦**: â­

**ä»£ç **:

```rust
fn main() {
    // å¿…é¡»ä½¿ç”¨ mut å£°æ˜å¯å˜å˜é‡
    let mut s = String::from("hello");

    println!("ä¿®æ”¹å‰: {}", s);

    // åˆ›å»ºå¯å˜å€Ÿç”¨
    change(&mut s);

    println!("ä¿®æ”¹å: {}", s);

    // ===== å¯å˜å€Ÿç”¨çš„é™åˆ¶ =====

    let mut value = 10;

    // åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨
    let r1 = &mut value;
    *r1 += 1;
    println!("r1 ä¿®æ”¹å: {}", r1);

    // âŒ é”™è¯¯! ä¸èƒ½åŒæ—¶å­˜åœ¨ä¸¤ä¸ªå¯å˜å€Ÿç”¨
    // let r2 = &mut value;
    // println!("{}, {}", r1, r2);

    // âœ… æ­£ç¡®: r1 çš„ä½œç”¨åŸŸç»“æŸå,å¯ä»¥åˆ›å»ºæ–°çš„å¯å˜å€Ÿç”¨
    let r2 = &mut value;
    *r2 += 1;
    println!("r2 ä¿®æ”¹å: {}", r2);

    // ===== å¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨ä¸èƒ½å…±å­˜ =====

    let mut s2 = String::from("hello");

    let r3 = &s2;  // ä¸å¯å˜å€Ÿç”¨
    let r4 = &s2;  // å¦ä¸€ä¸ªä¸å¯å˜å€Ÿç”¨

    println!("{} and {}", r3, r4);  // âœ… å¯ä»¥
    // r3 å’Œ r4 çš„ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ

    let r5 = &mut s2;  // âœ… å¯ä»¥,å› ä¸ºä¸å¯å˜å€Ÿç”¨å·²ç»“æŸ
    r5.push_str(" world");
    println!("{}", r5);
}

fn change(s: &mut String) {
    s.push_str(", world");
}
```

**è¯´æ˜**:

- **å¯å˜å€Ÿç”¨**: ä½¿ç”¨ `&mut` åˆ›å»ºå¯ä»¥ä¿®æ”¹çš„å¼•ç”¨
- **ç‹¬å è®¿é—®**: åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å€Ÿç”¨
- **äº’æ–¥è§„åˆ™**: å¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨ä¸èƒ½å…±å­˜

**è¾“å‡º**:

```text
ä¿®æ”¹å‰: hello
ä¿®æ”¹å: hello, world
r1 ä¿®æ”¹å: 11
r2 ä¿®æ”¹å: 12
hello and hello
hello world
```

**å…³é”®è§„åˆ™**:

- âœ… å¯å˜å€Ÿç”¨ `&mut T` å¯ä»¥ä¿®æ”¹æ•°æ®
- âŒ åŒä¸€æ—¶é—´åªèƒ½æœ‰**ä¸€ä¸ª**å¯å˜å€Ÿç”¨
- âŒ å¯å˜å€Ÿç”¨æœŸé—´ä¸èƒ½æœ‰ä¸å¯å˜å€Ÿç”¨
- ğŸ¯ è¿™äº›è§„åˆ™é˜²æ­¢æ•°æ®ç«äº‰

---

### ç¤ºä¾‹1.5: å€Ÿç”¨è§„åˆ™ä¸å¸¸è§é”™è¯¯

**ç›®æ ‡**: ç†è§£å€Ÿç”¨æ£€æŸ¥å™¨çš„è§„åˆ™å¹¶é¿å…å¸¸è§é”™è¯¯

**éš¾åº¦**: â­â­

**ä»£ç **:

```rust
fn main() {
    println!("===== é”™è¯¯1: åŒæ—¶å­˜åœ¨å¯å˜å’Œä¸å¯å˜å€Ÿç”¨ =====");

    let mut s = String::from("hello");

    let r1 = &s;       // ä¸å¯å˜å€Ÿç”¨
    let r2 = &s;       // å¦ä¸€ä¸ªä¸å¯å˜å€Ÿç”¨
    // let r3 = &mut s; // âŒ é”™è¯¯! ä¸èƒ½åœ¨ä¸å¯å˜å€Ÿç”¨å­˜åœ¨æ—¶åˆ›å»ºå¯å˜å€Ÿç”¨

    println!("{} and {}", r1, r2);
    // r1 å’Œ r2 çš„ä½œç”¨åŸŸç»“æŸ

    let r3 = &mut s;  // âœ… ç°åœ¨å¯ä»¥äº†
    r3.push_str(" world");
    println!("{}", r3);

    println!("\n===== é”™è¯¯2: å¤šä¸ªå¯å˜å€Ÿç”¨ =====");

    let mut value = 10;

    {
        let r1 = &mut value;
        *r1 += 1;
        println!("r1: {}", r1);
        // r1 çš„ä½œç”¨åŸŸç»“æŸ
    }

    // âœ… æ­£ç¡®: ä½¿ç”¨ä½œç”¨åŸŸåˆ†éš”ä¸åŒçš„å¯å˜å€Ÿç”¨
    {
        let r2 = &mut value;
        *r2 += 1;
        println!("r2: {}", r2);
    }

    println!("\n===== é”™è¯¯3: æ‚¬å‚å¼•ç”¨ =====");

    // let reference_to_nothing = dangle();  // âŒ ç¼–è¯‘é”™è¯¯!
    let no_dangle = no_dangle();  // âœ… è¿”å›æ‰€æœ‰æƒ
    println!("no_dangle: {}", no_dangle);

    println!("\n===== æ­£ç¡®ä½¿ç”¨: NLL (éè¯æ³•ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸ) =====");

    let mut s = String::from("hello");

    let r1 = &s;
    let r2 = &s;
    println!("{} and {}", r1, r2);
    // r1 å’Œ r2 ä¸å†ä½¿ç”¨ (NLL: åœ¨æœ€åä¸€æ¬¡ä½¿ç”¨åç»“æŸ)

    let r3 = &mut s;  // âœ… å¯ä»¥! r1 å’Œ r2 å·²ç»ä¸å†ä½¿ç”¨
    r3.push_str(" world");
    println!("{}", r3);
}

// âŒ é”™è¯¯ç¤ºä¾‹: è¿”å›æ‚¬å‚å¼•ç”¨
// fn dangle() -> &String {
//     let s = String::from("hello");
//     &s  // âŒ é”™è¯¯! è¿”å›å¯¹å±€éƒ¨å˜é‡çš„å¼•ç”¨
// }  // s åœ¨è¿™é‡Œè¢« drop,å¼•ç”¨æŒ‡å‘æ— æ•ˆå†…å­˜

// âœ… æ­£ç¡®: è¿”å›æ‰€æœ‰æƒ
fn no_dangle() -> String {
    let s = String::from("hello");
    s  // ç§»åŠ¨æ‰€æœ‰æƒå‡ºå»
}
```

**è¯´æ˜**:

- **NLL**: éè¯æ³•ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸ,å¼•ç”¨åœ¨æœ€åä¸€æ¬¡ä½¿ç”¨åå³å¯ç»“æŸ
- **æ‚¬å‚å¼•ç”¨**: Rust ç¼–è¯‘å™¨ä¼šé˜»æ­¢è¿”å›æŒ‡å‘å·²é‡Šæ”¾å†…å­˜çš„å¼•ç”¨
- **ä½œç”¨åŸŸ**: ä½¿ç”¨ `{}` åˆ›å»ºæ–°ä½œç”¨åŸŸæ¥åˆ†éš”å€Ÿç”¨

**è¾“å‡º**:

```text
===== é”™è¯¯1: åŒæ—¶å­˜åœ¨å¯å˜å’Œä¸å¯å˜å€Ÿç”¨ =====
hello and hello
hello world

===== é”™è¯¯2: å¤šä¸ªå¯å˜å€Ÿç”¨ =====
r1: 11
r2: 12

===== é”™è¯¯3: æ‚¬å‚å¼•ç”¨ =====
no_dangle: hello

===== æ­£ç¡®ä½¿ç”¨: NLL (éè¯æ³•ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸ) =====
hello and hello
hello world
```

**å¸¸è§é”™è¯¯æ€»ç»“**:

| é”™è¯¯ç±»å‹               | åŸå›                | è§£å†³æ–¹æ¡ˆ            |
| :--- | :--- | :--- || åŒæ—¶å­˜åœ¨ `&` å’Œ `&mut` | è¿åå€Ÿç”¨è§„åˆ™       | å…ˆä½¿ç”¨å®Œä¸å¯å˜å€Ÿç”¨  |
| å¤šä¸ª `&mut`            | è¿åç‹¬å è§„åˆ™       | ä½¿ç”¨ä½œç”¨åŸŸåˆ†éš”      |
| æ‚¬å‚å¼•ç”¨               | è¿”å›å±€éƒ¨å˜é‡çš„å¼•ç”¨ | è¿”å›æ‰€æœ‰æƒ,ä¸æ˜¯å¼•ç”¨ |
| ä½¿ç”¨å·²ç§»åŠ¨çš„å€¼         | æ‰€æœ‰æƒå·²è½¬ç§»       | ä½¿ç”¨å¼•ç”¨æˆ– clone    |

---

## ğŸš€ Tier 2: å®è·µåº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹2.1: å‡½æ•°å‚æ•°ç”Ÿå‘½å‘¨æœŸ

**ç›®æ ‡**: ç†è§£å‡½æ•°ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

**éš¾åº¦**: â­â­

**ä»£ç **:

```rust
fn main() {
    let string1 = String::from("long string is long");
    let string2 = String::from("xyz");

    let result = longest(&string1, &string2);
    println!("æœ€é•¿çš„å­—ç¬¦ä¸²æ˜¯: {}", result);

    // ===== ç”Ÿå‘½å‘¨æœŸç¡®ä¿äº†å¼•ç”¨çš„æœ‰æ•ˆæ€§ =====

    let string1 = String::from("long string is long");
    let result;
    {
        let string2 = String::from("xyz");
        result = longest(&string1, &string2);
        println!("å†…éƒ¨ä½œç”¨åŸŸ: {}", result);  // âœ… æœ‰æ•ˆ
    }
    // println!("å¤–éƒ¨ä½œç”¨åŸŸ: {}", result);  // âŒ é”™è¯¯! string2 å·²å¤±æ•ˆ

    // ===== ç”Ÿå‘½å‘¨æœŸçº¦æŸ =====

    let s1 = String::from("hello");
    let s2 = String::from("world");
    let result = first_word(&s1, &s2);
    println!("ç¬¬ä¸€ä¸ªå•è¯: {}", result);
}

// ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨: 'a è¡¨ç¤ºæ‰€æœ‰å‚æ•°å’Œè¿”å›å€¼æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() {
        x
    } else {
        y
    }
}

// è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸä¸ç¬¬ä¸€ä¸ªå‚æ•°ç›¸åŒ
fn first_word<'a>(s: &'a str, _other: &str) -> &'a str {
    // _other çš„ç”Ÿå‘½å‘¨æœŸä¸è¿”å›å€¼æ— å…³,ä¸éœ€è¦æ ‡æ³¨
    s.split_whitespace().next().unwrap_or("")
}
```

**è¯´æ˜**:

- **ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨**: `'a` æ˜¯ç”Ÿå‘½å‘¨æœŸå‚æ•°,è¡¨ç¤ºå¼•ç”¨çš„æœ‰æ•ˆæœŸ
- **ç”Ÿå‘½å‘¨æœŸçº¦æŸ**: è¿”å›çš„å¼•ç”¨ä¸èƒ½è¶…è¿‡å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸ
- **çœç•¥è§„åˆ™**: ç¼–è¯‘å™¨å¯ä»¥æ¨æ–­æŸäº›æƒ…å†µä¸‹çš„ç”Ÿå‘½å‘¨æœŸ

**è¾“å‡º**:

```text
æœ€é•¿çš„å­—ç¬¦ä¸²æ˜¯: long string is long
å†…éƒ¨ä½œç”¨åŸŸ: long string is long
ç¬¬ä¸€ä¸ªå•è¯: hello
```

**ç”Ÿå‘½å‘¨æœŸè§„åˆ™**:

- ğŸ¯ è¿”å›çš„å¼•ç”¨å¿…é¡»ä¸æŸä¸ªè¾“å…¥å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³
- ğŸ¯ ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ä¸ä¼šæ”¹å˜å®é™…ç”Ÿå‘½å‘¨æœŸ,åªæ˜¯æè¿°å…³ç³»
- ğŸ¯ å¤šä¸ªè¾“å…¥å‚æ•°æ—¶,å¿…é¡»æ˜ç¡®æŒ‡å®šç”Ÿå‘½å‘¨æœŸå…³ç³»

---

### ç¤ºä¾‹2.2: ç»“æ„ä½“ç”Ÿå‘½å‘¨æœŸ

**ç›®æ ‡**: åœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

**éš¾åº¦**: â­â­

**ä»£ç **:

```rust
// ç»“æ„ä½“åŒ…å«å¼•ç”¨æ—¶,å¿…é¡»æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ
struct ImportantExcerpt<'a> {
    part: &'a str,
}

impl<'a> ImportantExcerpt<'a> {
    // æ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™
    fn level(&self) -> i32 {
        3
    }

    // è¿”å›ç»“æ„ä½“ä¸­çš„å¼•ç”¨
    fn announce_and_return_part(&self, announcement: &str) -> &str {
        println!("æ³¨æ„! {}", announcement);
        self.part
    }
}

fn main() {
    let novel = String::from("Call me Ishmael. Some years ago...");
    let first_sentence = novel.split('.').next().expect("Could not find a '.'");

    let i = ImportantExcerpt {
        part: first_sentence,
    };

    println!("é‡è¦æ‘˜å½•: {}", i.part);
    println!("çº§åˆ«: {}", i.level());

    let result = i.announce_and_return_part("å¬å¥½äº†!");
    println!("è¿”å›: {}", result);

    // ===== ç”Ÿå‘½å‘¨æœŸçº¦æŸç¤ºä¾‹ =====

    let excerpt;
    {
        let novel = String::from("Once upon a time...");
        let first_line = novel.split('\n').next().unwrap();

        excerpt = ImportantExcerpt {
            part: first_line,
        };

        println!("å†…éƒ¨: {}", excerpt.part);  // âœ… æœ‰æ•ˆ
    }
    // println!("å¤–éƒ¨: {}", excerpt.part);  // âŒ é”™è¯¯! novel å·²å¤±æ•ˆ

    // ===== å¤šä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•° =====

    let s1 = String::from("hello");
    let s2 = String::from("world");
    let result = longest_with_announcement(&s1, &s2, "æ¯”è¾ƒä¸­...");
    println!("ç»“æœ: {}", result);
}

// å¤šä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°
fn longest_with_announcement<'a, 'b>(
    x: &'a str,
    y: &'a str,
    ann: &'b str,
) -> &'a str {
    println!("å…¬å‘Š: {}", ann);
    if x.len() > y.len() {
        x
    } else {
        y
    }
}
```

**è¯´æ˜**:

- **ç»“æ„ä½“ç”Ÿå‘½å‘¨æœŸ**: ç»“æ„ä½“åŒ…å«å¼•ç”¨æ—¶å¿…é¡»æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ
- **impl ç”Ÿå‘½å‘¨æœŸ**: å®ç°æ–¹æ³•æ—¶ä¹Ÿéœ€è¦ç”Ÿå‘½å‘¨æœŸå‚æ•°
- **å¤šç”Ÿå‘½å‘¨æœŸ**: ä¸åŒå¼•ç”¨å¯ä»¥æœ‰ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸ

**è¾“å‡º**:

```text
é‡è¦æ‘˜å½•: Call me Ishmael
çº§åˆ«: 3
æ³¨æ„! å¬å¥½äº†!
è¿”å›: Call me Ishmael
å†…éƒ¨: Once upon a time...
å…¬å‘Š: æ¯”è¾ƒä¸­...
ç»“æœ: hello
```

---

### ç¤ºä¾‹2.3: ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™

**ç›®æ ‡**: ç†è§£ä½•æ—¶å¯ä»¥çœç•¥ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

**éš¾åº¦**: â­â­

**ä»£ç **:

```rust
fn main() {
    let s = String::from("hello world");
    let first = first_word(&s);
    println!("ç¬¬ä¸€ä¸ªå•è¯: {}", first);

    let s1 = String::from("hello");
    let s2 = String::from("world");
    let result = compare(&s1, &s2);
    println!("æ¯”è¾ƒç»“æœ: {}", result);
}

// ===== è§„åˆ™1: æ¯ä¸ªå¼•ç”¨å‚æ•°éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ =====

// ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ä¸º:
// fn first_word<'a>(s: &'a str) -> &'a str
fn first_word(s: &str) -> &str {
    s.split_whitespace().next().unwrap_or("")
}

// ===== è§„åˆ™2: åªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°æ—¶,è¿”å›å€¼ä½¿ç”¨å®ƒ =====

// ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ä¸º:
// fn get_first_char<'a>(s: &'a str) -> &'a str
fn get_first_char(s: &str) -> &str {
    &s[0..1]
}

// ===== è§„åˆ™3: æ–¹æ³•çš„ &self ç”Ÿå‘½å‘¨æœŸèµ‹äºˆæ‰€æœ‰è¿”å›å¼•ç”¨ =====

struct StringHolder {
    content: String,
}

impl StringHolder {
    // ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ä¸º:
    // fn get_content<'a>(&'a self) -> &'a str
    fn get_content(&self) -> &str {
        &self.content
    }

    // å¤šä¸ªå‚æ•°æ—¶,è¿”å›å€¼ä½¿ç”¨ self çš„ç”Ÿå‘½å‘¨æœŸ
    fn get_or_default(&self, default: &str) -> &str {
        if self.content.is_empty() {
            default  // âš ï¸ è¿™å¯èƒ½æœ‰é—®é¢˜!
        } else {
            &self.content
        }
    }
}

// ===== éœ€è¦æ˜¾å¼æ ‡æ³¨çš„æƒ…å†µ =====

// å¤šä¸ªè¾“å…¥å‚æ•°,ä¸”è¿”å›å€¼å¯èƒ½æ¥è‡ªä»»ä¸€å‚æ•°
// å¿…é¡»æ˜¾å¼æ ‡æ³¨
fn compare<'a>(s1: &'a str, s2: &'a str) -> &'a str {
    if s1.len() > s2.len() {
        s1
    } else {
        s2
    }
}

// ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‚æ•°
fn longest_with_context<'a, 'b>(
    s1: &'a str,
    s2: &'a str,
    context: &'b str,  // ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸ
) -> &'a str {
    println!("ä¸Šä¸‹æ–‡: {}", context);
    if s1.len() > s2.len() {
        s1
    } else {
        s2
    }
}
```

**è¯´æ˜**:

- **çœç•¥è§„åˆ™1**: æ¯ä¸ªè¾“å…¥å¼•ç”¨å‚æ•°éƒ½æœ‰ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸ
- **çœç•¥è§„åˆ™2**: åªæœ‰ä¸€ä¸ªè¾“å…¥æ—¶,å®ƒçš„ç”Ÿå‘½å‘¨æœŸèµ‹ç»™æ‰€æœ‰è¾“å‡º
- **çœç•¥è§„åˆ™3**: æ–¹æ³•ä¸­,`&self` çš„ç”Ÿå‘½å‘¨æœŸèµ‹ç»™æ‰€æœ‰è¾“å‡º

**è¾“å‡º**:

```text
ç¬¬ä¸€ä¸ªå•è¯: hello
æ¯”è¾ƒç»“æœ: hello
```

**ä½•æ—¶éœ€è¦æ˜¾å¼æ ‡æ³¨**:

- âœ… å¤šä¸ªè¾“å…¥å¼•ç”¨,ä¸”è¿”å›å€¼å¯èƒ½æ¥è‡ªä»»ä¸€ä¸ª
- âœ… è¾“å…¥å’Œè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸå…³ç³»ä¸æ˜æ˜¾
- âœ… ç»“æ„ä½“åŒ…å«å¼•ç”¨å­—æ®µ
- âŒ å•ä¸ªè¾“å…¥å¼•ç”¨,è¿”å›å€¼æ¥è‡ªå®ƒ
- âŒ æ–¹æ³•è¿”å› `&self` çš„å­—æ®µ

---

### ç¤ºä¾‹2.4: åˆ‡ç‰‡æ“ä½œå®è·µ

**ç›®æ ‡**: æŒæ¡å­—ç¬¦ä¸²åˆ‡ç‰‡å’Œæ•°ç»„åˆ‡ç‰‡çš„ä½¿ç”¨

**éš¾åº¦**: â­â­

**ä»£ç **:

```rust
fn main() {
    println!("===== å­—ç¬¦ä¸²åˆ‡ç‰‡ =====\n");

    let s = String::from("hello world");

    // åˆ›å»ºåˆ‡ç‰‡
    let hello = &s[0..5];   // æˆ– &s[..5]
    let world = &s[6..11];  // æˆ– &s[6..]
    let whole = &s[..];     // æ•´ä¸ªå­—ç¬¦ä¸²

    println!("hello: {}", hello);
    println!("world: {}", world);
    println!("whole: {}", whole);

    // å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯åˆ‡ç‰‡
    let literal: &str = "hello world";
    println!("literal: {}", literal);

    // å®ç”¨å‡½æ•°: è·å–ç¬¬ä¸€ä¸ªå•è¯
    let s = String::from("hello world rust");
    let first = first_word(&s);
    println!("ç¬¬ä¸€ä¸ªå•è¯: {}", first);

    // åˆ‡ç‰‡é˜²æ­¢æ‚¬å‚å¼•ç”¨
    let mut s = String::from("hello world");
    let word = first_word(&s);

    // s.clear();  // âŒ é”™è¯¯! ä¸èƒ½åœ¨ä¸å¯å˜å€Ÿç”¨å­˜åœ¨æ—¶ä¿®æ”¹
    println!("å•è¯: {}", word);

    println!("\n===== æ•°ç»„åˆ‡ç‰‡ =====\n");

    let a = [1, 2, 3, 4, 5];

    // åˆ›å»ºæ•°ç»„åˆ‡ç‰‡
    let slice = &a[1..3];  // [2, 3]

    println!("åŸæ•°ç»„: {:?}", a);
    println!("åˆ‡ç‰‡: {:?}", slice);
    println!("åˆ‡ç‰‡ç±»å‹: &[i32;{}]", slice.len());

    // è¿­ä»£åˆ‡ç‰‡
    for (i, &val) in slice.iter().enumerate() {
        println!("  slice[{}] = {}", i, val);
    }

    // å¯å˜åˆ‡ç‰‡
    let mut arr = [1, 2, 3, 4, 5];
    let slice_mut = &mut arr[..3];

    slice_mut[0] = 10;
    slice_mut[1] = 20;

    println!("ä¿®æ”¹åçš„æ•°ç»„: {:?}", arr);

    println!("\n===== åˆ‡ç‰‡æ¨¡å¼åŒ¹é… =====\n");

    let numbers = vec![1, 2, 3, 4, 5];

    match &numbers[..] {
        [] => println!("ç©º"),
        [x] => println!("åªæœ‰ä¸€ä¸ªå…ƒç´ : {}", x),
        [first, .., last] => println!("ç¬¬ä¸€ä¸ª: {}, æœ€åä¸€ä¸ª: {}", first, last),
    }

    // UTF-8 å®‰å…¨
    let s = String::from("ä½ å¥½ä¸–ç•Œ");
    // let slice = &s[0..2];  // âŒ panic! å¯èƒ½åˆ‡åœ¨å­—ç¬¦ä¸­é—´
    let slice = &s[0..3];  // âœ… "ä½ " å  3 å­—èŠ‚
    println!("UTF-8 åˆ‡ç‰‡: {}", slice);
}

fn first_word(s: &str) -> &str {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[0..i];
        }
    }

    &s[..]
}
```

**è¯´æ˜**:

- **å­—ç¬¦ä¸²åˆ‡ç‰‡**: `&str` æ˜¯å¯¹ String çš„ä¸€éƒ¨åˆ†çš„å¼•ç”¨
- **æ•°ç»„åˆ‡ç‰‡**: `&[T]` æ˜¯å¯¹æ•°ç»„çš„ä¸€éƒ¨åˆ†çš„å¼•ç”¨
- **UTF-8 å®‰å…¨**: åˆ‡ç‰‡ç´¢å¼•å¿…é¡»åœ¨å­—ç¬¦è¾¹ç•Œ

**è¾“å‡º**:

```text
===== å­—ç¬¦ä¸²åˆ‡ç‰‡ =====

hello: hello
world: world
whole: hello world
literal: hello world
ç¬¬ä¸€ä¸ªå•è¯: hello
å•è¯: hello

===== æ•°ç»„åˆ‡ç‰‡ =====

åŸæ•°ç»„: [1, 2, 3, 4, 5]
åˆ‡ç‰‡: [2, 3]
åˆ‡ç‰‡ç±»å‹: &[i32;2]
  slice[0] = 2
  slice[1] = 3
ä¿®æ”¹åçš„æ•°ç»„: [10, 20, 3, 4, 5]

===== åˆ‡ç‰‡æ¨¡å¼åŒ¹é… =====

ç¬¬ä¸€ä¸ª: 1, æœ€åä¸€ä¸ª: 5
UTF-8 åˆ‡ç‰‡: ä½ 
```

**åˆ‡ç‰‡è¦ç‚¹**:

- ğŸ¯ åˆ‡ç‰‡æ˜¯å¼•ç”¨,ä¸æ‹¥æœ‰æ•°æ®
- ğŸ¯ ç´¢å¼•èŒƒå›´ `[start..end]` æ˜¯åŠå¼€åŒºé—´
- ğŸ¯ UTF-8 å­—ç¬¦ä¸²åˆ‡ç‰‡å¿…é¡»åœ¨å­—ç¬¦è¾¹ç•Œ
- ğŸ¯ åˆ‡ç‰‡å¯ä»¥é˜²æ­¢éƒ¨åˆ†æ‚¬å‚å¼•ç”¨é—®é¢˜

---

### ç¤ºä¾‹2.5: String vs &str æ·±å…¥ç†è§£

**ç›®æ ‡**: ç†è§£ String å’Œ &str çš„åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯

**éš¾åº¦**: â­â­

**ä»£ç **:

```rust
fn main() {
    println!("===== String: å¯å¢é•¿çš„å †å­—ç¬¦ä¸² =====\n");

    // åˆ›å»º String
    let mut s1 = String::new();  // ç©ºå­—ç¬¦ä¸²
    let s2 = String::from("hello");
    let s3 = "hello".to_string();
    let s4 = "hello".to_owned();

    // String å¯ä»¥ä¿®æ”¹
    s1.push_str("hello");
    s1.push(' ');
    s1.push_str("world");

    println!("s1: {}", s1);
    println!("s1 å®¹é‡: {}, é•¿åº¦: {}", s1.capacity(), s1.len());

    println!("\n===== &str: å­—ç¬¦ä¸²åˆ‡ç‰‡ =====\n");

    // å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ &str
    let s5: &str = "hello";

    // String å¯ä»¥ deref åˆ° &str
    let s6: &str = &s2;

    // åˆ‡ç‰‡æ˜¯ &str
    let s7: &str = &s2[0..2];

    println!("s5 (å­—é¢å€¼): {}", s5);
    println!("s6 (deref): {}", s6);
    println!("s7 (åˆ‡ç‰‡): {}", s7);

    println!("\n===== ç±»å‹è½¬æ¢ =====\n");

    // &str â†’ String
    let s8: String = "hello".to_string();
    let s9: String = "hello".to_owned();
    let s10: String = String::from("hello");

    // String â†’ &str (è‡ªåŠ¨)
    let s11: &str = &s8;  // deref coercion

    // String â†’ &str (æ˜¾å¼)
    let s12: &str = s8.as_str();

    println!("è½¬æ¢ç¤ºä¾‹: s8={}, s11={}, s12={}", s8, s11, s12);

    println!("\n===== å‡½æ•°å‚æ•°æœ€ä½³å®è·µ =====\n");

    let string = String::from("hello");
    let literal = "world";

    // âœ… æ¨è: ä½¿ç”¨ &str ä½œä¸ºå‚æ•°
    print_string_slice(&string);  // String è‡ªåŠ¨è½¬ä¸º &str
    print_string_slice(literal);  // &str ç›´æ¥ä½¿ç”¨

    // âŒ ä¸æ¨è: ä½¿ç”¨ String ä½œä¸ºå‚æ•°
    // print_string_owned(literal);  // é”™è¯¯! &str ä¸èƒ½ç›´æ¥è½¬ä¸º String
    print_string_owned(literal.to_string());  // éœ€è¦æ˜¾å¼è½¬æ¢

    println!("\n===== æ€§èƒ½å¯¹æ¯” =====\n");

    // String: å †åˆ†é…,æœ‰å¼€é”€
    let s = String::from("hello");
    println!("String å¤§å°: {} å­—èŠ‚ (æ ˆä¸ŠæŒ‡é’ˆ+é•¿åº¦+å®¹é‡)",
             std::mem::size_of_val(&s));

    // &str: åªæ˜¯å¼•ç”¨,è½»é‡
    let s_ref: &str = &s;
    println!("&str å¤§å°: {} å­—èŠ‚ (æŒ‡é’ˆ+é•¿åº¦)",
             std::mem::size_of_val(&s_ref));

    println!("\n===== ä½¿ç”¨åœºæ™¯ =====\n");

    demo_string_usage();
}

// âœ… æ¨è: å‚æ•°ä½¿ç”¨ &str
fn print_string_slice(s: &str) {
    println!("  &str å‚æ•°: {}", s);
}

// âŒ ä¸æ¨è: å‚æ•°ä½¿ç”¨ String (é™¤ééœ€è¦æ‰€æœ‰æƒ)
fn print_string_owned(s: String) {
    println!("  String å‚æ•°: {}", s);
}

fn demo_string_usage() {
    // åœºæ™¯1: éœ€è¦ä¿®æ”¹ â†’ ä½¿ç”¨ String
    let mut greeting = String::from("Hello");
    greeting.push_str(", world!");
    println!("åœºæ™¯1 (å¯ä¿®æ”¹): {}", greeting);

    // åœºæ™¯2: åªè¯» â†’ ä½¿ç”¨ &str
    let message: &str = "Hello, Rust!";
    println!("åœºæ™¯2 (åªè¯»): {}", message);

    // åœºæ™¯3: éœ€è¦æ‰€æœ‰æƒ â†’ ä½¿ç”¨ String
    let owned = create_string();
    println!("åœºæ™¯3 (æ‰€æœ‰æƒ): {}", owned);

    // åœºæ™¯4: å­—ç¬¦ä¸²æ‹¼æ¥ â†’ String
    let s1 = String::from("Hello");
    let s2 = String::from("World");
    let s3 = format!("{} {}", s1, s2);  // format! è¿”å› String
    println!("åœºæ™¯4 (æ‹¼æ¥): {}", s3);
}

fn create_string() -> String {
    String::from("Created string")
}
```

**è¯´æ˜**:

- **String**: å¯å¢é•¿çš„å †åˆ†é…å­—ç¬¦ä¸²,æ‹¥æœ‰æ•°æ®
- **&str**: å­—ç¬¦ä¸²åˆ‡ç‰‡,åªæ˜¯å¼•ç”¨,ä¸å¯å˜
- **è½¬æ¢**: String å¯ä»¥è‡ªåŠ¨ deref åˆ° &str

**è¾“å‡º**:

```text
===== String: å¯å¢é•¿çš„å †å­—ç¬¦ä¸² =====

s1: hello world
s1 å®¹é‡: 11, é•¿åº¦: 11

===== &str: å­—ç¬¦ä¸²åˆ‡ç‰‡ =====

s5 (å­—é¢å€¼): hello
s6 (deref): hello
s7 (åˆ‡ç‰‡): he

===== ç±»å‹è½¬æ¢ =====

è½¬æ¢ç¤ºä¾‹: s8=hello, s11=hello, s12=hello

===== å‡½æ•°å‚æ•°æœ€ä½³å®è·µ =====

  &str å‚æ•°: hello
  &str å‚æ•°: world
  String å‚æ•°: world

===== æ€§èƒ½å¯¹æ¯” =====

String å¤§å°: 24 å­—èŠ‚ (æ ˆä¸ŠæŒ‡é’ˆ+é•¿åº¦+å®¹é‡)
&str å¤§å°: 16 å­—èŠ‚ (æŒ‡é’ˆ+é•¿åº¦)

===== ä½¿ç”¨åœºæ™¯ =====

åœºæ™¯1 (å¯ä¿®æ”¹): Hello, world!
åœºæ™¯2 (åªè¯»): Hello, Rust!
åœºæ™¯3 (æ‰€æœ‰æƒ): Created string
åœºæ™¯4 (æ‹¼æ¥): Hello World
```

**å¯¹æ¯”æ€»ç»“**:

| ç‰¹æ€§     | String          | &str         |
| :--- | :--- | :--- || æ‰€æœ‰æƒ   | æ‹¥æœ‰æ•°æ®        | å€Ÿç”¨æ•°æ®     |
| å¯å˜æ€§   | å¯ä¿®æ”¹          | ä¸å¯ä¿®æ”¹     |
| åˆ†é…     | å †åˆ†é…          | å¼•ç”¨(æ ˆæˆ–å †) |
| å¤§å°     | åŠ¨æ€            | å›ºå®š(åˆ‡ç‰‡)   |
| ä½¿ç”¨åœºæ™¯ | éœ€è¦ä¿®æ”¹/æ‰€æœ‰æƒ | åªè¯»/å‚æ•°    |
| å‡½æ•°å‚æ•° | éœ€è¦æ‰€æœ‰æƒæ—¶    | âœ… æ¨è      |

---

## ğŸ“ Tier 3: æ·±å…¥ç†è§£ç¤ºä¾‹

### ç¤ºä¾‹3.1: å¤æ‚ç”Ÿå‘½å‘¨æœŸåœºæ™¯

**ç›®æ ‡**: å¤„ç†å¤šä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°å’Œçº¦æŸ

**éš¾åº¦**: â­â­â­

**ä»£ç **:

```rust
use std::fmt::Display;

fn main() {
    let string1 = String::from("long string is long");
    let string2 = String::from("xyz");

    let result = longest_with_announcement(
        &string1,
        &string2,
        "ä»Šå¤©æˆ‘ä»¬è¦æ¯”è¾ƒå­—ç¬¦ä¸²!",
    );

    println!("æœ€é•¿çš„å­—ç¬¦ä¸²æ˜¯ '{}'", result);

    // ===== å¤æ‚çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸ =====

    let s1 = String::from("hello");
    let s2 = String::from("world");
    let s3 = String::from("rust");

    let result = complex_lifetime(&s1, &s2, &s3);
    println!("å¤æ‚ç”Ÿå‘½å‘¨æœŸç»“æœ: {}", result);

    // ===== ç”Ÿå‘½å‘¨æœŸå­ç±»å‹ =====

    let s1 = String::from("outer");
    {
        let s2 = String::from("inner");
        // 's1 çš„ç”Ÿå‘½å‘¨æœŸé•¿äº 's2
        let result = choose_first(&s1, &s2);
        println!("é€‰æ‹©ç»“æœ: {}", result);
    }
    // s1 ä»ç„¶æœ‰æ•ˆ
    println!("å¤–éƒ¨: {}", s1);
}

// å¤šä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•° + trait bound
fn longest_with_announcement<'a, 'b, T>(
    x: &'a str,
    y: &'a str,
    ann: &'b T,
) -> &'a str
where
    T: Display,
{
    println!("å…¬å‘Š! {}", ann);
    if x.len() > y.len() {
        x
    } else {
        y
    }
}

// å¤æ‚çš„ç”Ÿå‘½å‘¨æœŸå…³ç³»
fn complex_lifetime<'a, 'b, 'c>(
    x: &'a str,
    y: &'b str,
    z: &'c str,
) -> &'a str
where
    'b: 'a,  // 'b çš„ç”Ÿå‘½å‘¨æœŸè‡³å°‘å’Œ 'a ä¸€æ ·é•¿
    'c: 'a,  // 'c çš„ç”Ÿå‘½å‘¨æœŸè‡³å°‘å’Œ 'a ä¸€æ ·é•¿
{
    println!("x: {}, y: {}, z: {}", x, y, z);
    x  // è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ 'a
}

// è¿”å›å€¼æ€»æ˜¯ç¬¬ä¸€ä¸ªå‚æ•° (å±•ç¤ºç”Ÿå‘½å‘¨æœŸå­ç±»å‹)
fn choose_first<'a, 'b>(first: &'a str, _second: &'b str) -> &'a str {
    first
}

// ç»“æ„ä½“ä¸­çš„ç”Ÿå‘½å‘¨æœŸ
struct Context<'s> {
    part: &'s str,
}

impl<'s> Context<'s> {
    fn get_part(&self) -> &'s str {
        self.part
    }
}

// é«˜é˜¶ trait bounds (HRTB)
fn apply<F>(f: F) -> String
where
    F: for<'a> Fn(&'a str) -> &'a str,
{
    let s = String::from("hello");
    f(&s).to_string()
}
```

**è¯´æ˜**:

- **å¤šç”Ÿå‘½å‘¨æœŸ**: ä¸åŒå¼•ç”¨å¯ä»¥æœ‰ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‚æ•°
- **ç”Ÿå‘½å‘¨æœŸçº¦æŸ**: `'b: 'a` è¡¨ç¤º 'b è‡³å°‘å’Œ 'a ä¸€æ ·é•¿
- **HRTB**: é«˜é˜¶ trait bounds,å¤„ç†æ‰€æœ‰å¯èƒ½çš„ç”Ÿå‘½å‘¨æœŸ

**è¾“å‡º**:

```text
å…¬å‘Š! ä»Šå¤©æˆ‘ä»¬è¦æ¯”è¾ƒå­—ç¬¦ä¸²!
æœ€é•¿çš„å­—ç¬¦ä¸²æ˜¯ 'long string is long'
x: hello, y: world, z: rust
å¤æ‚ç”Ÿå‘½å‘¨æœŸç»“æœ: hello
é€‰æ‹©ç»“æœ: outer
å¤–éƒ¨: outer
```

---

### ç¤ºä¾‹3.2: 'static ç”Ÿå‘½å‘¨æœŸè¯¦è§£

**ç›®æ ‡**: ç†è§£é™æ€ç”Ÿå‘½å‘¨æœŸçš„å«ä¹‰å’Œä½¿ç”¨

**éš¾åº¦**: â­â­â­

**ä»£ç **:

```rust
fn main() {
    println!("===== 'static å­—ç¬¦ä¸²å­—é¢å€¼ =====\n");

    // å­—ç¬¦ä¸²å­—é¢å€¼å…·æœ‰ 'static ç”Ÿå‘½å‘¨æœŸ
    let s: &'static str = "æˆ‘æ˜¯é™æ€å­—ç¬¦ä¸²";
    println!("{}", s);

    // å­˜å‚¨åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­,æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½æœ‰æ•ˆ
    let s1 = "hello";
    let s2 = "hello";
    println!("s1 å’Œ s2 çš„åœ°å€ç›¸åŒ: {}", std::ptr::eq(s1, s2));

    println!("\n===== 'static çº¦æŸ =====\n");

    // å‡½æ•°è¦æ±‚å‚æ•°æœ‰ 'static ç”Ÿå‘½å‘¨æœŸ
    print_static("è¿™æ˜¯é™æ€çš„");

    // String å¯ä»¥è½¬æ¢ä¸º 'static (é€šè¿‡ leak)
    let string = String::from("åŠ¨æ€å­—ç¬¦ä¸²");
    let static_str: &'static str = Box::leak(string.into_boxed_str());
    print_static(static_str);

    println!("\n===== 'static ä¸æ³›å‹ =====\n");

    let s = String::from("hello");
    // generic_function(&s);  // âŒ é”™è¯¯! &s ä¸æ˜¯ 'static

    let s: &'static str = "hello";
    generic_function(s);  // âœ… å¯ä»¥

    println!("\n===== 'static trait å¯¹è±¡ =====\n");

    let boxed: Box<dyn std::fmt::Display + 'static> = Box::new(42);
    println!("Trait å¯¹è±¡: {}", boxed);

    println!("\n===== è¯¯è§£ä¸æ¾„æ¸… =====\n");

    // è¯¯è§£1: 'static è¡¨ç¤ºæ•°æ®æ°¸ä¹…å­˜åœ¨
    // æ­£ç¡®: 'static è¡¨ç¤ºå¼•ç”¨å¯ä»¥å­˜æ´»æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸ

    let s: &'static str = "literal";  // æ•°æ®åœ¨äºŒè¿›åˆ¶ä¸­
    println!("è¯¯è§£1: {}", s);

    // è¯¯è§£2: æ‰€æœ‰ 'static æ•°æ®éƒ½ä¸å¯å˜
    // æ­£ç¡®: static å˜é‡å¯ä»¥æ˜¯å¯å˜çš„ (ä½†éœ€è¦ unsafe)

    static mut COUNTER: i32 = 0;
    unsafe {
        COUNTER += 1;
        println!("è¯¯è§£2: COUNTER = {}", COUNTER);
    }

    println!("\n===== å®é™…ä½¿ç”¨åœºæ™¯ =====\n");

    // åœºæ™¯1: å…¨å±€é…ç½®
    const CONFIG: &str = "é…ç½®å­—ç¬¦ä¸²";
    println!("åœºæ™¯1: {}", CONFIG);

    // åœºæ™¯2: é”™è¯¯æ¶ˆæ¯
    fn get_error_message() -> &'static str {
        "å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯"
    }
    println!("åœºæ™¯2: {}", get_error_message());

    // åœºæ™¯3: å•ä¾‹æ¨¡å¼
    static INSTANCE: std::sync::Once = std::sync::Once::new();
    INSTANCE.call_once(|| {
        println!("åœºæ™¯3: å•ä¾‹åˆå§‹åŒ–");
    });
}

fn print_static(s: &'static str) {
    println!("  é™æ€å­—ç¬¦ä¸²: {}", s);
}

fn generic_function<T: std::fmt::Display + 'static>(t: T) {
    println!("  æ³›å‹å‚æ•°: {}", t);
}
```

**è¯´æ˜**:

- **'static å«ä¹‰**: å¼•ç”¨åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸéƒ½æœ‰æ•ˆ
- **å­—ç¬¦ä¸²å­—é¢å€¼**: å­˜å‚¨åœ¨äºŒè¿›åˆ¶ä¸­,å¤©ç„¶æ˜¯ 'static
- **'static çº¦æŸ**: è¦æ±‚æ•°æ®èƒ½å¤Ÿå­˜æ´»æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸ

**è¾“å‡º**:

```text
===== 'static å­—ç¬¦ä¸²å­—é¢å€¼ =====

æˆ‘æ˜¯é™æ€å­—ç¬¦ä¸²
s1 å’Œ s2 çš„åœ°å€ç›¸åŒ: true

===== 'static çº¦æŸ =====

  é™æ€å­—ç¬¦ä¸²: è¿™æ˜¯é™æ€çš„
  é™æ€å­—ç¬¦ä¸²: åŠ¨æ€å­—ç¬¦ä¸²

===== 'static ä¸æ³›å‹ =====

  æ³›å‹å‚æ•°: hello

===== 'static trait å¯¹è±¡ =====

Trait å¯¹è±¡: 42

===== è¯¯è§£ä¸æ¾„æ¸… =====

è¯¯è§£1: literal
è¯¯è§£2: COUNTER = 1

===== å®é™…ä½¿ç”¨åœºæ™¯ =====

åœºæ™¯1: é…ç½®å­—ç¬¦ä¸²
åœºæ™¯2: å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯
åœºæ™¯3: å•ä¾‹åˆå§‹åŒ–
```

**å…³é”®è¦ç‚¹**:

- ğŸ¯ 'static != ä¸å¯å˜
- ğŸ¯ 'static != æ³„æ¼å†…å­˜
- ğŸ¯ 'static åªæ˜¯ç”Ÿå‘½å‘¨æœŸçº¦æŸ
- ğŸ¯ è°¨æ…ä½¿ç”¨ Box::leak

---

### ç¤ºä¾‹3.3: RefCell å†…éƒ¨å¯å˜æ€§

**ç›®æ ‡**: ä½¿ç”¨ RefCell å®ç°å†…éƒ¨å¯å˜æ€§

**éš¾åº¦**: â­â­â­

**ä»£ç **:

```rust
use std::cell::RefCell;

fn main() {
    println!("===== RefCell åŸºç¡€ä½¿ç”¨ =====\n");

    // RefCell å…è®¸åœ¨ä¸å¯å˜å¼•ç”¨ä¸‹ä¿®æ”¹æ•°æ®
    let data = RefCell::new(5);

    println!("åˆå§‹å€¼: {:?}", data);

    // å€Ÿç”¨å¯å˜å¼•ç”¨å¹¶ä¿®æ”¹
    *data.borrow_mut() += 1;

    println!("ä¿®æ”¹å: {:?}", data);

    // è¯»å–æ•°æ®
    println!("è¯»å–: {}", *data.borrow());

    println!("\n===== å€Ÿç”¨è§„åˆ™åœ¨è¿è¡Œæ—¶æ£€æŸ¥ =====\n");

    let value = RefCell::new(String::from("hello"));

    // å¯ä»¥æœ‰å¤šä¸ªä¸å¯å˜å€Ÿç”¨
    let r1 = value.borrow();
    let r2 = value.borrow();
    println!("r1: {}, r2: {}", r1, r2);
    // r1 å’Œ r2 åœ¨è¿™é‡Œç»“æŸ

    // ç°åœ¨å¯ä»¥å¯å˜å€Ÿç”¨
    let mut r3 = value.borrow_mut();
    r3.push_str(" world");
    println!("r3: {}", r3);
    // r3 åœ¨è¿™é‡Œç»“æŸ

    println!("æœ€ç»ˆå€¼: {}", value.borrow());

    // âš ï¸ è¿è¡Œæ—¶ panic ç¤ºä¾‹ (å–æ¶ˆæ³¨é‡ŠæŸ¥çœ‹)
    // let r1 = value.borrow();
    // let r2 = value.borrow_mut();  // Panic! è¿åå€Ÿç”¨è§„åˆ™
    // println!("{}, {}", r1, r2);

    println!("\n===== å®é™…åº”ç”¨: å›¾ç»“æ„ =====\n");

    let node1 = Node::new(1);
    let node2 = Node::new(2);

    node1.add_neighbor(&node2);
    node2.add_neighbor(&node1);

    println!("èŠ‚ç‚¹1çš„é‚»å±…æ•°: {}", node1.neighbor_count());
    println!("èŠ‚ç‚¹2çš„é‚»å±…æ•°: {}", node2.neighbor_count());

    println!("\n===== ä¸ Rc ç»“åˆä½¿ç”¨ =====\n");

    demo_rc_refcell();
}

// å›¾èŠ‚ç‚¹ (ä½¿ç”¨ RefCell å®ç°å†…éƒ¨å¯å˜æ€§)
struct Node {
    value: i32,
    neighbors: RefCell<Vec<*const Node>>,
}

impl Node {
    fn new(value: i32) -> Self {
        Node {
            value,
            neighbors: RefCell::new(Vec::new()),
        }
    }

    fn add_neighbor(&self, node: &Node) {
        // åœ¨ä¸å¯å˜ &self ä¸‹ä¿®æ”¹ neighbors
        self.neighbors.borrow_mut().push(node as *const Node);
    }

    fn neighbor_count(&self) -> usize {
        self.neighbors.borrow().len()
    }
}

// Rc + RefCell çš„å¸¸è§æ¨¡å¼
use std::rc::Rc;

fn demo_rc_refcell() {
    let shared_data = Rc::new(RefCell::new(vec![1, 2, 3]));

    // å…‹éš† Rc,å…±äº«æ‰€æœ‰æƒ
    let data1 = Rc::clone(&shared_data);
    let data2 = Rc::clone(&shared_data);

    // é€šè¿‡ data1 ä¿®æ”¹
    data1.borrow_mut().push(4);

    // é€šè¿‡ data2 è¯»å–
    println!("data2 è¯»å–: {:?}", data2.borrow());

    // é€šè¿‡ shared_data ä¿®æ”¹
    shared_data.borrow_mut().push(5);

    println!("æœ€ç»ˆæ•°æ®: {:?}", shared_data.borrow());
    println!("å¼•ç”¨è®¡æ•°: {}", Rc::strong_count(&shared_data));
}
```

**è¯´æ˜**:

- **RefCell**: æä¾›å†…éƒ¨å¯å˜æ€§,è¿è¡Œæ—¶æ£€æŸ¥å€Ÿç”¨è§„åˆ™
- **borrow()**: è·å–ä¸å¯å˜å¼•ç”¨
- **borrow_mut()**: è·å–å¯å˜å¼•ç”¨
- **Panic**: è¿åå€Ÿç”¨è§„åˆ™ä¼šåœ¨è¿è¡Œæ—¶ panic

**è¾“å‡º**:

```text
===== RefCell åŸºç¡€ä½¿ç”¨ =====

åˆå§‹å€¼: RefCell { value: 5 }
ä¿®æ”¹å: RefCell { value: 6 }
è¯»å–: 6

===== å€Ÿç”¨è§„åˆ™åœ¨è¿è¡Œæ—¶æ£€æŸ¥ =====

r1: hello, r2: hello
r3: hello world
æœ€ç»ˆå€¼: hello world

===== å®é™…åº”ç”¨: å›¾ç»“æ„ =====

èŠ‚ç‚¹1çš„é‚»å±…æ•°: 1
èŠ‚ç‚¹2çš„é‚»å±…æ•°: 1

===== ä¸ Rc ç»“åˆä½¿ç”¨ =====

data2 è¯»å–: [1, 2, 3, 4]
æœ€ç»ˆæ•°æ®: [1, 2, 3, 4, 5]
å¼•ç”¨è®¡æ•°: 3
```

**ä½¿ç”¨åœºæ™¯**:

- âœ… å›¾ç»“æ„ã€æ ‘ç»“æ„ (éœ€è¦å¾ªç¯å¼•ç”¨)
- âœ… ç¼“å­˜ã€è®°å¿†åŒ–
- âœ… è§‚å¯Ÿè€…æ¨¡å¼
- âŒ ä¸æ˜¯çº¿ç¨‹å®‰å…¨ (å¤šçº¿ç¨‹ç”¨ Mutex)

---

### ç¤ºä¾‹3.4: Cell ç®€å•å†…éƒ¨å¯å˜æ€§

**ç›®æ ‡**: ä½¿ç”¨ Cell æä¾› Copy ç±»å‹çš„å†…éƒ¨å¯å˜æ€§

**éš¾åº¦**: â­â­â­

**ä»£ç **:

```rust
use std::cell::Cell;

fn main() {
    println!("===== Cell åŸºç¡€ä½¿ç”¨ =====\n");

    // Cell åªèƒ½ç”¨äº Copy ç±»å‹
    let data = Cell::new(5);

    println!("åˆå§‹å€¼: {:?}", data);

    // è®¾ç½®æ–°å€¼
    data.set(10);

    // è·å–å€¼ (å¤åˆ¶)
    let value = data.get();
    println!("è·å–å€¼: {}", value);

    println!("Cell å†…çš„å€¼: {:?}", data);

    println!("\n===== Cell vs RefCell =====\n");

    // Cell: ç”¨äº Copy ç±»å‹,æ— è¿è¡Œæ—¶å¼€é”€
    let cell = Cell::new(42);
    cell.set(43);
    println!("Cell: {}", cell.get());

    // RefCell: ç”¨äºé Copy ç±»å‹,æœ‰è¿è¡Œæ—¶æ£€æŸ¥
    use std::cell::RefCell;
    let refcell = RefCell::new(String::from("hello"));
    refcell.borrow_mut().push_str(" world");
    println!("RefCell: {}", refcell.borrow());

    println!("\n===== å®é™…åº”ç”¨: è®¡æ•°å™¨ =====\n");

    let counter = Counter::new();

    counter.increment();
    counter.increment();
    counter.increment();

    println!("è®¡æ•°: {}", counter.get());

    println!("\n===== å®é™…åº”ç”¨: é…ç½® =====\n");

    let config = Config::new();

    println!("åˆå§‹é…ç½®: {:?}", config);

    config.set_debug(true);
    config.set_max_connections(100);

    println!("ä¿®æ”¹å: {:?}", config);

    println!("\n===== Cell æ–¹æ³• =====\n");

    let cell = Cell::new(10);

    // get: è·å–å€¼ (å¤åˆ¶)
    println!("get: {}", cell.get());

    // set: è®¾ç½®æ–°å€¼
    cell.set(20);
    println!("set å: {}", cell.get());

    // replace: æ›¿æ¢å¹¶è¿”å›æ—§å€¼
    let old = cell.replace(30);
    println!("replace: æ—§å€¼={}, æ–°å€¼={}", old, cell.get());

    // swap: äº¤æ¢ä¸¤ä¸ª Cell çš„å€¼
    let cell2 = Cell::new(40);
    cell.swap(&cell2);
    println!("swap å: cell={}, cell2={}", cell.get(), cell2.get());

    // take: å–å‡ºå€¼,ç•™ä¸‹ Default
    let cell3 = Cell::new(50);
    let value = cell3.take();
    println!("take: value={}, cell3={}", value, cell3.get());
}

// ä½¿ç”¨ Cell å®ç°è®¡æ•°å™¨ (åœ¨ä¸å¯å˜å¼•ç”¨ä¸‹å¯ä»¥ä¿®æ”¹)
struct Counter {
    count: Cell<u32>,
}

impl Counter {
    fn new() -> Self {
        Counter {
            count: Cell::new(0),
        }
    }

    // ä¸éœ€è¦ &mut self!
    fn increment(&self) {
        let count = self.count.get();
        self.count.set(count + 1);
    }

    fn get(&self) -> u32 {
        self.count.get()
    }
}

// ä½¿ç”¨ Cell å®ç°é…ç½® (å…è®¸å†…éƒ¨ä¿®æ”¹)
#[derive(Debug)]
struct Config {
    debug: Cell<bool>,
    max_connections: Cell<usize>,
}

impl Config {
    fn new() -> Self {
        Config {
            debug: Cell::new(false),
            max_connections: Cell::new(10),
        }
    }

    fn set_debug(&self, debug: bool) {
        self.debug.set(debug);
    }

    fn set_max_connections(&self, max: usize) {
        self.max_connections.set(max);
    }
}
```

**è¯´æ˜**:

- **Cell**: ä¸º Copy ç±»å‹æä¾›å†…éƒ¨å¯å˜æ€§,é›¶å¼€é”€
- **æ— å€Ÿç”¨æ£€æŸ¥**: Cell é€šè¿‡ copy é¿å…å€Ÿç”¨,æ— è¿è¡Œæ—¶æ£€æŸ¥
- **é™åˆ¶**: åªèƒ½ç”¨äº Copy ç±»å‹ (i32, bool, ç­‰)

**è¾“å‡º**:

```text
===== Cell åŸºç¡€ä½¿ç”¨ =====

åˆå§‹å€¼: Cell { value: 5 }
è·å–å€¼: 10
Cell å†…çš„å€¼: Cell { value: 10 }

===== Cell vs RefCell =====

Cell: 43
RefCell: hello world

===== å®é™…åº”ç”¨: è®¡æ•°å™¨ =====

è®¡æ•°: 3

===== å®é™…åº”ç”¨: é…ç½® =====

åˆå§‹é…ç½®: Config { debug: Cell { value: false }, max_connections: Cell { value: 10 } }
ä¿®æ”¹å: Config { debug: Cell { value: true }, max_connections: Cell { value: 100 } }

===== Cell æ–¹æ³• =====

get: 10
set å: 20
replace: æ—§å€¼=20, æ–°å€¼=30
swap å: cell=40, cell2=30
take: value=50, cell3=0
```

**Cell vs RefCell**:

| ç‰¹æ€§       | Cell   | RefCell       |
| :--- | :--- | :--- || é€‚ç”¨ç±»å‹   | Copy   | ä»»ä½•ç±»å‹      |
| è¿è¡Œæ—¶å¼€é”€ | é›¶     | æœ‰ (å€Ÿç”¨æ£€æŸ¥) |
| å¯èƒ½ panic | å¦     | æ˜¯ (è¿åè§„åˆ™) |
| è·å–å¼•ç”¨   | ä¸å¯ä»¥ | å¯ä»¥          |
| ä½¿ç”¨åœºæ™¯   | ç®€å•å€¼ | å¤æ‚ç±»å‹      |

---

## ğŸ“ æ€»ç»“

### å­¦ä¹ è·¯å¾„å»ºè®®

1. **ç¬¬ä¸€é˜¶æ®µ** (Tier 1): æŒæ¡åŸºç¡€
   - ç¤ºä¾‹ 1.1-1.5: æ‰€æœ‰æƒå’Œå€Ÿç”¨è§„åˆ™

2. **ç¬¬äºŒé˜¶æ®µ** (Tier 2): å®è·µåº”ç”¨
   - ç¤ºä¾‹ 2.1-2.5: ç”Ÿå‘½å‘¨æœŸå’Œå­—ç¬¦ä¸²å¤„ç†

3. **ç¬¬ä¸‰é˜¶æ®µ** (Tier 3): æ·±å…¥ç†è§£
   - ç¤ºä¾‹ 3.1-3.4: é«˜çº§æ¨¡å¼å’Œå†…éƒ¨å¯å˜æ€§

### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ       | ç›¸å…³ç¤ºä¾‹         | é‡è¦æ€§     |
| :--- | :--- | :--- || æ‰€æœ‰æƒè½¬ç§» | 1.1, 1.2         | â­â­â­â­â­ |
| å€Ÿç”¨è§„åˆ™   | 1.3-1.5          | â­â­â­â­â­ |
| ç”Ÿå‘½å‘¨æœŸ   | 2.1-2.3, 3.1-3.2 | â­â­â­â­   |
| å­—ç¬¦ä¸²ç±»å‹ | 2.4-2.5          | â­â­â­â­   |
| å†…éƒ¨å¯å˜æ€§ | 3.3-3.4          | â­â­â­     |

### ä¸‹ä¸€æ­¥

- ğŸ“– å­¦ä¹ æ›´å¤š: [æ™ºèƒ½æŒ‡é’ˆå®è·µ](./05_æ™ºèƒ½æŒ‡é’ˆå®è·µ.md)
- ğŸš€ å®æˆ˜é¡¹ç›®: [C01 å®æˆ˜é¡¹ç›®é›†](./07_å®æˆ˜é¡¹ç›®é›†.md) (å³å°†åˆ›å»º)
- ğŸ“š å‚è€ƒæ–‡æ¡£: [tier_03_references](../tier_03_references/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-10-25
**ç»´æŠ¤çŠ¶æ€**: æ´»è·ƒç»´æŠ¤

**ğŸ’¡ é€šè¿‡ä»£ç å­¦ä¹ æ˜¯æŒæ¡ Rust çš„æœ€ä½³æ–¹å¼! ğŸ¦€**-
