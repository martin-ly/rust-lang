# Tier 3: æ‰€æœ‰æƒè§„åˆ™å®Œæ•´å‚è€ƒ

> **æ–‡æ¡£ç±»å‹**: æŠ€æœ¯å‚è€ƒ
> **é€‚ç”¨ç‰ˆæœ¬**: Rust 1.92.0+
> **ç”¨é€”**: å®Œæ•´çš„æ‰€æœ‰æƒè§„åˆ™æ‰‹å†Œ

---

## ç›®å½•

- [Tier 3: æ‰€æœ‰æƒè§„åˆ™å®Œæ•´å‚è€ƒ](#tier-3-æ‰€æœ‰æƒè§„åˆ™å®Œæ•´å‚è€ƒ)
  - [ç›®å½•](#ç›®å½•)
  - [ğŸ“– 1. æ ¸å¿ƒè§„åˆ™](#-1-æ ¸å¿ƒè§„åˆ™)
    - [1.1 æ‰€æœ‰æƒä¸‰å¤§è§„åˆ™](#11-æ‰€æœ‰æƒä¸‰å¤§è§„åˆ™)
    - [1.2 æ‰€æœ‰æƒè½¬ç§»è§„åˆ™](#12-æ‰€æœ‰æƒè½¬ç§»è§„åˆ™)
  - [ğŸ“¦ 2. Move è¯­ä¹‰](#-2-move-è¯­ä¹‰)
    - [2.1 å®Œæ•´ç§»åŠ¨](#21-å®Œæ•´ç§»åŠ¨)
    - [2.2 éƒ¨åˆ†ç§»åŠ¨](#22-éƒ¨åˆ†ç§»åŠ¨)
  - [ğŸ“‹ 3. Copy è¯­ä¹‰](#-3-copy-è¯­ä¹‰)
    - [3.1 Copy trait è§„åˆ™](#31-copy-trait-è§„åˆ™)
    - [3.2 Copy ç±»å‹åˆ—è¡¨](#32-copy-ç±»å‹åˆ—è¡¨)
  - [ğŸ”„ 4. Clone è¯­ä¹‰](#-4-clone-è¯­ä¹‰)
  - [ğŸ“š 5. å‡½æ•°è°ƒç”¨è§„åˆ™](#-5-å‡½æ•°è°ƒç”¨è§„åˆ™)
    - [5.1 ä¼ å€¼ (by value)](#51-ä¼ å€¼-by-value)
    - [5.2 ä¼ å¼•ç”¨ (by reference)](#52-ä¼ å¼•ç”¨-by-reference)
  - [ğŸ¯ 6. è¿”å›å€¼è§„åˆ™](#-6-è¿”å›å€¼è§„åˆ™)
  - [âš™ï¸ 7. ç»“æ„ä½“æ‰€æœ‰æƒ](#ï¸-7-ç»“æ„ä½“æ‰€æœ‰æƒ)
  - [ğŸ“Š 8. é›†åˆæ‰€æœ‰æƒ](#-8-é›†åˆæ‰€æœ‰æƒ)
  - [ğŸ” 9. æ‰€æœ‰æƒæ£€æŸ¥æ—¶æœº](#-9-æ‰€æœ‰æƒæ£€æŸ¥æ—¶æœº)
  - [âš ï¸ 10. å¸¸è§é”™è¯¯](#ï¸-10-å¸¸è§é”™è¯¯)
    - [é”™è¯¯ 1: Use after move](#é”™è¯¯-1-use-after-move)
    - [é”™è¯¯ 2: éƒ¨åˆ†ç§»åŠ¨åä½¿ç”¨æ•´ä½“](#é”™è¯¯-2-éƒ¨åˆ†ç§»åŠ¨åä½¿ç”¨æ•´ä½“)
    - [é”™è¯¯ 3: å‡½æ•°å‚æ•°ç§»åŠ¨](#é”™è¯¯-3-å‡½æ•°å‚æ•°ç§»åŠ¨)

---

## ğŸ“– 1. æ ¸å¿ƒè§„åˆ™

### 1.1 æ‰€æœ‰æƒä¸‰å¤§è§„åˆ™

**è§„åˆ™ 1: å”¯ä¸€æ‰€æœ‰è€…**:

```rust
// âœ… æ¯ä¸ªå€¼æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
let s = String::from("hello"); // s æ˜¯æ‰€æœ‰è€…

// âŒ ä¸èƒ½æœ‰å¤šä¸ªæ‰€æœ‰è€…ï¼ˆé™¤éä½¿ç”¨ Rc/Arcï¼‰
// let s2 = s; // s çš„æ‰€æœ‰æƒå·²è½¬ç§»
```

**è§„åˆ™ 2: ä½œç”¨åŸŸç»“æŸé‡Šæ”¾**ï¼ˆå¼•ç”¨ä¸€è‡´æ€§è§†è§’ï¼‰:

```rust
{
    let s = String::from("hello"); // s è¿›å…¥ä½œç”¨åŸŸ
    // ä½¿ç”¨ s
} // s ç¦»å¼€ä½œç”¨åŸŸï¼Œè‡ªåŠ¨è°ƒç”¨ dropï¼Œèµ„æºè¢«é‡Šæ”¾ï¼ˆç¼–è¯‘æœŸè¯æ˜çš„èµ„æºç”Ÿå‘½å‘¨æœŸï¼‰
```

**è§„åˆ™ 3: è½¬ç§»åå¤±æ•ˆ**:

```rust
let s1 = String::from("hello");
let s2 = s1; // s1 çš„æ‰€æœ‰æƒè½¬ç§»ç»™ s2
// println!("{}", s1); // âŒ ç¼–è¯‘é”™è¯¯: s1 å·²å¤±æ•ˆ
println!("{}", s2); // âœ… æ­£ç¡®
```

---

### 1.2 æ‰€æœ‰æƒè½¬ç§»è§„åˆ™

**è§„åˆ™ 4: èµ‹å€¼è½¬ç§»**:

```rust
let s1 = String::from("hello");
let s2 = s1; // æ‰€æœ‰æƒä» s1 è½¬ç§»åˆ° s2
```

**è§„åˆ™ 5: å‡½æ•°ä¼ å‚è½¬ç§»**:

```rust
fn take_ownership(s: String) {
    println!("{}", s);
} // s åœ¨è¿™é‡Œè¢« drop

let s = String::from("hello");
take_ownership(s); // s çš„æ‰€æœ‰æƒè½¬ç§»åˆ°å‡½æ•°
// println!("{}", s); // âŒ é”™è¯¯
```

**è§„åˆ™ 6: å‡½æ•°è¿”å›è½¬ç§»**:

```rust
fn give_ownership() -> String {
    let s = String::from("hello");
    s // æ‰€æœ‰æƒè½¬ç§»ç»™è°ƒç”¨è€…
}

let s = give_ownership(); // s è·å¾—æ‰€æœ‰æƒ
```

---

## ğŸ“¦ 2. Move è¯­ä¹‰

### 2.1 å®Œæ•´ç§»åŠ¨

**é Copy ç±»å‹çš„ç§»åŠ¨**:

```rust
// String, Vec, Box ç­‰éƒ½æ˜¯ Move ç±»å‹
let s1 = String::from("hello");
let s2 = s1; // å®Œæ•´ç§»åŠ¨

let v1 = vec![1, 2, 3];
let v2 = v1; // å®Œæ•´ç§»åŠ¨

let b1 = Box::new(5);
let b2 = b1; // å®Œæ•´ç§»åŠ¨
```

**ç§»åŠ¨åèµ„æºæ§åˆ¶æƒè½¬ç§»**ï¼ˆå¼•ç”¨ä¸€è‡´æ€§è§†è§’ï¼‰:

```text
ç§»åŠ¨å‰:
s1: [ptr]--> [h][e][l][l][o] (heap)

ç§»åŠ¨å:
s1: [æ— æ•ˆ]
s2: [ptr]--> [h][e][l][l][o] (heap)
```

---

### 2.2 éƒ¨åˆ†ç§»åŠ¨

**ç»“æ„ä½“éƒ¨åˆ†ç§»åŠ¨**:

```rust
struct Point {
    x: i32,
    y: String,
}

let p = Point {
    x: 10,
    y: String::from("hello"),
};

let x = p.x; // Copy (i32 æ˜¯ Copy)
let y = p.y; // Move (String æ˜¯ Move)

// println!("{}", p.x); // âœ… x æ˜¯ Copyï¼Œp.x ä»æœ‰æ•ˆ
// println!("{}", p.y); // âŒ y å·²è¢«ç§»åŠ¨
// println!("{:?}", p);  // âŒ p éƒ¨åˆ†å¤±æ•ˆ
```

**å…ƒç»„éƒ¨åˆ†ç§»åŠ¨**:

```rust
let t = (String::from("hello"), 42);
let s = t.0; // Move
// let n = t.1; // âŒ t å·²éƒ¨åˆ†å¤±æ•ˆ
```

---

## ğŸ“‹ 3. Copy è¯­ä¹‰

### 3.1 Copy trait è§„åˆ™

**è§„åˆ™ 7: Copy ç±»å‹çš„å¤åˆ¶**:

```rust
// Copy ç±»å‹èµ‹å€¼æ˜¯å¤åˆ¶ï¼Œè€Œéç§»åŠ¨
let x = 5;
let y = x; // å¤åˆ¶ x çš„å€¼
println!("x = {}, y = {}", x, y); // âœ… x ä»æœ‰æ•ˆ
```

**è§„åˆ™ 8: Copy çš„çº¦æŸ**:

- å¿…é¡»å®ç° `Copy` trait
- æ‰€æœ‰å­—æ®µéƒ½å¿…é¡»æ˜¯ `Copy`
- ä¸èƒ½å®ç° `Drop` trait

```rust
// âœ… å¯ä»¥æ˜¯ Copy
#[derive(Copy, Clone)]
struct Point {
    x: i32,
    y: i32,
}

// âŒ ä¸èƒ½æ˜¯ Copy (æœ‰ non-Copy å­—æ®µ)
struct Data {
    name: String, // String ä¸æ˜¯ Copy
}
```

---

### 3.2 Copy ç±»å‹åˆ—è¡¨

**æ ‡å‡†åº“ Copy ç±»å‹**:

| ç±»å‹ç±»åˆ« | å…·ä½“ç±»å‹ |
|---------|---------|
| **åŸºæœ¬ç±»å‹** | `bool`, `char` |
| **æ•´æ•°** | `i8` ~ `i128`, `u8` ~ `u128`, `isize`, `usize` |
| **æµ®ç‚¹æ•°** | `f32`, `f64` |
| **æŒ‡é’ˆ** | `*const T`, `*mut T` |
| **å¼•ç”¨** | `&T`, `&mut T` (å¼•ç”¨æœ¬èº«) |
| **æ•°ç»„** | `[T; N]` (T æ˜¯ Copy) |
| **å…ƒç»„** | `(T1, T2, ...)` (æ‰€æœ‰ T éƒ½æ˜¯ Copy) |
| **Option** | `Option<T>` (T æ˜¯ Copy) |
| **Result** | `Result<T, E>` (T å’Œ E éƒ½æ˜¯ Copy) |

**é Copy ç±»å‹**:

- `String`, `Vec<T>`, `Box<T>`
- ä»»ä½•å®ç°äº† `Drop` çš„ç±»å‹
- åŒ…å«é Copy å­—æ®µçš„ç»“æ„ä½“

---

## ğŸ”„ 4. Clone è¯­ä¹‰

**è§„åˆ™ 9: Clone çš„æ˜¾å¼å¤åˆ¶**:

```rust
let s1 = String::from("hello");
let s2 = s1.clone(); // æ˜¾å¼æ·±æ‹·è´
println!("s1 = {}, s2 = {}", s1, s2); // âœ… s1 ä»æœ‰æ•ˆ
```

**Clone vs Copy**:

| ç‰¹æ€§ | Copy | Clone |
|------|------|-------|
| **è§¦å‘æ–¹å¼** | éšå¼ | æ˜¾å¼ (`clone()`) |
| **å¼€é”€** | O(1) | O(n) |
| **å®ç°çº¦æŸ** | ä¸¥æ ¼ | å®½æ¾ |
| **å…¸å‹ç”¨é€”** | ç®€å•ç±»å‹ | å¤æ‚ç±»å‹ |

---

## ğŸ“š 5. å‡½æ•°è°ƒç”¨è§„åˆ™

### 5.1 ä¼ å€¼ (by value)

**è§„åˆ™ 10: æ‰€æœ‰æƒè½¬ç§»åˆ°å‡½æ•°**:

```rust
fn process(s: String) {
    println!("{}", s);
} // s è¢« drop

let data = String::from("hello");
process(data); // data çš„æ‰€æœ‰æƒè½¬ç§»
// println!("{}", data); // âŒ é”™è¯¯
```

---

### 5.2 ä¼ å¼•ç”¨ (by reference)

**ä¸å¯å˜å¼•ç”¨**:

```rust
fn read(s: &String) {
    println!("{}", s);
}

let data = String::from("hello");
read(&data); // å€Ÿç”¨ï¼Œä¸è½¬ç§»æ‰€æœ‰æƒ
println!("{}", data); // âœ… data ä»æœ‰æ•ˆ
```

**å¯å˜å¼•ç”¨**:

```rust
fn modify(s: &mut String) {
    s.push_str(", world");
}

let mut data = String::from("hello");
modify(&mut data); // å¯å˜å€Ÿç”¨
println!("{}", data); // "hello, world"
```

---

## ğŸ¯ 6. è¿”å›å€¼è§„åˆ™

**è§„åˆ™ 11: è¿”å›è½¬ç§»æ‰€æœ‰æƒ**:

```rust
fn create() -> String {
    let s = String::from("hello");
    s // æ‰€æœ‰æƒè½¬ç§»ç»™è°ƒç”¨è€…
}

let data = create(); // data è·å¾—æ‰€æœ‰æƒ
```

**è§„åˆ™ 12: è¿”å›å¼•ç”¨å¿…é¡»æœ‰æ•ˆ**:

```rust
// âŒ è¿”å›æ‚¬å‚å¼•ç”¨
// fn dangle() -> &String {
//     let s = String::from("hello");
//     &s // s åœ¨è¿™é‡Œè¢« dropï¼Œè¿”å›æ‚¬å‚å¼•ç”¨
// }

// âœ… è¿”å›æ‰€æœ‰æƒ
fn no_dangle() -> String {
    String::from("hello")
}
```

---

## âš™ï¸ 7. ç»“æ„ä½“æ‰€æœ‰æƒ

**è§„åˆ™ 13: ç»“æ„ä½“æ‹¥æœ‰å­—æ®µ**:

```rust
struct User {
    username: String,
    email: String,
}

let user = User {
    username: String::from("alice"),
    email: String::from("alice@example.com"),
};
// user æ‹¥æœ‰ username å’Œ email
```

**è§„åˆ™ 14: ç»“æ„ä½“ç§»åŠ¨**:

```rust
let user1 = User {
    username: String::from("alice"),
    email: String::from("alice@example.com"),
};

let user2 = user1; // user1 æ•´ä½“ç§»åŠ¨
// println!("{}", user1.username); // âŒ user1 å·²å¤±æ•ˆ
```

---

## ğŸ“Š 8. é›†åˆæ‰€æœ‰æƒ

**è§„åˆ™ 15: é›†åˆæ‹¥æœ‰å…ƒç´ **:

```rust
let v = vec![
    String::from("a"),
    String::from("b"),
];
// v æ‹¥æœ‰æ‰€æœ‰ String

drop(v); // v å’Œæ‰€æœ‰å…ƒç´ éƒ½è¢« drop
```

**è§„åˆ™ 16: ä»é›†åˆç§»å‡ºå…ƒç´ **:

```rust
let mut v = vec![
    String::from("a"),
    String::from("b"),
];

// æ–¹æ³• 1: swap_remove (O(1))
let s = v.swap_remove(0);

// æ–¹æ³• 2: remove (O(n))
let s = v.remove(0);

// æ–¹æ³• 3: take (éœ€è¦ Option)
let mut v = vec![Some(String::from("a"))];
let s = v[0].take(); // Option::take
```

---

## ğŸ” 9. æ‰€æœ‰æƒæ£€æŸ¥æ—¶æœº

**ç¼–è¯‘æ—¶æ£€æŸ¥**:

- âœ… æ‰€æœ‰æƒè½¬ç§»
- âœ… å€Ÿç”¨è§„åˆ™
- âœ… ç”Ÿå‘½å‘¨æœŸ

**è¿è¡Œæ—¶æ£€æŸ¥** (å°‘æ•°æƒ…å†µ):

- `RefCell<T>` çš„å€Ÿç”¨
- `Mutex<T>` çš„é”

---

## âš ï¸ 10. å¸¸è§é”™è¯¯

### é”™è¯¯ 1: Use after move

```rust
let s = String::from("hello");
let s2 = s;
// println!("{}", s); // âŒ use of moved value: `s`
```

**è§£å†³æ–¹æ¡ˆ**:

```rust
// 1. clone
let s = String::from("hello");
let s2 = s.clone();
println!("{}, {}", s, s2); // âœ…

// 2. å€Ÿç”¨
let s = String::from("hello");
let s2 = &s;
println!("{}, {}", s, s2); // âœ…
```

---

### é”™è¯¯ 2: éƒ¨åˆ†ç§»åŠ¨åä½¿ç”¨æ•´ä½“

```rust
let s = Some(String::from("hello"));
let inner = s.unwrap();
// println!("{:?}", s); // âŒ s å·²è¢«ç§»åŠ¨
```

---

### é”™è¯¯ 3: å‡½æ•°å‚æ•°ç§»åŠ¨

```rust
fn process(s: String) {
    println!("{}", s);
}

let s = String::from("hello");
process(s);
// process(s); // âŒ use of moved value
```

**è§£å†³æ–¹æ¡ˆ**:

```rust
// ä½¿ç”¨å¼•ç”¨
fn process(s: &String) {
    println!("{}", s);
}

let s = String::from("hello");
process(&s);
process(&s); // âœ… å¯ä»¥å¤šæ¬¡è°ƒç”¨
```

---

**ç›¸å…³æ–‡æ¡£**:

- [Tier 2: 01_æ‰€æœ‰æƒå¿«é€Ÿå…¥é—¨](../tier_02_guides/01_æ‰€æœ‰æƒå¿«é€Ÿå…¥é—¨.md)
- [Tier 4: 03_æ‰€æœ‰æƒæ€§èƒ½ä¼˜åŒ–](../tier_04_advanced/03_æ‰€æœ‰æƒæ€§èƒ½ä¼˜åŒ–.md)

---

**æ–‡æ¡£ç»´æŠ¤**: Documentation Team
**åˆ›å»ºæ—¥æœŸ**: 2025-10-22
**é€‚ç”¨ç‰ˆæœ¬**: Rust 1.92.0+
