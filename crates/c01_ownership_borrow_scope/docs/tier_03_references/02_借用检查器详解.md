# Tier 3: å€Ÿç”¨æ£€æŸ¥å™¨è¯¦è§£

> **æ–‡æ¡£ç±»å‹**: æŠ€æœ¯å‚è€ƒ
> **é€‚ç”¨ç‰ˆæœ¬**: Rust 1.92.0+
> **ä¸»é¢˜**: å€Ÿç”¨æ£€æŸ¥å™¨å·¥ä½œåŸç†å’Œè§„åˆ™

---

## ç›®å½•

- [Tier 3: å€Ÿç”¨æ£€æŸ¥å™¨è¯¦è§£](#tier-3-å€Ÿç”¨æ£€æŸ¥å™¨è¯¦è§£)
  - [ç›®å½•](#ç›®å½•)
  - [ğŸ“ çŸ¥è¯†ç»“æ„](#-çŸ¥è¯†ç»“æ„)
  - [1. å€Ÿç”¨æ£€æŸ¥å™¨æ¦‚è¿°](#1-å€Ÿç”¨æ£€æŸ¥å™¨æ¦‚è¿°)
  - [2. å€Ÿç”¨è§„åˆ™](#2-å€Ÿç”¨è§„åˆ™)
  - [3. NLL (Non-Lexical Lifetimes)](#3-nll-non-lexical-lifetimes)
  - [4. å€Ÿç”¨æ£€æŸ¥ç®—æ³•](#4-å€Ÿç”¨æ£€æŸ¥ç®—æ³•)
  - [5. å¸¸è§é”™è¯¯è§£æ](#5-å¸¸è§é”™è¯¯è§£æ)
    - [é”™è¯¯ 1: Cannot borrow as mutable](#é”™è¯¯-1-cannot-borrow-as-mutable)
    - [é”™è¯¯ 2: Cannot borrow as mutable more than once](#é”™è¯¯-2-cannot-borrow-as-mutable-more-than-once)
    - [é”™è¯¯ 3: Cannot borrow as mutable because it is also borrowed as immutable](#é”™è¯¯-3-cannot-borrow-as-mutable-because-it-is-also-borrowed-as-immutable)

---

## 1. å€Ÿç”¨æ£€æŸ¥å™¨æ¦‚è¿°

å€Ÿç”¨æ£€æŸ¥å™¨ (Borrow Checker) æ˜¯ Rust ç¼–è¯‘å™¨çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£åœ¨ç¼–è¯‘æ—¶éªŒè¯æ‰€æœ‰æƒå’Œå€Ÿç”¨è§„åˆ™ã€‚ä»å¼•ç”¨ä¸€è‡´æ€§è§†è§’çœ‹ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨æ˜¯**ç¼–è¯‘æœŸé€»è¾‘è¯æ˜ç³»ç»Ÿ**ï¼Œé€šè¿‡çº¦æŸæ±‚è§£è€Œéå†…å­˜çŠ¶æ€æ£€æŸ¥æ¥ä¿è¯èµ„æºå®‰å…¨ã€‚

**ä¸»è¦èŒè´£**ï¼ˆå¼•ç”¨ä¸€è‡´æ€§è§†è§’ï¼‰:

- âœ… æ£€æŸ¥å€Ÿç”¨è§„åˆ™ï¼ˆç¼–è¯‘æœŸé€»è¾‘è¯æ˜ï¼‰
- âœ… é˜²æ­¢æ•°æ®ç«äº‰ï¼ˆç¼–è¯‘æœŸæ’ä»–æ€§å¥‘çº¦çš„éªŒè¯ï¼‰
- âœ… ç¡®ä¿èµ„æºå®‰å…¨ï¼ˆç¼–è¯‘æœŸé€»è¾‘è¯æ˜ï¼Œéå†…å­˜æ£€æŸ¥ï¼‰
- âœ… éªŒè¯ç”Ÿå‘½å‘¨æœŸï¼ˆé€»è¾‘ä¾èµ–å…³ç³»çš„è¯æ˜ï¼‰

---

## 2. å€Ÿç”¨è§„åˆ™

**æ ¸å¿ƒè§„åˆ™**:

1. **ä¸å¯å˜å€Ÿç”¨è§„åˆ™**: å¯ä»¥æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨

   ```rust
   let s = String::from("hello");
   let r1 = &s; // âœ…
   let r2 = &s; // âœ…
   ```

2. **å¯å˜å€Ÿç”¨è§„åˆ™**: åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨

   ```rust
   let mut s = String::from("hello");
   let r1 = &mut s; // âœ…
   // let r2 = &mut s; // âŒ ç¼–è¯‘é”™è¯¯
   ```

3. **æ··åˆå€Ÿç”¨è§„åˆ™**: ä¸èƒ½åŒæ—¶æœ‰å¯å˜å’Œä¸å¯å˜å¼•ç”¨

   ```rust
   let mut s = String::from("hello");
   let r1 = &s; // âœ…
   // let r2 = &mut s; // âŒ ç¼–è¯‘é”™è¯¯
   ```

---

## 3. NLL (Non-Lexical Lifetimes)

**NLL ä¼˜åŒ–** (Rust 2018+)ï¼ˆå¼•ç”¨ä¸€è‡´æ€§è§†è§’ï¼‰:

å€Ÿç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸å†ä¸¥æ ¼åŸºäºä½œç”¨åŸŸï¼Œè€Œæ˜¯åŸºäº**æœ€åä¸€æ¬¡ä½¿ç”¨**ã€‚ä»å¼•ç”¨ä¸€è‡´æ€§è§†è§’çœ‹ï¼ŒNLL ä½¿ç”¨**é€»è¾‘è¯æ˜**æ›´ç²¾ç¡®åœ°è®¡ç®—å¼•ç”¨çš„æœ‰æ•ˆèŒƒå›´ï¼ˆé€»è¾‘å…³ç³»ï¼Œéç‰©ç†æ—¶é—´ï¼‰ã€‚

```rust
let mut s = String::from("hello");

let r1 = &s;
let r2 = &s;
println!("{} and {}", r1, r2);
// r1 å’Œ r2 åœ¨æ­¤ä¹‹åä¸å†ä½¿ç”¨

let r3 = &mut s; // âœ… NLL å…è®¸
println!("{}", r3);
```

**ä¼ ç»Ÿä½œç”¨åŸŸ vs NLL**:

```text
ä¼ ç»Ÿ (Lexical):
let r1 = &s;      â”œâ”€â”€ r1 ç”Ÿå‘½å‘¨æœŸå¼€å§‹
let r2 = &s;      â”‚   â”œâ”€â”€ r2 ç”Ÿå‘½å‘¨æœŸå¼€å§‹
...               â”‚   â”‚
}                 â”´â”€â”€ r1, r2 ç”Ÿå‘½å‘¨æœŸç»“æŸ

NLL:
let r1 = &s;      â”œâ”€â”€ r1 ç”Ÿå‘½å‘¨æœŸå¼€å§‹
println!("{}", r1); â”´â”€â”€ r1 æœ€åä¸€æ¬¡ä½¿ç”¨ï¼Œç”Ÿå‘½å‘¨æœŸç»“æŸ
let r2 = &mut s;  âœ… å¯ä»¥å¯å˜å€Ÿç”¨
```

---

## 4. å€Ÿç”¨æ£€æŸ¥ç®—æ³•

**æ£€æŸ¥æµç¨‹**:

1. **å»ºç«‹å€Ÿç”¨å›¾**: åˆ†ææ‰€æœ‰å€Ÿç”¨å…³ç³»
2. **ç”Ÿå‘½å‘¨æœŸæ¨æ–­**: è®¡ç®—å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸ
3. **å†²çªæ£€æµ‹**: æ£€æŸ¥æ˜¯å¦è¿åå€Ÿç”¨è§„åˆ™
4. **é”™è¯¯æŠ¥å‘Š**: ç”Ÿæˆå‹å¥½çš„é”™è¯¯ä¿¡æ¯

**ç¤ºä¾‹**:

```rust
fn main() {
    let mut x = 5;
    let y = &mut x;   // å¯å˜å€Ÿç”¨å¼€å§‹
    *y += 1;          // ä½¿ç”¨å¯å˜å€Ÿç”¨
    println!("{}", x); // âŒ å€Ÿç”¨å†²çª
    //              ^
    //              y çš„å€Ÿç”¨ä»åœ¨æ­¤å¤„æ´»è·ƒ
}
```

---

## 5. å¸¸è§é”™è¯¯è§£æ

### é”™è¯¯ 1: Cannot borrow as mutable

```rust
let s = String::from("hello");
// s.push_str(", world"); // âŒ cannot borrow as mutable

let mut s = String::from("hello");
s.push_str(", world"); // âœ…
```

---

### é”™è¯¯ 2: Cannot borrow as mutable more than once

```rust
let mut s = String::from("hello");
let r1 = &mut s;
// let r2 = &mut s; // âŒ cannot borrow as mutable more than once
```

---

### é”™è¯¯ 3: Cannot borrow as mutable because it is also borrowed as immutable

```rust
let mut s = String::from("hello");
let r1 = &s;
// let r2 = &mut s; // âŒ cannot borrow
println!("{}", r1);
```

---

**ç›¸å…³æ–‡æ¡£**:

- [Tier 2: 02_å€Ÿç”¨å®è·µæŒ‡å—](../tier_02_guides/02_å€Ÿç”¨å®è·µæŒ‡å—.md)
- [Tier 4: 01_é«˜çº§ç”Ÿå‘½å‘¨æœŸæ¨¡å¼](../tier_04_advanced/01_é«˜çº§ç”Ÿå‘½å‘¨æœŸæ¨¡å¼.md)

---

**æ–‡æ¡£ç»´æŠ¤**: Documentation Team
**åˆ›å»ºæ—¥æœŸ**: 2025-10-22
**é€‚ç”¨ç‰ˆæœ¬**: Rust 1.92.0+
