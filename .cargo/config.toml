# Cargo配置文件
# 创建时间: 2025年9月25日 14:20
# 增强时间: 2025年9月25日 14:50
# 更新时间: 2026年2月11日 (cargo update 已更新60个包至 Rust 1.92 兼容版本：clap 4.5.57，zerocopy 0.8.39，tonic 0.14.3 等)

[build]
# 启用CPU指令集优化
rustflags = ["-C", "target-cpu=native"]
# 将构建产物放到非默认 target/ 目录，避免被工具链/编辑器忽略或锁定
target-dir = "cargo-artifacts"

# 针对测试环境的配置
[target.'cfg(test)']
rustflags = ["-C", "debug-assertions=on"]

# 针对基准测试的配置
[target.'cfg(bench)']
rustflags = ["-C", "target-cpu=native", "-C", "opt-level=3"]

# 网络配置
[net]
retry = 2
git-fetch-with-cli = true

# 注册表配置
[registries.crates-io]
protocol = "sparse"

# 别名配置
[alias]
# 测试别名
test-all = "test --all"
test-quick = "test --lib"
test-integration = "test --test"
test-doc = "test --doc"

# 构建别名
build-all = "build --all"
build-release = "build --release"
build-optimized = "build --release --target x86_64-unknown-linux-gnu"

# 检查别名
check-all = "check --all"
check-quick = "check --lib"

# 清理别名
clean-all = "clean --all"

# 格式化别名
fmt-all = "fmt --all"
fmt-check = "fmt --all -- --check"

# 代码质量检查别名
clippy-all = "clippy --all"
clippy-pedantic = "clippy --all -- -W clippy::pedantic"
clippy-cargo = "clippy --all -- -W clippy::cargo"

# 基准测试别名 - 2025年10月11日更新 (criterion 0.7.0)
bench-all = "bench --all"
bench-quick = "bench --lib"

# 覆盖率测试别名 - 2025年10月11日更新
coverage = "tarpaulin --all --out Html --out Xml"
coverage-quick = "tarpaulin --lib --out Html"

# 安全审计别名 - 2025年10月11日更新
audit-all = "audit"
audit-fix = "audit --fix"

# 文档生成别名
doc-all = "doc --all --open"
doc-lib = "doc --lib --open"

# 依赖更新别名
update-all = "update"

# 发布别名
publish-all = "publish --all"
publish-dry-run = "publish --all --dry-run"

# 性能分析别名
profile-cpu = "build --release && perf record --call-graph dwarf"
profile-mem = "build --release && valgrind --tool=massif"

# 编译优化别名
optimize-size = "build --release --target x86_64-unknown-linux-musl"
optimize-speed = "build --release --target x86_64-unknown-linux-gnu"

# 多平台构建别名
build-windows = "build --release --target x86_64-pc-windows-gnu"
build-linux = "build --release --target x86_64-unknown-linux-gnu"
build-macos = "build --release --target x86_64-apple-darwin"

# 开发工具别名
dev-setup = "run --bin dev-setup"
dev-test = "test --all --features test"
dev-bench = "bench --all --features benchmark"

# 质量保证别名
qa-check = "check"
qa-quick = "check"

# 发布准备别名
release-prep = "build --release"
release-check = "check"

# 持续集成别名
ci-test = "test"
ci-build = "build --release"

# 开发工作流别名
dev-start = "check"
dev-full = "test"
dev-release = "build --release"

# 维护别名
maintenance-clean = "clean"
maintenance-audit = "audit"
maintenance-deps = "update"

# 新增配置项 - 2025年10月11日更新
[env]
# 开发环境变量
RUST_LOG = "debug"
RUST_BACKTRACE = "1"
# 依赖更新提示
CARGO_UPDATE_REMINDER = "2026-02-11: cargo update 已更新60个包到最新 Rust 1.92 兼容版本（anyhow 1.0.101, tonic 0.14.3, reqwest 0.13.2, criterion 0.8.2 等）"

# 构建配置
[profile.dev]
# 开发模式配置
debug = true
opt-level = 0
overflow-checks = true

[profile.release]
# 发布模式配置
debug = false
opt-level = 3
lto = true
codegen-units = 1
panic = "abort"

[profile.test]
# 测试模式配置
debug = true
opt-level = 0
overflow-checks = true

[profile.bench]
# 基准测试模式配置
debug = false
opt-level = 3
lto = true
codegen-units = 1
