#!/bin/bash
# æ‰¹é‡æ¸…ç†è„šæœ¬
# åˆ›å»ºæ—¶é—´: 2025å¹´9æœˆ25æ—¥ 13:07

echo "ðŸ§¹ å¼€å§‹æ‰¹é‡æ¸…ç†æ“ä½œ..."
echo "æ¸…ç†æ—¶é—´: $(date)"
echo "================================"

# åˆ›å»ºæ¸…ç†æ—¥å¿—
CLEANUP_LOG="cleanup-log-$(date +%Y%m%d-%H%M%S).txt"
echo "æ¸…ç†æ—¥å¿—: $CLEANUP_LOG"

# 1. æ¸…ç†è™šå‡å£°æ˜Ž
echo "ðŸ“ å¼€å§‹æ¸…ç†è™šå‡å£°æ˜Ž..."

# æ¸…ç†"ä¸–ç•Œé¦–ä¸ª"å£°æ˜Ž
echo "æ¸…ç†'ä¸–ç•Œé¦–ä¸ª'å£°æ˜Ž..."
find . -name "*.md" -type f -exec sed -i 's/ä¸–ç•Œé¦–ä¸ªå®Œæ•´çš„Rustå½¢å¼åŒ–ç†è®ºä½“ç³»/åŸºäºŽRustçš„å­¦ä¹ é¡¹ç›®/g' {} \;
find . -name "*.md" -type f -exec sed -i 's/ä¸–ç•Œé¦–ä¸ªå®Œæ•´çš„/åŸºäºŽRustçš„/g' {} \;
find . -name "*.md" -type f -exec sed -i 's/ä¸–ç•Œç¬¬ä¸€/åŸºäºŽRustçš„/g' {} \;
find . -name "*.md" -type f -exec sed -i 's/ä¸–ç•Œé¦–åˆ›/åŸºäºŽRustçš„/g' {} \;

# æ¸…ç†è™šå‡è´¨é‡è®¤è¯
echo "æ¸…ç†è™šå‡è´¨é‡è®¤è¯..."
find . -name "*.md" -type f -exec sed -i 's/é’»çŸ³çº§å›½é™…æ ‡å‡†/å­¦ä¹ é¡¹ç›®æ ‡å‡†/g' {} \;
find . -name "*.md" -type f -exec sed -i 's/é»„é‡‘çº§å›½é™…æ ‡å‡†/å­¦ä¹ é¡¹ç›®æ ‡å‡†/g' {} \;
find . -name "*.md" -type f -exec sed -i 's/ç™½é‡‘çº§å›½é™…æ ‡å‡†/å­¦ä¹ é¡¹ç›®æ ‡å‡†/g' {} \;
find . -name "*.md" -type f -exec sed -i 's/å›½é™…æ ‡å‡†è®¤è¯/å­¦ä¹ é¡¹ç›®è®¤è¯/g' {} \;

# æ¸…ç†è™šå‡å®Œæˆåº¦å£°æ˜Ž
echo "æ¸…ç†è™šå‡å®Œæˆåº¦å£°æ˜Ž..."
find . -name "*.md" -type f -exec sed -i 's/100%å®Œæˆ/å¼€å‘ä¸­/g' {} \;
find . -name "*.md" -type f -exec sed -i 's/å®Œå…¨å®Œæˆ/å¼€å‘ä¸­/g' {} \;
find . -name "*.md" -type f -exec sed -i 's/å…¨é¢å®Œæˆ/å¼€å‘ä¸­/g' {} \;
find . -name "*.md" -type f -exec sed -i 's/âœ… å·²å®Œæˆ/ðŸ”„ å¼€å‘ä¸­/g' {} \;

echo "âœ… è™šå‡å£°æ˜Žæ¸…ç†å®Œæˆ"

# 2. æ¸…ç†é‡å¤çš„å®ŒæˆæŠ¥å‘Šæ–‡ä»¶
echo "ðŸ“ å¼€å§‹æ¸…ç†é‡å¤æ–‡ä»¶..."

# åˆ›å»ºé‡å¤æ–‡ä»¶åˆ—è¡¨
DUPLICATE_FILES=(
    "PROJECT_*_COMPLETION_*.md"
    "FINAL_*_COMPLETION_*.md"
    "*_COMPLETION_*_REPORT*.md"
    "*_FINAL_*_REPORT*.md"
    "*_ULTIMATE_*_REPORT*.md"
    "*_100_PERCENT_*.md"
    "*_COMPREHENSIVE_*_REPORT*.md"
)

# å¤‡ä»½å¹¶åˆ é™¤é‡å¤æ–‡ä»¶
for pattern in "${DUPLICATE_FILES[@]}"; do
    echo "å¤„ç†æ¨¡å¼: $pattern"
    find . -maxdepth 1 -name "$pattern" -type f | while read file; do
        if [ -f "$file" ]; then
            echo "å¤‡ä»½å¹¶åˆ é™¤: $file" >> "$CLEANUP_LOG"
            cp "$file" "backup-$(date +%Y%m%d-%H%M%S)/"
            rm "$file"
        fi
    done
done

echo "âœ… é‡å¤æ–‡ä»¶æ¸…ç†å®Œæˆ"

# 3. æ›´æ–°README.md
echo "ðŸ“– æ›´æ–°README.md..."
if [ -f "README.md" ]; then
    # å¤‡ä»½åŽŸæ–‡ä»¶
    cp "README.md" "README.md.backup"
    
    # åˆ›å»ºæ–°çš„README.md
    cat > "README.md" << 'EOF'
# ðŸ¦€ Rustè¯­è¨€å­¦ä¹ é¡¹ç›®

> **åŸºäºŽRustçš„å­¦ä¹ é¡¹ç›®** - è¿žæŽ¥ç†è®ºå­¦ä¹ ä¸Žå®žè·µåº”ç”¨çš„æ¡¥æ¢
> é¡¹ç›®å®šä½ä¸ŽèŒƒå›´ï¼šè¯¦è§ `PROJECT_SCOPE.md`ï¼ˆæœ¬é¡¹ç›®èšç„¦ Rust è¯­è¨€çš„å­¦ä¹ å’Œå®žè·µï¼Œä¸çº³å…¥æœªå‘å¸ƒç‰ˆæœ¬ç‰¹æ€§ï¼‰ã€‚

## ðŸŽ¯ é¡¹ç›®å®šä½

**é¡¹ç›®æ€§è´¨**: å­¦ä¹ é¡¹ç›®  
**è´¨é‡ç­‰çº§**: å¼€å‘ä¸­  
**å†…å®¹è§„æ¨¡**: æŒç»­å®Œå–„ä¸­  
**å®Œæˆåº¦**: å¼€å‘ä¸­  

### ðŸš€ å­¦ä¹ ç›®æ ‡

âœ… **Rustè¯­è¨€åŸºç¡€å­¦ä¹ **  
âœ… **æ‰€æœ‰æƒå’Œå€Ÿç”¨ç³»ç»Ÿç†è§£**  
âœ… **ç±»åž‹ç³»ç»Ÿå’Œæ³›åž‹ç¼–ç¨‹**  
âœ… **å¼‚æ­¥ç¼–ç¨‹å’Œå¹¶å‘å¤„ç†**  

---

## ðŸ§­ å­¦ä¹ è·¯å¾„æŒ‡å—

### ðŸš€ å¿«é€Ÿå…¥é—¨è·¯å¾„

1. **åŸºç¡€æ¦‚å¿µ**: [æ‰€æœ‰æƒä¸Žå€Ÿç”¨](crates/c01_ownership_borrow_scope/) â†’ [ç±»åž‹ç³»ç»Ÿ](crates/c02_type_system/)
2. **æŽ§åˆ¶æµ**: [æŽ§åˆ¶æµä¸Žå‡½æ•°](crates/c03_control_fn/) â†’ [æ³›åž‹ç¼–ç¨‹](crates/c04_generic/)
3. **å¹¶å‘ç¼–ç¨‹**: [çº¿ç¨‹ç®¡ç†](crates/c05_threads/) â†’ [å¼‚æ­¥ç¼–ç¨‹](crates/c06_async/)
4. **ç³»ç»Ÿç¼–ç¨‹**: [è¿›ç¨‹ç®¡ç†](crates/c07_process/) â†’ [ç½‘ç»œç¼–ç¨‹](crates/c10_networks/)

### ðŸ”¬ æ·±å…¥å­¦ä¹ 

1. **ç†è®ºå­¦ä¹ **: [ç†è®ºä½“ç³»å…¥å£](formal_rust/language/00_index.md)
2. **å®žè·µåº”ç”¨**: [ç®—æ³•å®žçŽ°](crates/c08_algorithms/)
3. **è®¾è®¡æ¨¡å¼**: [è®¾è®¡æ¨¡å¼åº“](crates/c09_design_pattern/)
4. **ç½‘ç»œç¼–ç¨‹**: [ç½‘ç»œç¼–ç¨‹](crates/c10_networks/)

---

## ðŸ“š é¡¹ç›®ç»“æž„æ€»è§ˆ

### ðŸ—ï¸ å®žè·µå­¦ä¹ æ¨¡å— (crates/)

- **[c01_ownership_borrow_scope](crates/c01_ownership_borrow_scope/)** - æ‰€æœ‰æƒã€å€Ÿç”¨ä¸Žä½œç”¨åŸŸ
- **[c02_type_system](crates/c02_type_system/)** - ç±»åž‹ç³»ç»Ÿç†è®ºä¸Žå®žè·µ
- **[c03_control_fn](crates/c03_control_fn/)** - æŽ§åˆ¶æµä¸Žå‡½æ•°å¼ç¼–ç¨‹
- **[c04_generic](crates/c04_generic/)** - æ³›åž‹ç¼–ç¨‹ä¸Žå…ƒç¼–ç¨‹
- **[c05_threads](crates/c05_threads/)** - å¹¶å‘ç¼–ç¨‹ä¸Žçº¿ç¨‹ç®¡ç†
- **[c06_async](crates/c06_async/)** - å¼‚æ­¥ç¼–ç¨‹ä¸ŽFutureæ¨¡å¼
- **[c07_process](crates/c07_process/)** - è¿›ç¨‹ç®¡ç†ä¸Žç³»ç»Ÿç¼–ç¨‹
- **[c08_algorithms](crates/c08_algorithms/)** - ç®—æ³•è®¾è®¡ä¸Žæ•°æ®ç»“æž„
- **[c09_design_pattern](crates/c09_design_pattern/)** - è®¾è®¡æ¨¡å¼ä¸Žæž¶æž„æ¨¡å¼
- **[c10_networks](crates/c10_networks/)** - ç½‘ç»œç¼–ç¨‹ä¸Žåè®®å®žçŽ°

### ðŸ”¬ ç†è®ºå­¦ä¹ æ¨¡å— (formal_rust/)

- **[è¯­è¨€åŸºç¡€](formal_rust/language/)** - Rustè¯­è¨€ç†è®ºå­¦ä¹ 
- **[ç†è®ºæ¡†æž¶](formal_rust/framework/)** - å½¢å¼åŒ–ç†è®ºæ¡†æž¶
- **[ç†è®ºåŸºç¡€](formal_rust/theoretical-foundations/)** - æ•°å­¦å’Œç†è®ºåŸºç¡€

---

## ðŸŽ“ å­¦ä¹ å»ºè®®

### åˆå­¦è€…
1. ä»ŽåŸºç¡€æ¨¡å—å¼€å§‹å­¦ä¹ 
2. é‡ç‚¹å…³æ³¨æ‰€æœ‰æƒå’Œå€Ÿç”¨æ¦‚å¿µ
3. å¤šç»ƒä¹ ä»£ç ç¤ºä¾‹
4. å‚è€ƒå®˜æ–¹æ–‡æ¡£

### è¿›é˜¶ç”¨æˆ·
1. æ·±å…¥å­¦ä¹ ç±»åž‹ç³»ç»Ÿ
2. æŽŒæ¡å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼
3. å­¦ä¹ è®¾è®¡æ¨¡å¼åº”ç”¨
4. å‚ä¸Žå®žé™…é¡¹ç›®å¼€å‘

---

## ðŸ“ž é¡¹ç›®ç»´æŠ¤

### å½“å‰çŠ¶æ€
- **å¼€å‘çŠ¶æ€**: ðŸ”„ æŒç»­å¼€å‘ä¸­
- **æ›´æ–°é¢‘çŽ‡**: è·Ÿéšå­¦ä¹ è¿›åº¦
- **è´¨é‡ä¿è¯**: æŒç»­æ”¹è¿›ä¸­
- **ç¤¾åŒºå¼€æ”¾**: æ¬¢è¿Žå­¦ä¹ å’Œåé¦ˆ

### è´¡çŒ®æŒ‡å—
- å­¦ä¹ è¿‡ç¨‹ä¸­å‘çŽ°çš„é—®é¢˜æ¬¢è¿Žåé¦ˆ
- æ”¹è¿›å»ºè®®å’Œä»£ç è´¡çŒ®æ¬¢è¿Žæäº¤
- å­¦ä¹ å¿ƒå¾—å’Œç»éªŒåˆ†äº«æ¬¢è¿Žäº¤æµ

---

*æœ€åŽæ›´æ–°: 2025å¹´9æœˆ25æ—¥*  
*é¡¹ç›®çŠ¶æ€: ðŸ”„ å¼€å‘ä¸­ - å­¦ä¹ é¡¹ç›®*  
*å®Œæˆåº¦: å¼€å‘ä¸­ - æŒç»­å®Œå–„*
EOF

    echo "âœ… README.mdæ›´æ–°å®Œæˆ"
else
    echo "âš ï¸  README.mdæ–‡ä»¶ä¸å­˜åœ¨"
fi

# 4. ç”Ÿæˆæ¸…ç†æŠ¥å‘Š
echo "ðŸ“Š ç”Ÿæˆæ¸…ç†æŠ¥å‘Š..."
cat > "cleanup-report-$(date +%Y%m%d-%H%M%S).md" << EOF
# æ‰¹é‡æ¸…ç†æŠ¥å‘Š

**æ¸…ç†æ—¶é—´**: $(date)
**æ¸…ç†æ—¥å¿—**: $CLEANUP_LOG

## æ¸…ç†æ“ä½œæ€»ç»“

### 1. è™šå‡å£°æ˜Žæ¸…ç†
- âœ… æ¸…ç†"ä¸–ç•Œé¦–ä¸ª"å£°æ˜Ž
- âœ… æ¸…ç†è™šå‡è´¨é‡è®¤è¯
- âœ… æ¸…ç†è™šå‡å®Œæˆåº¦å£°æ˜Ž

### 2. é‡å¤æ–‡ä»¶æ¸…ç†
- âœ… å¤‡ä»½é‡å¤çš„å®ŒæˆæŠ¥å‘Šæ–‡ä»¶
- âœ… åˆ é™¤å†—ä½™æ–‡ä»¶
- âœ… ä¿ç•™æœ‰ä»·å€¼å†…å®¹

### 3. æ–‡æ¡£æ›´æ–°
- âœ… æ›´æ–°README.md
- âœ… ä¿®æ­£é¡¹ç›®æè¿°
- âœ… å»ºç«‹çœŸå®žçš„é¡¹ç›®å®šä½

## æ¸…ç†ç»“æžœ

### æ–‡ä»¶ä¿®æ”¹ç»Ÿè®¡
- è™šå‡å£°æ˜Žæ¸…ç†: å®Œæˆ
- é‡å¤æ–‡ä»¶åˆ é™¤: å®Œæˆ
- æ–‡æ¡£æ›´æ–°: å®Œæˆ

### è´¨é‡æå‡
- é¡¹ç›®æè¿°çœŸå®žæ€§: æå‡
- æ–‡ä»¶ç»“æž„æ¸…æ™°åº¦: æå‡
- å†…å®¹å‡†ç¡®æ€§: æå‡

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **éªŒè¯æ¸…ç†ç»“æžœ**: æ£€æŸ¥æ¸…ç†åŽçš„æ–‡ä»¶å†…å®¹
2. **æµ‹è¯•ä»£ç ç¤ºä¾‹**: éªŒè¯æ‰€æœ‰ä»£ç å¯ç¼–è¯‘
3. **å»ºç«‹è´¨é‡æ ‡å‡†**: åˆ¶å®šçœŸå®žçš„è´¨é‡è¯„ä¼°æ ‡å‡†
4. **æŒç»­æ”¹è¿›**: å»ºç«‹æŒç»­æ”¹è¿›æœºåˆ¶

EOF

echo "âœ… æ¸…ç†æŠ¥å‘Šç”Ÿæˆå®Œæˆ"

echo "================================"
echo "ðŸŽ‰ æ‰¹é‡æ¸…ç†æ“ä½œå®Œæˆ!"
echo "æ¸…ç†æ—¥å¿—: $CLEANUP_LOG"
echo "æ¸…ç†æŠ¥å‘Š: cleanup-report-$(date +%Y%m%d-%H%M%S).md"
echo "å®Œæˆæ—¶é—´: $(date)"
echo "================================"
