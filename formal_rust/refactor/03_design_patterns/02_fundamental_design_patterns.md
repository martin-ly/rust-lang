# 03. åŸºç¡€è®¾è®¡æ¨¡å¼

## ğŸ“š ç›¸å…³æ–‡æ¡£å¼•ç”¨

### ğŸ›ï¸ ç†è®ºåŸºç¡€

- [Rustè¯­è¨€å“²å­¦åŸºç¡€](../01_foundational_theory/03_rust_language_philosophy.md) - è®¾è®¡æ¨¡å¼çš„å“²å­¦åŸºç¡€
- [ç†è®ºåŸºç¡€æ¦‚è¿°](../01_foundational_theory/00_readme.md) - ç†è®ºåŸºç¡€æ•´ä½“æ¡†æ¶

### ğŸ”„ ç¼–ç¨‹èŒƒå¼

- [Rustå“²å­¦å½¢å¼åŒ–](../02_programming_paradigms/04_rust_philosophy_formalization.md) - å“²å­¦æ€æƒ³çš„å½¢å¼åŒ–è¡¨è¾¾
- [è®¾è®¡åŸåˆ™å½¢å¼åŒ–](../02_programming_paradigms/07_design_principles_formalization.md) - è®¾è®¡åŸåˆ™çš„å½¢å¼åŒ–ç†è®º
- [æ¶æ„æ¨¡å¼å½¢å¼åŒ–](../02_programming_paradigms/06_architectural_patterns_formalization.md) - æ¶æ„æ¨¡å¼å½¢å¼åŒ–

### ğŸ¨ è®¾è®¡æ¨¡å¼

- [è®¾è®¡æ¨¡å¼æ¦‚è¿°](../03_design_patterns/00_readme.md) - è®¾è®¡æ¨¡å¼æ•´ä½“æ¦‚è¿°
- [åˆ›å»ºå‹æ¨¡å¼](../03_design_patterns/03_creational_patterns.md) - åˆ›å»ºå‹æ¨¡å¼è¯¦ç»†å†…å®¹
- [ç»“æ„å‹æ¨¡å¼](../03_design_patterns/04_structural_patterns.md) - ç»“æ„å‹æ¨¡å¼è¯¦ç»†å†…å®¹
- [è¡Œä¸ºå‹æ¨¡å¼](../03_design_patterns/05_behavioral_patterns.md) - è¡Œä¸ºå‹æ¨¡å¼è¯¦ç»†å†…å®¹
- [åˆ›å»ºå‹æ¨¡å¼å½¢å¼åŒ–](../03_design_patterns/06_creational_patterns_formalization.md) - åˆ›å»ºå‹æ¨¡å¼å½¢å¼åŒ–
- [ç»“æ„å‹æ¨¡å¼å½¢å¼åŒ–](../03_design_patterns/07_structural_patterns_formalization.md) - ç»“æ„å‹æ¨¡å¼å½¢å¼åŒ–
- [è¡Œä¸ºå‹æ¨¡å¼å½¢å¼åŒ–](../03_design_patterns/08_behavioral_patterns_formalization.md) - è¡Œä¸ºå‹æ¨¡å¼å½¢å¼åŒ–
- [é«˜çº§åˆ›å»ºå‹æ¨¡å¼](../03_design_patterns/09_creational_patterns_advanced.md) - é«˜çº§åˆ›å»ºå‹æ¨¡å¼

### ğŸ¦€ Rustè¯­è¨€ç†è®º

- [æ‰€æœ‰æƒç³»ç»Ÿå½¢å¼åŒ–](../08_rust_language_theory/01_ownership_system_formalization.md) - æ‰€æœ‰æƒç³»ç»Ÿåœ¨è®¾è®¡æ¨¡å¼ä¸­çš„åº”ç”¨
- [ç±»å‹ç³»ç»Ÿå½¢å¼åŒ–](../08_rust_language_theory/03_type_system_formalization.md) - ç±»å‹ç³»ç»Ÿåœ¨è®¾è®¡æ¨¡å¼ä¸­çš„åº”ç”¨
- [Traitç³»ç»Ÿå½¢å¼åŒ–](../08_rust_language_theory/08_trait_system_formalization.md) - Traitç³»ç»Ÿåœ¨è®¾è®¡æ¨¡å¼ä¸­çš„åº”ç”¨
- [æ³›å‹ç³»ç»Ÿå½¢å¼åŒ–](../08_rust_language_theory/09_generic_system_formalization.md) - æ³›å‹ç³»ç»Ÿåœ¨è®¾è®¡æ¨¡å¼ä¸­çš„åº”ç”¨

### âš¡ å¹¶å‘æ¨¡å¼

- [é«˜çº§å¹¶å‘å½¢å¼åŒ–](../05_concurrent_patterns/02_advanced_concurrency_formalization.md) - å¹¶å‘æ¨¡å¼ä¸è®¾è®¡æ¨¡å¼çš„ç»“åˆ
- [Actoræ¨¡å‹å½¢å¼åŒ–](../05_concurrent_patterns/14_actor_model_formalization.md) - Actoræ¨¡å¼ä¸è®¾è®¡æ¨¡å¼çš„ç»“åˆ
- [Future/Promiseæ¨¡å¼å½¢å¼åŒ–](../05_concurrent_patterns/13_future_promise_pattern_formalization.md) - Future/Promiseæ¨¡å¼ä¸è®¾è®¡æ¨¡å¼çš„ç»“åˆ

### ğŸ­ è¡Œä¸šåº”ç”¨

- [é‡‘èç§‘æŠ€å½¢å¼åŒ–](../04_industry_applications/09_fintech_formalization.md) - è®¾è®¡æ¨¡å¼åœ¨é‡‘èç§‘æŠ€ä¸­çš„åº”ç”¨
- [AI/MLå½¢å¼åŒ–](../04_industry_applications/17_ai_ml_formalization.md) - è®¾è®¡æ¨¡å¼åœ¨AI/MLä¸­çš„åº”ç”¨
- [åŒºå—é“¾å½¢å¼åŒ–](../04_industry_applications/19_blockchain_formalization.md) - è®¾è®¡æ¨¡å¼åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨

### ğŸ¯ é«˜çº§æ¨¡å¼

- [åˆ›å»ºå‹æ¨¡å¼å½¢å¼åŒ–](../12_advanced_patterns/01_creational_patterns_formalization.md) - é«˜çº§åˆ›å»ºå‹æ¨¡å¼å½¢å¼åŒ–
- [ç»“æ„å‹æ¨¡å¼å½¢å¼åŒ–](../12_advanced_patterns/04_structural_patterns_formalization.md) - é«˜çº§ç»“æ„å‹æ¨¡å¼å½¢å¼åŒ–
- [å“åº”å¼æ¨¡å¼](../12_advanced_patterns/03_reactive_patterns.md) - å“åº”å¼è®¾è®¡æ¨¡å¼

---

## ç›®å½•

### 1. è®¾è®¡æ¨¡å¼ç†è®ºåŸºç¡€

#### 1.1 æ¦‚å¿µä¸å®šä¹‰

#### 1.2 åˆ†ç±»ä½“ç³»

#### 1.3 å½¢å¼åŒ–è¡¨è¾¾

### 2. åˆ›å»ºå‹æ¨¡å¼ (Creational Patterns)

#### 2.1 å•ä¾‹æ¨¡å¼ (Singleton)

#### 2.2 å·¥å‚æ–¹æ³•æ¨¡å¼ (Factory Method)

#### 2.3 æŠ½è±¡å·¥å‚æ¨¡å¼ (Abstract Factory)

#### 2.4 å»ºé€ è€…æ¨¡å¼ (Builder)

#### 2.5 åŸå‹æ¨¡å¼ (Prototype)

### 3. ç»“æ„å‹æ¨¡å¼ (Structural Patterns)

#### 3.1 é€‚é…å™¨æ¨¡å¼ (Adapter)

#### 3.2 æ¡¥æ¥æ¨¡å¼ (Bridge)

#### 3.3 ç»„åˆæ¨¡å¼ (Composite)

#### 3.4 è£…é¥°å™¨æ¨¡å¼ (Decorator)

#### 3.5 å¤–è§‚æ¨¡å¼ (Facade)

#### 3.6 äº«å…ƒæ¨¡å¼ (Flyweight)

#### 3.7 ä»£ç†æ¨¡å¼ (Proxy)

### 4. è¡Œä¸ºå‹æ¨¡å¼ (Behavioral Patterns)

#### 4.1 è´£ä»»é“¾æ¨¡å¼ (Chain of Responsibility)

#### 4.2 å‘½ä»¤æ¨¡å¼ (Command)

#### 4.3 è§£é‡Šå™¨æ¨¡å¼ (Interpreter)

#### 4.4 è¿­ä»£å™¨æ¨¡å¼ (Iterator)

#### 4.5 ä¸­ä»‹è€…æ¨¡å¼ (Mediator)

#### 4.6 å¤‡å¿˜å½•æ¨¡å¼ (Memento)

#### 4.7 è§‚å¯Ÿè€…æ¨¡å¼ (Observer)

#### 4.8 çŠ¶æ€æ¨¡å¼ (State)

#### 4.9 ç­–ç•¥æ¨¡å¼ (Strategy)

#### 4.10 æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method)

#### 4.11 è®¿é—®è€…æ¨¡å¼ (Visitor)

---

## 1. è®¾è®¡æ¨¡å¼ç†è®ºåŸºç¡€

### 1.1 æ¦‚å¿µä¸å®šä¹‰

**è®¾è®¡æ¨¡å¼å®šä¹‰**ï¼š

```
DesignPattern : Problem â†’ Solution
âˆ€problem âˆˆ DesignProblem | DesignPattern(problem) = 
  {solution, context, consequences}
```

> **å“²å­¦åŸºç¡€**: å…³äºè®¾è®¡æ¨¡å¼çš„å“²å­¦æ€è€ƒï¼Œè¯·å‚è€ƒ [Rustè¯­è¨€å“²å­¦åŸºç¡€](../01_foundational_theory/03_rust_language_philosophy.md) ä¸­çš„ [çº¦æŸæ€§è®¾è®¡åŸåˆ™](#32-æœ‰æ•ˆå½¢å¼æ¨¡å‹çš„æ¢ç´¢åŸåˆ™)ã€‚

**æ¨¡å¼ç»“æ„**ï¼š

```
PatternStructure : Pattern â†’ Components
âˆ€pattern âˆˆ Pattern | PatternStructure(pattern) = {
  name: String,
  intent: Problem,
  motivation: Context,
  applicability: Conditions,
  structure: UML,
  participants: Classes,
  collaborations: Interactions,
  consequences: Tradeoffs
}
```

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Pattern : (Context, Problem, Solution) â†’ Design
âˆ€c âˆˆ Context, âˆ€p âˆˆ Problem, âˆ€s âˆˆ Solution | 
  Pattern(c, p, s) = {context: c, problem: p, solution: s}
```

> **å½¢å¼åŒ–ç†è®º**: å…³äºè®¾è®¡æ¨¡å¼çš„å½¢å¼åŒ–ç†è®ºï¼Œè¯·å‚è€ƒ [Rustå“²å­¦å½¢å¼åŒ–](../02_programming_paradigms/04_rust_philosophy_formalization.md) å’Œ [è®¾è®¡åŸåˆ™å½¢å¼åŒ–](../02_programming_paradigms/07_design_principles_formalization.md)ã€‚

### 1.2 åˆ†ç±»ä½“ç³»

**æŒ‰ç›®çš„åˆ†ç±»**ï¼š

```
PatternClassification : Pattern â†’ Category
âˆ€pattern âˆˆ Pattern | PatternClassification(pattern) âˆˆ {
  Creational, Structural, Behavioral
}
```

**æŒ‰èŒƒå›´åˆ†ç±»**ï¼š

```
PatternScope : Pattern â†’ Scope
âˆ€pattern âˆˆ Pattern | PatternScope(pattern) âˆˆ {
  Class, Object
}
```

**åˆ†ç±»å‡½æ•°**ï¼š

```
CategorizePattern : Pattern â†’ (Purpose, Scope)
âˆ€p âˆˆ Pattern | CategorizePattern(p) = 
  (p.purpose, p.scope)
```

> **è¯¦ç»†åˆ†ç±»**: å…³äºå„ç§æ¨¡å¼çš„è¯¦ç»†åˆ†ç±»ï¼Œè¯·å‚è€ƒ [åˆ›å»ºå‹æ¨¡å¼](../03_design_patterns/03_creational_patterns.md)ã€[ç»“æ„å‹æ¨¡å¼](../03_design_patterns/04_structural_patterns.md) å’Œ [è¡Œä¸ºå‹æ¨¡å¼](../03_design_patterns/05_behavioral_patterns.md)ã€‚

### 1.3 å½¢å¼åŒ–è¡¨è¾¾

**æ¨¡å¼å®ä¾‹åŒ–**ï¼š

```
PatternInstantiation : Pattern â†’ Instance
âˆ€pattern âˆˆ Pattern | PatternInstantiation(pattern) = 
  apply_pattern(pattern, concrete_context)
```

**æ¨¡å¼ç»„åˆ**ï¼š

```
PatternComposition : [Pattern] â†’ CompositePattern
âˆ€patterns âˆˆ [Pattern] | PatternComposition(patterns) = 
  combine_patterns(patterns)
```

> **é«˜çº§æ¨¡å¼**: å…³äºé«˜çº§æ¨¡å¼çš„å½¢å¼åŒ–ï¼Œè¯·å‚è€ƒ [åˆ›å»ºå‹æ¨¡å¼å½¢å¼åŒ–](../03_design_patterns/06_creational_patterns_formalization.md)ã€[ç»“æ„å‹æ¨¡å¼å½¢å¼åŒ–](../03_design_patterns/07_structural_patterns_formalization.md) å’Œ [è¡Œä¸ºå‹æ¨¡å¼å½¢å¼åŒ–](../03_design_patterns/08_behavioral_patterns_formalization.md)ã€‚

---

## 2. åˆ›å»ºå‹æ¨¡å¼ (Creational Patterns)

### 2.1 å•ä¾‹æ¨¡å¼ (Singleton)

**å®šä¹‰**ï¼šä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Singleton : Class â†’ Instance
âˆ€class âˆˆ Class | Singleton(class) = {
  instance: Option<Instance>,
  get_instance: () â†’ Instance
}
```

**çº¦æŸæ¡ä»¶**ï¼š

```
SingletonConstraints : Class â†’ Boolean
âˆ€class âˆˆ Class | SingletonConstraints(class) = 
  |instances(class)| = 1 âˆ§ 
  global_access(class) âˆ§ 
  lazy_initialization(class)
```

> **æ‰€æœ‰æƒåº”ç”¨**: å…³äºå•ä¾‹æ¨¡å¼ä¸­æ‰€æœ‰æƒç³»ç»Ÿçš„åº”ç”¨ï¼Œè¯·å‚è€ƒ [æ‰€æœ‰æƒç³»ç»Ÿå½¢å¼åŒ–](../08_rust_language_theory/01_ownership_system_formalization.md)ã€‚

**Rustå®ç°**ï¼š

```rust
use std::sync::{Mutex, Once, ONCE_INIT};
use std::mem;

#[derive(Debug)]
struct SingletonLogger {
    level: String,
}

static mut SINGLETON_INSTANCE: *const Mutex<SingletonLogger> = 0 as *const _;
static ONCE: Once = ONCE_INIT;

impl SingletonLogger {
    fn get_instance() -> &'static Mutex<SingletonLogger> {
        ONCE.call_once(|| {
            let singleton = Mutex::new(SingletonLogger {
                level: "INFO".to_string(),
            });
            unsafe {
                SINGLETON_INSTANCE = Box::into_raw(Box::new(singleton));
            }
        });
        unsafe { &*SINGLETON_INSTANCE }
    }

    fn log(&self, message: &str) {
        println!("[{}] {}", self.level, message);
    }
}
```

**å½¢å¼åŒ–éªŒè¯**ï¼š

```
Theorem: SingletonUniqueness
âˆ€s1, s2 âˆˆ SingletonInstance | s1 = s2
```

### 2.2 å·¥å‚æ–¹æ³•æ¨¡å¼ (Factory Method)

**å®šä¹‰**ï¼šå®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
FactoryMethod : Creator â†’ Product
âˆ€creator âˆˆ Creator | FactoryMethod(creator) = 
  creator.factory_method()
```

**ç±»å‹å…³ç³»**ï¼š

```
FactoryMethodTypes : (Creator, Product) â†’ Relationship
âˆ€creator âˆˆ Creator, âˆ€product âˆˆ Product | 
  FactoryMethodTypes(creator, product) = 
    creator â†’ product : creates
```

**Rustå®ç°**ï¼š

```rust
// äº§å“trait
trait Product {
    fn operation(&self) -> String;
}

// å…·ä½“äº§å“A
struct ConcreteProductA;
impl Product for ConcreteProductA {
    fn operation(&self) -> String {
        "ConcreteProductA operation".to_string()
    }
}

// å…·ä½“äº§å“B
struct ConcreteProductB;
impl Product for ConcreteProductB {
    fn operation(&self) -> String {
        "ConcreteProductB operation".to_string()
    }
}

// åˆ›å»ºè€…trait
trait Creator {
    type ProductType: Product;
    fn factory_method(&self) -> Self::ProductType;
}

// å…·ä½“åˆ›å»ºè€…A
struct ConcreteCreatorA;
impl Creator for ConcreteCreatorA {
    type ProductType = ConcreteProductA;
    fn factory_method(&self) -> Self::ProductType {
        ConcreteProductA
    }
}

// å…·ä½“åˆ›å»ºè€…B
struct ConcreteCreatorB;
impl Creator for ConcreteCreatorB {
    type ProductType = ConcreteProductB;
    fn factory_method(&self) -> Self::ProductType {
        ConcreteProductB
    }
}
```

### 2.3 æŠ½è±¡å·¥å‚æ¨¡å¼ (Abstract Factory)

**å®šä¹‰**ï¼šæä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬çš„å…·ä½“ç±»ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
AbstractFactory : Factory â†’ ProductFamily
âˆ€factory âˆˆ Factory | AbstractFactory(factory) = 
  {product_a: factory.create_product_a(),
   product_b: factory.create_product_b()}
```

**äº§å“æ—çº¦æŸ**ï¼š

```
ProductFamilyConstraint : ProductFamily â†’ Boolean
âˆ€family âˆˆ ProductFamily | ProductFamilyConstraint(family) = 
  compatible(family.product_a, family.product_b)
```

### 2.4 å»ºé€ è€…æ¨¡å¼ (Builder)

**å®šä¹‰**ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Builder : Builder â†’ Product
âˆ€builder âˆˆ Builder | Builder(builder) = 
  builder.build()
```

**æ„å»ºè¿‡ç¨‹**ï¼š

```
BuildProcess : Builder â†’ [Step]
âˆ€builder âˆˆ Builder | BuildProcess(builder) = 
  [step_1, step_2, ..., step_n]
```

### 2.5 åŸå‹æ¨¡å¼ (Prototype)

**å®šä¹‰**ï¼šç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡å¤åˆ¶è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Prototype : Prototype â†’ Clone
âˆ€prototype âˆˆ Prototype | Prototype(prototype) = 
  prototype.clone()
```

**å…‹éš†æ“ä½œ**ï¼š

```
CloneOperation : Object â†’ Object
âˆ€obj âˆˆ Object | CloneOperation(obj) = 
  deep_copy(obj) âˆ¨ shallow_copy(obj)
```

---

## 3. ç»“æ„å‹æ¨¡å¼ (Structural Patterns)

### 3.1 é€‚é…å™¨æ¨¡å¼ (Adapter)

**å®šä¹‰**ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Adapter : (Target, Adaptee) â†’ Adapted
âˆ€target âˆˆ Target, âˆ€adaptee âˆˆ Adaptee | 
  Adapter(target, adaptee) = adapt_interface(adaptee, target)
```

**æ¥å£æ˜ å°„**ï¼š

```
InterfaceMapping : (SourceInterface, TargetInterface) â†’ Mapping
âˆ€source âˆˆ SourceInterface, âˆ€target âˆˆ TargetInterface | 
  InterfaceMapping(source, target) = 
    {source.method â†’ target.method}
```

### 3.2 æ¡¥æ¥æ¨¡å¼ (Bridge)

**å®šä¹‰**ï¼šå°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Bridge : (Abstraction, Implementation) â†’ Bridge
âˆ€abstraction âˆˆ Abstraction, âˆ€implementation âˆˆ Implementation | 
  Bridge(abstraction, implementation) = 
    {abstraction, implementation, bridge_method}
```

**è§£è€¦å…³ç³»**ï¼š

```
Decoupling : (Abstraction, Implementation) â†’ Boolean
âˆ€abs âˆˆ Abstraction, âˆ€impl âˆˆ Implementation | 
  Decoupling(abs, impl) = independent(abs, impl)
```

### 3.3 ç»„åˆæ¨¡å¼ (Composite)

**å®šä¹‰**ï¼šå°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º"éƒ¨åˆ†-æ•´ä½“"çš„å±‚æ¬¡ç»“æ„ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Composite : Component â†’ Tree
âˆ€component âˆˆ Component | Composite(component) = 
  if is_leaf(component) then leaf(component)
  else node(component, children(component))
```

**æ ‘ç»“æ„**ï¼š

```
TreeStructure : Component â†’ Structure
âˆ€component âˆˆ Component | TreeStructure(component) = {
  root: component,
  children: [Component],
  operations: [Operation]
}
```

### 3.4 è£…é¥°å™¨æ¨¡å¼ (Decorator)

**å®šä¹‰**ï¼šåŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Decorator : (Component, Decorator) â†’ DecoratedComponent
âˆ€component âˆˆ Component, âˆ€decorator âˆˆ Decorator | 
  Decorator(component, decorator) = 
    decorator.wrap(component)
```

**è£…é¥°é“¾**ï¼š

```
DecorationChain : [Decorator] â†’ Component â†’ DecoratedComponent
âˆ€decorators âˆˆ [Decorator], âˆ€component âˆˆ Component | 
  DecorationChain(decorators, component) = 
    fold(decorators, component, |acc, d| d.wrap(acc))
```

### 3.5 å¤–è§‚æ¨¡å¼ (Facade)

**å®šä¹‰**ï¼šä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Facade : Subsystem â†’ Interface
âˆ€subsystem âˆˆ Subsystem | Facade(subsystem) = 
  unified_interface(subsystem)
```

**ç®€åŒ–æ¥å£**ï¼š

```
SimplifiedInterface : ComplexInterface â†’ SimpleInterface
âˆ€complex âˆˆ ComplexInterface | SimplifiedInterface(complex) = 
  {essential_methods(complex)}
```

### 3.6 äº«å…ƒæ¨¡å¼ (Flyweight)

**å®šä¹‰**ï¼šè¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡çš„å¤ç”¨ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Flyweight : (IntrinsicState, ExtrinsicState) â†’ Flyweight
âˆ€intrinsic âˆˆ IntrinsicState, âˆ€extrinsic âˆˆ ExtrinsicState | 
  Flyweight(intrinsic, extrinsic) = 
    {shared: intrinsic, unique: extrinsic}
```

**å…±äº«æ± **ï¼š

```
SharedPool : Flyweight â†’ Pool
âˆ€flyweight âˆˆ Flyweight | SharedPool(flyweight) = 
  pool.get_or_create(flyweight.intrinsic_state)
```

### 3.7 ä»£ç†æ¨¡å¼ (Proxy)

**å®šä¹‰**ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Proxy : Subject â†’ ControlledAccess
âˆ€subject âˆˆ Subject | Proxy(subject) = 
  {access_control, subject}
```

**è®¿é—®æ§åˆ¶**ï¼š

```
AccessControl : (Subject, Client) â†’ Permission
âˆ€subject âˆˆ Subject, âˆ€client âˆˆ Client | 
  AccessControl(subject, client) = 
    check_permission(client, subject)
```

---

## 4. è¡Œä¸ºå‹æ¨¡å¼ (Behavioral Patterns)

### 4.1 è´£ä»»é“¾æ¨¡å¼ (Chain of Responsibility)

**å®šä¹‰**ï¼šä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
ChainOfResponsibility : [Handler] â†’ Request â†’ Response
âˆ€handlers âˆˆ [Handler], âˆ€request âˆˆ Request | 
  ChainOfResponsibility(handlers, request) = 
    process_chain(handlers, request)
```

**å¤„ç†é“¾**ï¼š

```
ProcessingChain : Handler â†’ Handler
âˆ€handler âˆˆ Handler | ProcessingChain(handler) = 
  if can_handle(handler, request) then handle(handler, request)
  else next_handler(handler).process(request)
```

### 4.2 å‘½ä»¤æ¨¡å¼ (Command)

**å®šä¹‰**ï¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿ä½ å¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Command : (Receiver, Action) â†’ Command
âˆ€receiver âˆˆ Receiver, âˆ€action âˆˆ Action | 
  Command(receiver, action) = 
    {execute: Î»() â†’ action(receiver)}
```

**å‘½ä»¤æ‰§è¡Œ**ï¼š

```
CommandExecution : Command â†’ Result
âˆ€command âˆˆ Command | CommandExecution(command) = 
  command.execute()
```

### 4.3 è§£é‡Šå™¨æ¨¡å¼ (Interpreter)

**å®šä¹‰**ï¼šç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥è¡¨ç¤ºæ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Interpreter : (Grammar, Expression) â†’ Result
âˆ€grammar âˆˆ Grammar, âˆ€expression âˆˆ Expression | 
  Interpreter(grammar, expression) = 
    interpret(grammar, expression)
```

**è¯­æ³•æ ‘**ï¼š

```
SyntaxTree : Expression â†’ Tree
âˆ€expression âˆˆ Expression | SyntaxTree(expression) = 
  parse(expression)
```

### 4.4 è¿­ä»£å™¨æ¨¡å¼ (Iterator)

**å®šä¹‰**ï¼šæä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²å…¶å†…éƒ¨çš„è¡¨ç¤ºã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Iterator : Aggregate â†’ Iterator
âˆ€aggregate âˆˆ Aggregate | Iterator(aggregate) = 
  aggregate.create_iterator()
```

**è¿­ä»£æ“ä½œ**ï¼š

```
IterationOperations : Iterator â†’ Operations
âˆ€iterator âˆˆ Iterator | IterationOperations(iterator) = {
  next: () â†’ Option<Element>,
  has_next: () â†’ Boolean,
  reset: () â†’ Unit
}
```

### 4.5 ä¸­ä»‹è€…æ¨¡å¼ (Mediator)

**å®šä¹‰**ï¼šç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Mediator : [Colleague] â†’ Mediator
âˆ€colleagues âˆˆ [Colleague] | Mediator(colleagues) = 
  {mediate: Î»(from, to, message) â†’ route_message(from, to, message)}
```

**æ¶ˆæ¯è·¯ç”±**ï¼š

```
MessageRouting : (From, To, Message) â†’ RoutedMessage
âˆ€from âˆˆ Colleague, âˆ€to âˆˆ Colleague, âˆ€message âˆˆ Message | 
  MessageRouting(from, to, message) = 
    mediator.route(from, to, message)
```

### 4.6 å¤‡å¿˜å½•æ¨¡å¼ (Memento)

**å®šä¹‰**ï¼šåœ¨ä¸ç ´åå°è£…çš„å‰æä¸‹ï¼Œæ•è·å¹¶å¤–éƒ¨åŒ–å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Memento : Originator â†’ Memento
âˆ€originator âˆˆ Originator | Memento(originator) = 
  {state: originator.get_state()}
```

**çŠ¶æ€ä¿å­˜**ï¼š

```
StatePreservation : Originator â†’ Memento
âˆ€originator âˆˆ Originator | StatePreservation(originator) = 
  save_state(originator)
```

### 4.7 è§‚å¯Ÿè€…æ¨¡å¼ (Observer)

**å®šä¹‰**ï¼šå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Observer : (Subject, [Observer]) â†’ Notification
âˆ€subject âˆˆ Subject, âˆ€observers âˆˆ [Observer] | 
  Observer(subject, observers) = 
    notify_all(subject, observers)
```

**é€šçŸ¥æœºåˆ¶**ï¼š

```
NotificationMechanism : Subject â†’ [Observer] â†’ Unit
âˆ€subject âˆˆ Subject, âˆ€observers âˆˆ [Observer] | 
  NotificationMechanism(subject, observers) = 
    for observer in observers { observer.update(subject.state) }
```

### 4.8 çŠ¶æ€æ¨¡å¼ (State)

**å®šä¹‰**ï¼šå…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
State : Context â†’ State
âˆ€context âˆˆ Context | State(context) = 
  context.current_state
```

**çŠ¶æ€è½¬æ¢**ï¼š

```
StateTransition : (Context, Event) â†’ NewState
âˆ€context âˆˆ Context, âˆ€event âˆˆ Event | 
  StateTransition(context, event) = 
    context.current_state.handle(event)
```

### 4.9 ç­–ç•¥æ¨¡å¼ (Strategy)

**å®šä¹‰**ï¼šå®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Strategy : [Algorithm] â†’ Context
âˆ€algorithms âˆˆ [Algorithm] | Strategy(algorithms) = 
  {execute: Î»(algorithm) â†’ algorithm.compute()}
```

**ç®—æ³•é€‰æ‹©**ï¼š

```
AlgorithmSelection : Context â†’ Algorithm
âˆ€context âˆˆ Context | AlgorithmSelection(context) = 
  context.select_algorithm()
```

### 4.10 æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method)

**å®šä¹‰**ï¼šå®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
TemplateMethod : AbstractClass â†’ Template
âˆ€abstract_class âˆˆ AbstractClass | TemplateMethod(abstract_class) = 
  {template_method: Î»() â†’ {
    step1(),
    step2(),
    step3()
  }}
```

**æ­¥éª¤å®šä¹‰**ï¼š

```
StepDefinition : AbstractClass â†’ [Step]
âˆ€abstract_class âˆˆ AbstractClass | StepDefinition(abstract_class) = 
  [abstract_class.step1, abstract_class.step2, abstract_class.step3]
```

### 4.11 è®¿é—®è€…æ¨¡å¼ (Visitor)

**å®šä¹‰**ï¼šè¡¨ç¤ºä¸€ä¸ªä½œç”¨äºæŸå¯¹è±¡ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œã€‚

**å½¢å¼åŒ–è¡¨è¾¾**ï¼š

```
Visitor : (Visitor, Element) â†’ Result
âˆ€visitor âˆˆ Visitor, âˆ€element âˆˆ Element | 
  Visitor(visitor, element) = 
    element.accept(visitor)
```

**åŒé‡åˆ†å‘**ï¼š

```
DoubleDispatch : (Visitor, Element) â†’ Operation
âˆ€visitor âˆˆ Visitor, âˆ€element âˆˆ Element | 
  DoubleDispatch(visitor, element) = 
    element.accept(visitor) âˆ§ visitor.visit(element)
```

---

## ç»“è®º

åŸºç¡€è®¾è®¡æ¨¡å¼ä¸ºè½¯ä»¶è®¾è®¡æä¾›äº†ç»è¿‡éªŒè¯çš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å½¢å¼åŒ–çš„è¡¨è¾¾å’ŒRustçš„å…·ä½“å®ç°ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è¿™äº›æ¨¡å¼ã€‚

**æ ¸å¿ƒè®¾è®¡åŸåˆ™**ï¼š

1. å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
2. å•ä¸€èŒè´£åŸåˆ™ï¼šä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªèŒè´£
3. é‡Œæ°æ›¿æ¢åŸåˆ™ï¼šå­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»
4. æ¥å£éš”ç¦»åŸåˆ™ï¼šå®¢æˆ·ç«¯ä¸åº”ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£
5. ä¾èµ–å€’ç½®åŸåˆ™ï¼šä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°

è¿™äº›æ¨¡å¼ä¸ºåç»­çš„é«˜çº§è®¾è®¡æ¨¡å¼ã€å¹¶å‘æ¨¡å¼å’Œåˆ†å¸ƒå¼æ¨¡å¼æä¾›äº†åŸºç¡€ã€‚
