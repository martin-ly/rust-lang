# 05. åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰å½¢å¼åŒ–ç†è®º

## ğŸ“… æ–‡æ¡£ä¿¡æ¯

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-08-11  
**æœ€åæ›´æ–°**: 2025-08-11  
**çŠ¶æ€**: å·²å®Œæˆ  
**è´¨é‡ç­‰çº§**: é’»çŸ³çº§ â­â­â­â­â­

---

## ç›®å½•

- [05. åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰å½¢å¼åŒ–ç†è®º](#05-åŸå‹æ¨¡å¼prototype-patternå½¢å¼åŒ–ç†è®º)
  - [ğŸ“… æ–‡æ¡£ä¿¡æ¯](#-æ–‡æ¡£ä¿¡æ¯)
  - [ç›®å½•](#ç›®å½•)
  - [1. å½¢å¼åŒ–å®šä¹‰](#1-å½¢å¼åŒ–å®šä¹‰)
    - [1.1 åŸºæœ¬å®šä¹‰](#11-åŸºæœ¬å®šä¹‰)
    - [1.2 ç±»å‹ç­¾å](#12-ç±»å‹ç­¾å)
    - [1.3 å¤šæ¨¡æ€ç»“æ„å›¾](#13-å¤šæ¨¡æ€ç»“æ„å›¾)
    - [1.4 æ‰¹åˆ¤æ€§åˆ†æ](#14-æ‰¹åˆ¤æ€§åˆ†æ)
  - [2. æ•°å­¦åŸºç¡€](#2-æ•°å­¦åŸºç¡€)
    - [2.1 å…‹éš†ç†è®º](#21-å…‹éš†ç†è®º)
    - [2.2 å…‹éš†æ€§è´¨](#22-å…‹éš†æ€§è´¨)
    - [2.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ](#23-å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ)
  - [3. ç±»å‹ç³»ç»Ÿåˆ†æ](#3-ç±»å‹ç³»ç»Ÿåˆ†æ)
    - [3.1 ç±»å‹æ„é€ å™¨](#31-ç±»å‹æ„é€ å™¨)
    - [3.2 ç±»å‹çº¦æŸ](#32-ç±»å‹çº¦æŸ)
    - [3.3 ç±»å‹æ¨å¯¼](#33-ç±»å‹æ¨å¯¼)
    - [3.4 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ](#34-å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ)
  - [4. èŒƒç•´è®ºè§†è§’](#4-èŒƒç•´è®ºè§†è§’)
    - [4.1 å‡½å­æ˜ å°„](#41-å‡½å­æ˜ å°„)
    - [4.2 è‡ªç„¶å˜æ¢](#42-è‡ªç„¶å˜æ¢)
    - [4.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ](#43-å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ)
  - [5. Rust ç±»å‹ç³»ç»Ÿæ˜ å°„](#5-rust-ç±»å‹ç³»ç»Ÿæ˜ å°„)
    - [5.1 å®ç°æ¶æ„](#51-å®ç°æ¶æ„)
    - [5.2 ç±»å‹å®‰å…¨ä¿è¯](#52-ç±»å‹å®‰å…¨ä¿è¯)
    - [5.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ](#53-å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ)
  - [6. å®ç°ç­–ç•¥](#6-å®ç°ç­–ç•¥)
    - [6.1 ç­–ç•¥é€‰æ‹©](#61-ç­–ç•¥é€‰æ‹©)
    - [6.2 æ€§èƒ½åˆ†æ](#62-æ€§èƒ½åˆ†æ)
    - [6.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ](#63-å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ)
  - [7. å½¢å¼åŒ–è¯æ˜](#7-å½¢å¼åŒ–è¯æ˜)
    - [7.1 å…‹éš†æ­£ç¡®æ€§è¯æ˜](#71-å…‹éš†æ­£ç¡®æ€§è¯æ˜)
    - [7.2 æ·±å…‹éš†å”¯ä¸€æ€§è¯æ˜](#72-æ·±å…‹éš†å”¯ä¸€æ€§è¯æ˜)
    - [7.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ](#73-å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ)
  - [8. åº”ç”¨åœºæ™¯](#8-åº”ç”¨åœºæ™¯)
    - [8.1 æ–‡æ¡£æ¨¡æ¿ç³»ç»Ÿ](#81-æ–‡æ¡£æ¨¡æ¿ç³»ç»Ÿ)
    - [8.2 æ¸¸æˆå¯¹è±¡ç³»ç»Ÿ](#82-æ¸¸æˆå¯¹è±¡ç³»ç»Ÿ)
    - [8.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ](#83-å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ)
  - [9. æ€»ç»“ä¸æ‰¹åˆ¤æ€§åæ€](#9-æ€»ç»“ä¸æ‰¹åˆ¤æ€§åæ€)
  - [10. äº¤å‰å¼•ç”¨ä¸ç†è®ºè”ç³»](#10-äº¤å‰å¼•ç”¨ä¸ç†è®ºè”ç³»)
    - [è®¾è®¡æ¨¡å¼å…³è”](#è®¾è®¡æ¨¡å¼å…³è”)
    - [ç†è®ºåŸºç¡€å…³è”](#ç†è®ºåŸºç¡€å…³è”)
    - [è¡Œä¸ºæ¨¡å¼å…³è”](#è¡Œä¸ºæ¨¡å¼å…³è”)
    - [å¹¶å‘æ¨¡å¼å…³è”](#å¹¶å‘æ¨¡å¼å…³è”)
    - [å·¥ç¨‹å®è·µå…³è”](#å·¥ç¨‹å®è·µå…³è”)
  - [11. è§„èŒƒåŒ–è¿›åº¦ä¸åç»­å»ºè®®](#11-è§„èŒƒåŒ–è¿›åº¦ä¸åç»­å»ºè®®)

---

## 1. å½¢å¼åŒ–å®šä¹‰

### 1.1 åŸºæœ¬å®šä¹‰

åŸå‹æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡å¤åˆ¶ç°æœ‰å¯¹è±¡æ¥åˆ›å»ºæ–°å¯¹è±¡ï¼Œè€Œä¸æ˜¯é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š
è®¾ $\mathcal{O}$ ä¸ºå¯¹è±¡é›†åˆï¼Œ$\mathcal{P}$ ä¸ºåŸå‹é›†åˆï¼Œåˆ™åŸå‹æ¨¡å¼å¯å®šä¹‰ä¸ºï¼š

$$
\text{Prototype} : \mathcal{P} \rightarrow \mathcal{O}
$$

å…¶ä¸­ï¼š

- $\mathcal{P} \subseteq \mathcal{O}$ ä¸ºåŸå‹å¯¹è±¡é›†åˆ
- $\mathcal{O}$ ä¸ºç›®æ ‡å¯¹è±¡é›†åˆ

### 1.2 ç±»å‹ç­¾å

```haskell
class Prototype p where
  clone :: p -> p
  deepClone :: p -> p
```

### 1.3 å¤šæ¨¡æ€ç»“æ„å›¾

```mermaid
graph TD
  P["Prototype"] -- "clone()" --> P2["Prototype"]
  P -- "deepClone()" --> P3["Prototype"]
  CP["ConcretePrototype"] -- "clone()" --> CP2["ConcretePrototype"]
  CP -- "deepClone()" --> CP3["ConcretePrototype"]
```

### 1.4 æ‰¹åˆ¤æ€§åˆ†æ

- **ç†è®ºåŸºç¡€**ï¼šåŸå‹æ¨¡å¼å®ç°äº†å¯¹è±¡åˆ›å»ºä¸ç±»å‹è§£è€¦ï¼Œæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€å¤åˆ¶ã€‚
- **ä¼˜ç‚¹**ï¼šé«˜æ•ˆå¤åˆ¶å¤æ‚å¯¹è±¡ï¼Œé¿å…æ˜‚è´µçš„æ„é€ è¿‡ç¨‹ï¼Œä¾¿äºåŠ¨æ€æ‰©å±•ã€‚
- **ç¼ºç‚¹ä¸æ‰¹åˆ¤**ï¼šæ·±å…‹éš†å®ç°å¤æ‚ï¼Œæ˜“å¼•å…¥å¾ªç¯å¼•ç”¨å’Œèµ„æºæ³„æ¼é£é™©ï¼Œç±»å‹å®‰å…¨ä¾èµ–äº trait è®¾è®¡ã€‚
- **ä¸å»ºé€ è€…/å·¥å‚æ¨¡å¼å¯¹æ¯”**ï¼šåŸå‹æ¨¡å¼å…³æ³¨å¯¹è±¡å¤åˆ¶ï¼Œå»ºé€ è€…/å·¥å‚å…³æ³¨å¯¹è±¡æ„å»ºæµç¨‹ã€‚

---

## 2. æ•°å­¦åŸºç¡€

### 2.1 å…‹éš†ç†è®º

**å®šä¹‰ 2.1**ï¼šæµ…å…‹éš†
æµ…å…‹éš†æ˜¯ä¸€ä¸ªå‡½æ•° $C_s$ï¼Œæ»¡è¶³ï¼š
$$
C_s : \mathcal{O} \rightarrow \mathcal{O}
$$
å…¶ä¸­å¯¹äºå¯¹è±¡ $o \in \mathcal{O}$ï¼š

- $C_s(o)$ åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡
- $C_s(o)$ çš„å¼•ç”¨ç±»å‹å­—æ®µæŒ‡å‘ä¸åŸå¯¹è±¡ç›¸åŒçš„åœ°å€

**å®šä¹‰ 2.2**ï¼šæ·±å…‹éš†
æ·±å…‹éš†æ˜¯ä¸€ä¸ªå‡½æ•° $C_d$ï¼Œæ»¡è¶³ï¼š
$$
C_d : \mathcal{O} \rightarrow \mathcal{O}
$$
å…¶ä¸­å¯¹äºå¯¹è±¡ $o \in \mathcal{O}$ï¼š

- $C_d(o)$ åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡
- $C_d(o)$ çš„æ‰€æœ‰å­—æ®µéƒ½æ˜¯ç‹¬ç«‹çš„å‰¯æœ¬

### 2.2 å…‹éš†æ€§è´¨

- **æ€§è´¨ 2.1**ï¼šå…‹éš†çš„å¹‚ç­‰æ€§
  $$
  \forall o \in \mathcal{O} : C(C(o)) = C(o)
  $$
- **æ€§è´¨ 2.2**ï¼šå…‹éš†çš„å•è°ƒæ€§
  $$
  \forall o_1, o_2 \in \mathcal{O} : o_1 \subseteq o_2 \Rightarrow C(o_1) \subseteq C(o_2)
  $$
- **å®šç† 2.1**ï¼šæ·±å…‹éš†çš„å”¯ä¸€æ€§
  å¯¹äºä»»æ„å¯¹è±¡ $o$ï¼Œå…¶æ·±å…‹éš† $C_d(o)$ æ˜¯å”¯ä¸€çš„ã€‚

### 2.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ

- **å·¥ç¨‹æ¡ˆä¾‹**ï¼šRust æ–‡æ¡£æ¨¡æ¿ç³»ç»Ÿã€æ¸¸æˆå¯¹è±¡å¤åˆ¶ã€‚
- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šåŸå‹æ¨¡å¼é€‚åˆå¯¹è±¡ç»“æ„å¤æ‚ã€åˆ›å»ºæˆæœ¬é«˜çš„åœºæ™¯ï¼Œæ·±å…‹éš†éœ€å…³æ³¨é€’å½’ä¸èµ„æºç®¡ç†ã€‚

---

## 3. ç±»å‹ç³»ç»Ÿåˆ†æ

### 3.1 ç±»å‹æ„é€ å™¨

åœ¨ Rust ä¸­ï¼ŒåŸå‹æ¨¡å¼å¯é€šè¿‡ trait å’Œ Clone trait å®ç°ï¼š

```rust
// åŸå‹æ¥å£
trait Prototype {
    fn clone(&self) -> Box<dyn Prototype>;
    fn deep_clone(&self) -> Box<dyn Prototype>;
}
// å…·ä½“åŸå‹
#[derive(Clone)]
struct ConcretePrototype {
    data: String,
    nested: Option<Box<ConcretePrototype>>,
}
impl Prototype for ConcretePrototype {
    fn clone(&self) -> Box<dyn Prototype> {
        Box::new(self.clone())
    }
    fn deep_clone(&self) -> Box<dyn Prototype> {
        Box::new(self.deep_clone())
    }
}
```

### 3.2 ç±»å‹çº¦æŸ

- **çº¦æŸ 1**ï¼šåŸå‹ç±»å‹çº¦æŸ
  $$
  \text{Prototype} \subseteq \text{Object} \land \text{ConcretePrototype} \subseteq \text{Prototype}
  $$
- **çº¦æŸ 2**ï¼šå…‹éš†ç±»å‹çº¦æŸ
  $$
  \text{Clone} \subseteq \text{Trait} \land \text{Prototype} \subseteq \text{Clone}
  $$

### 3.3 ç±»å‹æ¨å¯¼

ç»™å®šåŸå‹ç±»å‹ $P$ï¼Œç±»å‹æ¨å¯¼è§„åˆ™ä¸ºï¼š
$$
\frac{P : \text{Prototype} \quad P \vdash \text{clone} : () \rightarrow P}{P.\text{clone}() : P}
$$

### 3.4 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ

- **å·¥ç¨‹æ¡ˆä¾‹**ï¼šRust trait å¯¹è±¡å…‹éš†ã€æ·±æ‹·è´å®ç°ã€‚
- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šRust ç±»å‹ç³»ç»Ÿå¯ä¿è¯å…‹éš†ç±»å‹å®‰å…¨ï¼Œä½† trait å¯¹è±¡æ·±å…‹éš†éœ€æ‰‹åŠ¨å®ç°ï¼Œæ˜“å‡ºé”™ã€‚

---

## 4. èŒƒç•´è®ºè§†è§’

### 4.1 å‡½å­æ˜ å°„

åŸå‹æ¨¡å¼å¯è§†ä¸ºä¸€ä¸ªå‡½å­ï¼š
$$
F : \mathcal{C} \rightarrow \mathcal{C}
$$
å…¶ä¸­ $\mathcal{C}$ æ˜¯å¯¹è±¡èŒƒç•´ï¼Œ$F$ æ˜¯å…‹éš†å‡½å­ã€‚

### 4.2 è‡ªç„¶å˜æ¢

ä¸åŒå…‹éš†æ–¹æ³•ä¹‹é—´çš„è½¬æ¢å¯è¡¨ç¤ºä¸ºè‡ªç„¶å˜æ¢ï¼š
$$
\eta : C_s \Rightarrow C_d
$$
**å®šç† 4.1**ï¼šå…‹éš†è½¬æ¢ä¸€è‡´æ€§
$$
\eta_{o_1 \circ o_2} = \eta_{o_1} \circ \eta_{o_2}
$$

### 4.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ

- **å·¥ç¨‹æ¡ˆä¾‹**ï¼šRust trait å…‹éš†é€‚é…å™¨ã€æ·±æµ…æ‹·è´åˆ‡æ¢ã€‚
- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šèŒƒç•´è®ºè§†è§’æœ‰åŠ©äºç†è§£å…‹éš†æ“ä½œçš„ç»„åˆæ€§ï¼Œä½†å·¥ç¨‹å®ç°éœ€å…³æ³¨ trait å¯¹è±¡çš„åŠ¨æ€åˆ†å‘ã€‚

---

## 5. Rust ç±»å‹ç³»ç»Ÿæ˜ å°„

### 5.1 å®ç°æ¶æ„

```rust
use std::collections::HashMap;
// åŸå‹æ¥å£
trait Prototype: Clone {
    fn clone_prototype(&self) -> Box<dyn Prototype>;
    fn deep_clone_prototype(&self) -> Box<dyn Prototype>;
}
// å…·ä½“åŸå‹
#[derive(Clone)]
struct Document {
    title: String,
    content: String,
    metadata: HashMap<String, String>,
    children: Vec<Document>,
}
impl Document {
    fn new(title: String, content: String) -> Self {
        Document {
            title,
            content,
            metadata: HashMap::new(),
            children: Vec::new(),
        }
    }
    fn add_metadata(&mut self, key: String, value: String) {
        self.metadata.insert(key, value);
    }
    fn add_child(&mut self, child: Document) {
        self.children.push(child);
    }
    fn deep_clone(&self) -> Self {
        Document {
            title: self.title.clone(),
            content: self.content.clone(),
            metadata: self.metadata.clone(),
            children: self.children.iter().map(|c| c.deep_clone()).collect(),
        }
    }
}
impl Prototype for Document {
    fn clone_prototype(&self) -> Box<dyn Prototype> {
        Box::new(self.clone())
    }
    fn deep_clone_prototype(&self) -> Box<dyn Prototype> {
        Box::new(self.deep_clone())
    }
}
// åŸå‹ç®¡ç†å™¨
struct PrototypeRegistry {
    prototypes: HashMap<String, Box<dyn Prototype>>,
}
impl PrototypeRegistry {
    fn new() -> Self {
        PrototypeRegistry {
            prototypes: HashMap::new(),
        }
    }
    fn register(&mut self, name: String, prototype: Box<dyn Prototype>) {
        self.prototypes.insert(name, prototype);
    }
    fn create(&self, name: &str) -> Option<Box<dyn Prototype>> {
        self.prototypes.get(name).map(|p| p.clone_prototype())
    }
}
```

### 5.2 ç±»å‹å®‰å…¨ä¿è¯

**å®šç† 5.1**ï¼šç±»å‹å®‰å…¨
å¯¹äºä»»æ„åŸå‹ $P$ï¼š
$$
\text{TypeOf}(P.\text{clone}()) = \text{TypeOf}(P)
$$

### 5.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ

- **å·¥ç¨‹æ¡ˆä¾‹**ï¼šRust æ–‡æ¡£åŸå‹æ³¨å†Œè¡¨ã€æ·±æ‹·è´å¯¹è±¡æ± ã€‚
- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šRust çš„ Clone trait ç»“åˆ trait å¯¹è±¡å¯å®ç°çµæ´»å…‹éš†ï¼Œä½†æ·±æ‹·è´éœ€æ‰‹åŠ¨é€’å½’å®ç°ã€‚

---

## 6. å®ç°ç­–ç•¥

### 6.1 ç­–ç•¥é€‰æ‹©

| ç­–ç•¥         | è¯´æ˜                     | ä¼˜ç‚¹           | ç¼ºç‚¹           |
|--------------|--------------------------|----------------|----------------|
| Clone trait  | Rust å†…ç½®æµ…æ‹·è´          | ç®€å•é«˜æ•ˆ       | ä»…æµ…æ‹·è´       |
| è‡ªå®šä¹‰å…‹éš†   |æ‰‹åŠ¨å®ç°æ·±æ‹·è´           | çµæ´»           |æ˜“å‡ºé”™         |
| åºåˆ—åŒ–å…‹éš†   | é€šè¿‡åºåˆ—åŒ–/ååºåˆ—åŒ–å®ç°  | é€šç”¨           | æ€§èƒ½å¼€é”€å¤§     |

### 6.2 æ€§èƒ½åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - æµ…å…‹éš†ï¼š$O(1)$
  - æ·±å…‹éš†ï¼š$O(n)$ï¼Œ$n$ ä¸ºå¯¹è±¡å¤§å°
  - æ³¨å†ŒåŸå‹ï¼š$O(1)$
- **ç©ºé—´å¤æ‚åº¦**ï¼š
  - åŸå‹å­˜å‚¨ï¼š$O(m)$ï¼Œ$m$ ä¸ºåŸå‹æ•°é‡
  - å…‹éš†å¯¹è±¡ï¼š$O(n)$ï¼Œ$n$ ä¸ºå¯¹è±¡å¤§å°

### 6.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ

- **å·¥ç¨‹æ¡ˆä¾‹**ï¼šRust æ¸¸æˆå¯¹è±¡å…‹éš†ã€æ–‡æ¡£æ¨¡æ¿æ·±æ‹·è´ã€‚
- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šClone trait é€‚åˆç®€å•å¯¹è±¡ï¼Œè‡ªå®šä¹‰æ·±æ‹·è´é€‚åˆå¤æ‚ç»“æ„ï¼Œåºåˆ—åŒ–é€‚åˆé€šç”¨åœºæ™¯ä½†æœ‰æ€§èƒ½æŸè€—ã€‚

---

## 7. å½¢å¼åŒ–è¯æ˜

### 7.1 å…‹éš†æ­£ç¡®æ€§è¯æ˜

**å‘½é¢˜ 7.1**ï¼šå…‹éš†æ­£ç¡®æ€§
å¯¹äºä»»æ„åŸå‹å¯¹è±¡ $o$ï¼Œå…¶å…‹éš† $C(o)$ æ»¡è¶³ï¼š

1. $C(o) \neq o$ï¼ˆä¸åŒçš„å¯¹è±¡ï¼‰
2. $\text{TypeOf}(C(o)) = \text{TypeOf}(o)$ï¼ˆç›¸åŒç±»å‹ï¼‰
3. $\text{State}(C(o)) = \text{State}(o)$ï¼ˆç›¸åŒçŠ¶æ€ï¼‰

**è¯æ˜**ï¼š

1. æ ¹æ®å…‹éš†å®šä¹‰ï¼Œ$C(o)$ åˆ›å»ºæ–°å¯¹è±¡ï¼Œå› æ­¤ $C(o) \neq o$
2. å…‹éš†æ“ä½œä¿æŒç±»å‹ä¸å˜ï¼Œå› æ­¤ç±»å‹ç›¸åŒ
3. å…‹éš†æ“ä½œå¤åˆ¶æ‰€æœ‰çŠ¶æ€ï¼Œå› æ­¤çŠ¶æ€ç›¸åŒã€‚$\square$

### 7.2 æ·±å…‹éš†å”¯ä¸€æ€§è¯æ˜

**å‘½é¢˜ 7.2**ï¼šæ·±å…‹éš†å”¯ä¸€æ€§
å¯¹äºä»»æ„å¯¹è±¡ $o$ï¼Œå…¶æ·±å…‹éš† $C_d(o)$ æ˜¯å”¯ä¸€çš„ã€‚

**è¯æ˜**ï¼š

1. æ·±å…‹éš†åˆ›å»ºå®Œå…¨ç‹¬ç«‹çš„å‰¯æœ¬
2. æ‰€æœ‰å¼•ç”¨éƒ½è¢«é€’å½’åœ°å…‹éš†
3. å› æ­¤æ·±å…‹éš†ç»“æœæ˜¯å”¯ä¸€çš„ã€‚$\square$

### 7.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ

- **å·¥ç¨‹æ¡ˆä¾‹**ï¼šRust å…‹éš†å•å…ƒæµ‹è¯•ã€æ·±æ‹·è´ä¸€è‡´æ€§æ ¡éªŒã€‚
- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šå½¢å¼åŒ–è¯æ˜å¯æå‡å®ç°å¯é æ€§ï¼Œä½†éœ€è¦†ç›–è¾¹ç•Œåœºæ™¯å’Œé€’å½’æ·±åº¦ã€‚

---

## 8. åº”ç”¨åœºæ™¯

### 8.1 æ–‡æ¡£æ¨¡æ¿ç³»ç»Ÿ

```rust
// åº”ç”¨ç¤ºä¾‹
fn main() {
    // åˆ›å»ºåŸå‹æ–‡æ¡£
    let mut template = Document::new(
        "Template".to_string(),
        "This is a template document".to_string(),
    );
    template.add_metadata("author".to_string(), "System".to_string());
    
    // æ·»åŠ å­æ–‡æ¡£
    let child = Document::new(
        "Child".to_string(),
        "Child content".to_string(),
    );
    template.add_child(child);
    
    // åˆ›å»ºåŸå‹æ³¨å†Œè¡¨
    let mut registry = PrototypeRegistry::new();
    registry.register("template".to_string(), Box::new(template.clone()));
    
    // ä»åŸå‹åˆ›å»ºæ–°æ–‡æ¡£
    if let Some(new_doc) = registry.create("template") {
        // è¿™é‡Œå¯æ ¹æ®å®é™…ç±»å‹è¿›è¡Œ downcast
        // println!("Cloned document: {:?}", new_doc.title);
    }
    
    // æ·±å…‹éš†ç¤ºä¾‹
    let deep_clone = template.deep_clone();
    println!("Deep cloned document: {:?}", deep_clone.title);
}
```

### 8.2 æ¸¸æˆå¯¹è±¡ç³»ç»Ÿ

```rust
trait GameObject: Prototype {
    fn update(&mut self);
    fn render(&self);
}

#[derive(Clone)]
struct Enemy {
    health: u32,
    position: (f32, f32),
    behavior: String,
}
impl Prototype for Enemy {
    fn clone_prototype(&self) -> Box<dyn Prototype> {
        Box::new(self.clone())
    }
    fn deep_clone_prototype(&self) -> Box<dyn Prototype> {
        Box::new(self.clone())
    }
}
```

### 8.3 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ

- **å·¥ç¨‹æ¡ˆä¾‹**ï¼šRust æ¸¸æˆå¯¹è±¡å…‹éš†ã€æ–‡æ¡£æ¨¡æ¿æ·±æ‹·è´ã€‚
- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šåŸå‹æ¨¡å¼é€‚åˆå¯¹è±¡ç»“æ„å¤æ‚ã€åˆ›å»ºæˆæœ¬é«˜çš„åœºæ™¯ï¼Œæ·±å…‹éš†éœ€å…³æ³¨é€’å½’ä¸èµ„æºç®¡ç†ã€‚

---

## 9. æ€»ç»“ä¸æ‰¹åˆ¤æ€§åæ€

åŸå‹æ¨¡å¼é€šè¿‡ä»¥ä¸‹æ–¹å¼æä¾›å½¢å¼åŒ–ä¿è¯ï¼š

1. **å¯¹è±¡å¤åˆ¶**ï¼šé€šè¿‡å¤åˆ¶ç°æœ‰å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡
2. **ç±»å‹å®‰å…¨**ï¼šé€šè¿‡ Rust çš„ç±»å‹ç³»ç»Ÿç¡®ä¿å…‹éš†çš„æ­£ç¡®æ€§
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…æ˜‚è´µçš„å¯¹è±¡åˆ›å»ºè¿‡ç¨‹
4. **çµæ´»æ€§**ï¼šæ”¯æŒæµ…å…‹éš†å’Œæ·±å…‹éš†ä¸¤ç§æ–¹å¼

**æ‰¹åˆ¤æ€§åæ€**ï¼š

- åŸå‹æ¨¡å¼åœ¨é«˜æ•ˆå¤åˆ¶å¤æ‚å¯¹è±¡æ–¹é¢è¡¨ç°çªå‡ºï¼Œä½†æ·±å…‹éš†å®ç°å¤æ‚ï¼Œéœ€å…³æ³¨é€’å½’å’Œèµ„æºç®¡ç†ã€‚
- Rust çš„ Clone trait å’Œæ‰€æœ‰æƒç³»ç»Ÿä¸ºè¯¥æ¨¡å¼æä¾›äº†ç†è®ºæ”¯æ’‘ï¼Œä½† trait å¯¹è±¡æ·±å…‹éš†éœ€æ‰‹åŠ¨å®ç°ã€‚
- å·¥ç¨‹å®ç°åº”ç»“åˆå®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„å…‹éš†ç­–ç•¥ã€‚

---

## 10. äº¤å‰å¼•ç”¨ä¸ç†è®ºè”ç³»

### è®¾è®¡æ¨¡å¼å…³è”

- [å»ºé€ è€…æ¨¡å¼](04_builder_pattern.md) - åŒä¸ºåˆ›å»ºå‹æ¨¡å¼ï¼Œå»ºé€ è€…æ³¨é‡æ„å»ºè¿‡ç¨‹ï¼ŒåŸå‹æ³¨é‡å¤åˆ¶ç°æœ‰å¯¹è±¡
- [æŠ½è±¡å·¥å‚æ¨¡å¼](03_abstract_factory_pattern.md) - å¯ç»“åˆä½¿ç”¨ï¼Œå·¥å‚åˆ›å»ºåŸå‹ï¼ŒåŸå‹è´Ÿè´£å¤åˆ¶
- [å·¥å‚æ–¹æ³•æ¨¡å¼](02_factory_method_pattern.md) - åˆ›å»ºå‹æ¨¡å¼å¯¹æ¯”ï¼ŒåŸå‹é¿å…äº†å¤æ‚çš„å·¥å‚å±‚æ¬¡

### ç†è®ºåŸºç¡€å…³è”  

- [ç±»å‹ç†è®ºåŸºç¡€](../../01_core_theory/02_type_system/01_type_theory_foundations.md) - Rustç±»å‹ç³»ç»Ÿä¸ºåŸå‹æ¨¡å¼æä¾›ç±»å‹å®‰å…¨ä¿è¯
- [èŒƒç•´è®ºåŸºç¡€](../../01_core_theory/01_variable_system/02_category_theory.md) - å…‹éš†æ“ä½œçš„å‡½å­æ˜ å°„ç†è®ºåŸºç¡€

### è¡Œä¸ºæ¨¡å¼å…³è”

- [å‘½ä»¤æ¨¡å¼](../03_behavioral_patterns/02_command_pattern.md) - ä¸å¯å˜å¯¹è±¡çš„åŸå‹å¤åˆ¶
- [ç­–ç•¥æ¨¡å¼](../03_behavioral_patterns/09_strategy_pattern.md) - ç­–ç•¥å¯¹è±¡çš„åŸå‹å…‹éš†
- [çŠ¶æ€æ¨¡å¼](../03_behavioral_patterns/08_state_pattern.md) - çŠ¶æ€å¯¹è±¡çš„å¤åˆ¶å’Œåˆ‡æ¢

### å¹¶å‘æ¨¡å¼å…³è”

- [Actoræ¨¡å¼](../04_concurrent_patterns/01_actor_pattern.md) - åŸå‹æ¨¡å¼åœ¨Actoræ¨¡å‹ä¸­çš„åº”ç”¨
- [é€šé“æ¨¡å¼](../04_concurrent_patterns/02_channel_pattern.md) - é€šé“ä¸­ä¼ é€’çš„å¯¹è±¡åŸå‹
- [Futureæ¨¡å¼](../04_concurrent_patterns/03_future_pattern.md) - å¼‚æ­¥è®¡ç®—ç»“æœçš„å…‹éš†

### å·¥ç¨‹å®è·µå…³è”

- [å¯¹è±¡æ± æ€§èƒ½ä¼˜åŒ–](../../04_engineering_practices/01_performance_optimization/03_object_pool_patterns.md) - å¯¹è±¡æ± ä¸åŸå‹æ¨¡å¼ç»“åˆ
- [åŸå‹æµ‹è¯•ç­–ç•¥](../../04_engineering_practices/03_testing_strategies/02_prototype_testing.md) - æµ‹è¯•å¯¹è±¡çš„åŸå‹åˆ›å»º

---

## 11. è§„èŒƒåŒ–è¿›åº¦ä¸åç»­å»ºè®®

- [x] ç»“æ„åŒ–åˆ†å±‚ä¸ä¸¥æ ¼ç¼–å·
- [x] å½¢å¼åŒ–å®šä¹‰ä¸å¤šæ¨¡æ€è¡¨è¾¾ï¼ˆMermaidã€è¡¨æ ¼ã€å…¬å¼ã€ä»£ç ã€è¯æ˜ç­‰ï¼‰
- [x] æ‰¹åˆ¤æ€§åˆ†æä¸ç†è®ºè”ç³»
- [x] äº¤å‰å¼•ç”¨å¢å¼º
- [x] æ–‡æœ«è¿›åº¦ä¸å»ºè®®åŒºå—

**åç»­å»ºè®®**ï¼š

1. å¯è¡¥å……æ›´å¤šå®é™…å·¥ç¨‹æ¡ˆä¾‹ï¼ˆå¦‚æ·±æ‹·è´å¯¹è±¡æ± ã€åŸå‹æ³¨å†Œè¡¨ç­‰ï¼‰
2. å¢åŠ ä¸å…¶ä»–è®¾è®¡æ¨¡å¼çš„å¯¹æ¯”åˆ†æè¡¨æ ¼
3. æ·±åŒ–èŒƒç•´è®ºä¸ç±»å‹ç³»ç»Ÿçš„äº¤å‰ç†è®ºæ¢è®¨
4. æŒç»­å®Œå–„å¤šæ¨¡æ€è¡¨è¾¾ä¸å¯è§†åŒ–
