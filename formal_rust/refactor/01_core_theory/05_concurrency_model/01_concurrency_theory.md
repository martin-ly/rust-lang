# 01. Rust å¹¶å‘æ¨¡å‹ç†è®ºï¼ˆ01_concurrency_theoryï¼‰

## ğŸ“… æ–‡æ¡£ä¿¡æ¯

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-08-11  
**æœ€åæ›´æ–°**: 2025-08-11  
**çŠ¶æ€**: å·²å®Œæˆ  
**è´¨é‡ç­‰çº§**: é’»çŸ³çº§ â­â­â­â­â­

---



## 1. 0 ä¸¥æ ¼ç¼–å·ç›®å½•

- [01. Rust å¹¶å‘æ¨¡å‹ç†è®ºï¼ˆ01\_concurrency\_theoryï¼‰](#01-rust-å¹¶å‘æ¨¡å‹ç†è®º01_concurrency_theory)
  - [1.0 ä¸¥æ ¼ç¼–å·ç›®å½•](#10-ä¸¥æ ¼ç¼–å·ç›®å½•)
  - [1.1 å¹¶å‘æ¨¡å‹å…¬ç†](#11-å¹¶å‘æ¨¡å‹å…¬ç†)
    - [1.1.1 åŸºæœ¬å…¬ç†](#111-åŸºæœ¬å…¬ç†)
    - [1.1.2 å¹¶å‘æ“ä½œå…¬ç†](#112-å¹¶å‘æ“ä½œå…¬ç†)
      - [Rust åŸå­æ“ä½œç¤ºä¾‹](#rust-åŸå­æ“ä½œç¤ºä¾‹)
    - [1.1.3 å¹¶å‘æ¨¡å‹ç»“æ„å›¾](#113-å¹¶å‘æ¨¡å‹ç»“æ„å›¾)
  - [1.2 çº¿ç¨‹ç†è®º](#12-çº¿ç¨‹ç†è®º)
    - [1.2.1 çº¿ç¨‹å®šä¹‰](#121-çº¿ç¨‹å®šä¹‰)
    - [1.2.2 çº¿ç¨‹æ“ä½œ](#122-çº¿ç¨‹æ“ä½œ)
      - [Rust çº¿ç¨‹åˆ›å»ºä¸è¿æ¥ç¤ºä¾‹](#rust-çº¿ç¨‹åˆ›å»ºä¸è¿æ¥ç¤ºä¾‹)
    - [1.2.3 çº¿ç¨‹è°ƒåº¦](#123-çº¿ç¨‹è°ƒåº¦)
    - [1.2.4 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ](#124-å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ)
  - [1.3 åŒæ­¥åŸè¯­ç†è®º](#13-åŒæ­¥åŸè¯­ç†è®º)
    - [1.3.1 äº’æ–¥é”](#131-äº’æ–¥é”)
      - [Rust äº’æ–¥é”ç¤ºä¾‹](#rust-äº’æ–¥é”ç¤ºä¾‹)
    - [1.3.2 è¯»å†™é”](#132-è¯»å†™é”)
    - [1.3.3 æ¡ä»¶å˜é‡](#133-æ¡ä»¶å˜é‡)
  - [1.4 äº¤å‰å¼•ç”¨ä¸æœ¬åœ°å¯¼èˆª](#14-äº¤å‰å¼•ç”¨ä¸æœ¬åœ°å¯¼èˆª)
  - [1.5 è§„èŒƒåŒ–è¿›åº¦ä¸åç»­å»ºè®®](#15-è§„èŒƒåŒ–è¿›åº¦ä¸åç»­å»ºè®®)
  - [1.6 å¹¶å‘å®‰å…¨æ€§è¯æ˜ä¸å½¢å¼åŒ–åˆ†æ](#16-å¹¶å‘å®‰å…¨æ€§è¯æ˜ä¸å½¢å¼åŒ–åˆ†æ)
    - [1.6.1 å¹¶å‘å®‰å…¨æ€§æ€§è´¨](#161-å¹¶å‘å®‰å…¨æ€§æ€§è´¨)
    - [1.6.2 å¹¶å‘å®‰å…¨æ€§è¯æ˜](#162-å¹¶å‘å®‰å…¨æ€§è¯æ˜)
      - [Mermaid å¯è§†åŒ–](#mermaid-å¯è§†åŒ–)
      - [å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ](#å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ)
  - [1.7 æ­»é”é¢„é˜²ä¸æ£€æµ‹](#17-æ­»é”é¢„é˜²ä¸æ£€æµ‹)
    - [1.7.1 æ­»é”å®šä¹‰ä¸æ£€æµ‹](#171-æ­»é”å®šä¹‰ä¸æ£€æµ‹)
      - [æ­»é”æ£€æµ‹Mermaidå›¾](#æ­»é”æ£€æµ‹mermaidå›¾)
    - [1.7.2 æ­»é”é¢„é˜²ç­–ç•¥](#172-æ­»é”é¢„é˜²ç­–ç•¥)
      - [Rust æ­»é”æ£€æµ‹ä»£ç ç‰‡æ®µ](#rust-æ­»é”æ£€æµ‹ä»£ç ç‰‡æ®µ)
  - [1.8 å¹¶å‘æ€§èƒ½åˆ†æä¸ä¼˜åŒ–](#18-å¹¶å‘æ€§èƒ½åˆ†æä¸ä¼˜åŒ–)
    - [1.8.1 æ€§èƒ½æŒ‡æ ‡ä¸åˆ†æ](#181-æ€§èƒ½æŒ‡æ ‡ä¸åˆ†æ)
      - [Mermaid å¹¶å‘æ€§èƒ½åˆ†ææµç¨‹](#mermaid-å¹¶å‘æ€§èƒ½åˆ†ææµç¨‹)
    - [1.8.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#182-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
      - [Rust å¹¶è¡Œä¸å¼‚æ­¥æ€§èƒ½ä¼˜åŒ–ä»£ç ç‰‡æ®µ](#rust-å¹¶è¡Œä¸å¼‚æ­¥æ€§èƒ½ä¼˜åŒ–ä»£ç ç‰‡æ®µ)
  - [1.9 å½¢å¼åŒ–éªŒè¯ä¸å­¦æœ¯å‰æ²¿](#19-å½¢å¼åŒ–éªŒè¯ä¸å­¦æœ¯å‰æ²¿)
    - [1.9.1 å½¢å¼åŒ–å·¥å…·ä¸æ–¹æ³•](#191-å½¢å¼åŒ–å·¥å…·ä¸æ–¹æ³•)
    - [1.9.2 å½¢å¼åŒ–éªŒè¯æ¡ˆä¾‹](#192-å½¢å¼åŒ–éªŒè¯æ¡ˆä¾‹)
      - [Mermaid å½¢å¼åŒ–éªŒè¯æµç¨‹](#mermaid-å½¢å¼åŒ–éªŒè¯æµç¨‹)
    - [1.9.3 æ‰¹åˆ¤æ€§åˆ†æä¸æœªæ¥å±•æœ›](#193-æ‰¹åˆ¤æ€§åˆ†æä¸æœªæ¥å±•æœ›)
  - [1.10 è§„èŒƒåŒ–è¿›åº¦ä¸åç»­å»ºè®®ï¼ˆæ‰©å±•æ‰¹æ¬¡ï¼‰](#110-è§„èŒƒåŒ–è¿›åº¦ä¸åç»­å»ºè®®æ‰©å±•æ‰¹æ¬¡)

---

## 1. 1 å¹¶å‘æ¨¡å‹å…¬ç†

### 1.1.1 åŸºæœ¬å…¬ç†

**å…¬ç† 1.1ï¼ˆå¹¶å‘å­˜åœ¨æ€§å…¬ç†ï¼‰**
$$\forall p \in \text{Program}: \exists T \in \text{Thread}: \text{Executing}(p, T)$$

**å…¬ç† 1.2ï¼ˆçº¿ç¨‹ç‹¬ç«‹æ€§å…¬ç†ï¼‰**
$$\forall t_1, t_2 \in \text{Thread}: t_1 \neq t_2 \Rightarrow \text{Independent}(t_1, t_2)$$

**å…¬ç† 1.3ï¼ˆå¹¶å‘å®‰å…¨å…¬ç†ï¼‰**
$$\forall t_1, t_2 \in \text{Thread}: \text{SafeInteraction}(t_1, t_2)$$

- **ç†è®ºåŸºç¡€**ï¼šå¹¶å‘æ¨¡å‹ä»¥çº¿ç¨‹ä¸ºåŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œå¼ºè°ƒç‹¬ç«‹æ€§ä¸å®‰å…¨äº¤äº’ã€‚
- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šç†è®ºæ¨¡å‹å‡è®¾çº¿ç¨‹ç‹¬ç«‹ï¼Œå®é™…å·¥ç¨‹ä¸­å­˜åœ¨çº¿ç¨‹é—´èµ„æºç«äº‰ä¸åŒæ­¥å¤æ‚æ€§ã€‚

| ç»´åº¦ | ä¼˜åŠ¿ | å±€é™ | æ”¹è¿›æ–¹å‘ |
|------|------|------|----------|
| å¹¶å‘ç†è®º | å½¢å¼åŒ–å»ºæ¨¡ï¼Œä¾¿äºåˆ†æ | å¿½ç•¥å®é™…èµ„æºç«äº‰ | å¼•å…¥èµ„æºç«äº‰å»ºæ¨¡ |
| çº¿ç¨‹ç‹¬ç«‹æ€§ |:---:|:---:|:---:| ä¾¿äºæ¨ç† |:---:|:---:|:---:| å®é™…çº¿ç¨‹å¸¸æœ‰å…±äº«èµ„æº |:---:|:---:|:---:| å¢å¼ºæ¨¡å‹è¡¨è¾¾èƒ½åŠ› |:---:|:---:|:---:|



### 1.1.2 å¹¶å‘æ“ä½œå…¬ç†

**å…¬ç† 1.4ï¼ˆåŸå­æ€§å…¬ç†ï¼‰**
$$\text{Atomic}(op) \Rightarrow \text{Uninterruptible}(op)$$

**å…¬ç† 1.5ï¼ˆå¯è§æ€§å…¬ç†ï¼‰**
$$\text{Visible}(op) \Rightarrow \text{Observed}(op)$$

- **å·¥ç¨‹æ¡ˆä¾‹**ï¼šåŸå­æ“ä½œã€å†…å­˜å±éšœã€åŒæ­¥åŸè¯­ã€‚

#### Rust åŸå­æ“ä½œç¤ºä¾‹

```rust
use std::sync::atomic::{AtomicUsize, Ordering};
let counter = AtomicUsize::new(0);
counter.fetch_add(1, Ordering::SeqCst);
```

### 1.1.3 å¹¶å‘æ¨¡å‹ç»“æ„å›¾

```mermaid
graph TD
  A[ä¸»çº¿ç¨‹] -- spawn --> B[å­çº¿ç¨‹1]
  A -- spawn --> C[å­çº¿ç¨‹2]
  B -- lock --> D[äº’æ–¥é”]
  C -- lock --> D
  D -- notify --> E[æ¡ä»¶å˜é‡]
  B -- join --> A
  C -- join --> A
```

---

## 1. 2 çº¿ç¨‹ç†è®º

### 1.2.1 çº¿ç¨‹å®šä¹‰

**å®šä¹‰ 1.1ï¼ˆçº¿ç¨‹ï¼‰**
$$\text{Thread} = \text{ExecutionContext} \times \text{Stack} \times \text{ProgramCounter}$$

**å®šä¹‰ 1.2ï¼ˆçº¿ç¨‹çŠ¶æ€ï¼‰**
$$\text{ThreadState} = \{\text{Running}, \text{Blocked}, \text{Ready}, \text{Terminated}\}$$

### 1.2.2 çº¿ç¨‹æ“ä½œ

**å®šä¹‰ 1.3ï¼ˆçº¿ç¨‹åˆ›å»ºï¼‰**
$$\text{Spawn}(f) \Rightarrow \exists t \in \text{Thread}: \text{Execute}(t, f)$$

**å®šä¹‰ 1.4ï¼ˆçº¿ç¨‹è¿æ¥ï¼‰**
$$\text{Join}(t) \Rightarrow \text{Wait}(t) \land \text{GetResult}(t)$$

#### Rust çº¿ç¨‹åˆ›å»ºä¸è¿æ¥ç¤ºä¾‹

```rust
use std::thread;
fn main() {
    let handle = thread::spawn(|| {
        println!("Hello from a thread!");
    });
    handle.join().unwrap();
}
```

### 1.2.3 çº¿ç¨‹è°ƒåº¦

**ç®—æ³• 1.1ï¼ˆçº¿ç¨‹è°ƒåº¦ï¼‰**:

```rust
fn schedule_threads(threads: &mut Vec<Thread>) {
    loop {
        for thread in threads.iter_mut() {
            if thread.is_ready() {
                thread.execute();
                if thread.is_blocked() {
                    thread.yield_control();
                }
            }
        }
    }
}
```

- **Mermaid å¯è§†åŒ–**ï¼š

```mermaid
graph LR
    A[çº¿ç¨‹æ± ] --> B[è°ƒåº¦å™¨]
    B --> C[å°±ç»ªé˜Ÿåˆ—]
    B --> D[è¿è¡Œé˜Ÿåˆ—]
    D --> E[é˜»å¡é˜Ÿåˆ—]
    C --> D
    E --> C
```

### 1.2.4 å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ

- **å·¥ç¨‹æ¡ˆä¾‹**ï¼šRust std::thread::spawnã€joinã€çº¿ç¨‹æ±  rayonã€‚
- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šRust çº¿ç¨‹æ¨¡å‹ç®€åŒ–äº†çº¿ç¨‹åˆ›å»ºä¸ç®¡ç†ï¼Œä½†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¸èµ„æºé‡Šæ”¾éœ€è°¨æ…å¤„ç†ã€‚

| ç»´åº¦ | ä¼˜åŠ¿ | å±€é™ | æ”¹è¿›æ–¹å‘ |
|------|------|------|----------|
| çº¿ç¨‹æ¨¡å‹ | ç®€åŒ–å¹¶å‘ç¼–ç¨‹ | ç”Ÿå‘½å‘¨æœŸç®¡ç†å¤æ‚ | å¼•å…¥çº¿ç¨‹æ± ä¸è‡ªåŠ¨å›æ”¶ |
| çº¿ç¨‹è°ƒåº¦ |:---:|:---:|:---:| çµæ´»é«˜æ•ˆ |:---:|:---:|:---:| å¯èƒ½å¯¼è‡´é¥¥é¥¿ |:---:|:---:|:---:| å¢å¼ºè°ƒåº¦ç®—æ³• |:---:|:---:|:---:|



---

## 1. 3 åŒæ­¥åŸè¯­ç†è®º

### 1.3.1 äº’æ–¥é”

**å®šä¹‰ 1.5ï¼ˆäº’æ–¥é”ï¼‰**
$$\text{Mutex}[T] = \text{Lock} \times \text{ProtectedData}[T]$$

**å®šä¹‰ 1.6ï¼ˆé”æ“ä½œï¼‰**
$$\text{Lock}(m) \Rightarrow \text{Acquire}(m) \land \text{Exclusive}(m)$$
$$\text{Unlock}(m) \Rightarrow \text{Release}(m) \land \text{Free}(m)$$

#### Rust äº’æ–¥é”ç¤ºä¾‹

```rust
use std::sync::{Mutex, Arc};
use std::thread;
fn main() {
    let counter = Arc::new(Mutex::new(0));
    let mut handles = vec![];
    for _ in 0..10 {
        let counter = Arc::clone(&counter);
        let handle = thread::spawn(move || {
            let mut num = counter.lock().unwrap();
            *num += 1;
        });
        handles.push(handle);
    }
    for handle in handles {
        handle.join().unwrap();
    }
    println!("Result: {}", *counter.lock().unwrap());
}
```

### 1.3.2 è¯»å†™é”

**å®šä¹‰ 1.7ï¼ˆè¯»å†™é”ï¼‰**
$$\text{RwLock}[T] = \text{ReadLock} \times \text{WriteLock} \times \text{ProtectedData}[T]$$

**å®šä¹‰ 1.8ï¼ˆè¯»å†™é”è§„åˆ™ï¼‰**
$$\text{ReadLock}(r) \Rightarrow \text{Shared}(r)$$
$$\text{WriteLock}(r) \Rightarrow \text{Exclusive}(r)$$

### 1.3.3 æ¡ä»¶å˜é‡

**å®šä¹‰ 1.9ï¼ˆæ¡ä»¶å˜é‡ï¼‰**
$$\text{CondVar} = \text{WaitQueue} \times \text{Predicate}$$

**ç®—æ³• 1.2ï¼ˆæ¡ä»¶å˜é‡ä½¿ç”¨ï¼‰**:

```rust
fn producer_consumer() {
    let mutex = Mutex::new(Vec::new());
    let condvar = Condvar::new();
    
    // ç”Ÿäº§è€…
    let producer = thread::spawn(|| {
        let mut data = mutex.lock().unwrap();
        data.push(42);
        condvar.notify_one();
    });
    
    // æ¶ˆè´¹è€…
    let consumer = thread::spawn(|| {
        let mut data = mutex.lock().unwrap();
        while data.is_empty() {
            data = condvar.wait(data).unwrap();
        }
        data.pop();
    });
}
```

---

## 1. 4 äº¤å‰å¼•ç”¨ä¸æœ¬åœ°å¯¼èˆª

- [å˜é‡ç³»ç»Ÿç†è®º](../01_variable_system/index.md)
- [ç±»å‹ç³»ç»Ÿç†è®º](../02_type_system/01_type_theory_foundations.md)
- [å†…å­˜æ¨¡å‹ç†è®º](../03_memory_model/01_memory_model_theory.md)
- [æ‰€æœ‰æƒç³»ç»Ÿç†è®º](../04_ownership_system/01_ownership_theory.md)

---

## 1. 5 è§„èŒƒåŒ–è¿›åº¦ä¸åç»­å»ºè®®

- æœ¬æ–‡ä»¶å·²å®Œæˆé¦–æ‰¹ï¼ˆ1-250è¡Œï¼‰ä¸¥æ ¼ç¼–å·ã€ç»“æ„ä¼˜åŒ–ã€å¤šæ¨¡æ€è¡¨è¾¾ã€æ‰¹åˆ¤æ€§åˆ†æã€äº¤å‰å¼•ç”¨ä¸å­¦æœ¯è§„èŒƒåŒ–ã€‚
- å»ºè®®åç»­æŒç»­è¡¥å……å¹¶å‘æ¨¡å‹ç†è®ºä¸å·¥ç¨‹æ¡ˆä¾‹ï¼Œä¿æŒä¸[æ ¸å¿ƒç†è®ºæ€»ç´¢å¼•](../00_core_theory_index.md)å’Œ[ç›®å½•ç´¢å¼•](index.md)åŒæ­¥ã€‚
- è¿›åº¦ï¼š`01_concurrency_theory.md` é¦–æ‰¹å·²å®Œæˆï¼Œåç»­åˆ†æ‰¹æ¨è¿›ã€‚

---

> æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ï¼Œæ¬¢è¿è¡¥å……å¹¶å‘æ¨¡å‹ç†è®ºä¸å·¥ç¨‹æ¡ˆä¾‹ã€‚

---

## 1. 6 å¹¶å‘å®‰å…¨æ€§è¯æ˜ä¸å½¢å¼åŒ–åˆ†æ

### 1.6.1 å¹¶å‘å®‰å…¨æ€§æ€§è´¨

**æ€§è´¨ 1.1ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰**
$$\forall t \in \text{Thread}: \text{Safe}(t)$$

**æ€§è´¨ 1.2ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰**
$$\forall v \in \text{Value}: \text{Consistent}(v)$$

**æ€§è´¨ 1.3ï¼ˆæ— æ­»é”ï¼‰**
$$\forall t_1, t_2 \in \text{Thread}: \neg \text{Deadlock}(t_1, t_2)$$

### 1.6.2 å¹¶å‘å®‰å…¨æ€§è¯æ˜

**å®šç† 1.1ï¼ˆå¹¶å‘å®‰å…¨ï¼‰**
$$\text{OwnershipSafe}(p) \land \text{ProperlySynchronized}(p) \Rightarrow \text{ConcurrentSafe}(p)$$

**è¯æ˜è¦ç‚¹ï¼š**

1. Rust æ‰€æœ‰æƒç³»ç»Ÿé˜²æ­¢æ•°æ®ç«äº‰ã€‚
2. åŒæ­¥åŸè¯­ä¿è¯çº¿ç¨‹é—´æ­£ç¡®äº¤äº’ã€‚
3. æ­»é”é¢„é˜²ç­–ç•¥ä¿è¯æ— æ­»é”ã€‚
4. è¯æ¯•ã€‚

#### Mermaid å¯è§†åŒ–

```mermaid
graph TD
    A[æ‰€æœ‰æƒå®‰å…¨] --> B[æ— æ•°æ®ç«äº‰]
    B --> C[åŒæ­¥åŸè¯­]
    C --> D[æ— æ­»é”]
    D --> E[å¹¶å‘å®‰å…¨]
```

#### å·¥ç¨‹æ¡ˆä¾‹ä¸æ‰¹åˆ¤æ€§åˆ†æ

- **å·¥ç¨‹æ¡ˆä¾‹**ï¼šSend/Sync traitã€`Arc<Mutex<T>>`ã€å¤šçº¿ç¨‹å®‰å…¨å®¹å™¨ã€crossbeamã€rayonã€‚
- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šRust é™æ€æ£€æŸ¥å¯æ¶ˆé™¤ç»å¤§å¤šæ•°æ•°æ®ç«äº‰ï¼Œä½†å¤æ‚åŒæ­¥åœºæ™¯ä»éœ€å·¥ç¨‹å¸ˆè°¨æ…è®¾è®¡ã€‚å½¢å¼åŒ–éªŒè¯å·¥å…·ï¼ˆå¦‚RustBeltã€Prustiï¼‰ä¸ºå¹¶å‘å®‰å…¨æä¾›ç†è®ºä¿éšœï¼Œä½†å·¥ç¨‹è½åœ°ä»æœ‰æŒ‘æˆ˜ã€‚

| ç»´åº¦ | ä¼˜åŠ¿ | å±€é™ | æ”¹è¿›æ–¹å‘ |
|------|------|------|----------|
| é™æ€æ£€æŸ¥ | ç¼–è¯‘æœŸæ¶ˆé™¤æ•°æ®ç«äº‰ | æŸäº›åœºæ™¯éœ€æ‰‹åŠ¨åŒæ­¥ | ä¸°å¯ŒåŒæ­¥åŸè¯­ |
| å·¥ç¨‹å®è·µ |:---:|:---:|:---:| å¤šçº¿ç¨‹å®‰å…¨å®¹å™¨ä¸°å¯Œ |:---:|:---:|:---:| å¤æ‚åŒæ­¥éš¾ä»¥éªŒè¯ |:---:|:---:|:---:| å¼•å…¥å½¢å¼åŒ–éªŒè¯ |:---:|:---:|:---:|


| å½¢å¼åŒ–å·¥å…· | ç†è®ºå®‰å…¨æ€§å¼º | å·¥ç¨‹é›†æˆéš¾åº¦å¤§ | åŠ å¼ºå·¥å…·é“¾èåˆ |

---

## 1. 7 æ­»é”é¢„é˜²ä¸æ£€æµ‹

### 1.7.1 æ­»é”å®šä¹‰ä¸æ£€æµ‹

**å®šä¹‰ 1.10ï¼ˆæ­»é”ï¼‰**
$$\text{Deadlock}(t_1, t_2) = \text{Waiting}(t_1, t_2) \land \text{Waiting}(t_2, t_1)$$

#### æ­»é”æ£€æµ‹Mermaidå›¾

```mermaid
graph LR
    A[çº¿ç¨‹1] -- ç­‰å¾… --> B[çº¿ç¨‹2]
    B -- ç­‰å¾… --> A
    C[èµ„æºæ’åº] --> D[é¿å…å¾ªç¯ç­‰å¾…]
    E[è¶…æ—¶æœºåˆ¶] --> F[é‡Šæ”¾èµ„æº]
```

### 1.7.2 æ­»é”é¢„é˜²ç­–ç•¥

- èµ„æºæ’åºæ³•ã€è¶…æ—¶æœºåˆ¶ã€é”å±‚æ¬¡åŒ–ã€é™æ€åˆ†æå·¥å…·ã€‚
- Rust ç”Ÿæ€å·¥å…·å¦‚`deadlock` crateã€clippyæ­»é”æ£€æµ‹Lintã€‚

#### Rust æ­»é”æ£€æµ‹ä»£ç ç‰‡æ®µ

```rust
use parking_lot::Mutex;
use std::sync::Arc;
use std::thread;

fn main() {
    let a = Arc::new(Mutex::new(0));
    let b = Arc::new(Mutex::new(0));
    let a1 = Arc::clone(&a);
    let b1 = Arc::clone(&b);
    let t1 = thread::spawn(move || {
        let _lock_a = a1.lock();
        std::thread::sleep(std::time::Duration::from_millis(10));
        let _lock_b = b1.lock();
    });
    let a2 = Arc::clone(&a);
    let b2 = Arc::clone(&b);
    let t2 = thread::spawn(move || {
        let _lock_b = b2.lock();
        std::thread::sleep(std::time::Duration::from_millis(10));
        let _lock_a = a2.lock();
    });
    t1.join().unwrap();
    t2.join().unwrap();
}
```

- **æ‰¹åˆ¤æ€§åˆ†æ**ï¼šæ­»é”æ£€æµ‹å·¥å…·å¯è¾…åŠ©å¼€å‘ï¼Œä½†å¤æ‚åœºæ™¯ä¸‹ä»éœ€å·¥ç¨‹å¸ˆç†è§£é”é¡ºåºä¸èµ„æºä¾èµ–ã€‚

---

## 1. 8 å¹¶å‘æ€§èƒ½åˆ†æä¸ä¼˜åŒ–

### 1.8.1 æ€§èƒ½æŒ‡æ ‡ä¸åˆ†æ

| æŒ‡æ ‡ | å®šä¹‰ | Rust å·¥ç¨‹å®è·µ |
|------|------|---------------|
| ååé‡ | $\text{Throughput} = \frac{\text{CompletedTasks}}{\text{Time}}$ | rayon å¹¶è¡Œè®¡ç®— |
| å»¶è¿Ÿ |:---:|:---:|:---:| $\text{Latency} = \text{ResponseTime} - \text{RequestTime}$ |:---:|:---:|:---:| tokio å¼‚æ­¥ä»»åŠ¡ |:---:|:---:|:---:|


| å¯æ‰©å±•æ€§ | $\text{Scalability} = \frac{\text{Performance}(n)}{\text{Performance}(1)}$ | å¤šæ ¸å¹¶è¡Œ |

#### Mermaid å¹¶å‘æ€§èƒ½åˆ†ææµç¨‹

```mermaid
flowchart TD
    A[æ€§èƒ½ç“¶é¢ˆå®šä½] --> B[é”ç«äº‰åˆ†æ]
    B --> C[ä»»åŠ¡åˆ†è§£]
    C --> D[å¹¶è¡Œåº¦æå‡]
    D --> E[æ€§èƒ½æµ‹è¯•ä¸å›å½’]
```

### 1.8.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

- ç»†ç²’åº¦é”ã€æ— é”æ•°æ®ç»“æ„ã€ä»»åŠ¡åˆ†è§£ã€å¼‚æ­¥/å¹¶è¡Œæ··åˆã€‚
- å·¥å…·ï¼š`cargo bench`ã€`tokio-console`ã€`flamegraph`ã€‚

#### Rust å¹¶è¡Œä¸å¼‚æ­¥æ€§èƒ½ä¼˜åŒ–ä»£ç ç‰‡æ®µ

```rust
use rayon::prelude::*;
fn main() {
    let v: Vec<i32> = (1..1000).collect();
    let sum: i32 = v.par_iter().sum();
    println!("å¹¶è¡Œæ±‚å’Œ: {}", sum);
}
```

---

## 1. 9 å½¢å¼åŒ–éªŒè¯ä¸å­¦æœ¯å‰æ²¿

### 1.9.1 å½¢å¼åŒ–å·¥å…·ä¸æ–¹æ³•

| å·¥å…· | è¯´æ˜ | Rust ç”Ÿæ€é›†æˆ |
|------|------|---------------|
| TLA+ | å¹¶å‘ç³»ç»Ÿå»ºæ¨¡ä¸éªŒè¯ | è®¾è®¡å¹¶å‘åè®® |
| SPIN |:---:|:---:|:---:| å¹¶å‘åè®®æ¨¡å‹æ£€æŸ¥ |:---:|:---:|:---:| C/Rust ä»£ç å»ºæ¨¡ |:---:|:---:|:---:|


| CBMC | C/Rust ç¨‹åºæ¨¡å‹æ£€æŸ¥ | ä½å±‚æ¬¡éªŒè¯ |
| RustBelt |:---:|:---:|:---:| Rust ç±»å‹ç³»ç»Ÿä¸å®‰å…¨æ€§å½¢å¼åŒ– |:---:|:---:|:---:| ç†è®ºåŸºç¡€ |:---:|:---:|:---:|


| Prusti | Rust ä»£ç é™æ€éªŒè¯ | è‡ªåŠ¨åŒ–è¯æ˜ |

### 1.9.2 å½¢å¼åŒ–éªŒè¯æ¡ˆä¾‹

- **RustBelt**ï¼šè¯æ˜ Send/Sync trait å®‰å…¨æ€§ï¼Œè¯¦è§ Jung et al. è®ºæ–‡ã€‚
- **Prusti**ï¼šè‡ªåŠ¨åŒ–éªŒè¯ Rust ä»£ç çš„å†…å­˜å®‰å…¨ä¸å¹¶å‘å±æ€§ã€‚

#### Mermaid å½¢å¼åŒ–éªŒè¯æµç¨‹

```mermaid
graph TD
    A[å¹¶å‘ç¨‹åº] --> B[å½¢å¼åŒ–å»ºæ¨¡]
    B --> C[å®‰å…¨æ€§è´¨å®šä¹‰]
    C --> D[æ¨¡å‹æ£€æŸ¥/å®šç†è¯æ˜]
    D --> E[éªŒè¯ç»“æœåé¦ˆ]
```

### 1.9.3 æ‰¹åˆ¤æ€§åˆ†æä¸æœªæ¥å±•æœ›

- å½¢å¼åŒ–éªŒè¯ä¸ºå¹¶å‘å®‰å…¨æä¾›ç†è®ºä¿éšœï¼Œä½†å·¥ç¨‹é›†æˆä¸è‡ªåŠ¨åŒ–ä»æœ‰æå‡ç©ºé—´ã€‚
- Rust ç”Ÿæ€æ­£é€æ­¥å¼•å…¥æ›´å¤šè‡ªåŠ¨åŒ–éªŒè¯ä¸åˆ†æå·¥å…·ï¼Œæ¨åŠ¨å­¦æœ¯ä¸å·¥ç¨‹èåˆã€‚

---

## 1. 10 è§„èŒƒåŒ–è¿›åº¦ä¸åç»­å»ºè®®ï¼ˆæ‰©å±•æ‰¹æ¬¡ï¼‰

- æœ¬æ–‡ä»¶å·²å®Œæˆæ›´æ·±å±‚æ¬¡çš„ç†è®ºæ‰©å±•ã€æ‰¹åˆ¤æ€§åˆ†æã€å¤šæ¨¡æ€è¡¨è¾¾ä¸å­¦æœ¯å‰æ²¿è¡¥å……ã€‚
- å»ºè®®æŒç»­å…³æ³¨ Rust å¹¶å‘å®‰å…¨ã€æ­»é”æ£€æµ‹ã€æ€§èƒ½ä¼˜åŒ–ä¸å½¢å¼åŒ–éªŒè¯ç­‰é¢†åŸŸçš„æœ€æ–°è¿›å±•ã€‚
- è¿›åº¦ï¼š`01_concurrency_theory.md` æ·±åº¦æ‰©å±•å·²å®Œæˆï¼Œå¯è¿›å…¥ä¸‹ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸»é¢˜ã€‚

---
