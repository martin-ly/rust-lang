# Rust 类型系统分类关系思维导图

```text
Rust 类型系统
├── 基本类型结构
│   ├── 原始类型
│   │   ├── 整数类型 (i8, i16, i32, i64, i128, isize)
│   │   ├── 无符号整数 (u8, u16, u32, u64, u128, usize)
│   │   ├── 浮点类型 (f32, f64)
│   │   ├── 布尔类型 (bool)
│   │   ├── 字符类型 (char)
│   │   └── 单元类型 (())
│   │
│   ├── 复合类型
│   │   ├── 结构体 (struct) ─── 积类型 (Product Type)
│   │   ├── 元组 (tuple) ────── 积类型 (Product Type)
│   │   ├── 枚举 (enum) ─────── 和类型 (Sum Type)
│   │   ├── 数组 ([T; N]) ───── 同质固定长度集合
│   │   └── 切片 (&[T]) ─────── 同质可变长度借用
│   │
│   └── 指针类型
│       ├── 借用 (&T, &mut T)
│       ├── 原始指针 (*const T, *mut T)
│       ├── 函数指针 (fn(T) -> U)
│       └── 智能指针 (Box<T>, Rc<T>, Arc<T>)
│
├── 类型参数化
│   ├── 泛型
│   │   ├── 泛型函数 (fn foo<T>(x: T))
│   │   ├── 泛型结构体 (struct Foo<T>)
│   │   ├── 泛型枚举 (enum Option<T>)
│   │   ├── 泛型方法 (impl<T> Foo<T>)
│   │   └── 泛型特质 (trait Bar<T>)
│   │
│   ├── 关联类型
│   │   └── 特质中的关联类型 (trait Iterator { type Item; })
│   │
│   └── 常量泛型
│       └── 值级别的类型参数 (struct Array<T, const N: usize>)
│
├── 类型约束系统
│   ├── 特质系统
│   │   ├── 特质定义 (trait Foo { ... })
│   │   ├── 特质实现 (impl Trait for Type)
│   │   ├── 泛型约束 (T: Trait)
│   │   ├── 特质对象 (dyn Trait)
│   │   └── 标记特质 (Send, Sync, Sized, etc.)
│   │
│   ├── 生命周期系统
│   │   ├── 生命周期标注 ('a, 'static)
│   │   ├── 生命周期参数 (fn foo<'a>(x: &'a T))
│   │   ├── 生命周期约束 (T: 'a)
│   │   └── 生命周期省略规则
│   │
│   └── 类型边界
│       ├── 简单边界 (T: Display)
│       ├── 多重边界 (T: Clone + Debug)
│       ├── where 从句 (where T: Clone)
│       └── 关联类型边界 (T: Iterator<Item=u8>)
│
├── 资源管理系统
│   ├── 所有权系统
│   │   ├── 所有权 (ownership)
│   │   ├── 移动语义 (move semantics)
│   │   ├── 借用 (borrowing)
│   │   └── 借用 (references)
│   │
│   ├── 生命周期
│   │   ├── 静态生命周期 ('static)
│   │   ├── 动态生命周期 ('a)
│   │   └── 借用追踪
│   │
│   └── 内存管理
│       ├── 栈分配
│       ├── 堆分配 (Box<T>)
│       ├── 借用计数 (Rc<T>, Arc<T>)
│       └── 内部可变性 (Cell<T>, RefCell<T>)
│
├── 型变系统
│   ├── 协变 (Covariant)
│   │   ├── 不可变借用 (&T)
│   │   ├── Box<T>, Vec<T>
│   │   └── 函数返回值位置
│   │
│   ├── 逆变 (Contravariant)
│   │   ├── 函数参数位置
│   │   └── 函数类型的参数 (fn(T))
│   │
│   ├── 不变 (Invariant)
│   │   ├── 可变借用 (&mut T)
│   │   ├── Cell<T>, RefCell<T>
│   │   └── 原始指针 (*mut T)
│   │
│   └── 生命周期型变
│       ├── 生命周期协变 (&'a T 是 &'b T 的子类型，当 'b: 'a)
│       └── 型变相互影响
│
├── 类型系统理论基础
│   ├── 代数数据类型
│   │   ├── 积类型 (Product Types)
│   │   └── 和类型 (Sum Types)
│   │
│   ├── 多态性
│   │   ├── 参数多态 (泛型)
│   │   ├── 特设多态 (特质)
│   │   └── 子类型多态 (特质对象)
│   │
│   ├── 类型理论
│   │   ├── 仿射类型 (Affine Types)
│   │   ├── 线性类型 (Linear Types)
│   │   └── 依存类型 (生命周期为有限形式)
│   │
│   └── 范畴论对应
│       ├── 类型作为对象
│       ├── 函数作为态射
│       ├── 类型构造子作为函子
│       └── 特质作为自然变换
│
└── 实用类型模式
    ├── 容器类型
    │   ├── 顺序容器 (Vec<T>, VecDeque<T>)
    │   ├── 关联容器 (HashMap<K,V>, BTreeMap<K,V>)
    │   └── 智能指针容器 (Box<T>, Rc<T>, Arc<T>)
    │
    ├── 空安全类型
    │   ├── Option<T>
    │   └── 非空借用 (&T)
    │
    ├── 错误处理类型
    │   ├── Result<T,E>
    │   ├── Result<T,E>.?
    │   └── panic!/catch_unwind
    │
    ├── 并发类型
    │   ├── 线程安全类型 (Send, Sync)
    │   ├── 原子类型 (std::sync::atomic)
    │   ├── 互斥类型 (Mutex<T>, RwLock<T>)
    │   └── 异步类型 (Future<Output=T>)
    │
    └── 类型转换
        ├── 强制类型转换 (coercion)
        ├── 显式转换 (as, From/Into)
        ├── 转换特质 (From<T>, Into<T>, TryFrom<T>, TryInto<T>)
        └── 透明包装类型 (newtype pattern)
```

此思维导图综合了 Rust 类型系统的主要组成部分及其关系，涵盖了从基本类型结构到类型系统理论基础的各个方面。它展示了 Rust 如何将多种类型理论概念（如仿射类型、代数数据类型、多态性等）整合到一个统一的类型系统中，以及这些概念如何相互关联以提供内存安全和类型安全保证。

思维导图分为六大部分：基本类型结构、类型参数化、类型约束系统、资源管理系统、型变系统和类型系统理论基础，以及实用类型模式。这些部分共同构成了 Rust 强大而富有表现力的类型系统。
